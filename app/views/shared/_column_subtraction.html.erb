<style>
  /* Rendi le celle quadrate */
  [data-column-subtraction-target="input"],
  [data-column-subtraction-target="result"] {
    width: 4rem;
    height: 4rem;
  }

  /* Celle per i prestiti - più piccole */
  [data-column-subtraction-target="carry"] {
    width: 4rem;
    height: 2rem;
  }

  /* Placeholder più piccolo */
  [data-column-subtraction-target="input"]::placeholder,
  [data-column-subtraction-target="result"]::placeholder {
    font-size: 0.75rem;
    opacity: 0.3;
  }

  /* Barratura doppia diagonale per le cifre barrate (come una X) usando background-image */
  [data-column-subtraction-target="input"].line-through {
    background-image:
      linear-gradient(to bottom right, transparent calc(50% - 1px), #000000 calc(50% - 1px), #000000 calc(50% + 1px), transparent calc(50% + 1px)),
      linear-gradient(to bottom left, transparent calc(50% - 1px), #000000 calc(50% - 1px), #000000 calc(50% + 1px), transparent calc(50% + 1px));
    background-size: 50% 50%;
    background-position: center;
    background-repeat: no-repeat;
  }
</style>

<div class="text-center">
  <% if sottrazione.title.present? %>
    <div class="text-xl font-bold mb-4"><%= sottrazione.title %></div>
  <% end %>

  <div class="flex items-start justify-center gap-2">
    <div class="inline-block border-4 border-blue-400 rounded-lg bg-white" data-controller="column-subtraction">

      <!-- Header con le etichette delle colonne -->
      <div class="border-b-2 border-gray-300 flex">
        <div class="w-8"></div>
        <div style="<%= sottrazione.grid_style %>">
          <% sottrazione.column_labels.each_with_index do |label, idx| %>
            <div class="text-center <%= sottrazione.column_colors[idx] %> font-bold <%= 'border-r-2 border-gray-300' unless idx == sottrazione.column_labels.length - 1 %> py-2 text-sm">
              <%= label %>
            </div>
          <% end %>
        </div>
      </div>

      <!-- Riga dei prestiti -->
      <% if sottrazione.show_borrow %>
      <div class="border-b border-gray-200 flex">
        <div class="w-8"></div>
        <div style="<%= sottrazione.grid_style %>">
          <% sottrazione.borrows.each_with_index do |borrow, idx| %>
            <input type="text"
                   class="text-center text-sm font-bold <%= sottrazione.column_colors[idx] %> <%= idx == sottrazione.max_digits - 1 ? 'bg-white' : 'bg-blue-100' %> <%= 'border-r-2 border-gray-300' unless idx == sottrazione.max_digits - 1 %>"
                   data-column-subtraction-target="carry"
                   data-correct-answer="<%= borrow %>"
                   maxlength="1"
                   placeholder=""
                   <% if sottrazione.show_solution && borrow.present? %>value="<%= borrow %>"<% end %>
                   <% if idx == sottrazione.max_digits - 1 %>disabled<% end %>
                   style="height: 1.5rem;">
          <% end %>
        </div>
      </div>
      <% end %>

      <!-- Riga del minuendo -->
      <div class="border-b border-gray-200 flex" style="height: 4rem;">
        <div class="w-8 flex items-center justify-center"></div>
        <div style="<%= sottrazione.grid_style %>">
          <% sottrazione.minuend_digits.each_with_index do |digit, idx| %>
            <input type="text"
                   class="text-center text-2xl font-bold <%= 'border-r-2 border-gray-300' unless idx == sottrazione.minuend_digits.length - 1 %> <%= 'line-through' if sottrazione.crossed_out[idx] && sottrazione.show_solution %>"
                   data-column-subtraction-target="input"
                   data-correct-answer="<%= digit %>"
                   data-crossed-out="<%= sottrazione.crossed_out[idx] %>"
                   maxlength="1"
                   placeholder="."
                   <% if (sottrazione.show_minuend_subtrahend || sottrazione.show_solution) && digit.present? %>value="<%= digit %>"<% end %>>
          <% end %>
        </div>
      </div>

      <!-- Riga del sottraendo -->
      <div class="border-b border-gray-200 flex" style="height: 4rem;">
        <div class="w-8 flex items-center justify-center text-2xl font-bold text-blue-600">-</div>
        <div style="<%= sottrazione.grid_style %>">
          <% sottrazione.subtrahend_digits.each_with_index do |digit, idx| %>
            <input type="text"
                   class="text-center text-2xl font-bold <%= 'border-r-2 border-gray-300' unless idx == sottrazione.subtrahend_digits.length - 1 %>"
                   data-column-subtraction-target="input"
                   data-correct-answer="<%= digit %>"
                   maxlength="1"
                   placeholder="."
                   <% if (sottrazione.show_minuend_subtrahend || sottrazione.show_solution) && digit.present? %>value="<%= digit %>"<% end %>>
          <% end %>
        </div>
      </div>

      <!-- Riga del risultato -->
      <div class="border-t-4 border-gray-500 flex" style="height: 4rem;">
        <div class="w-8 flex items-center justify-center text-2xl font-bold text-blue-600">=</div>
        <div style="<%= sottrazione.grid_style %>">
          <% sottrazione.result_digits.each_with_index do |digit, idx| %>
            <input type="text"
                   class="text-center text-2xl font-bold <%= 'border-r-2 border-gray-300' unless idx == sottrazione.result_digits.length - 1 %>"
                   data-column-subtraction-target="result"
                   data-correct-answer="<%= digit %>"
                   maxlength="1"
                   placeholder="."
                   <% if sottrazione.show_solution && digit.present? %>value="<%= digit %>"<% end %>>
          <% end %>
        </div>
      </div>

    </div>
  </div>

  <!-- Toolbar con pulsanti -->
  <% if sottrazione.show_toolbar %>
  <div class="print-hidden flex justify-center gap-4 mt-6">
    <!-- Cancella -->
    <button type="button"
            data-action="click->column-subtraction#clearGrid"
            class="w-14 h-14 rounded-full bg-gray-500 hover:bg-gray-600 text-white shadow-lg hover:shadow-xl transition-all transform hover:scale-110 flex items-center justify-center"
            title="Cancella">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
      </svg>
    </button>

    <!-- Mostra Numeri -->
    <button type="button"
            data-action="click->column-subtraction#showNumbers"
            class="w-14 h-14 rounded-full bg-blue-500 hover:bg-blue-600 text-white shadow-lg hover:shadow-xl transition-all transform hover:scale-110 flex items-center justify-center"
            title="Mostra Numeri">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
      </svg>
    </button>

    <!-- Mostra Risultato -->
    <button type="button"
            data-action="click->column-subtraction#showResult"
            class="w-14 h-14 rounded-full bg-green-500 hover:bg-green-600 text-white shadow-lg hover:shadow-xl transition-all transform hover:scale-110 flex items-center justify-center"
            title="Mostra Risultato">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
      </svg>
    </button>

    <!-- Verifica -->
    <button type="button"
            data-action="click->column-subtraction#verifyAnswers"
            class="w-14 h-14 rounded-full bg-purple-500 hover:bg-purple-600 text-white shadow-lg hover:shadow-xl transition-all transform hover:scale-110 flex items-center justify-center"
            title="Verifica">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4" />
      </svg>
    </button>
  </div>
  <% end %>
</div>
