<aside id="sidebar-nav"
       class="print-hidden w-80 bg-white border-r border-gray-200 overflow-y-auto transition-all duration-300"
       data-sidebar-target="sidebar"
       data-controller="sidebar-nav"
       data-turbo-permanent>

  <!-- Header -->
  <div class="p-4 border-b border-gray-200">
    <h2 class="text-lg font-bold text-gray-800">Libri di Testo</h2>
  </div>

  <!-- Menu Content -->
  <nav class="p-4">
    <div class="space-y-1">
      <% Volume.all.includes(:corso, discipline: :pagine).each do |volume| %>
        <div class="volume-item">
          <!-- Volume -->
          <button class="w-full flex items-center gap-2 p-3 rounded-lg hover:bg-purple-50 transition text-left group"
                  data-action="click->sidebar-nav#toggle"
                  data-sidebar-item-id="volume-<%= volume.id %>">
            <svg class="toggle-icon w-4 h-4 text-gray-500 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
            </svg>
            <div class="flex-1">
              <div class="text-xs text-gray-500"><%= volume.corso.nome %></div>
              <div class="font-semibold text-gray-900"><%= volume.nome %></div>
              <% if volume.classe %>
                <div class="text-xs text-gray-500">Classe <%= volume.classe %></div>
              <% end %>
            </div>
          </button>

          <!-- Discipline (collassabile) -->
          <div class="sidebar-children ml-4 hidden" 
               data-sidebar-children-id="volume-<%= volume.id %>"
               style="max-height: 0; overflow: hidden; transition: max-height 0.3s ease;">
            <% volume.discipline.each do |disciplina| %>
              <div class="disciplina-item mt-1">
                <!-- Disciplina -->
                <button class="w-full flex items-center gap-2 p-2 rounded-lg hover:bg-indigo-50 transition text-left group"
                        data-action="click->sidebar-nav#toggle"
                        data-sidebar-item-id="disciplina-<%= disciplina.id %>">
                  <svg class="toggle-icon w-3 h-3 text-gray-400 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                  </svg>
                  <div class="flex-1">
                    <div class="text-sm font-medium text-gray-700"
                         style="<%= "color: #{disciplina.colore};" if disciplina.colore.present? %>">
                      <%= disciplina.nome %>
                    </div>
                    <div class="text-xs text-gray-500"><%= pluralize(disciplina.pagine.count, "pagina", "pagine") %></div>
                  </div>
                </button>

                <!-- Pagine (collassabile) -->
                <div class="sidebar-children ml-4 hidden"
                     data-sidebar-children-id="disciplina-<%= disciplina.id %>"
                     style="max-height: 0; overflow: hidden; transition: max-height 0.3s ease;">
                  <% disciplina.pagine.each do |pagina| %>
                    <%= link_to pagina_path(pagina.slug),
                                data: { turbo_frame: "_top" },
                                class: "flex items-center gap-2 p-2 rounded-lg hover:bg-gray-100 transition group mt-1" do %>
                      <div class="w-8 h-8 rounded-full flex items-center justify-center text-white text-sm font-bold"
                           style="background-color: <%= disciplina.colore || '#6B7280' %>">
                        <%= pagina.numero %>
                      </div>
                      <div class="flex-1 min-w-0">
                        <div class="text-sm text-gray-800 truncate"><%= pagina.titolo %></div>
                        <div class="text-xs text-gray-500">Pag. <%= pagina.numero %></div>
                      </div>
                    <% end %>
                  <% end %>
                </div>
              </div>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>
  </nav>

  <style>
    .sidebar-children.open {
      display: block !important;
      max-height: 2000px !important;
    }
  </style>
</aside>
