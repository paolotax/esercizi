<%
  # Parameters:
  # - color: Theme color (default: 'orange')
  # - current_page: Current page identifier (view_template) (optional if @pagina is available)
  # - pagina: Pagina object (optional, will use @pagina if not provided)
  
  color = local_assigns[:color] || 'orange'
  current_page = local_assigns[:current_page]
  pagina_obj = local_assigns[:pagina] || @pagina
  
  # Trova la pagina corrente nel database
  if pagina_obj
    current_pagina = pagina_obj
  elsif current_page
    # Cerca per view_template
    current_pagina = Pagina.find_by(view_template: current_page)
  end
  
  prev_page = nil
  next_page = nil
  
  if current_pagina
    # Trova la pagina precedente e successiva nella stessa disciplina
    # Le pagine sono ordinate per posizione e numero (default_scope)
    all_pages = current_pagina.disciplina.pagine.to_a
    current_index = all_pages.find_index { |p| p.id == current_pagina.id }
    
    if current_index
      prev_page = current_index > 0 ? all_pages[current_index - 1] : nil
      next_page = current_index < all_pages.length - 1 ? all_pages[current_index + 1] : nil
    end
  end
  
  # Color variants for different buttons
  button_colors = {
    'orange' => {
      primary: 'bg-orange-500 hover:bg-orange-600',
      secondary: 'bg-orange-400 hover:bg-orange-500',
      outline: 'border-orange-500 text-orange-600 hover:bg-orange-50'
    },
    'blue' => {
      primary: 'bg-blue-500 hover:bg-blue-600',
      secondary: 'bg-blue-400 hover:bg-blue-500',
      outline: 'border-blue-500 text-blue-600 hover:bg-blue-50'
    },
    'purple' => {
      primary: 'bg-purple-500 hover:bg-purple-600',
      secondary: 'bg-purple-400 hover:bg-purple-500',
      outline: 'border-purple-500 text-purple-600 hover:bg-purple-50'
    },
    'green' => {
      primary: 'bg-green-500 hover:bg-green-600',
      secondary: 'bg-green-400 hover:bg-green-500',
      outline: 'border-green-500 text-green-600 hover:bg-green-50'
    },
    'pink' => {
      primary: 'bg-pink-500 hover:bg-pink-600',
      secondary: 'bg-pink-400 hover:bg-pink-500',
      outline: 'border-pink-500 text-pink-600 hover:bg-pink-50'
    },
    'red' => {
      primary: 'bg-red-500 hover:bg-red-600',
      secondary: 'bg-red-400 hover:bg-red-500',
      outline: 'border-red-500 text-red-600 hover:bg-red-50'
    }
  }
  
  colors = button_colors[color] || button_colors['orange']
%>

<div class="print-hidden mt-8" data-exercise-checker-target="buttonContainer">
  <!-- All buttons on same line -->
  <div class="flex flex-wrap gap-4 justify-between items-center">
    <!-- Previous Page Button -->
    <div class="flex-shrink-0">
      <% if prev_page %>
        <%= link_to pagina_path(prev_page.slug), 
            data: { turbo_frame: "_top" },
            class: "flex items-center justify-center #{colors[:primary]} text-white font-bold py-4 px-4 md:py-4 md:px-8 rounded-full shadow-lg transition transform hover:scale-105 w-14 h-14 md:w-auto md:h-auto" do %>
          <span class="text-xl md:text-2xl font-bold text-white">←</span>
        <% end %>
      <% else %>
        <div class="flex items-center justify-center bg-gray-300 text-gray-500 font-bold rounded-full cursor-not-allowed opacity-50 w-14 h-14 md:w-auto md:h-auto md:py-4 md:px-8">
          <span class="text-xl md:text-2xl font-bold text-white">←</span>
        </div>
      <% end %>
    </div>
    
    <!-- Center control buttons -->
    <div class="flex flex-wrap gap-2 md:gap-4 justify-center items-center flex-1">
      <!-- Check Answers Button -->
      <button class="<%= colors[:primary] %> text-white font-bold py-4 px-4 md:py-4 md:px-8 rounded-full shadow-lg transition transform hover:scale-105 flex items-center justify-center w-14 h-14 md:w-auto md:h-auto"
              data-action="click->exercise-checker#checkAnswers"
              title="Controlla">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 md:hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
        <span class="hidden md:inline text-xl">Controlla</span>
      </button>
      
      <!-- Solve Button -->
      <button class="<%= colors[:secondary] %> text-white font-bold py-4 px-4 md:py-4 md:px-8 rounded-full shadow-lg transition transform hover:scale-105 flex items-center justify-center w-14 h-14 md:w-auto md:h-auto"
              data-action="click->exercise-checker#showSolutions"
              title="Soluzioni">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 md:hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
        </svg>
        <span class="hidden md:inline text-xl">Soluzioni</span>
      </button>
      
      <!-- Reset Button -->
      <button class="border-2 <%= colors[:outline] %> bg-white font-bold py-4 px-4 md:py-4 md:px-8 rounded-full shadow-lg transition transform hover:scale-105 flex items-center justify-center w-14 h-14 md:w-auto md:h-auto"
              data-action="click->exercise-checker#resetExercise"
              title="Ricomincia">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 md:hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
        </svg>
        <span class="hidden md:inline text-xl">Ricomincia</span>
      </button>
    </div>
    
    <!-- Next Page Button -->
    <div class="flex-shrink-0">
      <% if next_page %>
        <%= link_to pagina_path(next_page.slug), 
            data: { turbo_frame: "_top" },
            class: "flex items-center justify-center #{colors[:primary]} text-white font-bold py-4 px-4 md:py-4 md:px-8 rounded-full shadow-lg transition transform hover:scale-105 w-14 h-14 md:w-auto md:h-auto" do %>
          <span class="text-xl md:text-2xl font-bold text-white">→</span>
        <% end %>
      <% else %>
        <div class="flex items-center justify-center bg-gray-300 text-gray-500 font-bold rounded-full cursor-not-allowed opacity-50 w-14 h-14 md:w-auto md:h-auto md:py-4 md:px-8">
          <span class="text-xl md:text-2xl font-bold text-white">→</span>
        </div>
      <% end %>
    </div>
  </div>
</div>


