<div class="max-w-6xl mx-auto bg-white dark:bg-gray-900 text-black dark:text-white p-3 md:p-6 transition-colors duration-300"
     data-controller="exercise-checker text-toggle font-controls"
     data-text-toggle-target="content"
     data-font-controls-target="content">

  <%= render 'shared/page_header', pagina: @pagina %>

  <div class="space-y-6">

  <!-- Info Box -->
  <div class="bg-yellow-100 dark:bg-yellow-900/30 rounded-lg p-4 md:p-6">
    <h2 class="font-bold text-gray-800 dark:text-gray-200 mb-3">
      La lettera <span class="font-bold text-cyan-700 dark:text-cyan-400">H</span> si usa:
    </h2>
    <ul class="space-y-2">
      <li>• con i suoni duri <strong class="text-cyan-700 dark:text-cyan-400">C e G</strong>, davanti alle vocali <strong class="text-cyan-700 dark:text-cyan-400">E</strong> o <strong class="text-cyan-700 dark:text-cyan-400">I</strong> (<span class="text-cyan-700 dark:text-cyan-400">che, chi, ghe, ghi</span>);</li>
      <li>• in alcune forme del verbo <strong class="text-cyan-700 dark:text-cyan-400">avere</strong> (<strong class="text-cyan-700 dark:text-cyan-400">ho, hai, ha, hanno</strong>) per distinguerle da altre parole che si pronunciano nello stesso modo (<span class="text-cyan-700 dark:text-cyan-400">o, ai, a, anno</span>);</li>
      <li>• nelle <strong class="text-cyan-700 dark:text-cyan-400">esclamazioni</strong>, l'h segue la vocale (<strong class="text-cyan-700 dark:text-cyan-400">oh, ah</strong>) o sta tra due vocali (<strong class="text-cyan-700 dark:text-cyan-400">ahi, ahimè</strong>);</li>
      <li>• in alcune <strong class="text-cyan-700 dark:text-cyan-400">parole di origine straniera</strong>: <span class="text-cyan-700 dark:text-cyan-400">hamburger, hotel, hobby</span>...</li>
    </ul>
  </div>

  <!-- Exercise 1: IMPARARE TUTTI - Underline text -->
  <div class="bg-white dark:bg-gray-800 rounded-lg p-4 md:p-6 border-4 border-yellow-400 dark:border-yellow-600" data-controller="word-highlighter" data-word-highlighter-multi-color-value="true">
    <h2 class="font-bold text-gray-800 dark:text-gray-200">
      <span class="bg-blue-800 text-white rounded-full w-8 h-8 md:w-10 md:h-10 inline-flex items-center justify-center mr-2">1</span>
      <span class="bg-yellow-400 dark:bg-yellow-600 text-blue-800 dark:text-blue-200 px-2 py-1 rounded font-bold">IMPARARE TUTTI</span>
      Clicca un colore, poi clicca le parole per evidenziarle.
    </h2>

    <div class="p-4 md:p-6">
      <p class="leading-relaxed text-gray-800 dark:text-gray-200">
        <span data-word-highlighter-target="word" data-correct="green" data-action="click->word-highlighter#toggleHighlight" class="px-1 rounded">Ai</span> "Giochi della scienza" un mio amico
        <span data-word-highlighter-target="word" data-correct="red" data-action="click->word-highlighter#toggleHighlight" class="px-1 rounded">ha</span> presentato un videogioco che
        <span data-word-highlighter-target="word" data-correct="red" data-action="click->word-highlighter#toggleHighlight" class="px-1 rounded">ha</span> inventato lui stesso. Lo
        <span data-word-highlighter-target="word" data-correct="red" data-action="click->word-highlighter#toggleHighlight" class="px-1 rounded">ha</span> chiamato "Esploratori delle stelle": bisogna fare finta di essere astronauti e di esplorare lo spazio
        <span data-word-highlighter-target="word" data-correct="green" data-action="click->word-highlighter#toggleHighlight" class="px-1 rounded">a</span> caccia di stelle
        <span data-word-highlighter-target="word" data-correct="green" data-action="click->word-highlighter#toggleHighlight" class="px-1 rounded">o</span> di comete rare. Ogni volta che tocchi una stella,
        <span data-word-highlighter-target="word" data-correct="red" data-action="click->word-highlighter#toggleHighlight" class="px-1 rounded">hai</span> un punto in più. Quando l'<span data-word-highlighter-target="word" data-correct="red" data-action="click->word-highlighter#toggleHighlight" class="px-1 rounded">ho</span> provato,
        <span data-word-highlighter-target="word" data-correct="red" data-action="click->word-highlighter#toggleHighlight" class="px-1 rounded">ho</span> subito pensato: "<span data-word-highlighter-target="word" data-correct="yellow" data-action="click->word-highlighter#toggleHighlight" class="px-1 rounded">Ah</span>, che meraviglia, come vorrei andare veramente
        <span data-word-highlighter-target="word" data-correct="green" data-action="click->word-highlighter#toggleHighlight" class="px-1 rounded">a</span> esplorare le galassie
        <span data-word-highlighter-target="word" data-correct="green" data-action="click->word-highlighter#toggleHighlight" class="px-1 rounded">o</span>
        <span data-word-highlighter-target="word" data-correct="green" data-action="click->word-highlighter#toggleHighlight" class="px-1 rounded">a</span> toccare le stelle!".
      </p>

      <div class="mt-6 flex flex-wrap gap-4 items-center justify-between">
        <div class="flex flex-wrap gap-4">
          <div class="flex items-center gap-2">
            <div class="w-6 h-6 bg-red-600 rounded cursor-pointer transition transform hover:scale-110 ring-2 ring-gray-300 dark:ring-gray-600"
                 data-word-highlighter-target="colorBox"
                 data-color="red"
                 data-action="click->word-highlighter#selectColor"
                 title="Clicca per selezionare">
            </div>
            <span>Verbo avere (ho, hai, ha)</span>
          </div>
          <div class="flex items-center gap-2">
            <div class="w-6 h-6 bg-green-600 rounded cursor-pointer transition transform hover:scale-110 ring-2 ring-gray-300 dark:ring-gray-600"
                 data-word-highlighter-target="colorBox"
                 data-color="green"
                 data-action="click->word-highlighter#selectColor"
                 title="Clicca per selezionare">
            </div>
            <span>Preposizioni e congiunzione (a, ai, o)</span>
          </div>
          <div class="flex items-center gap-2">
            <div class="w-6 h-6 bg-yellow-500 rounded cursor-pointer transition transform hover:scale-110 ring-2 ring-gray-300 dark:ring-gray-600"
                 data-word-highlighter-target="colorBox"
                 data-color="yellow"
                 data-action="click->word-highlighter#selectColor"
                 title="Clicca per selezionare">
            </div>
            <span>Esclamazione (ah)</span>
          </div>
        </div>
        <button class="bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 px-4 py-2 rounded-lg transition font-semibold"
                data-action="click->word-highlighter#clearHighlights">
          Cancella
        </button>
      </div>
    </div>
  </div>

  <!-- Exercise 2: Complete with HO, HA, O, A, OH, AH -->
  <div class="bg-white dark:bg-gray-800 rounded-lg p-4 md:p-6">
    <h2 class="font-bold text-gray-800 dark:text-gray-200 mb-4">
      <span class="bg-pink-600 text-white rounded-full w-8 h-8 md:w-10 md:h-10 inline-flex items-center justify-center mr-2">2</span>
      Completa con <span class="font-bold text-cyan-700 dark:text-cyan-400">HO</span>, <span class="font-bold text-cyan-700 dark:text-cyan-400">HA</span>, <span class="font-bold text-cyan-700 dark:text-cyan-400">O</span>, <span class="font-bold text-cyan-700 dark:text-cyan-400">A</span>, <span class="font-bold text-cyan-700 dark:text-cyan-400">OH</span>, <span class="font-bold text-cyan-700 dark:text-cyan-400">AH</span>.
    </h2>

    <div class="sm:ml-7">
      <%= render 'shared/fill_list',
          color: "pink",
          bullet: "•",
          container_class: "space-y-1",
          items: [
            { prefix: "Tra due giorni andrò", answer: "a", suffix: "Bologna con la mamma." },
            { prefix: "Preferisci un panino", answer: "o", suffix: "una mela?" },
            { prefix: "Andrea mi", answer: "ha", suffix: "regalato un libro molto bello." },
            { answer: "Oh", suffix: "! Che meraviglia i colori dell'autunno!" },
            { prefix: "Non posso venire al cinema:", answer: "ho", suffix: "molte cose da fare." },
            { segments: [{ answer: "Ah" }, ", che bellezza! Marta", { answer: "ha" }, "ritrovato la penna a cui teneva tanto."] }
          ] %>
    </div>
  </div>

  <!-- Exercise 3: Write sentences on notebook -->
  <div class="bg-white dark:bg-gray-800 rounded-lg p-4 md:p-6">
    <h2 class="font-bold text-gray-800 dark:text-gray-200 mb-4">
      <span class="bg-pink-600 text-white rounded-full w-8 h-8 md:w-10 md:h-10 inline-flex items-center justify-center mr-2">3</span>
      Scrivi sul quaderno una frase con ognuna delle seguenti espressioni.
    </h2>

    <div class="grid grid-cols-2 sm:grid-cols-3 gap-3 md:gap-4">
      <% expressions = [
        {text: 'Ahi, che male!', color: 'blue'},
        {text: 'Hai male?', color: 'orange'},
        {text: 'Ah, che caldo insopportabile!', color: 'green'},
        {text: 'Thomas ha caldo', color: 'pink'},
        {text: 'Non ce l\'hanno fatta', color: 'cyan'},
        {text: 'L\'anno passato', color: 'purple'}
      ] %>

      <% expressions.each do |expr| %>
        <div class="border-3 rounded-lg px-3 py-3 text-center font-bold"
             style="border-color: <%= case expr[:color]
               when 'blue' then '#3b82f6'
               when 'orange' then '#f97316'
               when 'green' then '#22c55e'
               when 'pink' then '#ec4899'
               when 'cyan' then '#06b6d4'
               when 'purple' then '#a855f7'
               end %>;">
          <%= expr[:text] %>
        </div>
      <% end %>
    </div>

    <div class="mt-4">
      <textarea class="w-full border-2 border-dotted border-gray-400 dark:border-gray-500 bg-transparent dark:text-white rounded-lg p-3 focus:outline-none"
                rows="4"
                placeholder="Scrivi le tue frasi sul quaderno o usa quest'area per annotarle."></textarea>
    </div>
  </div>

  <!-- Reference note -->
  <%
    base_color = @pagina&.base_color || "blue"
    color_map = {
      "purple" => "text-purple-700 dark:text-purple-400 hover:text-purple-900 dark:hover:text-purple-300",
      "blue" => "text-blue-700 dark:text-blue-400 hover:text-blue-900 dark:hover:text-blue-300",
      "cyan" => "text-cyan-700 dark:text-cyan-400 hover:text-cyan-900 dark:hover:text-cyan-300",
      "green" => "text-green-700 dark:text-green-400 hover:text-green-900 dark:hover:text-green-300",
      "orange" => "text-orange-700 dark:text-orange-400 hover:text-orange-900 dark:hover:text-orange-300",
      "red" => "text-red-700 dark:text-red-400 hover:text-red-900 dark:hover:text-red-300",
      "pink" => "text-pink-700 dark:text-pink-400 hover:text-pink-900 dark:hover:text-pink-300"
    }
    link_color = color_map[base_color] || "text-blue-700 dark:text-blue-400 hover:text-blue-900 dark:hover:text-blue-300"
  %>
  <div class="text-right font-bold">
    <p class="<%= link_color %>">
      Esercizi pp. <%= link_to "136", pagina_path("nvl5_gram_p136"), class: "#{link_color} underline" %>-<%= link_to "137", pagina_path("nvl5_gram_p137"), class: "#{link_color} underline" %>
    </p>
  </div>

  <!-- Exercise Controls -->
  <%= render 'shared/exercise_controls' %>
  </div><!-- chiude space-y-6 -->
</div>
