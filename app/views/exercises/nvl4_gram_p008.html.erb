<div class="max-w-6xl mx-auto bg-white dark:bg-gray-900 text-black dark:text-white p-3 md:p-6 transition-colors duration-300"
     data-controller="exercise-checker text-toggle font-controls"
     data-text-toggle-target="content"
     data-font-controls-target="content">

  <%= render 'shared/page_header', pagina: @pagina %>

  <!-- Explanation Box -->
  <div class="bg-yellow-50 dark:bg-yellow-900/30 border-4 border-yellow-400 dark:border-yellow-600 rounded-lg p-4 md:p-6 mb-6 md:mb-8">
    <h2 class="font-bold text-pink-600 dark:text-pink-400 mb-3 md:mb-4">Lettera C</h2>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-3 md:gap-4">
      <div class="border-4 border-red-400 dark:border-red-600 rounded-lg p-3 md:p-4 bg-red-50 dark:bg-red-900/30">
        <h3 class="font-bold text-red-600 dark:text-red-400 mb-2">Suono dolce</h3>
        <ul class="space-y-2 dark:text-gray-200">
          <li>• davanti a <span class="font-bold">E, I</span> → <span class="font-bold text-red-600 dark:text-red-400">cena, cibi</span></li>
        </ul>
      </div>
      <div class="border-4 border-blue-400 dark:border-blue-600 rounded-lg p-3 md:p-4 bg-blue-50 dark:bg-blue-900/30">
        <h3 class="font-bold text-blue-600 dark:text-blue-400 mb-2">Suono duro</h3>
        <ul class="space-y-2 dark:text-gray-200">
          <li>• davanti a <span class="font-bold">A, O, U</span> → <span class="font-bold text-blue-600 dark:text-blue-400">casa, tacco, curva</span></li>
          <li>• davanti a <span class="font-bold">H</span> → <span class="font-bold text-blue-600 dark:text-blue-400">amiche, chiave</span></li>
          <li>• davanti a un'altra consonante → <span class="font-bold text-blue-600 dark:text-blue-400">crema</span></li>
        </ul>
      </div>
    </div>
  </div>

  <!-- Exercise 1: Classify words by C sound -->
  <div class="mb-8 md:mb-12 bg-white dark:bg-gray-800 rounded-lg p-4 md:p-6 shadow-md">
    <h2 class="font-bold text-pink-600 dark:text-pink-400 mb-4 md:mb-6">
      <span class="bg-pink-600 text-white rounded-full w-8 h-8 md:w-10 md:h-10 inline-flex items-center justify-center mr-2">1</span>
      <span class="">IMPARARE TUTTI</span> Leggi e sottolinea in rosso le parole con <span class="text-red-600">C suono dolce</span>,
      in blu le parole con <span class="text-blue-600">C suono duro</span>.
    </h2>

    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-3 md:gap-4">
      <% words = [
        {word: 'cinema', correct_color: 'red'},
        {word: 'celeste', correct_color: 'red'},
        {word: 'chiavi', correct_color: 'blue'},
        {word: 'capra', correct_color: 'blue'},
        {word: 'curva', correct_color: 'blue'},
        {word: 'ricetta', correct_color: 'red'},
        {word: 'comico', correct_color: 'blue'},
        {word: 'cipolla', correct_color: 'red'},
        {word: 'cesto', correct_color: 'red'},
        {word: 'cresta', correct_color: 'blue'},
        {word: 'chiodo', correct_color: 'blue'},
        {word: 'dolce', correct_color: 'red'}
      ] %>

      <% words.each do |item| %>
        <div class="border-2 border-gray-300 dark:border-gray-600 rounded-lg p-3 md:p-4 bg-gray-50 dark:bg-gray-700 hover:shadow-lg transition"
             data-controller="card-selector">
          <div class="font-bold text-gray-800 dark:text-gray-100 mb-2 md:mb-3">• <%= item[:word] %></div>
          <div class="flex gap-2">
            <button class="flex-1 py-1.5 md:py-2 px-2 md:px-3 rounded-lg border-2 transition"
                    data-action="click->card-selector#select"
                    data-card-selector-target="card"
                    data-correct="<%= item[:correct_color] == 'red' %>"
                    style="border-color: #ef4444; color: #ef4444;">
              Dolce
            </button>
            <button class="flex-1 py-1.5 md:py-2 px-2 md:px-3 rounded-lg border-2 transition"
                    data-action="click->card-selector#select"
                    data-card-selector-target="card"
                    data-correct="<%= item[:correct_color] == 'blue' %>"
                    style="border-color: #3b82f6; color: #3b82f6;">
              Duro
            </button>
          </div>
        </div>
      <% end %>
    </div>
  </div>

  <!-- Exercise 2: Complete words with CA, CO, CU or C + consonant -->
  <div class="mb-8 md:mb-12 bg-white dark:bg-gray-800 rounded-lg p-4 md:p-6 shadow-md">
    <h2 class="font-bold text-pink-600 dark:text-pink-400 mb-4 md:mb-6">
      <span class="bg-pink-600 text-white rounded-full w-8 h-8 md:w-10 md:h-10 inline-flex items-center justify-center mr-2">2</span>
      Completa le parole con <span class="font-bold">CA, CO, CU</span> o con <span class="font-bold">C + consonante</span> (suono duro).
    </h2>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 md:gap-6" data-controller="fill-blanks">
      <% completions = [
        {prefix: '', suffix: 'chiaio', answer: 'cu'},
        {prefix: '', suffix: 'rota', answer: 'ca'},
        {prefix: '', suffix: 'niglio', answer: 'co'},
        {prefix: 'ama', suffix: '', answer: 'ca'},
        {prefix: '', suffix: 'stode', answer: 'cu'},
        {prefix: 'an', suffix: 'ra', answer: 'co'},
        {prefix: '', suffix: 'iniera', answer: 'cr'},
        {prefix: '', suffix: 'ramella', answer: 'ca'},
        {prefix: 'ac', suffix: 'ppatoio', answer: 'ca'},
        {prefix: 'pan', suffix: '', answer: 'ca'},
        {prefix: '', suffix: 'stagna', answer: 'ca'},
        {prefix: '', suffix: 'gino', answer: 'cu'}
      ] %>

      <% completions.each_with_index do |item, idx| %>
        <div class="flex flex-wrap items-center gap-1 md:gap-2 font-bold dark:text-gray-200">
          <span class="whitespace-nowrap">• <%= item[:prefix] %></span>
          <input type="text"
                 class="border-b-4 border-pink-500 bg-transparent w-12 md:w-16 text-center focus:outline-none focus:border-pink-700 flex-shrink-0 dark:text-white"
                 data-fill-blanks-target="input"
                 data-answer="<%= item[:answer] %>"
                 data-correct-answer="<%= item[:answer] %>"
                 maxlength="4">
          <span class="whitespace-nowrap"><%= item[:suffix] %></span>
        </div>
      <% end %>
    </div>
  </div>

  <!-- Exercise 3: CE o CHE? CI o CHI? -->
  <div class="mb-8 md:mb-12 bg-white dark:bg-gray-800 rounded-lg p-4 md:p-6 shadow-md">
    <h2 class="font-bold text-pink-600 dark:text-pink-400 mb-4 md:mb-6">
      <span class="bg-pink-600 text-white rounded-full w-8 h-8 md:w-10 md:h-10 inline-flex items-center justify-center mr-2">3</span>
      <span class="font-bold">CE</span> o <span class="font-bold">CHE</span>? <span class="font-bold">CI</span> o <span class="font-bold">CHI</span>?
      Colora il riquadro con la parola corretta.
    </h2>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 md:gap-8 lg:gap-12">
      <% word_pairs = [
        {words: ['cercio', 'cerchio'], correct: 'cerchio', color: 'red'},
        {words: ['amiche', 'amice'], correct: 'amiche', color: 'green'},
        {words: ['voce', 'voche'], correct: 'voce', color: 'yellow'},
        {words: ['chiesa', 'ciesa'], correct: 'chiesa', color: 'cyan'},
        {words: ['civetta', 'chivetta'], correct: 'civetta', color: 'pink'},
        {words: ['ciusa', 'chiusa'], correct: 'chiusa', color: 'purple'},
        {words: ['stecchino', 'steccino'], correct: 'stecchino', color: 'blue'},
        {words: ['oce', 'oche'], correct: 'oche', color: 'orange'},
        {words: ['incendio', 'inchendio'], correct: 'incendio', color: 'green'}
      ] %>

      <% word_pairs.each do |pair| %>
        <div class="flex gap-1 md:gap-2" data-controller="card-selector">
          <% pair[:words].each do |word| %>
            <div class="flex-1 border-4 rounded-xl px-3 md:px-6 py-3 md:py-4 text-center font-bold cursor-pointer transition hover:scale-105 dark:text-gray-100"
                 style="border-color: <%= case pair[:color]
                   when 'red' then '#ef4444'
                   when 'green' then '#84cc16'
                   when 'yellow' then '#eab308'
                   when 'cyan' then '#06b6d4'
                   when 'pink' then '#ec4899'
                   when 'purple' then '#a855f7'
                   when 'blue' then '#3b82f6'
                   when 'orange' then '#f97316'
                   end %>;"
                 data-action="click->card-selector#select"
                 data-card-selector-target="card"
                 data-correct="<%= word == pair[:correct] %>">
              <%= word %>
            </div>
          <% end %>
        </div>
      <% end %>
    </div>
  </div>

  <!-- Exercise Controls -->
  <%= render 'shared/exercise_controls', color: 'pink' %>
</div>
