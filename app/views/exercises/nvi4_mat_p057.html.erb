<div class="max-w-6xl mx-auto bg-white p-3 md:p-6"
     data-controller="exercise-checker text-toggle font-controls fraction-coloring"
     data-text-toggle-target="content"
     data-font-controls-target="content">

  <%= render 'shared/page_header', pagina: @pagina %>

  <div class="space-y-6">

    <!-- Box teoria principale -->
    <div class="p-4 md:p-6 bg-white rounded-2xl border-3 border-blue-800">
      <p class="text-gray-700 mb-4">
        <span class="font-bold">Frazionare</span> significa dividere un intero in parti uguali.<br>
        Un mezzo <%= render 'shared/frazione', num: 1, den: 2 %>, un terzo <%= render 'shared/frazione', num: 1, den: 3 %>, un quarto <%= render 'shared/frazione', num: 1, den: 4 %> indicano che un intero è stato diviso in due, in tre o in quattro parti uguali e ogni volta è stata considerata una parte.
      </p>

      <div class="grid grid-cols-1 md:grid-cols-3 gap-6 items-center">
        <!-- Frazione grande con etichette -->
        <div class="flex justify-center">
          <div class="relative">
            <div class="flex flex-col items-center">
              <span class="font-bold text-<%= @pagina.base_color %>-600">1</span>
              <span class="w-8 border-t-2 border-gray-900"></span>
              <span class="font-bold text-<%= @pagina.base_color %>-600">3</span>
            </div>
          </div>
        </div>

        <!-- Descrizioni termini -->
        <div class="md:col-span-2 space-y-3">
          <div class="flex items-center gap-3">
            <span class="text-<%= @pagina.base_color %>-500">→</span>
            <span class="font-bold text-<%= @pagina.base_color %>-600">NUMERATORE</span>
            <span class="text-gray-700">Indica il numero delle parti uguali considerate.</span>
          </div>
          <div class="flex items-center gap-3">
            <span class="text-<%= @pagina.base_color %>-500">→</span>
            <span class="font-bold text-<%= @pagina.base_color %>-600">LINEA DI FRAZIONE</span>
            <span class="text-gray-700">Indica che l'intero è stato diviso in parti uguali.</span>
          </div>
          <div class="flex items-center gap-3">
            <span class="text-<%= @pagina.base_color %>-500">→</span>
            <span class="font-bold text-<%= @pagina.base_color %>-600">DENOMINATORE</span>
            <span class="text-gray-700">Indica in quante parti uguali è stato diviso l'intero.</span>
          </div>
        </div>
      </div>

      <p class="text-gray-700 mt-4">Si legge "un terzo".</p>
    </div>

    <!-- Osserva e completa -->
    <div class="py-4">
      <p class="font-bold text-gray-700 mb-4">
        <span class="text-<%= @pagina.base_color %>-500">•</span> Osserva e completa.
      </p>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <!-- Rettangolo -->
        <div class="flex items-center gap-4">
          <div class="w-32 h-24 border-2 border-gray-400 grid grid-cols-4">
            <div class="border-r border-gray-400 bg-orange-400"></div>
            <div class="border-r border-gray-400"></div>
            <div class="border-r border-gray-400"></div>
            <div></div>
          </div>
          <div class="space-y-2">
            <p class="text-gray-700">
              Ho diviso il rettangolo in
              <input type="text" data-correct-answer="4" class="w-12 border-b-2 border-dotted border-gray-400 text-center font-bold bg-transparent">
              parti uguali; di queste ne ho colorata
              <input type="text" data-correct-answer="1" class="w-12 border-b-2 border-dotted border-gray-400 text-center font-bold bg-transparent">.
            </p>
            <p class="text-gray-700">
              Ho colorato <%= render 'shared/frazione', num: 1, den: 4 %> del rettangolo.
            </p>
          </div>
        </div>

        <!-- Cerchio -->
        <div class="flex items-center gap-4">
          <div class="relative w-24 h-24">
            <%= image_tag "nvi4_mat/p057/p057_07.jpg", class: "w-full h-auto" %>
          </div>
          <div class="space-y-2">
            <p class="text-gray-700">
              Ho diviso il cerchio in
              <input type="text" data-correct-answer="8" class="w-12 border-b-2 border-dotted border-gray-400 text-center font-bold bg-transparent">
              parti uguali; di queste ne ho colorate
              <input type="text" data-correct-answer="3" class="w-12 border-b-2 border-dotted border-gray-400 text-center font-bold bg-transparent">.
            </p>
            <p class="text-gray-700">
              Ho colorato <%= render 'shared/frazione', num: nil, den: nil, num_answer: "3", den_answer: "8" %> del cerchio.
            </p>
          </div>
        </div>
      </div>
    </div>

    <!-- ESERCIZI -->
    <div class="p-4 md:p-6 bg-orange-100 rounded-2xl">

      <!-- Esercizio 1 -->
      <div class="p-4 bg-white rounded-2xl -mx-4 md:-mx-6 -mt-4 md:-mt-6 mb-6 border-3 border-blue-500">
        <p class="font-bold text-gray-700 mb-4">
          <%= imparare_tutti_badge(1) %>
          Scrivi le frazioni corrispondenti alle parti colorate e come si leggono.
        </p>

        <div class="space-y-4">
          <!-- Prima riga -->
          <div class="flex items-center gap-4 flex-wrap">
            <%= render 'shared/frazione', num: nil, den: nil, num_answer: "2", den_answer: "5" %>
            <div class="w-40 h-8 border-2 border-gray-400 grid grid-cols-5">
              <div class="border-r border-gray-400 bg-cyan-400"></div>
              <div class="border-r border-gray-400 bg-cyan-400"></div>
              <div class="border-r border-gray-400"></div>
              <div class="border-r border-gray-400"></div>
              <div></div>
            </div>
            <span class="text-gray-700">si legge</span>
            <input type="text" data-correct-answer="due quinti" class="min-w-0 flex-1 max-w-xs border-b-2 border-dotted border-gray-400 text-center font-bold bg-transparent">
          </div>

          <!-- Seconda riga -->
          <div class="flex items-center gap-4 flex-wrap">
            <%= render 'shared/frazione', num: nil, den: nil, num_answer: "3", den_answer: "6" %>
            <div class="w-40 h-8 border-2 border-gray-400 grid grid-cols-6">
              <div class="border-r border-gray-400 bg-cyan-400"></div>
              <div class="border-r border-gray-400 bg-cyan-400"></div>
              <div class="border-r border-gray-400 bg-cyan-400"></div>
              <div class="border-r border-gray-400"></div>
              <div class="border-r border-gray-400"></div>
              <div></div>
            </div>
            <span class="text-gray-700">si legge</span>
            <input type="text" data-correct-answer="tre sesti" class="min-w-0 flex-1 max-w-xs border-b-2 border-dotted border-gray-400 text-center font-bold bg-transparent">
          </div>

          <!-- Terza riga -->
          <div class="flex items-center gap-4 flex-wrap">
            <%= render 'shared/frazione', num: nil, den: nil, num_answer: "4", den_answer: "8" %>
            <div class="w-40 h-8 border-2 border-gray-400 grid grid-cols-8">
              <div class="border-r border-gray-400 bg-cyan-400"></div>
              <div class="border-r border-gray-400 bg-cyan-400"></div>
              <div class="border-r border-gray-400 bg-cyan-400"></div>
              <div class="border-r border-gray-400 bg-cyan-400"></div>
              <div class="border-r border-gray-400"></div>
              <div class="border-r border-gray-400"></div>
              <div class="border-r border-gray-400"></div>
              <div></div>
            </div>
            <span class="text-gray-700">si legge</span>
            <input type="text" data-correct-answer="quattro ottavi" class="min-w-0 flex-1 max-w-xs border-b-2 border-dotted border-gray-400 text-center font-bold bg-transparent">
          </div>
        </div>
      </div>

      <!-- Esercizio 2 -->
      <div>
        <p class="font-bold text-gray-700 mb-4">
          <%= numero_esercizio_badge(2) %>
          Di ogni figura colora la parte indicata dalla frazione.
        </p>

        <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
          <!-- Triangoli 2/4 -->
          <div class="flex flex-col items-center gap-2">
            <div class="flex gap-1">
              <div class="w-0 h-0 border-l-[20px] border-r-[20px] border-b-[35px] border-l-transparent border-r-transparent border-b-cyan-400"></div>
              <div class="w-0 h-0 border-l-[20px] border-r-[20px] border-b-[35px] border-l-transparent border-r-transparent border-b-gray-300 cursor-pointer hover:border-b-cyan-200" data-action="click->fraction-coloring#toggleColor"></div>
              <div class="w-0 h-0 border-l-[20px] border-r-[20px] border-b-[35px] border-l-transparent border-r-transparent border-b-gray-300 cursor-pointer hover:border-b-cyan-200" data-action="click->fraction-coloring#toggleColor"></div>
              <div class="w-0 h-0 border-l-[20px] border-r-[20px] border-b-[35px] border-l-transparent border-r-transparent border-b-gray-300 cursor-pointer hover:border-b-cyan-200" data-action="click->fraction-coloring#toggleColor"></div>
            </div>
            <%= render 'shared/frazione', num: 2, den: 4 %>
          </div>

          <!-- Rettangolo 5/8 -->
          <div class="flex flex-col items-center gap-2">
            <div class="w-32 h-12 border-2 border-gray-400 grid grid-cols-8">
              <% 8.times do |i| %>
                <div class="<%= i < 7 ? 'border-r border-gray-400' : '' %> cursor-pointer hover:bg-cyan-200" data-action="click->fraction-coloring#toggleColor"></div>
              <% end %>
            </div>
            <%= render 'shared/frazione', num: 5, den: 8 %>
          </div>

          <!-- Rettangolo 2/6 -->
          <div class="flex flex-col items-center gap-2">
            <div class="w-24 h-16 border-2 border-gray-400 grid grid-cols-3 grid-rows-2">
              <% 6.times do |i| %>
                <div class="border border-gray-400 cursor-pointer hover:bg-cyan-200" data-action="click->fraction-coloring#toggleColor"></div>
              <% end %>
            </div>
            <%= render 'shared/frazione', num: 2, den: 6 %>
          </div>

          <!-- Rettangolo 3/10 -->
          <div class="flex flex-col items-center gap-2">
            <div class="w-40 h-8 border-2 border-gray-400 grid grid-cols-10">
              <% 10.times do |i| %>
                <div class="<%= i < 9 ? 'border-r border-gray-400' : '' %> cursor-pointer hover:bg-cyan-200" data-action="click->fraction-coloring#toggleColor"></div>
              <% end %>
            </div>
            <%= render 'shared/frazione', num: 3, den: 10 %>
          </div>

          <!-- Rettangolo 1/2 -->
          <div class="flex flex-col items-center gap-2">
            <div class="w-24 h-12 border-2 border-gray-400 grid grid-cols-2">
              <div class="border-r border-gray-400 cursor-pointer hover:bg-cyan-200" data-action="click->fraction-coloring#toggleColor"></div>
              <div class="cursor-pointer hover:bg-cyan-200" data-action="click->fraction-coloring#toggleColor"></div>
            </div>
            <%= render 'shared/frazione', num: 1, den: 2 %>
          </div>

          <!-- Rettangolo 4/5 -->
          <div class="flex flex-col items-center gap-2">
            <div class="w-20 h-16 border-2 border-gray-400 grid grid-rows-5">
              <% 5.times do |i| %>
                <div class="<%= i < 4 ? 'border-b border-gray-400' : '' %> cursor-pointer hover:bg-cyan-200" data-action="click->fraction-coloring#toggleColor"></div>
              <% end %>
            </div>
            <%= render 'shared/frazione', num: 4, den: 5 %>
          </div>
        </div>
      </div>
    </div>

    <%= render 'shared/quaderno_link', pagine: [201] %>

    <%= render 'shared/exercise_controls' %>
  </div>
</div>
