<% content_for :titolo, "#{@pagina.titolo} - #{@pagina.numero}" %>

<div class="max-w-7xl mx-auto p-3 md:p-6 bg-white font-mono" data-controller="exercise-checker page-viewer text-toggle font-controls" data-page-viewer-image-url-value="<%= asset_path('bus3_mat/p047/page.png') %>" data-text-toggle-target="content" data-font-controls-target="content">
  <!-- Header -->
  <%= render 'shared/page_header', pagina: @pagina %>

  <!-- Parte teorica: Moltiplicazioni con una cifra -->
  <div class="bg-[#C7EAFB] p-4 md:p-6 -ml-3 md:-ml-0 -mr-3 md:mr-0 mb-8">
    <p class="text-gray-800 mb-6">
      <strong class="text-red-500">•</strong> Osserva come si eseguono le moltiplicazioni in colonna.
    </p>

    <!-- Sezione: SENZA CAMBIO -->
    <h3 class="text-red-500 mb-4"><strong>•</strong> SENZA CAMBIO</h3>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
      <div class="flex items-center gap-4">
        <%= image_tag "bus3_mat/p047/p47_1.jpg",
            alt: "Moltiplicazione senza cambio - passo 1",
            class: "max-w-full" %>
        <p class="text-gray-700">
          Prima moltiplica le <span class="text-cyan-500 font-bold">unità</span> per le <span class="text-cyan-500 font-bold">unità</span>.
        </p>
      </div>

      <div class="flex items-center gap-4">
        <%= image_tag "bus3_mat/p047/p47_2.jpg",
            alt: "Moltiplicazione senza cambio - passo 2",
            class: "max-w-full" %>
        <p class="text-gray-700">
          Dopo moltiplica le <span class="text-cyan-500 font-bold">unità</span> per le <span class="text-red-500 font-bold">decine</span>.
        </p>
      </div>
    </div>

    <!-- Sezione: CON IL CAMBIO -->
    <h3 class="text-red-500 mb-4 mt-8"><strong>•</strong> CON IL CAMBIO</h3>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
      <div class="flex items-center gap-4">
        <%= image_tag "bus3_mat/p047/p47_3.jpg",
            alt: "Moltiplicazione con cambio - passo 1",
            class: "max-w-full" %>
        <p class="text-gray-700">
          Moltiplica le <span class="text-cyan-500 font-bold">unità</span> per le <span class="text-cyan-500 font-bold">unità</span>.<br>
          Scrivi <span class="text-cyan-500 font-bold">2</span> sotto le <span class="text-cyan-500 font-bold">unità</span> e <span class="text-cyan-500 font-bold">+1</span> sopra le
          <span class="text-red-500 font-bold">decine</span>.
        </p>
      </div>

      <div class="flex items-center gap-4">
        <%= image_tag "bus3_mat/p047/p47_4.jpg",
            alt: "Moltiplicazione con cambio - passo 2",
            class: "max-w-full" %>
        <p class="text-gray-700">
          Moltiplica le <span class="text-cyan-500 font-bold">unità</span> per
          le <span class="text-red-500 font-bold">decine</span> e aggiungi <span class="text-cyan-500 font-bold">+1</span> al risultato.
        </p>
      </div>

      <div class="flex items-center gap-4">
        <%= image_tag "bus3_mat/p047/p47_5.jpg",
            alt: "Moltiplicazione con cambio - passo 3",
            class: "max-w-full" %>
        <p class="text-gray-700">
          Moltiplica le <span class="text-cyan-500 font-bold">unità</span> per le <span class="text-green-500 font-bold">centinaia</span>.
        </p>
      </div>
    </div>
  </div>

  <!-- Esercizio 1: Calcola in colonna (con modal) -->
  <div class="p-4 md:p-8 mb-8" data-controller="column-modal" data-action="keydown@window->column-modal#handleEscape">
    <div class="flex items-center gap-3 mb-6">
      <div class="bg-red-500 text-white rounded-full w-8 h-8 flex items-center justify-center font-bold flex-shrink-0">
        1
      </div>
      <p class="text-gray-700">
        Calcola in colonna sul quaderno.
      </p>
    </div>

    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 items-start">
      <!-- Column a: Senza cambio -->
      <button class="bg-orange-50 p-4 rounded-lg hover:bg-orange-100 transition cursor-pointer text-left border-2 border-transparent hover:border-orange-400"
              data-action="click->column-modal#openGroup"
              data-group="a"
              data-operations="122×4,221×3,110×6,324×2,320×3,201×4"
              data-show-carry="true"
              data-column-modal-target="groupButton">
        <div class="mb-3"><strong class="text-orange-500">a.</strong> Senza cambio</div>
        <div class="space-y-2" data-column-modal-target="operationsList" data-group="a">
          <div class="operation-item" data-index="0">122 × 4 =</div>
          <div class="operation-item" data-index="1">221 × 3 =</div>
          <div class="operation-item" data-index="2">110 × 6 =</div>
          <div class="operation-item" data-index="3">324 × 2 =</div>
          <div class="operation-item" data-index="4">320 × 3 =</div>
          <div class="operation-item" data-index="5">201 × 4 =</div>
        </div>
      </button>

      <!-- Column b: Con un cambio -->
      <button class="bg-blue-50 p-4 rounded-lg hover:bg-blue-100 transition cursor-pointer text-left border-2 border-transparent hover:border-blue-400"
              data-action="click->column-modal#openGroup"
              data-group="b"
              data-operations="126×3,104×8,145×2,136×2,180×2,190×4"
              data-show-carry="true"
              data-column-modal-target="groupButton">
        <div class="mb-3"><strong class="text-blue-500">b.</strong> Con un cambio</div>
        <div class="space-y-2" data-column-modal-target="operationsList" data-group="b">
          <div class="operation-item" data-index="0">126 × 3 =</div>
          <div class="operation-item" data-index="1">104 × 8 =</div>
          <div class="operation-item" data-index="2">145 × 2 =</div>
          <div class="operation-item" data-index="3">136 × 2 =</div>
          <div class="operation-item" data-index="4">180 × 2 =</div>
          <div class="operation-item" data-index="5">190 × 4 =</div>
        </div>
      </button>

      <!-- Column c: Con più cambi -->
      <button class="bg-green-50 p-4 rounded-lg hover:bg-green-100 transition cursor-pointer text-left border-2 border-transparent hover:border-green-400"
              data-action="click->column-modal#openGroup"
              data-group="c"
              data-operations="123×5,124×7,146×4"
              data-show-carry="true"
              data-column-modal-target="groupButton">
        <div class="mb-3"><strong class="text-purple-500">c.</strong> Con più cambi</div>
        <div class="space-y-2" data-column-modal-target="operationsList" data-group="c">
          <div class="operation-item" data-index="0">123 × 5 =</div>
          <div class="operation-item" data-index="1">124 × 7 =</div>
          <div class="operation-item" data-index="2">146 × 4 =</div>
        </div>
      </button>
    </div>

    <!-- Modal -->
    <%= render 'shared/column_modal', title: "Calcola in colonna", color: "green", show_save: true %>

    <div class="mt-6 text-right">
      <span class="text-gray-600">Quaderno →</span> <%= link_to "p. 150", pagina_path("bus3_mat_p150"), class: "text-cyan-600 font-bold hover:underline" %>
    </div>
  </div>

  <!-- Footer con controlli -->
  <%= render 'shared/exercise_controls' %>
</div>
