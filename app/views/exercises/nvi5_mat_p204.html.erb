<div class="max-w-6xl mx-auto bg-white p-3 md:p-6"
     data-controller="exercise-checker text-toggle font-controls word-highlighter"
     data-text-toggle-target="content"
     data-font-controls-target="content">

  <%= render 'shared/page_header', pagina: @pagina %>

  <div class="space-y-6">
    <!-- Box teoria -->
    <div class="p-4 bg-custom-blue-light rounded-lg">
      <div class="flex flex-col md:flex-row md:items-center gap-4">
        <div class="flex-1">
          <p class="text-gray-700">
            <span class="font-bold text-cyan-600">Frazioni equivalenti</span>: rappresentano la stessa parte dell'intero.
          </p>
        </div>
        <div class="flex items-center gap-4">
          <%= image_tag "nvi5_mat/p204/p204_01.jpg", class: "max-w-[150px]", alt: "esempio frazioni equivalenti" %>
          <div class="flex flex-col">
            <%= render 'shared/frazione', num: 2, den: 3, border: nil %>
            <%= render 'shared/frazione', num: 4, den: 6, border: nil %>
          </div>
        </div>
      </div>
    </div>

    <!-- Esercizio 1: IMPARARE TUTTI -->
    <div class="p-4 bg-white rounded-2xl border-3 border-yellow-400">
      <p class="font-bold text-gray-700 mb-4">
        <%= imparare_tutti_badge(1) %>
        Scrivi le frazioni corrispondenti alle parti colorate. Poi rispondi.
      </p>

      <div class="flex flex-col md:flex-row gap-6 items-center">
        <div class="flex items-center gap-4">
          <%= image_tag "nvi5_mat/p204/p204_02.jpg", class: "max-w-[250px]", alt: "figure" %>
        </div>
        <div class="flex gap-4">
          <%= render 'shared/frazione', num: nil, den: nil, num_answer: "1", den_answer: "2" %>
          <%= render 'shared/frazione', num: nil, den: nil, num_answer: "2", den_answer: "4" %>
          <%= render 'shared/frazione', num: nil, den: nil, num_answer: "4", den_answer: "8" %>
        </div>
      </div>

      <div class="mt-4 flex items-center gap-3 flex-wrap">
        <span class="text-cyan-500">•</span>
        <span class="text-gray-700">Le tre frazioni sono equivalenti?</span>
        <label class="relative flex items-center justify-center w-10 h-8 bg-white border-2 border-cyan-500 rounded cursor-pointer hover:bg-custom-blue-light-light has-checked:bg-cyan-300">
          <input type="radio" name="vf_equiv" class="absolute inset-0 opacity-0 cursor-pointer" data-correct-answer="true">
          <span>SÌ</span>
        </label>
        <label class="relative flex items-center justify-center w-10 h-8 bg-white border-2 border-cyan-500 rounded cursor-pointer hover:bg-custom-blue-light-light has-checked:bg-cyan-300">
          <input type="radio" name="vf_equiv" class="absolute inset-0 opacity-0 cursor-pointer" data-correct-answer="false">
          <span>NO</span>
        </label>
      </div>
    </div>

    <!-- Esercizio 2: Osserva l'operatore e scrivi la frazione equivalente -->
    <div>
      <p class="font-bold text-gray-700 mb-4">
        <%= numero_esercizio_badge(2) %>
        Osserva l'operatore e scrivi la frazione equivalente. Segui l'esempio.
      </p>

      <div class="p-3 bg-custom-blue-light-light rounded-2xl mb-4">
        <p class="text-gray-700">Per trovare frazioni equivalenti moltiplica o dividi numeratore e denominatore per lo stesso numero.</p>
      </div>

      <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
        <!-- Esempio: 3/10 × 6 = 18/60 -->
        <div class="p-3 border border-cyan-400 rounded">
          <div class="text-center mb-2 font-bold text-cyan-600">× 6</div>
          <div class="flex items-center justify-center gap-2">
            <%= render 'shared/frazione', num: 3, den: 10, border: nil %>
            <span class="text-cyan-500">→</span>
            <span class="font-bold text-cyan-600"><%= render 'shared/frazione', num: 18, den: 60, border: nil %></span>
          </div>
          <div class="text-center mt-2 font-bold text-cyan-600">× 6</div>
        </div>

        <!-- 25/20 : 5 = 5/4 -->
        <div class="p-3 border border-cyan-400 rounded">
          <div class="text-center mb-2 font-bold text-cyan-600">: 5</div>
          <div class="flex items-center justify-center gap-2">
            <%= render 'shared/frazione', num: 25, den: 20, border: nil %>
            <span class="text-cyan-500">→</span>
            <%= render 'shared/frazione', num: nil, den: nil, num_answer: "5", den_answer: "4" %>
          </div>
          <div class="text-center mt-2 font-bold text-cyan-600">: 5</div>
        </div>

        <!-- 5/9 × 5 = 25/45 -->
        <div class="p-3 border border-cyan-400 rounded">
          <div class="text-center mb-2 font-bold text-cyan-600">× 5</div>
          <div class="flex items-center justify-center gap-2">
            <%= render 'shared/frazione', num: 5, den: 9, border: nil %>
            <span class="text-cyan-500">→</span>
            <%= render 'shared/frazione', num: nil, den: nil, num_answer: "25", den_answer: "45" %>
          </div>
          <div class="text-center mt-2 font-bold text-cyan-600">× 5</div>
        </div>

        <!-- 48/72 : 8 = 6/9 -->
        <div class="p-3 border border-cyan-400 rounded">
          <div class="text-center mb-2 font-bold text-cyan-600">: 8</div>
          <div class="flex items-center justify-center gap-2">
            <%= render 'shared/frazione', num: 48, den: 72, border: nil %>
            <span class="text-cyan-500">→</span>
            <%= render 'shared/frazione', num: nil, den: nil, num_answer: "6", den_answer: "9" %>
          </div>
          <div class="text-center mt-2 font-bold text-cyan-600">: 8</div>
        </div>

        <!-- 7/11 × 3 = 21/33 -->
        <div class="p-3 border border-cyan-400 rounded">
          <div class="text-center mb-2 font-bold text-cyan-600">× 3</div>
          <div class="flex items-center justify-center gap-2">
            <%= render 'shared/frazione', num: 7, den: 11, border: nil %>
            <span class="text-cyan-500">→</span>
            <%= render 'shared/frazione', num: nil, den: nil, num_answer: "21", den_answer: "33" %>
          </div>
          <div class="text-center mt-2 font-bold text-cyan-600">× 3</div>
        </div>

        <!-- 30/54 : 6 = 5/9 -->
        <div class="p-3 border border-cyan-400 rounded">
          <div class="text-center mb-2 font-bold text-cyan-600">: 6</div>
          <div class="flex items-center justify-center gap-2">
            <%= render 'shared/frazione', num: 30, den: 54, border: nil %>
            <span class="text-cyan-500">→</span>
            <%= render 'shared/frazione', num: nil, den: nil, num_answer: "5", den_answer: "9" %>
          </div>
          <div class="text-center mt-2 font-bold text-cyan-600">: 6</div>
        </div>

        <!-- 18/39 : 3 = 6/13 -->
        <div class="p-3 border border-cyan-400 rounded">
          <div class="text-center mb-2 font-bold text-cyan-600">: 3</div>
          <div class="flex items-center justify-center gap-2">
            <%= render 'shared/frazione', num: 18, den: 39, border: nil %>
            <span class="text-cyan-500">→</span>
            <%= render 'shared/frazione', num: nil, den: nil, num_answer: "6", den_answer: "13" %>
          </div>
          <div class="text-center mt-2 font-bold text-cyan-600">: 3</div>
        </div>

        <!-- 12/26 × 2 = 24/52 -->
        <div class="p-3 border border-cyan-400 rounded">
          <div class="text-center mb-2 font-bold text-cyan-600">× 2</div>
          <div class="flex items-center justify-center gap-2">
            <%= render 'shared/frazione', num: 12, den: 26, border: nil %>
            <span class="text-cyan-500">→</span>
            <%= render 'shared/frazione', num: nil, den: nil, num_answer: "24", den_answer: "52" %>
          </div>
          <div class="text-center mt-2 font-bold text-cyan-600">× 2</div>
        </div>

        <!-- 21/63 : 7 = 3/9 -->
        <div class="p-3 border border-cyan-400 rounded">
          <div class="text-center mb-2 font-bold text-cyan-600">: 7</div>
          <div class="flex items-center justify-center gap-2">
            <%= render 'shared/frazione', num: 21, den: 63, border: nil %>
            <span class="text-cyan-500">→</span>
            <%= render 'shared/frazione', num: nil, den: nil, num_answer: "3", den_answer: "9" %>
          </div>
          <div class="text-center mt-2 font-bold text-cyan-600">: 7</div>
        </div>

        <!-- 13/15 × 2 = 26/30 -->
        <div class="p-3 border border-cyan-400 rounded">
          <div class="text-center mb-2 font-bold text-cyan-600">× 2</div>
          <div class="flex items-center justify-center gap-2">
            <%= render 'shared/frazione', num: 13, den: 15, border: nil %>
            <span class="text-cyan-500">→</span>
            <%= render 'shared/frazione', num: nil, den: nil, num_answer: "26", den_answer: "30" %>
          </div>
          <div class="text-center mt-2 font-bold text-cyan-600">× 2</div>
        </div>
      </div>
    </div>

    <!-- Esercizio 3: Cerchia le frazioni equivalenti a 2/5 -->
    <div>
      <p class="font-bold text-gray-700 mb-4">
        <%= numero_esercizio_badge(3) %>
        Cerchia le frazioni equivalenti a <%= render 'shared/frazione', num: 2, den: 5, border: nil %>.
      </p>

      <div class="flex flex-wrap gap-3">
        <!-- 8/20 = 2/5 ✓ -->
        <span data-word-highlighter-target="word" data-correct="true" data-action="click->word-highlighter#toggleHighlight" class="cursor-pointer hover:opacity-80 p-2 border border-cyan-400 rounded"><%= render 'shared/frazione', num: 8, den: 20, border: nil %></span>
        <!-- 14/40 ≠ 2/5 -->
        <span data-word-highlighter-target="word" data-correct="false" data-action="click->word-highlighter#toggleHighlight" class="cursor-pointer hover:opacity-80 p-2 border border-cyan-400 rounded"><%= render 'shared/frazione', num: 14, den: 40, border: nil %></span>
        <!-- 10/25 = 2/5 ✓ -->
        <span data-word-highlighter-target="word" data-correct="true" data-action="click->word-highlighter#toggleHighlight" class="cursor-pointer hover:opacity-80 p-2 border border-cyan-400 rounded"><%= render 'shared/frazione', num: 10, den: 25, border: nil %></span>
        <!-- 6/15 = 2/5 ✓ -->
        <span data-word-highlighter-target="word" data-correct="true" data-action="click->word-highlighter#toggleHighlight" class="cursor-pointer hover:opacity-80 p-2 border border-cyan-400 rounded"><%= render 'shared/frazione', num: 6, den: 15, border: nil %></span>
        <!-- 12/35 ≠ 2/5 -->
        <span data-word-highlighter-target="word" data-correct="false" data-action="click->word-highlighter#toggleHighlight" class="cursor-pointer hover:opacity-80 p-2 border border-cyan-400 rounded"><%= render 'shared/frazione', num: 12, den: 35, border: nil %></span>
        <!-- 20/50 = 2/5 ✓ -->
        <span data-word-highlighter-target="word" data-correct="true" data-action="click->word-highlighter#toggleHighlight" class="cursor-pointer hover:opacity-80 p-2 border border-cyan-400 rounded"><%= render 'shared/frazione', num: 20, den: 50, border: nil %></span>
        <!-- 4/10 = 2/5 ✓ -->
        <span data-word-highlighter-target="word" data-correct="true" data-action="click->word-highlighter#toggleHighlight" class="cursor-pointer hover:opacity-80 p-2 border border-cyan-400 rounded"><%= render 'shared/frazione', num: 4, den: 10, border: nil %></span>
        <!-- 40/80 ≠ 2/5 -->
        <span data-word-highlighter-target="word" data-correct="false" data-action="click->word-highlighter#toggleHighlight" class="cursor-pointer hover:opacity-80 p-2 border border-cyan-400 rounded"><%= render 'shared/frazione', num: 40, den: 80, border: nil %></span>
        <!-- 200/1000 ≠ 2/5 -->
        <span data-word-highlighter-target="word" data-correct="false" data-action="click->word-highlighter#toggleHighlight" class="cursor-pointer hover:opacity-80 p-2 border border-cyan-400 rounded"><%= render 'shared/frazione', num: 200, den: 1000, border: nil %></span>
      </div>
    </div>

    <!-- Esercizio 4: Colora solo le frazioni equivalenti a quella data -->
    <div>
      <p class="font-bold text-gray-700 mb-4">
        <%= numero_esercizio_badge(4) %>
        Colora solo le frazioni equivalenti a quella data.
      </p>

      <div class="flex flex-wrap gap-3">
        <!-- 5/7 - frazioni equivalenti: 50/70, 10/14, 15/21 -->
        <div class="p-2 border-2 border-cyan-400 rounded font-bold bg-custom-blue-light-light"><%= render 'shared/frazione', num: 5, den: 7, border: nil %></div>
        <!-- 50/70 = 5/7 ✓ -->
        <span data-word-highlighter-target="word" data-correct="true" data-action="click->word-highlighter#toggleHighlight" class="cursor-pointer hover:opacity-80 p-2 border border-cyan-400 rounded"><%= render 'shared/frazione', num: 50, den: 70, border: nil %></span>
        <!-- 3/4 ≠ 5/7 -->
        <span data-word-highlighter-target="word" data-correct="false" data-action="click->word-highlighter#toggleHighlight" class="cursor-pointer hover:opacity-80 p-2 border border-cyan-400 rounded"><%= render 'shared/frazione', num: 3, den: 4, border: nil %></span>
        <!-- 10/14 = 5/7 ✓ -->
        <span data-word-highlighter-target="word" data-correct="true" data-action="click->word-highlighter#toggleHighlight" class="cursor-pointer hover:opacity-80 p-2 border border-cyan-400 rounded"><%= render 'shared/frazione', num: 10, den: 14, border: nil %></span>
        <!-- 15/14 ≠ 5/7 -->
        <span data-word-highlighter-target="word" data-correct="false" data-action="click->word-highlighter#toggleHighlight" class="cursor-pointer hover:opacity-80 p-2 border border-cyan-400 rounded"><%= render 'shared/frazione', num: 15, den: 14, border: nil %></span>
      </div>

      <div class="flex flex-wrap gap-3 mt-4">
        <!-- 8/20 - frazioni equivalenti: 4/10, 2/5 -->
        <div class="p-2 border-2 border-cyan-400 rounded font-bold bg-custom-blue-light-light"><%= render 'shared/frazione', num: 8, den: 20, border: nil %></div>
        <!-- 4/10 = 8/20 ✓ -->
        <span data-word-highlighter-target="word" data-correct="true" data-action="click->word-highlighter#toggleHighlight" class="cursor-pointer hover:opacity-80 p-2 border border-cyan-400 rounded"><%= render 'shared/frazione', num: 4, den: 10, border: nil %></span>
        <!-- 2/5 = 8/20 ✓ -->
        <span data-word-highlighter-target="word" data-correct="true" data-action="click->word-highlighter#toggleHighlight" class="cursor-pointer hover:opacity-80 p-2 border border-cyan-400 rounded"><%= render 'shared/frazione', num: 2, den: 5, border: nil %></span>
        <!-- 1/5 ≠ 8/20 -->
        <span data-word-highlighter-target="word" data-correct="false" data-action="click->word-highlighter#toggleHighlight" class="cursor-pointer hover:opacity-80 p-2 border border-cyan-400 rounded"><%= render 'shared/frazione', num: 1, den: 5, border: nil %></span>
        <!-- 16/40 = 8/20 ✓ -->
        <span data-word-highlighter-target="word" data-correct="true" data-action="click->word-highlighter#toggleHighlight" class="cursor-pointer hover:opacity-80 p-2 border border-cyan-400 rounded"><%= render 'shared/frazione', num: 16, den: 40, border: nil %></span>
      </div>
    </div>

    <%= render 'shared/exercise_controls' %>
  </div>
</div>
