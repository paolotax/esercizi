<div class="max-w-6xl mx-auto p-3 md:p-8 bg-gradient-to-br from-cyan-50 via-white to-blue-50 rounded-3xl shadow-xl" data-controller="exercise-checker">

  <!-- Header -->
  <%= render 'shared/page_header', pagina: @pagina %>

  <!-- Esercizio 1: Completa con complemento di mezzo -->
  <div class="mb-6 bg-white rounded-2xl border-4 border-yellow-200 shadow-2xl p-4 md:p-6" data-controller="fill-blanks">
    <h2 class="text-lg md:text-xl font-bold text-yellow-700 mb-3">
      <div class="flex items-center gap-2 flex-wrap">
        <div class="flex items-center gap-2">
          <span class="bg-yellow-600 text-white rounded-full w-8 h-8 md:w-10 md:h-10 inline-flex items-center justify-center flex-shrink-0">1</span>
          <span class="bg-yellow-400 text-blue-800 px-2 py-1 rounded text-sm md:text-base font-bold whitespace-nowrap">IMPARARE TUTTI</span>
        </div>
        <span>Completa con un <span class="text-blue-600 font-bold">complemento di mezzo</span> (<em>con che cosa? / per mezzo di chi? / per mezzo di che cosa?</em>).</span>
      </div>
    </h2>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-3 text-base md:text-lg">
      <div class="bg-yellow-50 border-2 border-yellow-200 rounded-xl px-3 py-3">
        <div class="flex items-center gap-2">
          <span class="text-gray-700">• Mi piace dipingere</span>
          <input type="text"
                 class="border-b-2 border-yellow-500 bg-transparent px-2 py-1 focus:outline-none focus:border-yellow-700 flex-1"
                 data-fill-blanks-target="input"
                 data-correct-answer="libera"
                 placeholder="">
        </div>
      </div>

      <div class="bg-yellow-50 border-2 border-yellow-200 rounded-xl px-3 py-3">
        <div class="flex items-center gap-2">
          <span class="text-gray-700">• Io vado a scuola</span>
          <input type="text"
                 class="border-b-2 border-yellow-500 bg-transparent px-2 py-1 focus:outline-none focus:border-yellow-700 flex-1"
                 data-fill-blanks-target="input"
                 data-correct-answer="libera"
                 placeholder="">
        </div>
      </div>

      <div class="bg-yellow-50 border-2 border-yellow-200 rounded-xl px-3 py-3">
        <div class="flex items-center gap-2">
          <span class="text-gray-700">• Ho piantato il chiodo</span>
          <input type="text"
                 class="border-b-2 border-yellow-500 bg-transparent px-2 py-1 focus:outline-none focus:border-yellow-700 flex-1"
                 data-fill-blanks-target="input"
                 data-correct-answer="libera"
                 placeholder="">
        </div>
      </div>

      <div class="bg-yellow-50 border-2 border-yellow-200 rounded-xl px-3 py-3">
        <div class="flex items-center gap-2">
          <span class="text-gray-700">• Marta ha incartato i regali</span>
          <input type="text"
                 class="border-b-2 border-yellow-500 bg-transparent px-2 py-1 focus:outline-none focus:border-yellow-700 flex-1"
                 data-fill-blanks-target="input"
                 data-correct-answer="libera"
                 placeholder="">
        </div>
      </div>
    </div>
  </div>

  <!-- Esercizio 2: Completa con complemento di causa -->
  <div class="mb-6 bg-white rounded-2xl border-4 border-blue-200 shadow-2xl p-4 md:p-6" data-controller="fill-blanks">
    <h2 class="text-lg md:text-xl font-bold text-blue-700 mb-3">
      <div class="flex items-center gap-2 flex-wrap">
        <span class="bg-blue-600 text-white rounded-full w-8 h-8 md:w-10 md:h-10 inline-flex items-center justify-center flex-shrink-0">2</span>
        <span>Completa con un <span class="text-blue-600 font-bold">complemento di causa</span> (<em>per quale motivo? / per quale causa?</em>).</span>
      </div>
    </h2>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-3 text-base md:text-lg">
      <div class="bg-blue-50 border-2 border-blue-200 rounded-xl px-3 py-3">
        <div class="flex items-center gap-2">
          <span class="text-gray-700">• Domani indosserò i pantaloncini</span>
          <input type="text"
                 class="border-b-2 border-blue-500 bg-transparent px-2 py-1 focus:outline-none focus:border-blue-700 flex-1"
                 data-fill-blanks-target="input"
                 data-correct-answer="libera"
                 placeholder="">
        </div>
      </div>

      <div class="bg-blue-50 border-2 border-blue-200 rounded-xl px-3 py-3">
        <div class="flex items-center gap-2">
          <span class="text-gray-700">• Sono arrivata in ritardo</span>
          <input type="text"
                 class="border-b-2 border-blue-500 bg-transparent px-2 py-1 focus:outline-none focus:border-blue-700 flex-1"
                 data-fill-blanks-target="input"
                 data-correct-answer="libera"
                 placeholder="">
        </div>
      </div>

      <div class="bg-blue-50 border-2 border-blue-200 rounded-xl px-3 py-3">
        <div class="flex items-center gap-2">
          <span class="text-gray-700">• Il gelato si è sciolto</span>
          <input type="text"
                 class="border-b-2 border-blue-500 bg-transparent px-2 py-1 focus:outline-none focus:border-blue-700 flex-1"
                 data-fill-blanks-target="input"
                 data-correct-answer="libera"
                 placeholder="">
        </div>
      </div>

      <div class="bg-blue-50 border-2 border-blue-200 rounded-xl px-3 py-3">
        <div class="flex items-center gap-2">
          <span class="text-gray-700">• Il cofano dell'auto si è rovinato</span>
          <input type="text"
                 class="border-b-2 border-blue-500 bg-transparent px-2 py-1 focus:outline-none focus:border-blue-700 flex-1"
                 data-fill-blanks-target="input"
                 data-correct-answer="libera"
                 placeholder="">
        </div>
      </div>
    </div>
  </div>

  <!-- Esercizio 3: Osserva e sottolinea complementi di causa -->
  <div class="mb-6 bg-white rounded-2xl border-4 border-green-200 shadow-2xl p-4 md:p-6" data-controller="word-highlighter" data-word-highlighter-multi-color-value="false">
    <h2 class="text-lg md:text-xl font-bold text-green-700 mb-3">
      <div class="flex items-center gap-2 flex-wrap">
        <span class="bg-green-600 text-white rounded-full w-8 h-8 md:w-10 md:h-10 inline-flex items-center justify-center flex-shrink-0">3</span>
        <span>Osserva i sintagmi evidenziati e sottolinea quelli che sono <span class="text-blue-600 font-bold underline">complementi di causa</span>.</span>
      </div>
    </h2>

    <div class="bg-yellow-100 rounded-lg p-3 mb-4">
      <p class="text-sm md:text-base mb-2">Fai attenzione a non confondere la causa con l'obiettivo.</p>
      <p class="text-sm md:text-base">Non ci vedo più <strong class="text-red-600">dalla fame!</strong> → "dalla fame" è la <strong>causa</strong> per cui non ci vedo più.</p>
      <p class="text-sm md:text-base">Preparo la tavola <strong class="text-red-600">per il pranzo</strong> → "per il pranzo" è l'<strong>obiettivo</strong> per cui preparo la tavola.</p>
    </div>

    <!-- Hidden color selector -->
    <div class="hidden">
      <span data-word-highlighter-target="colorBox" data-color="green"></span>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-3 text-base md:text-lg cursor-pointer">
      <div class="bg-green-50 border-2 border-green-200 rounded-xl px-3 py-3">
        <span class="text-gray-700">• Le mura furono costruite <span data-word-highlighter-target="word" data-correct="false" data-action="click->word-highlighter#toggleHighlight" class="px-1 rounded font-bold">per difesa</span>.</span>
      </div>

      <div class="bg-green-50 border-2 border-green-200 rounded-xl px-3 py-3">
        <span class="text-gray-700">• Arrossì <span data-word-highlighter-target="word" data-correct="green" data-action="click->word-highlighter#toggleHighlight" class="px-1 rounded font-bold">dalla vergogna</span>.</span>
      </div>

      <div class="bg-green-50 border-2 border-green-200 rounded-xl px-3 py-3">
        <span class="text-gray-700">• Piangeva <span data-word-highlighter-target="word" data-correct="green" data-action="click->word-highlighter#toggleHighlight" class="px-1 rounded font-bold">per l'emozione</span>.</span>
      </div>

      <div class="bg-green-50 border-2 border-green-200 rounded-xl px-3 py-3">
        <span class="text-gray-700">• <span data-word-highlighter-target="word" data-correct="green" data-action="click->word-highlighter#toggleHighlight" class="px-1 rounded font-bold">Per l'impegno</span>, meriti un premio.</span>
      </div>

      <div class="bg-green-50 border-2 border-green-200 rounded-xl px-3 py-3">
        <span class="text-gray-700">• Preparatevi <span data-word-highlighter-target="word" data-correct="false" data-action="click->word-highlighter#toggleHighlight" class="px-1 rounded font-bold">per l'uscita</span>.</span>
      </div>

      <div class="bg-green-50 border-2 border-green-200 rounded-xl px-3 py-3">
        <span class="text-gray-700">• <span data-word-highlighter-target="word" data-correct="green" data-action="click->word-highlighter#toggleHighlight" class="px-1 rounded font-bold">Per la fretta</span>, hai sbagliato i calcoli.</span>
      </div>

      <div class="bg-green-50 border-2 border-green-200 rounded-xl px-3 py-3">
        <span class="text-gray-700">• Si fermò <span data-word-highlighter-target="word" data-correct="green" data-action="click->word-highlighter#toggleHighlight" class="px-1 rounded font-bold">per la grandine</span>.</span>
      </div>

      <div class="bg-green-50 border-2 border-green-200 rounded-xl px-3 py-3">
        <span class="text-gray-700">• Si è allenato tanto <span data-word-highlighter-target="word" data-correct="false" data-action="click->word-highlighter#toggleHighlight" class="px-1 rounded font-bold">per la gara</span>.</span>
      </div>
    </div>
  </div>

  <!-- Esercizio 4: Sottolinea complementi di mezzo e causa -->
  <div class="mb-6 bg-white rounded-2xl border-4 border-purple-200 shadow-2xl p-4 md:p-6" data-controller="word-highlighter" data-word-highlighter-multi-color-value="true">
    <h2 class="text-lg md:text-xl font-bold text-purple-700 mb-3">
      <div class="flex items-center gap-2 flex-wrap">
        <span class="bg-purple-600 text-white rounded-full w-8 h-8 md:w-10 md:h-10 inline-flex items-center justify-center flex-shrink-0">4</span>
        <span>Sottolinea in <span class="text-red-600 font-bold">rosso<span class="inline-block w-6 h-6 bg-red-300 rounded ml-1 align-middle cursor-pointer transition transform hover:scale-110" data-word-highlighter-target="colorBox" data-color="red" data-action="click->word-highlighter#selectColor"></span></span> i <span class="underline">complementi di mezzo</span>,
        in <span class="text-blue-600 font-bold">blu<span class="inline-block w-6 h-6 bg-blue-300 rounded ml-1 align-middle cursor-pointer transition transform hover:scale-110" data-word-highlighter-target="colorBox" data-color="blue" data-action="click->word-highlighter#selectColor"></span></span> i <span class="underline">complementi di causa</span>.</span>
      </div>
    </h2>

    <div class="space-y-3 text-base md:text-lg cursor-pointer">
      <div class="bg-purple-50 border-2 border-purple-200 rounded-xl px-3 py-3">
        <span class="text-gray-700">• Il nonno è a letto <span data-word-highlighter-target="word" data-correct="blue" data-action="click->word-highlighter#toggleHighlight" class="px-1 rounded">per l'influenza</span>.</span>
      </div>

      <div class="bg-purple-50 border-2 border-purple-200 rounded-xl px-3 py-3">
        <span class="text-gray-700">• <span data-word-highlighter-target="word" data-correct="blue" data-action="click->word-highlighter#toggleHighlight" class="px-1 rounded">Per il freddo</span> abbiamo dovuto ripararci <span data-word-highlighter-target="word" data-correct="red" data-action="click->word-highlighter#toggleHighlight" class="px-1 rounded">con guanti e sciarpe</span>.</span>
      </div>

      <div class="bg-purple-50 border-2 border-purple-200 rounded-xl px-3 py-3">
        <span class="text-gray-700">• Bisogna sbattere le uova <span data-word-highlighter-target="word" data-correct="red" data-action="click->word-highlighter#toggleHighlight" class="px-1 rounded">con la frusta</span>.</span>
      </div>

      <div class="bg-purple-50 border-2 border-purple-200 rounded-xl px-3 py-3">
        <span class="text-gray-700">• Il treno non è partito <span data-word-highlighter-target="word" data-correct="blue" data-action="click->word-highlighter#toggleHighlight" class="px-1 rounded">per un guasto sui binari</span>, sono dovuto venire <span data-word-highlighter-target="word" data-correct="red" data-action="click->word-highlighter#toggleHighlight" class="px-1 rounded">con l'auto</span>.</span>
      </div>

      <div class="bg-purple-50 border-2 border-purple-200 rounded-xl px-3 py-3">
        <span class="text-gray-700">• Ti scrivo a breve <span data-word-highlighter-target="word" data-correct="red" data-action="click->word-highlighter#toggleHighlight" class="px-1 rounded">con la posta elettronica</span>.</span>
      </div>
    </div>
  </div>

  <div class="text-right text-sm text-gray-500 mb-6">
    Grammatica pp. <%= link_to "112", pagina_path("nvl5_gram_p112"), class: "text-red-600 hover:text-red-800 underline font-bold" %>, <%= link_to "113", pagina_path("nvl5_gram_p113"), class: "text-red-600 hover:text-red-800 underline font-bold" %>
  </div>

  <!-- Exercise Controls -->
  <div class="mt-6">
    <%= render 'shared/exercise_controls', color: 'cyan', current_page: 'nvl5_gram_p186' %>
  </div>
</div>