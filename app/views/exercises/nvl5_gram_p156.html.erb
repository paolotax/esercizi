<div class="max-w-6xl mx-auto bg-white dark:bg-gray-900 text-black dark:text-white p-3 md:p-6 transition-colors duration-300"
     data-controller="exercise-checker text-toggle font-controls"
     data-text-toggle-target="content"
     data-font-controls-target="content">

  <%= render 'shared/page_header', pagina: @pagina %>

  <!-- Esercizio 1: Cerchia il pronome personale adatto -->
  <div class="mb-6 bg-white dark:bg-gray-800 rounded-2xl border-4 border-yellow-200 dark:border-yellow-700 shadow-2xl p-4 md:p-6" data-controller="word-highlighter" data-word-highlighter-multi-color-value="false">
    <h2 class="font-bold text-yellow-700 dark:text-yellow-400 mb-3">
      <div class="flex items-center gap-2 flex-wrap">
        <div class="flex items-center gap-2">
          <span class="bg-yellow-600 text-white rounded-full w-8 h-8 md:w-10 md:h-10 inline-flex items-center justify-center flex-shrink-0">1</span>
          <span class="bg-yellow-400 text-blue-800 px-2 py-1 rounded font-bold whitespace-nowrap">IMPARARE TUTTI</span>
        </div>
        <span>Cerchia il <span class="text-blue-600 dark:text-blue-400 font-bold underline">pronome personale</span> adatto.</span>
      </div>
    </h2>

    <!-- Hidden color selector -->
    <div class="hidden">
      <span data-word-highlighter-target="colorBox" data-color="yellow"></span>
    </div>

    <div class="space-y-3 cursor-pointer">
      <div class="bg-yellow-50 dark:bg-yellow-900/30 border-2 border-yellow-200 dark:border-yellow-700 rounded-xl px-3 py-3">
        <span class="text-gray-700 dark:text-gray-200">• È il compleanno del nonno: <span data-word-highlighter-target="word" data-correct="false" data-action="click->word-highlighter#toggleHighlight" class="rounded font-bold">li</span> / <span data-word-highlighter-target="word" data-correct="true" data-action="click->word-highlighter#toggleHighlight" class="rounded font-bold">gli</span> ho regalato un cappello.</span>
      </div>

      <div class="bg-yellow-50 dark:bg-yellow-900/30 border-2 border-yellow-200 dark:border-yellow-700 rounded-xl px-3 py-3">
        <span class="text-gray-700 dark:text-gray-200">• Ho incontrato Mia e <span data-word-highlighter-target="word" data-correct="false" data-action="click->word-highlighter#toggleHighlight" class="rounded font-bold">ci</span> / <span data-word-highlighter-target="word" data-correct="true" data-action="click->word-highlighter#toggleHighlight" class="rounded font-bold">le</span> ho detto tutto.</span>
      </div>

      <div class="bg-yellow-50 dark:bg-yellow-900/30 border-2 border-yellow-200 dark:border-yellow-700 rounded-xl px-3 py-3">
        <span class="text-gray-700 dark:text-gray-200">• Non trovo i guanti. <span data-word-highlighter-target="word" data-correct="true" data-action="click->word-highlighter#toggleHighlight" class="rounded font-bold">Li</span> / <span data-word-highlighter-target="word" data-correct="false" data-action="click->word-highlighter#toggleHighlight" class="rounded font-bold">Gli</span> hai visti?</span>
      </div>

      <div class="bg-yellow-50 dark:bg-yellow-900/30 border-2 border-yellow-200 dark:border-yellow-700 rounded-xl px-3 py-3">
        <span class="text-gray-700 dark:text-gray-200">• <span data-word-highlighter-target="word" data-correct="false" data-action="click->word-highlighter#toggleHighlight" class="rounded font-bold">Te</span> / <span data-word-highlighter-target="word" data-correct="true" data-action="click->word-highlighter#toggleHighlight" class="rounded font-bold">Tu</span> sei il mio migliore amico.</span>
      </div>

      <div class="bg-yellow-50 dark:bg-yellow-900/30 border-2 border-yellow-200 dark:border-yellow-700 rounded-xl px-3 py-3">
        <span class="text-gray-700 dark:text-gray-200">• <span data-word-highlighter-target="word" data-correct="true" data-action="click->word-highlighter#toggleHighlight" class="rounded font-bold">Te</span> / <span data-word-highlighter-target="word" data-correct="false" data-action="click->word-highlighter#toggleHighlight" class="rounded font-bold">Tu</span> e <span data-word-highlighter-target="word" data-correct="false" data-action="click->word-highlighter#toggleHighlight" class="rounded font-bold">me</span> / <span data-word-highlighter-target="word" data-correct="true" data-action="click->word-highlighter#toggleHighlight" class="rounded font-bold">io</span> andiamo molto d'accordo.</span>
      </div>

      <div class="bg-yellow-50 dark:bg-yellow-900/30 border-2 border-yellow-200 dark:border-yellow-700 rounded-xl px-3 py-3">
        <span class="text-gray-700 dark:text-gray-200">• Ho preparato una torta per Lucia: <span data-word-highlighter-target="word" data-correct="false" data-action="click->word-highlighter#toggleHighlight" class="rounded font-bold">gli</span> / <span data-word-highlighter-target="word" data-correct="true" data-action="click->word-highlighter#toggleHighlight" class="rounded font-bold">le</span> voglio fare una sorpresa.</span>
      </div>

      <div class="bg-yellow-50 dark:bg-yellow-900/30 border-2 border-yellow-200 dark:border-yellow-700 rounded-xl px-3 py-3">
        <span class="text-gray-700 dark:text-gray-200">• Telefonai a Paolo e <span data-word-highlighter-target="word" data-correct="true" data-action="click->word-highlighter#toggleHighlight" class="rounded font-bold">gli</span> / <span data-word-highlighter-target="word" data-correct="false" data-action="click->word-highlighter#toggleHighlight" class="rounded font-bold">li</span> chiesi di te.</span>
      </div>

      <div class="bg-yellow-50 dark:bg-yellow-900/30 border-2 border-yellow-200 dark:border-yellow-700 rounded-xl px-3 py-3">
        <span class="text-gray-700 dark:text-gray-200">• Non l'ho più vista, ma <span data-word-highlighter-target="word" data-correct="false" data-action="click->word-highlighter#toggleHighlight" class="rounded font-bold">gli</span> / <span data-word-highlighter-target="word" data-correct="true" data-action="click->word-highlighter#toggleHighlight" class="rounded font-bold">le</span> ho scritto.</span>
      </div>

      <div class="bg-yellow-50 dark:bg-yellow-900/30 border-2 border-yellow-200 dark:border-yellow-700 rounded-xl px-3 py-3">
        <span class="text-gray-700 dark:text-gray-200">• I nonni stanno partendo, <span data-word-highlighter-target="word" data-correct="true" data-action="click->word-highlighter#toggleHighlight" class="rounded font-bold">li</span> / <span data-word-highlighter-target="word" data-correct="false" data-action="click->word-highlighter#toggleHighlight" class="rounded font-bold">gli</span> hai salutati?</span>
      </div>

      <div class="bg-yellow-50 dark:bg-yellow-900/30 border-2 border-yellow-200 dark:border-yellow-700 rounded-xl px-3 py-3">
        <span class="text-gray-700 dark:text-gray-200">• Ho fatto un dolce: <span data-word-highlighter-target="word" data-correct="true" data-action="click->word-highlighter#toggleHighlight" class="rounded font-bold">ne</span> / <span data-word-highlighter-target="word" data-correct="false" data-action="click->word-highlighter#toggleHighlight" class="rounded font-bold">lo</span> vuoi un po'?</span>
      </div>
    </div>
  </div>

  <!-- Esercizio 2: Colora articoli (blu) e pronomi (rosso) -->
  <div class="mb-6 bg-white dark:bg-gray-800 rounded-2xl border-4 border-blue-200 dark:border-blue-700 shadow-2xl p-4 md:p-6" data-controller="word-highlighter" data-word-highlighter-multi-color-value="true">
    <h2 class="font-bold text-blue-700 dark:text-blue-400 mb-3">
      <div class="flex items-center gap-2 flex-wrap">
        <span class="bg-blue-600 text-white rounded-full w-8 h-8 md:w-10 md:h-10 inline-flex items-center justify-center flex-shrink-0">2</span>
        <span>Colora i cartellini con <strong>la, lo, gli, le</strong> di <span class="text-red-600 font-bold">rosso<span class="inline-block w-6 h-6 bg-red-300 rounded ml-1 align-middle cursor-pointer transition transform hover:scale-110" data-word-highlighter-target="colorBox" data-color="red" data-action="click->word-highlighter#selectColor"></span></span> se sono <span class="underline">pronomi</span>, di <span class="text-blue-600 font-bold">blu<span class="inline-block w-6 h-6 bg-blue-300 rounded ml-1 align-middle cursor-pointer transition transform hover:scale-110" data-word-highlighter-target="colorBox" data-color="blue" data-action="click->word-highlighter#selectColor"></span></span> se sono <span class="underline">articoli</span>.</span>
      </div>
    </h2>

    <div class="space-y-3 cursor-pointer">
      <div class="bg-blue-50 dark:bg-blue-900/30 border-2 border-blue-200 dark:border-blue-700 rounded-xl px-3 py-3">
        <span class="text-gray-700 dark:text-gray-200">• <span data-word-highlighter-target="word" data-correct="blue" data-action="click->word-highlighter#toggleHighlight" class="rounded font-bold">Le</span> arance sono buone e tutti <span data-word-highlighter-target="word" data-correct="red" data-action="click->word-highlighter#toggleHighlight" class="rounded font-bold">le</span> mangiano volentieri.</span>
      </div>

      <div class="bg-blue-50 dark:bg-blue-900/30 border-2 border-blue-200 dark:border-blue-700 rounded-xl px-3 py-3">
        <span class="text-gray-700 dark:text-gray-200">• Se vedo Piero <span data-word-highlighter-target="word" data-correct="red" data-action="click->word-highlighter#toggleHighlight" class="rounded font-bold">gli</span> restituisco <span data-word-highlighter-target="word" data-correct="blue" data-action="click->word-highlighter#toggleHighlight" class="rounded font-bold">gli</span> sci che mi ha prestato.</span>
      </div>

      <div class="bg-blue-50 dark:bg-blue-900/30 border-2 border-blue-200 dark:border-blue-700 rounded-xl px-3 py-3">
        <span class="text-gray-700 dark:text-gray-200">• Come sta Carla? <span data-word-highlighter-target="word" data-correct="red" data-action="click->word-highlighter#toggleHighlight" class="rounded font-bold">La</span> vidi qualche mese fa in giro con <span data-word-highlighter-target="word" data-correct="blue" data-action="click->word-highlighter#toggleHighlight" class="rounded font-bold">la</span> sua bicicletta rossa.</span>
      </div>

      <div class="bg-blue-50 dark:bg-blue-900/30 border-2 border-blue-200 dark:border-blue-700 rounded-xl px-3 py-3">
        <span class="text-gray-700 dark:text-gray-200">• <span data-word-highlighter-target="word" data-correct="blue" data-action="click->word-highlighter#toggleHighlight" class="rounded font-bold">Lo</span> gnomo di questa favola si chiama Temperino. <span data-word-highlighter-target="word" data-correct="red" data-action="click->word-highlighter#toggleHighlight" class="rounded font-bold">Lo</span> sapevi?</span>
      </div>

      <div class="bg-blue-50 dark:bg-blue-900/30 border-2 border-blue-200 dark:border-blue-700 rounded-xl px-3 py-3">
        <span class="text-gray-700 dark:text-gray-200">• I pesci hanno <span data-word-highlighter-target="word" data-correct="blue" data-action="click->word-highlighter#toggleHighlight" class="rounded font-bold">le</span> lische, cerca di non ingoiar<span data-word-highlighter-target="word" data-correct="red" data-action="click->word-highlighter#toggleHighlight" class="rounded font-bold">le</span>!</span>
      </div>
    </div>
  </div>

  <!-- Esercizio 3: Completa con gli, le, la, loro -->
  <div class="mb-6 bg-white dark:bg-gray-800 rounded-2xl border-4 border-green-200 dark:border-green-700 shadow-2xl p-4 md:p-6" data-controller="fill-blanks">
    <h2 class="font-bold text-green-700 dark:text-green-400 mb-3">
      <div class="flex items-center gap-2 flex-wrap">
        <span class="bg-green-600 text-white rounded-full w-8 h-8 md:w-10 md:h-10 inline-flex items-center justify-center flex-shrink-0">3</span>
        <span>Completa con <strong>gli, le, la, loro</strong>.</span>
      </div>
    </h2>

    <div class="bg-green-50 dark:bg-green-900/30 border-2 border-green-200 dark:border-green-700 rounded-xl px-4 py-4 leading-relaxed">
      <p class="mb-3 text-gray-700 dark:text-gray-200">Matilde stava leggendo sotto l'albero quando giunsero cinque fate.</p>
      <p class="mb-3 text-gray-700 dark:text-gray-200"><input type="text" class="border-b-2 border-green-500 dark:border-green-400 bg-transparent dark:text-white px-2 py-1 focus:outline-none focus:border-green-700 w-32" data-fill-blanks-target="input" data-correct-answer="Le" placeholder=""> vide arrivare da lontano: all'inizio erano solo cinque puntini nel cielo, ma quando si avvicinarono capì che erano proprio <input type="text" class="border-b-2 border-green-500 dark:border-green-400 bg-transparent dark:text-white px-2 py-1 focus:outline-none focus:border-green-700 w-32" data-fill-blanks-target="input" data-correct-answer="loro|esse" placeholder="">, le fate. Ognuna cavalcava un cavallo alato. Quando atterrarono, Matilde si avvicinò al primo cavallo e <input type="text" class="border-b-2 border-green-500 dark:border-green-400 bg-transparent dark:text-white px-2 py-1 focus:outline-none focus:border-green-700 w-32" data-fill-blanks-target="input" data-correct-answer="gli" placeholder=""> porse uno zuccherino. Subito gli altri quattro cavalli <input type="text" class="border-b-2 border-green-500 dark:border-green-400 bg-transparent dark:text-white px-2 py-1 focus:outline-none focus:border-green-700 w-32" data-fill-blanks-target="input" data-correct-answer="le|la" placeholder=""> circondarono e lei diede uno zuccherino anche a ciascuno di <input type="text" class="border-b-2 border-green-500 dark:border-green-400 bg-transparent dark:text-white px-2 py-1 focus:outline-none focus:border-green-700 w-32" data-fill-blanks-target="input" data-correct-answer="loro|essi" placeholder="">.</p>
    </div>
  </div>

  <div class="text-right text-gray-500 dark:text-gray-400 mb-6">
    Grammatica pp. <%= link_to "54", pagina_path("nvl5_gram_p054"), class: "text-red-600 hover:text-red-800 dark:text-red-400 dark:hover:text-red-300 underline font-bold" %>, <%= link_to "55", pagina_path("nvl5_gram_p055"), class: "text-red-600 hover:text-red-800 dark:text-red-400 dark:hover:text-red-300 underline font-bold" %>
  </div>

  <%= render 'shared/exercise_controls' %>

</div>
