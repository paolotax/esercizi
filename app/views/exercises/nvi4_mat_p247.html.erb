<div class="max-w-6xl mx-auto bg-white dark:bg-gray-900 p-3 md:p-6 transition-colors duration-300"
     data-controller="exercise-checker text-toggle font-controls"
     data-text-toggle-target="content"
     data-font-controls-target="content">

  <%= render 'shared/page_header', pagina: @pagina %>

  <div class="space-y-6">

    <!-- Tabella misure di superficie -->
    <div class="overflow-x-auto">
      <table class="w-full border-collapse border-2 border-cyan-400 dark:border-cyan-600">
        <thead>
          <tr>
            <th colspan="6" class="p-2 bg-cyan-100 dark:bg-cyan-800 border-2 border-cyan-400 dark:border-cyan-600 text-center text-gray-800 dark:text-gray-200 font-bold">MULTIPLI</th>
            <th colspan="2" class="p-2 bg-cyan-200 dark:bg-cyan-700 border-2 border-cyan-400 dark:border-cyan-600 text-center text-gray-800 dark:text-gray-200 font-bold">UNITÀ FONDAMENTALE</th>
            <th colspan="6" class="p-2 bg-cyan-100 dark:bg-cyan-800 border-2 border-cyan-400 dark:border-cyan-600 text-center text-gray-800 dark:text-gray-200 font-bold">SOTTOMULTIPLI</th>
          </tr>
          <tr>
            <th colspan="2" class="p-2 bg-white dark:bg-gray-700 border-2 border-cyan-400 dark:border-cyan-600 text-center text-gray-700 dark:text-gray-200">chilometro quadrato<br><span class="font-bold">km²</span></th>
            <th colspan="2" class="p-2 bg-white dark:bg-gray-700 border-2 border-cyan-400 dark:border-cyan-600 text-center text-gray-700 dark:text-gray-200">ettometro quadrato<br><span class="font-bold">hm²</span></th>
            <th colspan="2" class="p-2 bg-white dark:bg-gray-700 border-2 border-cyan-400 dark:border-cyan-600 text-center text-gray-700 dark:text-gray-200">decametro quadrato<br><span class="font-bold">dam²</span></th>
            <th colspan="2" class="p-2 bg-cyan-50 dark:bg-cyan-900 border-2 border-cyan-400 dark:border-cyan-600 text-center text-gray-700 dark:text-gray-200">metro quadrato<br><span class="font-bold">m²</span></th>
            <th colspan="2" class="p-2 bg-white dark:bg-gray-700 border-2 border-cyan-400 dark:border-cyan-600 text-center text-gray-700 dark:text-gray-200">decimetro quadrato<br><span class="font-bold">dm²</span></th>
            <th colspan="2" class="p-2 bg-white dark:bg-gray-700 border-2 border-cyan-400 dark:border-cyan-600 text-center text-gray-700 dark:text-gray-200">centimetro quadrato<br><span class="font-bold">cm²</span></th>
            <th colspan="2" class="p-2 bg-white dark:bg-gray-700 border-2 border-cyan-400 dark:border-cyan-600 text-center text-gray-700 dark:text-gray-200">millimetro quadrato<br><span class="font-bold">mm²</span></th>
          </tr>
          <tr>
            <th class="p-1 bg-white dark:bg-gray-700 border-2 border-cyan-400 dark:border-cyan-600 text-center text-gray-600 dark:text-gray-300">da</th>
            <th class="p-1 bg-white dark:bg-gray-700 border-2 border-cyan-400 dark:border-cyan-600 text-center text-gray-600 dark:text-gray-300">u</th>
            <th class="p-1 bg-white dark:bg-gray-700 border-2 border-cyan-400 dark:border-cyan-600 text-center text-gray-600 dark:text-gray-300">da</th>
            <th class="p-1 bg-white dark:bg-gray-700 border-2 border-cyan-400 dark:border-cyan-600 text-center text-gray-600 dark:text-gray-300">u</th>
            <th class="p-1 bg-white dark:bg-gray-700 border-2 border-cyan-400 dark:border-cyan-600 text-center text-gray-600 dark:text-gray-300">da</th>
            <th class="p-1 bg-white dark:bg-gray-700 border-2 border-cyan-400 dark:border-cyan-600 text-center text-gray-600 dark:text-gray-300">u</th>
            <th class="p-1 bg-cyan-50 dark:bg-cyan-900 border-2 border-cyan-400 dark:border-cyan-600 text-center text-gray-600 dark:text-gray-300 font-bold">da</th>
            <th class="p-1 bg-cyan-50 dark:bg-cyan-900 border-2 border-cyan-400 dark:border-cyan-600 text-center text-gray-600 dark:text-gray-300 font-bold">u</th>
            <th class="p-1 bg-white dark:bg-gray-700 border-2 border-cyan-400 dark:border-cyan-600 text-center text-gray-600 dark:text-gray-300">da</th>
            <th class="p-1 bg-white dark:bg-gray-700 border-2 border-cyan-400 dark:border-cyan-600 text-center text-gray-600 dark:text-gray-300">u</th>
            <th class="p-1 bg-white dark:bg-gray-700 border-2 border-cyan-400 dark:border-cyan-600 text-center text-gray-600 dark:text-gray-300">da</th>
            <th class="p-1 bg-white dark:bg-gray-700 border-2 border-cyan-400 dark:border-cyan-600 text-center text-gray-600 dark:text-gray-300">u</th>
            <th class="p-1 bg-white dark:bg-gray-700 border-2 border-cyan-400 dark:border-cyan-600 text-center text-gray-600 dark:text-gray-300">da</th>
            <th class="p-1 bg-white dark:bg-gray-700 border-2 border-cyan-400 dark:border-cyan-600 text-center text-gray-600 dark:text-gray-300">u</th>
          </tr>
        </thead>
      </table>
    </div>

    <!-- Regola conversione -->
    <div class="p-4 bg-custom-blue dark:bg-cyan-900 rounded-2xl">
      <p class="text-gray-700 dark:text-gray-200 mb-3">
        Per passare da un'unità di misura a un'altra si moltiplica o si divide per 100, 10 000 o 1 000 000.
      </p>
      <div class="flex flex-wrap justify-center gap-8">
        <div class="text-center">
          <p class="text-gray-700 dark:text-gray-200">34 m² = <span class="font-bold text-cyan-600 dark:text-cyan-400">0,34</span> dam²</p>
          <p class="text-gray-500 dark:text-gray-400">: 100</p>
        </div>
        <div class="text-center">
          <p class="text-gray-700 dark:text-gray-200">34 m² = <span class="font-bold text-cyan-600 dark:text-cyan-400">3 400</span> dm²</p>
          <p class="text-gray-500 dark:text-gray-400">× 100</p>
        </div>
      </div>
    </div>

    <!-- Grid due colonne -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 md:divide-x-2 md:divide-cyan-300 dark:md:divide-cyan-600">

      <!-- Colonna sinistra -->
      <div class="md:pr-4 space-y-6">
        <!-- Esercizio 1 IMPARARE TUTTI -->
        <div class="p-5 bg-white dark:bg-gray-800 rounded-2xl border-3 border-yellow-400 dark:border-yellow-500 space-y-4">
          <p class="font-bold text-gray-700 dark:text-gray-200">
            <%= imparare_tutti_badge(1) %>
            Inserisci le misure in tabella. Segui l'esempio.
          </p>

          <div class="overflow-x-auto">
            <table class="w-full border-collapse border-2 border-cyan-400 dark:border-cyan-600">
              <thead>
                <tr>
                  <th class="p-1 border-2 border-cyan-400 dark:border-cyan-600 bg-white dark:bg-gray-700"></th>
                  <th colspan="2" class="p-1 border-2 border-cyan-400 dark:border-cyan-600 bg-cyan-100 dark:bg-cyan-800 text-gray-800 dark:text-gray-200 font-bold">m²</th>
                  <th colspan="2" class="p-1 border-2 border-cyan-400 dark:border-cyan-600 bg-cyan-100 dark:bg-cyan-800 text-gray-800 dark:text-gray-200 font-bold">dm²</th>
                  <th colspan="2" class="p-1 border-2 border-cyan-400 dark:border-cyan-600 bg-cyan-100 dark:bg-cyan-800 text-gray-800 dark:text-gray-200 font-bold">cm²</th>
                  <th colspan="2" class="p-1 border-2 border-cyan-400 dark:border-cyan-600 bg-cyan-100 dark:bg-cyan-800 text-gray-800 dark:text-gray-200 font-bold">mm²</th>
                </tr>
                <tr>
                  <th class="p-1 border-2 border-cyan-400 dark:border-cyan-600 bg-white dark:bg-gray-700"></th>
                  <th class="p-1 border-2 border-cyan-400 dark:border-cyan-600 bg-white dark:bg-gray-700 text-gray-600 dark:text-gray-300 font-bold">da</th>
                  <th class="p-1 border-2 border-cyan-400 dark:border-cyan-600 bg-white dark:bg-gray-700 text-gray-600 dark:text-gray-300 font-bold">u</th>
                  <th class="p-1 border-2 border-cyan-400 dark:border-cyan-600 bg-white dark:bg-gray-700 text-gray-600 dark:text-gray-300 font-bold">da</th>
                  <th class="p-1 border-2 border-cyan-400 dark:border-cyan-600 bg-white dark:bg-gray-700 text-gray-600 dark:text-gray-300 font-bold">u</th>
                  <th class="p-1 border-2 border-cyan-400 dark:border-cyan-600 bg-white dark:bg-gray-700 text-gray-600 dark:text-gray-300 font-bold">da</th>
                  <th class="p-1 border-2 border-cyan-400 dark:border-cyan-600 bg-white dark:bg-gray-700 text-gray-600 dark:text-gray-300 font-bold">u</th>
                  <th class="p-1 border-2 border-cyan-400 dark:border-cyan-600 bg-white dark:bg-gray-700 text-gray-600 dark:text-gray-300 font-bold">da</th>
                  <th class="p-1 border-2 border-cyan-400 dark:border-cyan-600 bg-white dark:bg-gray-700 text-gray-600 dark:text-gray-300 font-bold">u</th>
                </tr>
              </thead>
              <tbody>
                <!-- Esempio -->
                <tr>
                  <td class="p-1 border-2 border-cyan-400 dark:border-cyan-600 bg-white dark:bg-gray-700 text-gray-700 dark:text-gray-200 font-bold">3,82 dm²</td>
                  <td class="p-1 border-2 border-cyan-400 dark:border-cyan-600 bg-white dark:bg-gray-700 text-center"></td>
                  <td class="p-1 border-2 border-cyan-400 dark:border-cyan-600 bg-white dark:bg-gray-700 text-center"></td>
                  <td class="p-1 border-2 border-cyan-400 dark:border-cyan-600 bg-white dark:bg-gray-700 text-center"></td>
                  <td class="p-1 border-2 border-cyan-400 dark:border-cyan-600 bg-cyan-50 dark:bg-cyan-900 text-center font-bold text-cyan-600 dark:text-cyan-400">3</td>
                  <td class="p-1 border-2 border-cyan-400 dark:border-cyan-600 bg-cyan-50 dark:bg-cyan-900 text-center font-bold text-cyan-600 dark:text-cyan-400">8</td>
                  <td class="p-1 border-2 border-cyan-400 dark:border-cyan-600 bg-cyan-50 dark:bg-cyan-900 text-center font-bold text-cyan-600 dark:text-cyan-400">2</td>
                  <td class="p-1 border-2 border-cyan-400 dark:border-cyan-600 bg-white dark:bg-gray-700 text-center"></td>
                  <td class="p-1 border-2 border-cyan-400 dark:border-cyan-600 bg-white dark:bg-gray-700 text-center"></td>
                </tr>
                <!-- Righe da completare -->
                <% [
                  { label: "2,80 m²", m2_da: "2", m2_u: "8", dm2_da: "0", dm2_u: "0", cm2_da: "", cm2_u: "", mm2_da: "", mm2_u: "" },
                  { label: "5,77 cm²", m2_da: "", m2_u: "", dm2_da: "", dm2_u: "", cm2_da: "5", cm2_u: "7", mm2_da: "7", mm2_u: "0" },
                  { label: "6,19 m²", m2_da: "6", m2_u: "1", dm2_da: "9", dm2_u: "0", cm2_da: "", cm2_u: "", mm2_da: "", mm2_u: "" },
                  { label: "470 mm²", m2_da: "", m2_u: "", dm2_da: "", dm2_u: "", cm2_da: "4", cm2_u: "7", mm2_da: "0", mm2_u: "0" },
                  { label: "1 725 mm²", m2_da: "", m2_u: "", dm2_da: "", dm2_u: "1", cm2_da: "7", cm2_u: "2", mm2_da: "5", mm2_u: "0" },
                  { label: "0,03 dm²", m2_da: "", m2_u: "", dm2_da: "", dm2_u: "0", cm2_da: "3", cm2_u: "0", mm2_da: "", mm2_u: "" }
                ].each do |row| %>
                <tr>
                  <td class="p-1 border-2 border-cyan-400 dark:border-cyan-600 bg-white dark:bg-gray-700 text-gray-700 dark:text-gray-200"><%= row[:label] %></td>
                  <% [:m2_da, :m2_u, :dm2_da, :dm2_u, :cm2_da, :cm2_u, :mm2_da, :mm2_u].each do |col| %>
                  <td class="p-1 border-2 border-cyan-400 dark:border-cyan-600 bg-white dark:bg-gray-700 text-center">
                    <input type="text" data-correct-answer="<%= row[col] %>" class="w-8 text-center font-bold bg-transparent dark:text-white border-none">
                  </td>
                  <% end %>
                </tr>
                <% end %>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Colonna destra -->
      <div class="md:pl-4 space-y-6">
        <!-- Esercizio 2 -->
        <div class="space-y-3">
          <p class="font-bold text-gray-700 dark:text-gray-200">
            <%= numero_esercizio_badge(2) %>
            Esegui le equivalenze.
          </p>

          <div class="space-y-2">
            <% [
              { value: "58 m²", answer: "0,58", unit: "dam²" },
              { value: "13,09 hm²", answer: "130900", unit: "m²" },
              { value: "7,20 cm²", answer: "720", unit: "mm²" },
              { value: "4,50 km²", answer: "450", unit: "hm²" },
              { value: "6 800 hm²", answer: "68", unit: "km²" }
            ].each do |eq| %>
            <div class="flex items-center gap-2">
              <span class="text-gray-700 dark:text-gray-200"><%= eq[:value] %> =</span>
              <input type="text" data-correct-answer="<%= eq[:answer] %>" class="w-24 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold bg-transparent dark:text-white">
              <span class="text-gray-700 dark:text-gray-200"><%= eq[:unit] %></span>
            </div>
            <% end %>
          </div>
        </div>

        <!-- Esercizio 3 -->
        <div class="space-y-3">
          <p class="font-bold text-gray-700 dark:text-gray-200">
            <%= numero_esercizio_badge(3) %>
            Completa con l'unità di misura adeguata.
          </p>

          <div class="space-y-2">
            <% [
              { value: "3 m² = 300", answer: "dm²" },
              { value: "34 dm² = 0,0034", answer: "hm²" },
              { value: "52 km² = 5 200", answer: "hm²" },
              { value: "6,10 cm² = 0,061", answer: "dm²" },
              { value: "87,30 hm² = 873 000", answer: "m²" }
            ].each do |eq| %>
            <div class="flex items-center gap-2">
              <span class="text-gray-700 dark:text-gray-200"><%= eq[:value] %></span>
              <input type="text" data-correct-answer="<%= eq[:answer] %>" class="w-16 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold bg-transparent dark:text-white">
            </div>
            <% end %>
          </div>
        </div>
      </div>
    </div>

    <!-- Esercizio 4 -->
    <div class="space-y-4">
      <p class="font-bold text-gray-700 dark:text-gray-200">
        <%= numero_esercizio_badge(4) %>
        Scomponi come nell'esempio. Aiutati con la tabella dell'esercizio 1.
      </p>

      <div class="space-y-3">
        <!-- Esempio -->
        <div class="flex flex-wrap items-center gap-2">
          <span class="text-gray-700 dark:text-gray-200">4 823 cm² =</span>
          <span class="font-bold text-cyan-600 dark:text-cyan-400">4 da di dm² 8 u di dm² 2 da di cm² 3 u di cm²</span>
        </div>

        <!-- Da completare -->
        <% [
          { value: "56 701 m²", answer: "5 da di dam² 6 u di dam² 7 da di m² 0 u di m² 1 da di dm²" },
          { value: "83,92 dm²", answer: "8 da di dm² 3 u di dm² 9 da di cm² 2 u di cm²" },
          { value: "7 046 hm²", answer: "7 u di km² 0 da di hm² 4 u di hm² 6 da di dam²" },
          { value: "0,91 dam²", answer: "9 da di m² 1 u di m²" },
          { value: "45 028 mm²", answer: "4 da di cm² 5 u di cm² 0 da di mm² 2 u di mm² 8 da" },
          { value: "4,53 km²", answer: "4 u di km² 5 da di hm² 3 u di hm²" }
        ].each do |eq| %>
        <div class="flex flex-wrap items-center gap-2">
          <span class="text-gray-700 dark:text-gray-200"><%= eq[:value] %> =</span>
          <input type="text" data-correct-answer="<%= eq[:answer] %>" class="flex-1 min-w-0 border-b-2 border-dotted border-gray-400 dark:border-gray-500 font-bold bg-transparent dark:text-white">
        </div>
        <% end %>
      </div>
    </div>

    <%= render 'shared/exercise_controls' %>
  </div>
</div>
