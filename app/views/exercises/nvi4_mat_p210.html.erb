<div class="max-w-6xl mx-auto bg-white dark:bg-gray-900 p-3 md:p-6 transition-colors duration-300"
     data-controller="exercise-checker text-toggle font-controls"
     data-text-toggle-target="content"
     data-font-controls-target="content">

  <%= render 'shared/page_header', pagina: @pagina %>

  <div class="space-y-6">

    <!-- Esercizio 1 IMPARARE TUTTI -->
    <div class="p-5 bg-white dark:bg-gray-800 rounded-2xl border-3 border-yellow-400 dark:border-yellow-500">
      <p class="font-bold text-gray-700 dark:text-gray-200 mb-4">
        <%= imparare_tutti_badge(1) %>
        Inserisci i seguenti numeri in tabella.
      </p>

      <p class="text-gray-700 dark:text-gray-200 mb-4">
        <span class="whitespace-nowrap">4 076,89</span> • <span class="whitespace-nowrap">1 070,52</span> • 43,201 • 6,923 • 0,583
      </p>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <!-- Tabella esempio -->
        <div class="space-y-2">
          <div class="overflow-x-auto">
            <table class="border-collapse border-2 border-cyan-400 dark:border-cyan-600">
              <thead>
                <tr>
                  <th colspan="4" class="p-2 border-2 border-cyan-400 dark:border-cyan-600 bg-cyan-100 dark:bg-cyan-800 text-center font-bold text-gray-800 dark:text-gray-200">Parte intera</th>
                  <th class="p-2 border-2 border-cyan-400 dark:border-cyan-600 bg-white dark:bg-gray-700"></th>
                  <th colspan="3" class="p-2 border-2 border-cyan-400 dark:border-cyan-600 bg-pink-200 dark:bg-pink-800 text-center font-bold text-gray-800 dark:text-gray-200">Parte decimale</th>
                </tr>
                <tr>
                  <th class="p-2 border-2 border-cyan-400 dark:border-cyan-600 bg-cyan-50 dark:bg-cyan-900 text-center text-gray-700 dark:text-gray-200">uk</th>
                  <th class="p-2 border-2 border-cyan-400 dark:border-cyan-600 bg-cyan-50 dark:bg-cyan-900 text-center text-gray-700 dark:text-gray-200">h</th>
                  <th class="p-2 border-2 border-cyan-400 dark:border-cyan-600 bg-cyan-50 dark:bg-cyan-900 text-center text-gray-700 dark:text-gray-200">da</th>
                  <th class="p-2 border-2 border-cyan-400 dark:border-cyan-600 bg-cyan-50 dark:bg-cyan-900 text-center text-gray-700 dark:text-gray-200">u</th>
                  <th class="p-2 border-2 border-cyan-400 dark:border-cyan-600 bg-white dark:bg-gray-700 text-center text-gray-700 dark:text-gray-200"></th>
                  <th class="p-2 border-2 border-cyan-400 dark:border-cyan-600 bg-pink-50 dark:bg-pink-900 text-center text-gray-700 dark:text-gray-200">d</th>
                  <th class="p-2 border-2 border-cyan-400 dark:border-cyan-600 bg-pink-50 dark:bg-pink-900 text-center text-gray-700 dark:text-gray-200">c</th>
                  <th class="p-2 border-2 border-cyan-400 dark:border-cyan-600 bg-pink-50 dark:bg-pink-900 text-center text-gray-700 dark:text-gray-200">m</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td class="p-2 border-2 border-cyan-400 dark:border-cyan-600 bg-white dark:bg-gray-700 text-center font-bold text-gray-700 dark:text-gray-200"></td>
                  <td class="p-2 border-2 border-cyan-400 dark:border-cyan-600 bg-white dark:bg-gray-700 text-center font-bold text-gray-700 dark:text-gray-200"></td>
                  <td class="p-2 border-2 border-cyan-400 dark:border-cyan-600 bg-white dark:bg-gray-700 text-center font-bold text-gray-700 dark:text-gray-200">3</td>
                  <td class="p-2 border-2 border-cyan-400 dark:border-cyan-600 bg-white dark:bg-gray-700 text-center font-bold text-gray-700 dark:text-gray-200">6</td>
                  <td class="p-2 border-2 border-cyan-400 dark:border-cyan-600 bg-white dark:bg-gray-700 text-center font-bold text-gray-700 dark:text-gray-200">,</td>
                  <td class="p-2 border-2 border-cyan-400 dark:border-cyan-600 bg-white dark:bg-gray-700 text-center font-bold text-gray-700 dark:text-gray-200">4</td>
                  <td class="p-2 border-2 border-cyan-400 dark:border-cyan-600 bg-white dark:bg-gray-700 text-center font-bold text-gray-700 dark:text-gray-200">5</td>
                  <td class="p-2 border-2 border-cyan-400 dark:border-cyan-600 bg-white dark:bg-gray-700 text-center font-bold text-gray-700 dark:text-gray-200">7</td>
                </tr>
              </tbody>
            </table>
          </div>
          <p class="text-center text-gray-500 dark:text-gray-400">virgola</p>
        </div>

        <!-- Tabella da compilare -->
        <div class="overflow-x-auto">
          <table class="border-collapse border-2 border-cyan-400 dark:border-cyan-600">
            <thead>
              <tr>
                <th colspan="4" class="p-2 border-2 border-cyan-400 dark:border-cyan-600 bg-cyan-100 dark:bg-cyan-800 text-center font-bold text-gray-800 dark:text-gray-200">Parte intera</th>
                <th class="p-2 border-2 border-cyan-400 dark:border-cyan-600 bg-white dark:bg-gray-700"></th>
                <th colspan="3" class="p-2 border-2 border-cyan-400 dark:border-cyan-600 bg-pink-200 dark:bg-pink-800 text-center font-bold text-gray-800 dark:text-gray-200">Parte decimale</th>
              </tr>
              <tr>
                <th class="p-2 border-2 border-cyan-400 dark:border-cyan-600 bg-cyan-50 dark:bg-cyan-900 text-center text-gray-700 dark:text-gray-200">uk</th>
                <th class="p-2 border-2 border-cyan-400 dark:border-cyan-600 bg-cyan-50 dark:bg-cyan-900 text-center text-gray-700 dark:text-gray-200">h</th>
                <th class="p-2 border-2 border-cyan-400 dark:border-cyan-600 bg-cyan-50 dark:bg-cyan-900 text-center text-gray-700 dark:text-gray-200">da</th>
                <th class="p-2 border-2 border-cyan-400 dark:border-cyan-600 bg-cyan-50 dark:bg-cyan-900 text-center text-gray-700 dark:text-gray-200">u</th>
                <th class="p-2 border-2 border-cyan-400 dark:border-cyan-600 bg-white dark:bg-gray-700 text-center text-gray-700 dark:text-gray-200"></th>
                <th class="p-2 border-2 border-cyan-400 dark:border-cyan-600 bg-pink-50 dark:bg-pink-900 text-center text-gray-700 dark:text-gray-200">d</th>
                <th class="p-2 border-2 border-cyan-400 dark:border-cyan-600 bg-pink-50 dark:bg-pink-900 text-center text-gray-700 dark:text-gray-200">c</th>
                <th class="p-2 border-2 border-cyan-400 dark:border-cyan-600 bg-pink-50 dark:bg-pink-900 text-center text-gray-700 dark:text-gray-200">m</th>
              </tr>
            </thead>
            <tbody>
              <% [
                # 4076,89
                { uk: "4", h: "0", da: "7", u: "6", d: "8", c: "9", m: "" },
                # 1070,52
                { uk: "1", h: "0", da: "7", u: "0", d: "5", c: "2", m: "" },
                # 43,201
                { uk: "", h: "", da: "4", u: "3", d: "2", c: "0", m: "1" },
                # 6,923
                { uk: "", h: "", da: "", u: "6", d: "9", c: "2", m: "3" },
                # 0,583
                { uk: "", h: "", da: "", u: "0", d: "5", c: "8", m: "3" }
              ].each do |row| %>
                <tr>
                  <td class="p-2 border-2 border-cyan-400 dark:border-cyan-600 bg-white dark:bg-gray-700 text-center">
                    <input type="text" data-correct-answer="<%= row[:uk] %>" class="w-8 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold bg-transparent dark:text-white">
                  </td>
                  <td class="p-2 border-2 border-cyan-400 dark:border-cyan-600 bg-white dark:bg-gray-700 text-center">
                    <input type="text" data-correct-answer="<%= row[:h] %>" class="w-8 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold bg-transparent dark:text-white">
                  </td>
                  <td class="p-2 border-2 border-cyan-400 dark:border-cyan-600 bg-white dark:bg-gray-700 text-center">
                    <input type="text" data-correct-answer="<%= row[:da] %>" class="w-8 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold bg-transparent dark:text-white">
                  </td>
                  <td class="p-2 border-2 border-cyan-400 dark:border-cyan-600 bg-white dark:bg-gray-700 text-center">
                    <input type="text" data-correct-answer="<%= row[:u] %>" class="w-8 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold bg-transparent dark:text-white">
                  </td>
                  <td class="p-2 border-2 border-cyan-400 dark:border-cyan-600 bg-white dark:bg-gray-700 text-center font-bold text-gray-700 dark:text-gray-200">,</td>
                  <td class="p-2 border-2 border-cyan-400 dark:border-cyan-600 bg-white dark:bg-gray-700 text-center">
                    <input type="text" data-correct-answer="<%= row[:d] %>" class="w-8 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold bg-transparent dark:text-white">
                  </td>
                  <td class="p-2 border-2 border-cyan-400 dark:border-cyan-600 bg-white dark:bg-gray-700 text-center">
                    <input type="text" data-correct-answer="<%= row[:c] %>" class="w-8 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold bg-transparent dark:text-white">
                  </td>
                  <td class="p-2 border-2 border-cyan-400 dark:border-cyan-600 bg-white dark:bg-gray-700 text-center">
                    <input type="text" data-correct-answer="<%= row[:m] %>" class="w-8 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold bg-transparent dark:text-white">
                  </td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Esercizio 2 -->
    <div>
      <p class="font-bold text-gray-700 dark:text-gray-200 mb-4">
        <%= numero_esercizio_badge(2) %>
        Indica il valore di ogni cifra. Segui l'esempio.
      </p>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <% [
          { num: "75,28", answer: "7 da 5 u 2 d 8 c", example: true },
          { num: "541,296", answer: "5 h 4 da 1 u 2 d 9 c 6 m", example: false },
          { num: "63,04", answer: "6 da 3 u 0 d 4 c", example: false },
          { num: "0,891", answer: "0 u 8 d 9 c 1 m", example: false },
          { num: "411,033", answer: "4 h 1 da 1 u 0 d 3 c 3 m", example: false },
          { num: "379,8", answer: "3 h 7 da 9 u 8 d", example: false }
        ].each do |item| %>
          <div class="flex items-center gap-3 p-3 <%= item[:example] ? 'bg-cyan-50 dark:bg-cyan-900/30' : '' %> rounded-lg">
            <span class="font-bold text-gray-700 dark:text-gray-200 shrink-0"><%= item[:num] %></span>
            <span class="text-cyan-500">→</span>
            <% if item[:example] %>
              <span class="font-bold text-cyan-600 dark:text-cyan-400"><%= item[:answer] %></span>
            <% else %>
              <input type="text" data-correct-answer="<%= item[:answer] %>" class="flex-1 min-w-0 border-b-2 border-dotted border-gray-400 dark:border-gray-500 font-bold bg-transparent dark:text-white">
            <% end %>
          </div>
        <% end %>
      </div>
    </div>

    <!-- Esercizio 3 -->
    <div>
      <p class="font-bold text-gray-700 dark:text-gray-200 mb-4">
        <%= numero_esercizio_badge(3) %>
        Cancella dai numeri gli zeri non necessari.
      </p>

      <div class="grid grid-cols-3 md:grid-cols-6 gap-3">
        <% [
          { num: "0,260", answer: "0,26" },
          { num: "0,020", answer: "0,02" },
          { num: "0,606", answer: "0,606" },
          { num: "45,100", answer: "45,1" },
          { num: "0,003", answer: "0,003" },
          { num: "23 060,70", answer: "23060,7" },
          { num: "60,020", answer: "60,02" },
          { num: "0,041", answer: "0,041" },
          { num: "89,010", answer: "89,01" },
          { num: "4,051", answer: "4,051" },
          { num: "5,700", answer: "5,7" },
          { num: "0,800", answer: "0,8" },
          { num: "0,060", answer: "0,06" },
          { num: "0,078", answer: "0,078" },
          { num: "4 600,030", answer: "4600,03" },
          { num: "77,900", answer: "77,9" },
          { num: "0,001", answer: "0,001" },
          { num: "204,071", answer: "204,071" }
        ].each do |item| %>
          <div class="flex flex-col items-center gap-1 p-2 border border-cyan-400 dark:border-cyan-600 rounded-lg">
            <span class="text-gray-700 dark:text-gray-200"><%= item[:num] %></span>
            <input type="text" data-correct-answer="<%= item[:answer] %>" class="w-full border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold bg-transparent dark:text-white">
          </div>
        <% end %>
      </div>
    </div>

    <!-- Esercizio 4 -->
    <div>
      <p class="font-bold text-gray-700 dark:text-gray-200 mb-4">
        <%= numero_esercizio_badge(4) %>
        Scrivi in cifre i seguenti numeri decimali.
      </p>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <% [
          { text: "centocinquantotto e otto decimi", answer: "158,8" },
          { text: "ottanta e tre decimi", answer: "80,3" },
          { text: "tre decimi", answer: "0,3" },
          { text: "quattordici e cinque millesimi", answer: "14,005" },
          { text: "cinque millesimi", answer: "0,005" },
          { text: "sette centesimi", answer: "0,07" },
          { text: "centoventi e quattro decimi", answer: "120,4" },
          { text: "due millesimi", answer: "0,002" }
        ].each do |item| %>
          <div class="flex items-center gap-2 p-2 border border-cyan-400 dark:border-cyan-600 rounded-lg">
            <span class="text-gray-700 dark:text-gray-200 flex-1"><%= item[:text] %></span>
            <input type="text" data-correct-answer="<%= item[:answer] %>" class="w-20 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold bg-transparent dark:text-white">
          </div>
        <% end %>
      </div>
    </div>

    <!-- Esercizio 5 -->
    <div>
      <p class="font-bold text-gray-700 dark:text-gray-200 mb-4">
        <%= numero_esercizio_badge(5) %>
        Scrivi in cifre e poi in lettere (attenzione agli zeri!) il numero che corrisponde a ciascuna scomposizione. Segui l'esempio.
      </p>

      <div class="p-3 bg-pink-light dark:bg-pink-900/40 rounded-2xl mb-4">
        <p class="text-gray-700 dark:text-gray-200">
          Disegna sul quaderno una tabella come quella dell'esercizio 1 e inserisci i numeri.
        </p>
      </div>

      <div class="space-y-3">
        <!-- Esempio -->
        <div class="flex items-center gap-3 flex-wrap p-3 bg-cyan-50 dark:bg-cyan-900/30 rounded-lg">
          <span class="text-gray-700 dark:text-gray-200">5 da 6 d 7 m =</span>
          <span class="font-bold text-cyan-600 dark:text-cyan-400">50,607</span>
          <span class="text-gray-700 dark:text-gray-200 italic">cinquanta unità e seicentosette millesimi</span>
        </div>

        <!-- Da compilare -->
        <% [
          { scomp: "4 h 8 da 6 u 8 c", answer_num: "486,08", answer_text: "quattrocentottantasei unità e otto centesimi" },
          { scomp: "4 h 7 da 1 d 6 m", answer_num: "470,106", answer_text: "quattrocentosettanta unità e centosei millesimi" },
          { scomp: "3 da 3 c 4 m", answer_num: "30,034", answer_text: "trenta unità e trentaquattro millesimi" }
        ].each do |item| %>
          <div class="flex items-center gap-3 flex-wrap p-3 border border-cyan-400 dark:border-cyan-600 rounded-lg">
            <span class="text-gray-700 dark:text-gray-200 shrink-0"><%= item[:scomp] %> =</span>
            <input type="text" data-correct-answer="<%= item[:answer_num] %>" class="w-24 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold bg-transparent dark:text-white">
            <input type="text" data-correct-answer="<%= item[:answer_text] %>" class="flex-1 min-w-0 border-b-2 border-dotted border-gray-400 dark:border-gray-500 font-bold bg-transparent dark:text-white">
          </div>
        <% end %>
      </div>
    </div>

    <%= render 'shared/exercise_controls' %>
  </div>
</div>
