<div class="max-w-6xl mx-auto bg-white dark:bg-gray-900 p-3 md:p-6 text-black dark:text-white transition-colors duration-300"
     data-controller="exercise-checker text-toggle font-controls"
     data-text-toggle-target="content"
     data-font-controls-target="content">

  <%= render 'shared/page_header', pagina: @pagina %>

  <div class="space-y-6">

    <!-- Box Ricorda! -->
    <div class="p-4 md:p-6 bg-custom-blue-light dark:bg-blue-900/40 rounded-2xl transition-colors duration-300">
      <h3 class="font-bold text-pink-600 italic mb-4">Ricorda!</h3>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6 items-center">
        <div>
          <p class="text-gray-700 dark:text-gray-200 leading-relaxed mb-3">
            Frazionare significa dividere un intero in parti uguali.
          </p>
          <p class="text-gray-700 dark:text-gray-200 leading-relaxed">
            Ogni parte ottenuta si chiama <span class="font-bold">unità frazionaria</span>.
          </p>
          <div class="mt-4 flex items-center gap-3">
            <%= render 'shared/frazione', num: 1, den: 6 %>
            <span class="text-gray-700 dark:text-gray-200">= unità frazionaria</span>
          </div>
        </div>
        <div class="flex justify-center">
          <div class="bg-white dark:bg-white rounded-xl p-1">
            <%= image_tag "nvi5_mat/p005/output-1715938802005_683_258_199_210.png", alt: "Cerchio diviso in 6 parti" %>
          </div>
        </div>
      </div>
    </div>

    <!-- Esercizi 1 e 2 affiancati -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
      <!-- Esercizio 1 -->
      <div class="p-4 md:p-6">
        <p class="text-gray-700 dark:text-gray-200 mb-6">
          <%= numero_esercizio_badge(1) %>
          Osserva le figure e scrivi la frazione che corrisponde alla parte colorata. Segui l'esempio.
        </p>
        <div class="flex justify-center">
          <div class="bg-white dark:bg-white rounded-xl p-1">
            <%= image_tag "nvi5_mat/p005/p005_03.jpg", alt: "Esercizio 1 - Figure con frazioni", class: "w-full max-w-md" %>
          </div>
        </div>
      </div>

      <!-- Esercizio 2 -->
      <div class="p-4 md:p-6">
        <p class="text-gray-700 dark:text-gray-200 mb-6">
          <%= numero_esercizio_badge(2) %>
          Colora le parti indicate dalle frazioni come nell'esempio.
        </p>
        <div class="grid grid-cols-2 gap-4">
          <!-- Esagono -->
          <div class="flex items-center gap-3">
            <svg viewBox="0 0 120 120" class="w-36 h-36" data-controller="fraction-coloring" data-fraction-coloring-parts-value="6" data-fraction-coloring-to-color-value="3">
              <polygon points="60,10 100,35 100,85 60,110 20,85 20,35" fill="white" stroke="#DB2777" stroke-width="2"/>
              <line x1="60" y1="60" x2="60" y2="10" stroke="#DB2777" stroke-width="2"/>
              <line x1="60" y1="60" x2="100" y2="35" stroke="#DB2777" stroke-width="2"/>
              <line x1="60" y1="60" x2="100" y2="85" stroke="#DB2777" stroke-width="2"/>
              <line x1="60" y1="60" x2="60" y2="110" stroke="#DB2777" stroke-width="2"/>
              <line x1="60" y1="60" x2="20" y2="85" stroke="#DB2777" stroke-width="2"/>
              <line x1="60" y1="60" x2="20" y2="35" stroke="#DB2777" stroke-width="2"/>
              <path d="M 60 60 L 60 10 L 100 35 Z" class="cursor-pointer hover:opacity-80 transition-opacity" fill="transparent" stroke="transparent" data-action="click->fraction-coloring#togglePart" data-fraction-coloring-target="part"/>
              <path d="M 60 60 L 100 35 L 100 85 Z" class="cursor-pointer hover:opacity-80 transition-opacity" fill="transparent" stroke="transparent" data-action="click->fraction-coloring#togglePart" data-fraction-coloring-target="part"/>
              <path d="M 60 60 L 100 85 L 60 110 Z" class="cursor-pointer hover:opacity-80 transition-opacity" fill="transparent" stroke="transparent" data-action="click->fraction-coloring#togglePart" data-fraction-coloring-target="part"/>
              <path d="M 60 60 L 60 110 L 20 85 Z" class="cursor-pointer hover:opacity-80 transition-opacity" fill="transparent" stroke="transparent" data-action="click->fraction-coloring#togglePart" data-fraction-coloring-target="part"/>
              <path d="M 60 60 L 20 85 L 20 35 Z" class="cursor-pointer hover:opacity-80 transition-opacity" fill="transparent" stroke="transparent" data-action="click->fraction-coloring#togglePart" data-fraction-coloring-target="part"/>
              <path d="M 60 60 L 20 35 L 60 10 Z" class="cursor-pointer hover:opacity-80 transition-opacity" fill="transparent" stroke="transparent" data-action="click->fraction-coloring#togglePart" data-fraction-coloring-target="part"/>
            </svg>
            <%= render 'shared/frazione', num: 3, den: 6 %>
          </div>
          <!-- Quadrato 3x3 -->
          <div class="flex items-center gap-3">
            <svg viewBox="0 0 120 120" class="w-36 h-36" data-controller="fraction-coloring" data-fraction-coloring-parts-value="9" data-fraction-coloring-to-color-value="9">
              <rect x="10" y="10" width="100" height="100" fill="white" stroke="#DB2777" stroke-width="2"/>
              <line x1="10" y1="43.33" x2="110" y2="43.33" stroke="#DB2777" stroke-width="2"/>
              <line x1="10" y1="76.66" x2="110" y2="76.66" stroke="#DB2777" stroke-width="2"/>
              <line x1="43.33" y1="10" x2="43.33" y2="110" stroke="#DB2777" stroke-width="2"/>
              <line x1="76.66" y1="10" x2="76.66" y2="110" stroke="#DB2777" stroke-width="2"/>
              <rect x="10" y="10" width="33.33" height="33.33" class="cursor-pointer hover:opacity-80 transition-opacity" fill="transparent" stroke="transparent" data-action="click->fraction-coloring#togglePart" data-fraction-coloring-target="part"/>
              <rect x="43.33" y="10" width="33.33" height="33.33" class="cursor-pointer hover:opacity-80 transition-opacity" fill="transparent" stroke="transparent" data-action="click->fraction-coloring#togglePart" data-fraction-coloring-target="part"/>
              <rect x="76.66" y="10" width="33.33" height="33.33" class="cursor-pointer hover:opacity-80 transition-opacity" fill="transparent" stroke="transparent" data-action="click->fraction-coloring#togglePart" data-fraction-coloring-target="part"/>
              <rect x="10" y="43.33" width="33.33" height="33.33" class="cursor-pointer hover:opacity-80 transition-opacity" fill="transparent" stroke="transparent" data-action="click->fraction-coloring#togglePart" data-fraction-coloring-target="part"/>
              <rect x="43.33" y="43.33" width="33.33" height="33.33" class="cursor-pointer hover:opacity-80 transition-opacity" fill="transparent" stroke="transparent" data-action="click->fraction-coloring#togglePart" data-fraction-coloring-target="part"/>
              <rect x="76.66" y="43.33" width="33.33" height="33.33" class="cursor-pointer hover:opacity-80 transition-opacity" fill="transparent" stroke="transparent" data-action="click->fraction-coloring#togglePart" data-fraction-coloring-target="part"/>
              <rect x="10" y="76.66" width="33.33" height="33.33" class="cursor-pointer hover:opacity-80 transition-opacity" fill="transparent" stroke="transparent" data-action="click->fraction-coloring#togglePart" data-fraction-coloring-target="part"/>
              <rect x="43.33" y="76.66" width="33.33" height="33.33" class="cursor-pointer hover:opacity-80 transition-opacity" fill="transparent" stroke="transparent" data-action="click->fraction-coloring#togglePart" data-fraction-coloring-target="part"/>
              <rect x="76.66" y="76.66" width="33.33" height="33.33" class="cursor-pointer hover:opacity-80 transition-opacity" fill="transparent" stroke="transparent" data-action="click->fraction-coloring#togglePart" data-fraction-coloring-target="part"/>
            </svg>
            <%= render 'shared/frazione', num: 9, den: 9 %>
          </div>
          <!-- Cerchio -->
          <div class="flex items-center gap-3">
            <svg viewBox="0 0 120 120" class="w-36 h-36" data-controller="fraction-coloring" data-fraction-coloring-parts-value="2" data-fraction-coloring-to-color-value="1">
              <circle cx="60" cy="60" r="50" fill="white" stroke="#DB2777" stroke-width="2"/>
              <line x1="10" y1="60" x2="110" y2="60" stroke="#DB2777" stroke-width="2"/>
              <path d="M 60 60 L 10 60 A 50 50 0 0 1 60 10 Z" class="cursor-pointer hover:opacity-80 transition-opacity" fill="transparent" stroke="transparent" data-action="click->fraction-coloring#togglePart" data-fraction-coloring-target="part"/>
              <path d="M 60 60 L 60 10 A 50 50 0 0 1 110 60 Z" class="cursor-pointer hover:opacity-80 transition-opacity" fill="transparent" stroke="transparent" data-action="click->fraction-coloring#togglePart" data-fraction-coloring-target="part"/>
            </svg>
            <%= render 'shared/frazione', num: 1, den: 2 %>
          </div>
          <!-- Parallelogramma -->
          <div class="flex items-center gap-3">
            <svg viewBox="0 0 140 100" class="w-40 h-28" data-controller="fraction-coloring" data-fraction-coloring-parts-value="6" data-fraction-coloring-to-color-value="5">
              <polygon points="20,10 120,10 100,90 0,90" fill="white" stroke="#DB2777" stroke-width="2"/>
              <line x1="36.67" y1="10" x2="16.67" y2="90" stroke="#DB2777" stroke-width="2"/>
              <line x1="53.33" y1="10" x2="33.33" y2="90" stroke="#DB2777" stroke-width="2"/>
              <line x1="70" y1="10" x2="50" y2="90" stroke="#DB2777" stroke-width="2"/>
              <line x1="86.67" y1="10" x2="66.67" y2="90" stroke="#DB2777" stroke-width="2"/>
              <line x1="103.33" y1="10" x2="83.33" y2="90" stroke="#DB2777" stroke-width="2"/>
              <polygon points="20,10 36.67,10 16.67,90 0,90" class="cursor-pointer hover:opacity-80 transition-opacity" fill="transparent" stroke="transparent" data-action="click->fraction-coloring#togglePart" data-fraction-coloring-target="part"/>
              <polygon points="36.67,10 53.33,10 33.33,90 16.67,90" class="cursor-pointer hover:opacity-80 transition-opacity" fill="transparent" stroke="transparent" data-action="click->fraction-coloring#togglePart" data-fraction-coloring-target="part"/>
              <polygon points="53.33,10 70,10 50,90 33.33,90" class="cursor-pointer hover:opacity-80 transition-opacity" fill="transparent" stroke="transparent" data-action="click->fraction-coloring#togglePart" data-fraction-coloring-target="part"/>
              <polygon points="70,10 86.67,10 66.67,90 50,90" class="cursor-pointer hover:opacity-80 transition-opacity" fill="transparent" stroke="transparent" data-action="click->fraction-coloring#togglePart" data-fraction-coloring-target="part"/>
              <polygon points="86.67,10 103.33,10 83.33,90 66.67,90" class="cursor-pointer hover:opacity-80 transition-opacity" fill="transparent" stroke="transparent" data-action="click->fraction-coloring#togglePart" data-fraction-coloring-target="part"/>
              <polygon points="103.33,10 120,10 100,90 83.33,90" class="cursor-pointer hover:opacity-80 transition-opacity" fill="transparent" stroke="transparent" data-action="click->fraction-coloring#togglePart" data-fraction-coloring-target="part"/>
            </svg>
            <%= render 'shared/frazione', num: 5, den: 6 %>
          </div>
        </div>
      </div>
    </div>

    <!-- Esercizio 3 -->
    <div class="p-4 md:p-6">
      <p class="text-gray-700 dark:text-gray-200 mb-6">
        <%= numero_esercizio_badge(3) %>
        Inserisci i segni <span class="text-pink-600 font-bold">&gt;</span> oppure <span class="text-pink-600 font-bold">&lt;</span>. Segui l'esempio.
      </p>

      <div class="space-y-4">
        <!-- Esempio -->
        <div class="flex flex-wrap items-center justify-center gap-4 p-3 bg-pink-50 dark:bg-pink-900/30 rounded-lg transition-colors duration-300">
          <%= render 'shared/frazione', num: 3, den: 7 %>
          <span class="font-bold text-pink-600">&lt;</span>
          <%= render 'shared/frazione', num: 5, den: 7 %>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <!-- 2/6 __ 2/4 -->
          <div class="flex flex-wrap items-center justify-center gap-4 p-3">
            <%= render 'shared/frazione', num: 2, den: 6 %>
            <select class="bg-white dark:bg-gray-700 dark:text-white px-4 py-2 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold cursor-pointer" data-correct-answer="<">
              <option value="">...</option>
              <option value="<">&lt;</option>
              <option value=">">&gt;</option>
            </select>
            <%= render 'shared/frazione', num: 2, den: 4 %>
          </div>
          <!-- 3/10 __ 5/10 -->
          <div class="flex flex-wrap items-center justify-center gap-4 p-3">
            <%= render 'shared/frazione', num: 3, den: 10 %>
            <select class="bg-white dark:bg-gray-700 dark:text-white px-4 py-2 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold cursor-pointer" data-correct-answer="<">
              <option value="">...</option>
              <option value="<">&lt;</option>
              <option value=">">&gt;</option>
            </select>
            <%= render 'shared/frazione', num: 5, den: 10 %>
          </div>
          <!-- 2/16 __ 16/16 -->
          <div class="flex flex-wrap items-center justify-center gap-4 p-3">
            <%= render 'shared/frazione', num: 2, den: 16 %>
            <select class="bg-white dark:bg-gray-700 dark:text-white px-4 py-2 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold cursor-pointer" data-correct-answer="<">
              <option value="">...</option>
              <option value="<">&lt;</option>
              <option value=">">&gt;</option>
            </select>
            <%= render 'shared/frazione', num: 16, den: 16 %>
          </div>
          <!-- 1/2 __ 1/5 -->
          <div class="flex flex-wrap items-center justify-center gap-4 p-3">
            <%= render 'shared/frazione', num: 1, den: 2 %>
            <select class="bg-white dark:bg-gray-700 dark:text-white px-4 py-2 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold cursor-pointer" data-correct-answer=">">
              <option value="">...</option>
              <option value="<">&lt;</option>
              <option value=">">&gt;</option>
            </select>
            <%= render 'shared/frazione', num: 1, den: 5 %>
          </div>
        </div>
      </div>
    </div>

    <!-- Esercizio 4 -->
    <div class="p-4 md:p-6">
      <p class="text-gray-700 dark:text-gray-200 mb-6">
        <%= numero_esercizio_badge(4) %>
        Calcola come nell'esempio.
      </p>

      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <!-- Colonna 1 -->
        <div class="space-y-4">
          <!-- Esempio -->
          <div class="flex flex-wrap items-center gap-3 p-3 bg-pink-50 dark:bg-pink-900/30 rounded-lg transition-colors duration-300">
            <%= render 'shared/frazione', num: 2, den: 3 %>
            <span class="text-gray-700 dark:text-gray-200">di 21</span>
            <span class="text-pink-600">→</span>
            <span class="text-pink-600">21 : 3 = 7</span>
            <span class="text-pink-600">→</span>
            <span class="text-pink-600 font-bold">7 × 2 = 14</span>
          </div>
          <!-- 3/8 di 56 -->
          <div class="flex flex-wrap items-center gap-2 p-3">
            <%= render 'shared/frazione', num: 3, den: 8 %>
            <span class="text-gray-700 dark:text-gray-200">di 56</span>
            <span class="text-pink-600">→</span>
            <input type="text" class="w-10 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold bg-transparent dark:text-white" data-correct-answer="56">
            <span class="text-gray-700 dark:text-gray-200">:</span>
            <input type="text" class="w-10 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold bg-transparent dark:text-white" data-correct-answer="8">
            <span class="text-gray-700 dark:text-gray-200">=</span>
            <input type="text" class="w-10 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold bg-transparent dark:text-white" data-correct-answer="7">
            <span class="text-gray-700 dark:text-gray-200">×</span>
            <input type="text" class="w-10 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold bg-transparent dark:text-white" data-correct-answer="3">
            <span class="text-gray-700 dark:text-gray-200">=</span>
            <input type="text" class="w-10 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold bg-transparent dark:text-white" data-correct-answer="21">
          </div>
          <!-- 6/8 di 32 -->
          <div class="flex flex-wrap items-center gap-2 p-3">
            <%= render 'shared/frazione', num: 6, den: 8 %>
            <span class="text-gray-700 dark:text-gray-200">di 32</span>
            <span class="text-pink-600">→</span>
            <input type="text" class="w-10 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold bg-transparent dark:text-white" data-correct-answer="32">
            <span class="text-gray-700 dark:text-gray-200">:</span>
            <input type="text" class="w-10 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold bg-transparent dark:text-white" data-correct-answer="8">
            <span class="text-gray-700 dark:text-gray-200">=</span>
            <input type="text" class="w-10 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold bg-transparent dark:text-white" data-correct-answer="4">
            <span class="text-gray-700 dark:text-gray-200">×</span>
            <input type="text" class="w-10 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold bg-transparent dark:text-white" data-correct-answer="6">
            <span class="text-gray-700 dark:text-gray-200">=</span>
            <input type="text" class="w-10 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold bg-transparent dark:text-white" data-correct-answer="24">
          </div>
        </div>
        <!-- Colonna 2 -->
        <div class="space-y-4">
          <!-- 6/9 di 81 -->
          <div class="flex flex-wrap items-center gap-2 p-3">
            <%= render 'shared/frazione', num: 6, den: 9 %>
            <span class="text-gray-700 dark:text-gray-200">di 81</span>
            <span class="text-pink-600">→</span>
            <input type="text" class="w-10 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold bg-transparent dark:text-white" data-correct-answer="81">
            <span class="text-gray-700 dark:text-gray-200">:</span>
            <input type="text" class="w-10 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold bg-transparent dark:text-white" data-correct-answer="9">
            <span class="text-gray-700 dark:text-gray-200">=</span>
            <input type="text" class="w-10 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold bg-transparent dark:text-white" data-correct-answer="9">
            <span class="text-gray-700 dark:text-gray-200">×</span>
            <input type="text" class="w-10 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold bg-transparent dark:text-white" data-correct-answer="6">
            <span class="text-gray-700 dark:text-gray-200">=</span>
            <input type="text" class="w-10 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold bg-transparent dark:text-white" data-correct-answer="54">
          </div>
          <!-- 2/10 di 60 -->
          <div class="flex flex-wrap items-center gap-2 p-3">
            <%= render 'shared/frazione', num: 2, den: 10 %>
            <span class="text-gray-700 dark:text-gray-200">di 60</span>
            <span class="text-pink-600">→</span>
            <input type="text" class="w-10 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold bg-transparent dark:text-white" data-correct-answer="60">
            <span class="text-gray-700 dark:text-gray-200">:</span>
            <input type="text" class="w-10 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold bg-transparent dark:text-white" data-correct-answer="10">
            <span class="text-gray-700 dark:text-gray-200">=</span>
            <input type="text" class="w-10 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold bg-transparent dark:text-white" data-correct-answer="6">
            <span class="text-gray-700 dark:text-gray-200">×</span>
            <input type="text" class="w-10 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold bg-transparent dark:text-white" data-correct-answer="2">
            <span class="text-gray-700 dark:text-gray-200">=</span>
            <input type="text" class="w-10 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold bg-transparent dark:text-white" data-correct-answer="12">
          </div>
          <!-- 4/5 di 80 -->
          <div class="flex flex-wrap items-center gap-2 p-3">
            <%= render 'shared/frazione', num: 4, den: 5 %>
            <span class="text-gray-700 dark:text-gray-200">di 80</span>
            <span class="text-pink-600">→</span>
            <input type="text" class="w-10 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold bg-transparent dark:text-white" data-correct-answer="80">
            <span class="text-gray-700 dark:text-gray-200">:</span>
            <input type="text" class="w-10 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold bg-transparent dark:text-white" data-correct-answer="5">
            <span class="text-gray-700 dark:text-gray-200">=</span>
            <input type="text" class="w-10 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold bg-transparent dark:text-white" data-correct-answer="16">
            <span class="text-gray-700 dark:text-gray-200">×</span>
            <input type="text" class="w-10 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold bg-transparent dark:text-white" data-correct-answer="4">
            <span class="text-gray-700 dark:text-gray-200">=</span>
            <input type="text" class="w-10 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold bg-transparent dark:text-white" data-correct-answer="64">
          </div>
        </div>
      </div>
    </div>

    <%= render 'shared/exercise_controls' %>
  </div>
</div>
