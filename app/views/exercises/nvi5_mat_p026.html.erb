<div class="max-w-6xl mx-auto bg-white p-3 md:p-6"
     data-controller="exercise-checker text-toggle font-controls flower-matcher"
     data-text-toggle-target="content"
     data-font-controls-target="content">

  <%= render 'shared/page_header', pagina: @pagina %>

  <div class="space-y-6">
    <!-- Sezione ESERCIZI -->
    <div class="p-4 md:p-6 bg-orange-100 rounded-lg">

      <div class="grid grid-cols-1 md:grid-cols-2 divide-y-2 md:divide-y-0 md:divide-x-2 divide-pink-400">
        <!-- COLONNA SINISTRA -->
        <div class="p-4 space-y-6">
          <!-- Exercise 1: Sul quaderno -->
          <div>
            <p class="font-bold text-gray-700 mb-3">
              <%= numero_esercizio_badge(1) %>
              Scrivi i numeri sul quaderno come somma di valori, somma di addendi e somma di prodotti.
            </p>
            <div class="ml-10">
              <p class="text-cyan-500 font-bold">
                2 834 657 <span class="text-pink-600">&#8226;</span>
                82 372 630 <span class="text-pink-600">&#8226;</span>
                3 645 732 198
              </p>
              <p class="text-cyan-500 font-bold">
                483 200 574 120 <span class="text-pink-600">&#8226;</span>
                24 734 700 371
              </p>
              <p class="text-pink-500 italic mt-2">→ vedi p. seguente</p>
            </div>
          </div>

          <!-- Exercise 2: Collegamenti potenze -->
          <div>
            <p class="font-bold text-gray-700 mb-3">
              <%= numero_esercizio_badge(2) %>
              Collega ogni potenza al suo risultato. <span class="text-cyan-500">Attenzione: per due potenze c'è lo stesso risultato.</span>
            </p>
            <div class="ml-10 relative">
              <svg class="absolute top-0 left-0 w-full h-full pointer-events-none z-30" data-flower-matcher-target="canvas"></svg>

              <!-- Potenze -->
              <div class="flex flex-wrap justify-around gap-3 mb-8 relative z-20">
                <% [
                  { id: "pow-2-5", pair: "p32", label: "2<sup>5</sup>" },
                  { id: "pow-5-1", pair: "p5", label: "5<sup>1</sup>" },
                  { id: "pow-9-0", pair: "p1", label: "9<sup>0</sup>" },
                  { id: "pow-3-3", pair: "p27", label: "3<sup>3</sup>" },
                  { id: "pow-4-2", pair: "p16", label: "4<sup>2</sup>" },
                  { id: "pow-1-8", pair: "p1", label: "1<sup>9</sup>" }
                ].each do |item| %>
                  <div class="px-3 py-2 bg-custom-blue-light-light rounded-lg text-center font-bold cursor-pointer hover:bg-cyan-200 transition"
                       data-action="click->flower-matcher#selectFlower"
                       data-flower-matcher-target="flower"
                       data-flower-id="<%= item[:id] %>"
                       data-pair="<%= item[:pair] %>"><%= item[:label].html_safe %></div>
                <% end %>
              </div>

              <!-- Risultati -->
              <div class="flex flex-wrap justify-around gap-3 relative z-20">
                <% [
                  { id: "res-5", pair: "p5", label: "5" },
                  { id: "res-27", pair: "p27", label: "27" },
                  { id: "res-32", pair: "p32", label: "32" },
                  { id: "res-1", pair: "p1", label: "1" },
                  { id: "res-16", pair: "p16", label: "16" }
                ].each do |item| %>
                  <div class="px-3 py-2 bg-pink-100 rounded-lg text-center font-bold cursor-pointer hover:bg-pink-200 transition"
                       data-action="click->flower-matcher#selectFlower"
                       data-flower-matcher-target="flower"
                       data-flower-id="<%= item[:id] %>"
                       data-pair="<%= item[:pair] %>"><%= item[:label] %></div>
                <% end %>
              </div>

              <!-- Controlli -->
              <div class="mt-4 flex gap-3 items-center">
                <button class="bg-blue-500 hover:bg-blue-600 text-white font-bold rounded-full w-8 h-8 transition flex items-center justify-center"
                        data-action="click->flower-matcher#reset" title="Ricomincia">
                  <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                  </svg>
                </button>
                <button class="bg-green-500 hover:bg-green-600 text-white font-bold rounded-full w-8 h-8 transition flex items-center justify-center"
                        data-action="click->flower-matcher#showSolutions" title="Soluzioni">
                  <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                  </svg>
                </button>
              </div>
            </div>
          </div>

          <!-- Exercise 3: Vero o Falso -->
          <div>
            <p class="font-bold text-gray-700 mb-3">
              <%= numero_esercizio_badge(3) %>
              Vero o falso? Indica con una X.
            </p>
            <div class="grid grid-cols-2 gap-2 ml-10">
              <% [
                { text: "10² = 20", v: false },
                { text: "10⁴ = 10 000", v: true },
                { text: "4³ = 64", v: true },
                { text: "10⁶ = 100 000", v: false },
                { text: "5² = 50", v: false },
                { text: "10⁰ = 0", v: false },
                { text: "2⁷ = 128", v: true },
                { text: "10³ = 1 000", v: true },
                { text: "10¹ = 10", v: true },
                { text: "3⁵ = 243", v: true }
              ].each_with_index do |item, idx| %>
                <div class="flex items-center justify-between">
                  <span class="font-bold text-gray-800"><%= item[:text].html_safe %></span>
                  <div class="flex gap-2">
                    <label class="cursor-pointer flex items-center gap-1">
                      <input type="radio" name="vf3_<%= idx %>" data-correct-answer="<%= item[:v] %>">
                      <span class="font-semibold">V</span>
                    </label>
                    <label class="cursor-pointer flex items-center gap-1">
                      <input type="radio" name="vf3_<%= idx %>" data-correct-answer="<%= !item[:v] %>">
                      <span class="font-semibold">F</span>
                    </label>
                  </div>
                </div>
              <% end %>
            </div>
          </div>

          <!-- Exercise 4: Polinomio numerico -->
          <div>
            <p class="font-bold text-gray-700 mb-3">
              <%= numero_esercizio_badge(4) %>
              Scrivi i numeri sul quaderno come polinomio numerico.
            </p>
            <div class="ml-10">
              <p class="text-cyan-500 font-bold">
                63 253 <span class="text-pink-600">&#8226;</span>
                832 904 368 <span class="text-pink-600">&#8226;</span>
                3 729 456
              </p>
              <p class="text-cyan-500 font-bold">
                27 349 900 473 <span class="text-pink-600">&#8226;</span>
                273 480 <span class="text-pink-600">&#8226;</span>
                17 238 004
              </p>
              <p class="text-pink-500 italic mt-2">→ vedi p. seguente</p>
            </div>
          </div>

          <!-- Exercise 5: Decimali in cifre -->
          <div>
            <p class="font-bold text-gray-700 mb-3">
              <%= numero_esercizio_badge(5) %>
              Scrivi in cifre i seguenti numeri decimali.
            </p>
            <div class="space-y-2 ml-10">
              <% [
                { text: "trenta e otto decimi", answer: "30,8" },
                { text: "quarantaquattro centesimi", answer: "0,44" },
                { text: "due e ventisei centesimi", answer: "2,26" },
                { text: "centosessantadue millesimi", answer: "0,162" },
                { text: "uno e cinque centesimi", answer: "1,05" },
                { text: "nove millesimi", answer: "0,009" }
              ].each do |item| %>
                <div class="flex items-center gap-2">
                  <span class="text-gray-700 flex-1"><%= item[:text] %></span>
                  <span class="text-pink-600">→</span>
                  <input type="text" data-correct-answer="<%= item[:answer] %>" class="w-20 border-b-2 border-dotted border-gray-400 text-center font-bold bg-transparent">
                </div>
              <% end %>
            </div>
          </div>
        </div>

        <!-- COLONNA DESTRA -->
        <div class="p-4 space-y-6">
          <!-- Exercise 6: Scomposizione -->
          <div>
            <p class="font-bold text-gray-700 mb-3">
              <%= numero_esercizio_badge(6) %>
              Scomponi i numeri decimali come nell'esempio.
            </p>
            <div class="space-y-2 ml-10">
              <div class="flex items-center gap-2">
                <span class="font-bold text-cyan-500">13,26</span> =
                <span class="text-pink-600 font-bold">1 da, 3 u, 2 d, 6 c</span>
              </div>
              <% [
                { num: "40,157", answer: "4 da, 1 d, 5 c, 7 m" },
                { num: "0,945", answer: "9 d, 4 c, 5 m" },
                { num: "81,03", answer: "8 da, 1 u, 3 c" },
                { num: "27,108", answer: "2 da, 7 u, 1 d, 8 m" },
                { num: "106,92", answer: "1 h, 6 u, 9 d, 2 c" }
              ].each do |item| %>
                <div class="flex items-center gap-2">
                  <span class="font-bold text-cyan-500"><%= item[:num] %></span> =
                  <input type="text" data-correct-answer="<%= item[:answer] %>" class="flex-1 border-b-2 border-dotted border-gray-400 font-bold bg-transparent">
                </div>
              <% end %>
            </div>
          </div>

          <!-- Exercise 7: Composizione -->
          <div>
            <p class="font-bold text-gray-700 mb-3">
              <%= numero_esercizio_badge(7) %>
              Componi i seguenti numeri decimali.
            </p>
            <div class="space-y-2 ml-10">
              <% [
                { dec: "7 da, 8 u, 1 d, 4 c", num: "78,14" },
                { dec: "6 u, 5 c, 4 m", num: "6,054" },
                { dec: "2 da, 9 d, 3 m", num: "20,903" },
                { dec: "3 da, 8 d, 9 c, 2 m", num: "30,892" },
                { dec: "3 h, 5 u, 1 c, 6 m", num: "305,016" },
                { dec: "4 u, 7 c, 1 m", num: "4,071" }
              ].each do |item| %>
                <div class="flex items-center gap-2">
                  <span class="text-gray-700"><%= item[:dec] %></span>
                  <span class="text-pink-600">=</span>
                  <input type="text" data-correct-answer="<%= item[:num] %>" class="w-24 border-b-2 border-dotted border-gray-400 text-center font-bold bg-transparent">
                </div>
              <% end %>
            </div>
          </div>

          <!-- Exercise 8: Ordine decrescente -->
          <div>
            <p class="font-bold text-gray-700 mb-3">
              <%= numero_esercizio_badge(8) %>
              Scrivi i numeri in ordine decrescente.
            </p>
            <div class="ml-10">
              <p class="text-gray-600 mb-2">
                6,5 <span class="text-pink-600">&#8226;</span>
                6,005 <span class="text-pink-600">&#8226;</span>
                0,65 <span class="text-pink-600">&#8226;</span>
                6,05 <span class="text-pink-600">&#8226;</span>
                5,6
              </p>
              <input type="text" data-correct-answer="6,5, 6,05, 6,005, 5,6, 0,65" class="w-full border-b-2 border-dotted border-gray-400 text-center font-bold bg-transparent py-2" placeholder="Scrivi i numeri separati da virgola...">
            </div>
          </div>

          <!-- Exercise 9: Ordine crescente -->
          <div>
            <p class="font-bold text-gray-700 mb-3">
              <%= numero_esercizio_badge(9) %>
              Scrivi i numeri in ordine crescente.
            </p>
            <div class="ml-10">
              <p class="text-gray-600 mb-2">
                1,07 <span class="text-pink-600">&#8226;</span>
                10,7 <span class="text-pink-600">&#8226;</span>
                0,17 <span class="text-pink-600">&#8226;</span>
                1,7 <span class="text-pink-600">&#8226;</span>
                107
              </p>
              <input type="text" data-correct-answer="0,17, 1,07, 1,7, 10,7, 107" class="w-full border-b-2 border-dotted border-gray-400 text-center font-bold bg-transparent py-2" placeholder="Scrivi i numeri separati da virgola...">
            </div>
          </div>

          <!-- Exercise 10: Confronto numeri relativi -->
          <div>
            <p class="font-bold text-gray-700 mb-3">
              <%= numero_esercizio_badge(10) %>
              Confronta i numeri e inserisci i segni &lt; oppure &gt;.
            </p>
            <div class="grid grid-cols-2 gap-2 ml-10">
              <% [
                { a: "– 7", b: "+ 5", sign: "<", a_color: "red", b_color: "blue" },
                { a: "– 6", b: "– 4", sign: "<", a_color: "red", b_color: "red" },
                { a: "+ 9", b: "– 10", sign: ">", a_color: "blue", b_color: "red" },
                { a: "– 5", b: "– 8", sign: ">", a_color: "red", b_color: "red" },
                { a: "– 9", b: "+ 3", sign: "<", a_color: "red", b_color: "blue" },
                { a: "– 17", b: "0", sign: "<", a_color: "red", b_color: "gray" }
              ].each do |item| %>
                <div class="flex items-center justify-center gap-2">
                  <span class="font-bold text-<%= item[:a_color] %>-600"><%= item[:a] %></span>
                  <input type="text" data-correct-answer="<%= item[:sign] %>" class="w-10 border-b-2 border-dotted border-gray-400 text-center font-bold bg-transparent" maxlength="1">
                  <span class="font-bold text-<%= item[:b_color] %>-600"><%= item[:b] %></span>
                </div>
              <% end %>
            </div>
          </div>

          <!-- Exercise 11: Operazioni -->
          <div>
            <p class="font-bold text-gray-700 mb-3">
              <%= numero_esercizio_badge(11) %>
              Esegui le operazioni.
            </p>
            <div class="grid grid-cols-2 gap-2 ml-10">
              <% [
                { op: "– 7 – 15", result: "–22" },
                { op: "– 6 + 20", result: "+14" },
                { op: "+ 10 – 22", result: "–12" },
                { op: "+ 5 – 7", result: "–2" }
              ].each do |item| %>
                <div class="flex items-center gap-2">
                  <span class="text-gray-800"><%= item[:op] %> =</span>
                  <input type="text" data-correct-answer="<%= item[:result] %>" class="w-16 border-b-2 border-dotted border-gray-400 text-center font-bold bg-transparent">
                </div>
              <% end %>
            </div>
          </div>
        </div>
      </div>
    </div>

    <%= render 'shared/exercise_controls' %>
  </div>
</div>
