<% content_for :titolo, "#{@pagina.titolo} - #{@pagina.numero}" %>

<div class="max-w-7xl mx-auto p-3 md:p-6 bg-white dark:bg-gray-900 text-black dark:text-white font-mono transition-colors duration-300"
     data-controller="exercise-checker page-viewer text-toggle font-controls"
     data-page-viewer-image-url-value="<%= asset_path('bus3_mat/p170/page.png') %>"
     data-text-toggle-target="content"
     data-font-controls-target="content">

  <!-- Header -->
  <%= render 'shared/page_header', pagina: @pagina %>

  <!-- Esercizio 1 - IMPARARE TUTTI -->
  <div class="mb-12" data-controller="flower-matcher">
    <div class="flex items-start gap-3 mb-6">
      <div class="flex items-center">
        <div class="bg-cyan-700 text-white rounded-full w-8 h-8 flex items-center justify-center font-bold flex-shrink-0 z-10 relative">
          1
        </div>
        <span class="bg-yellow-300 text-cyan-700 font-bold pl-5 pr-4 py-1 rounded-r-full -ml-3">IMPARARE TUTTI</span>
      </div>
      <span class="text-gray-700 dark:text-gray-200">Leggi che cosa dice la freccia e collega i numeri.</span>
    </div>

    <div class="flex items-center gap-4 max-w-3xl mx-auto">
      <!-- Freccia a sinistra -->
      <div class="flex-shrink-0 flex items-center gap-2">
        <span class="font-bold">è il doppio di</span>
        <svg class="w-8 h-8 text-cyan-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M14 5l7 7m0 0l-7 7m7-7H3" />
        </svg>
      </div>

      <!-- Area collegamenti -->
      <div class="relative flex-1">
        <!-- SVG Canvas per disegnare le linee -->
        <svg class="absolute top-0 left-0 w-full h-full pointer-events-none z-30"
             data-flower-matcher-target="canvas">
        </svg>

        <!-- Prima riga di numeri (i doppi) -->
      <div class="flex justify-around mb-8 relative z-20">
        <div class="bg-white dark:bg-gray-800 border-3 border-cyan-500 rounded-lg px-5 py-3 cursor-pointer hover:bg-cyan-50 dark:hover:bg-cyan-900/30 transition"
             data-action="click->flower-matcher#selectFlower"
             data-flower-matcher-target="flower"
             data-flower-id="top-12"
             data-pair="pair-6">
          <p class="font-bold text-center">12</p>
        </div>
        <div class="bg-white dark:bg-gray-800 border-3 border-cyan-500 rounded-lg px-5 py-3 cursor-pointer hover:bg-cyan-50 dark:hover:bg-cyan-900/30 transition"
             data-action="click->flower-matcher#selectFlower"
             data-flower-matcher-target="flower"
             data-flower-id="top-7"
             data-pair="pair-14">
          <p class="font-bold text-center">7</p>
        </div>
        <div class="bg-white dark:bg-gray-800 border-3 border-cyan-500 rounded-lg px-5 py-3 cursor-pointer hover:bg-cyan-50 dark:hover:bg-cyan-900/30 transition"
             data-action="click->flower-matcher#selectFlower"
             data-flower-matcher-target="flower"
             data-flower-id="top-20"
             data-pair="pair-10">
          <p class="font-bold text-center">20</p>
        </div>
        <div class="bg-white dark:bg-gray-800 border-3 border-cyan-500 rounded-lg px-5 py-3 cursor-pointer hover:bg-cyan-50 dark:hover:bg-cyan-900/30 transition"
             data-action="click->flower-matcher#selectFlower"
             data-flower-matcher-target="flower"
             data-flower-id="top-16"
             data-pair="pair-8">
          <p class="font-bold text-center">16</p>
        </div>
        <div class="bg-white dark:bg-gray-800 border-3 border-cyan-500 rounded-lg px-5 py-3 cursor-pointer hover:bg-cyan-50 dark:hover:bg-cyan-900/30 transition"
             data-action="click->flower-matcher#selectFlower"
             data-flower-matcher-target="flower"
             data-flower-id="top-3"
             data-pair="pair-6b">
          <p class="font-bold text-center">3</p>
        </div>
        <div class="bg-white dark:bg-gray-800 border-3 border-cyan-500 rounded-lg px-5 py-3 cursor-pointer hover:bg-cyan-50 dark:hover:bg-cyan-900/30 transition"
             data-action="click->flower-matcher#selectFlower"
             data-flower-matcher-target="flower"
             data-flower-id="top-15"
             data-pair="pair-30">
          <p class="font-bold text-center">15</p>
        </div>
      </div>

      <!-- Seconda riga di numeri (le metà) -->
      <div class="flex justify-around relative z-20">
        <div class="bg-white dark:bg-gray-800 border-3 border-orange-500 rounded-lg px-5 py-3 cursor-pointer hover:bg-orange-50 dark:hover:bg-orange-900/30 transition"
             data-action="click->flower-matcher#selectFlower"
             data-flower-matcher-target="flower"
             data-flower-id="bottom-10"
             data-pair="pair-10">
          <p class="font-bold text-center">10</p>
        </div>
        <div class="bg-white dark:bg-gray-800 border-3 border-orange-500 rounded-lg px-5 py-3 cursor-pointer hover:bg-orange-50 dark:hover:bg-orange-900/30 transition"
             data-action="click->flower-matcher#selectFlower"
             data-flower-matcher-target="flower"
             data-flower-id="bottom-30"
             data-pair="pair-30">
          <p class="font-bold text-center">30</p>
        </div>
        <div class="bg-white dark:bg-gray-800 border-3 border-orange-500 rounded-lg px-5 py-3 cursor-pointer hover:bg-orange-50 dark:hover:bg-orange-900/30 transition"
             data-action="click->flower-matcher#selectFlower"
             data-flower-matcher-target="flower"
             data-flower-id="bottom-6"
             data-pair="pair-6">
          <p class="font-bold text-center">6</p>
        </div>
        <div class="bg-white dark:bg-gray-800 border-3 border-orange-500 rounded-lg px-5 py-3 cursor-pointer hover:bg-orange-50 dark:hover:bg-orange-900/30 transition"
             data-action="click->flower-matcher#selectFlower"
             data-flower-matcher-target="flower"
             data-flower-id="bottom-14"
             data-pair="pair-14">
          <p class="font-bold text-center">14</p>
        </div>
        <div class="bg-white dark:bg-gray-800 border-3 border-orange-500 rounded-lg px-5 py-3 cursor-pointer hover:bg-orange-50 dark:hover:bg-orange-900/30 transition"
             data-action="click->flower-matcher#selectFlower"
             data-flower-matcher-target="flower"
             data-flower-id="bottom-8"
             data-pair="pair-8">
          <p class="font-bold text-center">8</p>
        </div>
      </div>

      <!-- Pulsante reset sotto il 10 -->
      <div class="flex justify-start mt-4">
        <button class="bg-cyan-500 hover:bg-cyan-600 text-white font-bold rounded-full shadow-lg transition transform hover:scale-105 flex items-center justify-center w-10 h-10"
                data-action="click->flower-matcher#reset"
                title="Cancella collegamenti">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
          </svg>
        </button>
      </div>
      </div>
    </div>
  </div>

  <!-- Esercizio 2 -->
  <div class="mb-12" data-controller="fill-blanks auto-advance">
    <div class="flex items-start gap-3 mb-6">
      <div class="bg-red-500 text-white rounded-full w-8 h-8 flex items-center justify-center font-bold flex-shrink-0">
        2
      </div>
      <p class="text-gray-700 dark:text-gray-200">
        <strong>Osserva la tabella e rispondi alle domande.</strong>
      </p>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
      <!-- Legenda e Domande a sinistra -->
      <div>
        <div class="mb-6">
          <p class="font-bold text-cyan-600">LEGENDA</p>
          <p class="flex items-center gap-2">
            <span class="inline-block w-24 h-6 border-2 border-cyan-600 bg-white"></span> = 1 matita
          </p>
        </div>

        <!-- Domande -->
        <div class="space-y-4">
          <div>
            <p class="text-gray-700 dark:text-gray-200"><span class="text-blue-500 font-bold">•</span> Chi ha nell'astuccio meno matite?</p>
            <input type="text" data-fill-blanks-target="input" data-correct-answer="Gaia"
                   class="w-full px-2 py-1 border-b-2 border-dotted border-gray-400 dark:border-gray-500 bg-white dark:bg-gray-700 dark:text-white">
          </div>
          <div>
            <p class="text-gray-700 dark:text-gray-200"><span class="text-blue-500 font-bold">•</span> Chi ne ha di più?</p>
            <input type="text" data-fill-blanks-target="input" data-correct-answer="Lapo"
                   class="w-full px-2 py-1 border-b-2 border-dotted border-gray-400 dark:border-gray-500 bg-white dark:bg-gray-700 dark:text-white">
          </div>
          <div>
            <p class="text-gray-700 dark:text-gray-200"><span class="text-blue-500 font-bold">•</span> Quante matite ha Lapo più di Gaia?</p>
            <input type="text" data-fill-blanks-target="input" data-correct-answer="11"
                   class="w-full px-2 py-1 border-b-2 border-dotted border-gray-400 dark:border-gray-500 bg-white dark:bg-gray-700 dark:text-white" inputmode="numeric">
          </div>
          <div>
            <p class="text-gray-700 dark:text-gray-200"><span class="text-blue-500 font-bold">•</span> Chi ha lo stesso numero di matite?</p>
            <input type="text" data-fill-blanks-target="input" data-correct-answer="Michele e Anna"
                   class="w-full px-2 py-1 border-b-2 border-dotted border-gray-400 dark:border-gray-500 bg-white dark:bg-gray-700 dark:text-white">
          </div>
        </div>
      </div>

      <!-- Grafico a barre a destra -->
      <div class="flex justify-center">
        <div class="dark:bg-white dark:rounded-xl dark:p-2 inline-block">
          <%= image_tag "bus3_mat/p170/p170_01.jpg", alt: "Grafico matite", class: "max-w-full rounded" %>
        </div>
      </div>
    </div>
  </div>

  <!-- Esercizio 3 -->
  <div class="mb-12" data-controller="fill-blanks auto-advance">
    <div class="flex items-start gap-3 mb-6">
      <div class="bg-red-500 text-white rounded-full w-8 h-8 flex items-center justify-center font-bold flex-shrink-0">
        3
      </div>
      <p class="text-gray-700 dark:text-gray-200">
        <strong>Osserva e rispondi.</strong>
      </p>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
      <!-- Immagine calzini -->
      <div class="flex justify-center">
        <div class="dark:bg-white dark:rounded-xl dark:p-2 inline-block">
          <%= image_tag "bus3_mat/p170/output-1743504902170_130_901_293_289.png", alt: "Cassetto con calzini", class: "max-w-full rounded" %>
        </div>
      </div>

      <!-- Domande sulla probabilità -->
      <div class="space-y-4">
        <p class="text-gray-700 font-bold">Se pesco dal cassetto con gli occhi bendati:</p>

        <div>
          <p class="text-gray-700 flex items-center gap-2 flex-wrap">
            <span class="whitespace-nowrap"><span class="text-blue-500 font-bold">•</span> è più probabile che prenda un calzino blu o un calzino a pallini?</span>
            <input type="text" data-fill-blanks-target="input" data-correct-answer="blu"
                   class="w-32 px-2 py-1 border-b-2 border-dotted border-gray-400 text-center bg-white">
          </p>
        </div>

        <div>
          <p class="text-gray-700 flex items-center gap-2 flex-wrap">
            <span class="whitespace-nowrap"><span class="text-blue-500 font-bold">•</span> qual è la probabilità che prenda un calzino blu?</span>
            <span class="inline-flex flex-col items-center">
              <input type="text" data-fill-blanks-target="input" data-correct-answer="5"
                     class="w-10 px-1 py-1 border-b-2 border-dotted border-gray-400 text-center bg-white" inputmode="numeric">
              <span class="w-10 border-t-2 border-gray-600 dark:border-gray-400"></span>
              <input type="text" data-fill-blanks-target="input" data-correct-answer="13"
                     class="w-10 px-1 py-1 border-b-2 border-dotted border-gray-400 text-center bg-white" inputmode="numeric">
            </span>
          </p>
        </div>

        <div>
          <p class="text-gray-700 flex items-center gap-2 flex-wrap">
            <span class="whitespace-nowrap"><span class="text-blue-500 font-bold">•</span> qual è la probabilità che prenda un calzino a righe?</span>
            <span class="inline-flex flex-col items-center">
              <input type="text" data-fill-blanks-target="input" data-correct-answer="3"
                     class="w-10 px-1 py-1 border-b-2 border-dotted border-gray-400 text-center bg-white" inputmode="numeric">
              <span class="w-10 border-t-2 border-gray-600 dark:border-gray-400"></span>
              <input type="text" data-fill-blanks-target="input" data-correct-answer="13"
                     class="w-10 px-1 py-1 border-b-2 border-dotted border-gray-400 text-center bg-white" inputmode="numeric">
            </span>
          </p>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer con controlli -->
  <%= render 'shared/exercise_controls' %>
</div>
