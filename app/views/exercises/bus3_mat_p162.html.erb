<% content_for :titolo, "#{@pagina.titolo} - #{@pagina.numero}" %>

<div class="max-w-7xl mx-auto p-3 md:p-6 bg-white dark:bg-gray-900 text-black dark:text-white font-mono transition-colors duration-300"
     data-controller="exercise-checker page-viewer text-toggle font-controls"
     data-page-viewer-image-url-value="<%= asset_path('bus3_mat/p162/page.png') %>"
     data-text-toggle-target="content"
     data-font-controls-target="content">

  <!-- Header -->
  <%= render 'shared/page_header', pagina: @pagina %>

  <!-- Esercizio 1 - IMPARARE TUTTI -->
  <div class="mb-12" data-controller="fill-blanks auto-advance">
    <div class="flex items-start gap-3 mb-6">
      <div class="flex items-center">
        <div class="bg-cyan-700 text-white rounded-full w-8 h-8 flex items-center justify-center font-bold flex-shrink-0 z-10 relative">
          1
        </div>
        <span class="bg-yellow-300 text-cyan-700 font-bold pl-5 pr-4 py-1 rounded-r-full -ml-3">IMPARARE TUTTI</span>
      </div>
      <span class="text-gray-700 dark:text-gray-200">Completa come nell'esempio.</span>
    </div>

    <div class="space-y-6">
      <!-- Esempio: 7/10 → 0,7 → 7 decimi -->
      <div class="flex items-center gap-4 flex-wrap bg-yellow-50 dark:bg-yellow-900/30 p-4 rounded-lg">
        <div class="flex">
          <% 7.times do %>
            <div class="w-6 h-10 bg-yellow-400 border border-yellow-500"></div>
          <% end %>
          <% 3.times do %>
            <div class="w-6 h-10 bg-yellow-100 border border-yellow-300"></div>
          <% end %>
        </div>
        <span class="">→</span>
        <div class="text-center">
          <div class="border-b-2 border-gray-600 px-2">7</div>
          <div>10</div>
        </div>
        <span class="">→</span>
        <span class="font-bold">0,7</span>
        <span class="">→</span>
        <span class="underline decoration-dotted">7 decimi</span>
      </div>

      <!-- Riga 1: 4/10 -->
      <div class="flex items-center gap-4 flex-wrap">
        <div class="flex">
          <% 4.times do %>
            <div class="w-6 h-10 bg-yellow-400 border border-yellow-500"></div>
          <% end %>
          <% 6.times do %>
            <div class="w-6 h-10 bg-yellow-100 border border-yellow-300"></div>
          <% end %>
        </div>
        <span class="">→</span>
        <div class="text-center">
          <input type="text" data-fill-blanks-target="input" data-correct-answer="4"
                 class="w-10 px-1 py-1 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center bg-white dark:bg-gray-700 dark:text-white" inputmode="numeric">
          <div class="border-t-2 border-gray-600">10</div>
        </div>
        <span class="">→</span>
        <input type="text" data-fill-blanks-target="input" data-correct-answer="0,4"
               class="w-14 px-1 py-1 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center bg-white dark:bg-gray-700 dark:text-white">
        <span class="">→</span>
        <input type="text" data-fill-blanks-target="input" data-correct-answer="4 decimi"
               class="w-28 px-1 py-1 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center bg-white dark:bg-gray-700 dark:text-white">
      </div>

      <!-- Riga 2: 5/10 -->
      <div class="flex items-center gap-4 flex-wrap">
        <div class="flex">
          <% 5.times do %>
            <div class="w-6 h-10 bg-green-400 border border-green-500"></div>
          <% end %>
          <% 5.times do %>
            <div class="w-6 h-10 bg-green-100 border border-green-300"></div>
          <% end %>
        </div>
        <span class="">→</span>
        <div class="text-center">
          <input type="text" data-fill-blanks-target="input" data-correct-answer="5"
                 class="w-10 px-1 py-1 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center bg-white dark:bg-gray-700 dark:text-white" inputmode="numeric">
          <div class="border-t-2 border-gray-600">10</div>
        </div>
        <span class="">→</span>
        <input type="text" data-fill-blanks-target="input" data-correct-answer="0,5"
               class="w-14 px-1 py-1 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center bg-white dark:bg-gray-700 dark:text-white">
        <span class="">→</span>
        <input type="text" data-fill-blanks-target="input" data-correct-answer="5 decimi"
               class="w-28 px-1 py-1 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center bg-white dark:bg-gray-700 dark:text-white">
      </div>
    </div>
  </div>

  <!-- Esercizio 2 -->
  <div class="mb-12" data-controller="fill-blanks auto-advance">
    <div class="flex items-start gap-3 mb-6">
      <div class="bg-red-500 text-white rounded-full w-8 h-8 flex items-center justify-center font-bold flex-shrink-0">
        2
      </div>
      <p class="text-gray-700 dark:text-gray-200">
        <strong>Osserva e completa la tabella. Segui l'esempio.</strong>
      </p>
    </div>

    <div class="space-y-4">
      <!-- Riga 1 (esempio): 2 interi + 3 decimi = 2,3 -->
      <div class="flex items-center gap-4 flex-wrap bg-yellow-50 dark:bg-yellow-900/30 p-4 rounded-lg">
        <div class="flex gap-1">
          <div class="flex">
            <% 10.times do %><div class="w-4 h-8 bg-yellow-400 border border-yellow-500"></div><% end %>
          </div>
          <div class="flex">
            <% 10.times do %><div class="w-4 h-8 bg-green-400 border border-green-500"></div><% end %>
          </div>
          <div class="flex">
            <% 3.times do %><div class="w-4 h-8 bg-pink-400 border border-pink-500"></div><% end %>
            <% 7.times do %><div class="w-4 h-8 bg-pink-100 border border-pink-300"></div><% end %>
          </div>
        </div>
        <table class="border-collapse border border-gray-400 dark:border-gray-500">
          <thead>
            <tr class="bg-cyan-100 dark:bg-cyan-900/40">
              <th class="border border-gray-400 px-3 py-1">FIGURE INTERE</th>
              <th class="border border-gray-400 px-3 py-1">DECIMI</th>
              <th class="border border-gray-400 px-3 py-1">NUMERO DECIMALE</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="border border-gray-400 px-4 py-2 text-center">2</td>
              <td class="border border-gray-400 px-4 py-2 text-center">3</td>
              <td class="border border-gray-400 px-4 py-2 text-center text-cyan-600 dark:text-cyan-400 font-bold">2,3</td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Riga 2: 1 intero + 5 decimi = 1,5 -->
      <div class="flex items-center gap-4 flex-wrap">
        <div class="flex gap-1">
          <div class="flex">
            <% 10.times do %><div class="w-4 h-8 bg-yellow-400 border border-yellow-500"></div><% end %>
          </div>
          <div class="flex">
            <% 5.times do %><div class="w-4 h-8 bg-green-400 border border-green-500"></div><% end %>
            <% 5.times do %><div class="w-4 h-8 bg-green-100 border border-green-300"></div><% end %>
          </div>
        </div>
        <table class="border-collapse border border-gray-400 dark:border-gray-500">
          <tbody>
            <tr>
              <td class="border border-gray-400 px-4 py-2 text-center">
                <input type="text" data-fill-blanks-target="input" data-correct-answer="1"
                       class="w-10 px-1 py-1 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center bg-white dark:bg-gray-700 dark:text-white" inputmode="numeric">
              </td>
              <td class="border border-gray-400 px-4 py-2 text-center">
                <input type="text" data-fill-blanks-target="input" data-correct-answer="5"
                       class="w-10 px-1 py-1 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center bg-white dark:bg-gray-700 dark:text-white" inputmode="numeric">
              </td>
              <td class="border border-gray-400 px-4 py-2 text-center">
                <input type="text" data-fill-blanks-target="input" data-correct-answer="1,5"
                       class="w-14 px-1 py-1 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center bg-white dark:bg-gray-700 dark:text-white">
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Riga 3: 2 interi + 7 decimi = 2,7 -->
      <div class="flex items-center gap-4 flex-wrap">
        <div class="flex gap-1">
          <div class="flex">
            <% 10.times do %><div class="w-4 h-8 bg-cyan-400 border border-cyan-500"></div><% end %>
          </div>
          <div class="flex">
            <% 10.times do %><div class="w-4 h-8 bg-cyan-400 border border-cyan-500"></div><% end %>
          </div>
          <div class="flex">
            <% 7.times do %><div class="w-4 h-8 bg-purple-400 border border-purple-500"></div><% end %>
            <% 3.times do %><div class="w-4 h-8 bg-purple-100 border border-purple-300"></div><% end %>
          </div>
        </div>
        <table class="border-collapse border border-gray-400 dark:border-gray-500">
          <tbody>
            <tr>
              <td class="border border-gray-400 px-4 py-2 text-center">
                <input type="text" data-fill-blanks-target="input" data-correct-answer="2"
                       class="w-10 px-1 py-1 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center bg-white dark:bg-gray-700 dark:text-white" inputmode="numeric">
              </td>
              <td class="border border-gray-400 px-4 py-2 text-center">
                <input type="text" data-fill-blanks-target="input" data-correct-answer="7"
                       class="w-10 px-1 py-1 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center bg-white dark:bg-gray-700 dark:text-white" inputmode="numeric">
              </td>
              <td class="border border-gray-400 px-4 py-2 text-center">
                <input type="text" data-fill-blanks-target="input" data-correct-answer="2,7"
                       class="w-14 px-1 py-1 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center bg-white dark:bg-gray-700 dark:text-white">
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Riga 4: 3 interi + 4 decimi = 3,4 -->
      <div class="flex items-center gap-4 flex-wrap">
        <div class="flex gap-1">
          <div class="flex">
            <% 10.times do %><div class="w-4 h-8 bg-yellow-400 border border-yellow-500"></div><% end %>
          </div>
          <div class="flex">
            <% 10.times do %><div class="w-4 h-8 bg-yellow-400 border border-yellow-500"></div><% end %>
          </div>
          <div class="flex">
            <% 10.times do %><div class="w-4 h-8 bg-yellow-400 border border-yellow-500"></div><% end %>
          </div>
          <div class="flex">
            <% 4.times do %><div class="w-4 h-8 bg-purple-400 border border-purple-500"></div><% end %>
            <% 6.times do %><div class="w-4 h-8 bg-purple-100 border border-purple-300"></div><% end %>
          </div>
        </div>
        <table class="border-collapse border border-gray-400 dark:border-gray-500">
          <tbody>
            <tr>
              <td class="border border-gray-400 px-4 py-2 text-center">
                <input type="text" data-fill-blanks-target="input" data-correct-answer="3"
                       class="w-10 px-1 py-1 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center bg-white dark:bg-gray-700 dark:text-white" inputmode="numeric">
              </td>
              <td class="border border-gray-400 px-4 py-2 text-center">
                <input type="text" data-fill-blanks-target="input" data-correct-answer="4"
                       class="w-10 px-1 py-1 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center bg-white dark:bg-gray-700 dark:text-white" inputmode="numeric">
              </td>
              <td class="border border-gray-400 px-4 py-2 text-center">
                <input type="text" data-fill-blanks-target="input" data-correct-answer="3,4"
                       class="w-14 px-1 py-1 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center bg-white dark:bg-gray-700 dark:text-white">
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Esercizio 3 -->
  <div class="mb-12" data-controller="svg-colorable">
    <div class="flex items-start gap-3 mb-6">
      <div class="bg-red-500 text-white rounded-full w-8 h-8 flex items-center justify-center font-bold flex-shrink-0">
        3
      </div>
      <p class="text-gray-700 dark:text-gray-200">
        <strong>Colora come indicato dal numero decimale.</strong>
      </p>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
      <!-- 1,5 = 15 decimi = 1 intero + 5 decimi -->
      <div class="flex items-center gap-4">
        <div>
          <div class="flex mb-1">
            <% 10.times do |i| %>
              <div class="w-6 h-8 border border-gray-400 cursor-pointer hover:bg-cyan-200 transition-colors"
                   data-svg-colorable-target="cell" data-cell-id="3a-<%= i %>"></div>
            <% end %>
          </div>
          <div class="flex">
            <% 10.times do |i| %>
              <div class="w-6 h-8 border border-gray-400 cursor-pointer hover:bg-cyan-200 transition-colors"
                   data-svg-colorable-target="cell" data-cell-id="3a-<%= 10 + i %>"></div>
            <% end %>
          </div>
        </div>
        <span class="font-bold">1,5</span>
      </div>

      <!-- 0,7 = 7 decimi -->
      <div class="flex items-center gap-4">
        <div class="flex">
          <% 10.times do |i| %>
            <div class="w-6 h-8 border border-gray-400 cursor-pointer hover:bg-cyan-200 transition-colors"
                 data-svg-colorable-target="cell" data-cell-id="3b-<%= i %>"></div>
          <% end %>
        </div>
        <span class="font-bold">0,7</span>
      </div>

      <!-- 1,2 = 12 decimi = 1 intero + 2 decimi -->
      <div class="flex items-center gap-4">
        <div>
          <div class="flex mb-1">
            <% 10.times do |i| %>
              <div class="w-6 h-8 border border-gray-400 cursor-pointer hover:bg-cyan-200 transition-colors"
                   data-svg-colorable-target="cell" data-cell-id="3c-<%= i %>"></div>
            <% end %>
          </div>
          <div class="flex">
            <% 10.times do |i| %>
              <div class="w-6 h-8 border border-gray-400 cursor-pointer hover:bg-cyan-200 transition-colors"
                   data-svg-colorable-target="cell" data-cell-id="3c-<%= 10 + i %>"></div>
            <% end %>
          </div>
        </div>
        <span class="font-bold">1,2</span>
      </div>

      <!-- 2,6 = 26 decimi = 2 interi + 6 decimi -->
      <div class="flex items-center gap-4">
        <div>
          <div class="flex mb-1">
            <% 10.times do |i| %>
              <div class="w-6 h-8 border border-gray-400 cursor-pointer hover:bg-cyan-200 transition-colors"
                   data-svg-colorable-target="cell" data-cell-id="3d-<%= i %>"></div>
            <% end %>
          </div>
          <div class="flex mb-1">
            <% 10.times do |i| %>
              <div class="w-6 h-8 border border-gray-400 cursor-pointer hover:bg-cyan-200 transition-colors"
                   data-svg-colorable-target="cell" data-cell-id="3d-<%= 10 + i %>"></div>
            <% end %>
          </div>
          <div class="flex">
            <% 10.times do |i| %>
              <div class="w-6 h-8 border border-gray-400 cursor-pointer hover:bg-cyan-200 transition-colors"
                   data-svg-colorable-target="cell" data-cell-id="3d-<%= 20 + i %>"></div>
            <% end %>
          </div>
        </div>
        <span class="font-bold">2,6</span>
      </div>
    </div>
  </div>

  <!-- Esercizio 4 - LOGICA -->
  <div class="mb-12" data-controller="fill-blanks">
    <div class="flex items-start gap-3 mb-6">
      <div class="bg-red-500 text-white rounded-full w-8 h-8 flex items-center justify-center font-bold flex-shrink-0">
        4
      </div>
      <div class="flex items-center gap-2">
        <span class="bg-red-500 text-white font-bold px-1">L</span>
        <span class="bg-yellow-400 text-black font-bold px-1">O</span>
        <span class="bg-green-500 text-white font-bold px-1">G</span>
        <span class="bg-cyan-500 text-white font-bold px-1">I</span>
        <span class="bg-blue-500 text-white font-bold px-1">C</span>
        <span class="bg-purple-500 text-white font-bold px-1">A</span>
      </div>
    </div>

    <div class="flex items-center gap-3 flex-wrap">
      <p class="text-gray-700 dark:text-gray-200">Scrivi un numero maggiore di 2 e minore di 3.</p>
      <input type="text" data-fill-blanks-target="input" data-correct-answer="2,1|2,2|2,3|2,4|2,5|2,6|2,7|2,8|2,9"
             class="w-20 px-2 py-1 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center bg-white dark:bg-gray-700 dark:text-white">
    </div>
  </div>

  <!-- Footer con controlli -->
  <%= render 'shared/exercise_controls' %>
</div>
