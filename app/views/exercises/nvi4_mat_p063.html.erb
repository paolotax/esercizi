<div class="max-w-6xl mx-auto bg-white p-3 md:p-6"
     data-controller="exercise-checker text-toggle font-controls fraction-coloring word-highlighter"
     data-text-toggle-target="content"
     data-font-controls-target="content">

  <%= render 'shared/page_header', pagina: @pagina %>

  <div class="space-y-6">

    <!-- Sezione 1: Sabrina mangia 4/4 -->
    <div class="py-4">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div>
          <p class="text-gray-700 mb-4">
            Sabrina mangia <%= render 'shared/frazione', num: 4, den: 4 %> di una pizza.
          </p>

          <p class="font-bold text-gray-700 mb-3">
            <span class="text-<%= @pagina.base_color %>-500">•</span> Rispondi.
          </p>

          <div class="space-y-3">
            <div class="flex items-center gap-4 flex-wrap">
              <span class="text-gray-700">Sabrina mangia l'intera pizza?</span>
              <div class="flex gap-2">
                <label class="relative flex items-center justify-center w-10 h-8 bg-white border-2 border-<%= @pagina.base_color %>-500 rounded cursor-pointer hover:bg-<%= @pagina.base_color %>-100 has-checked:bg-pink-300">
                  <input type="radio" name="sabrina_intera" class="absolute inset-0 opacity-0 cursor-pointer" data-correct-answer="true">
                  <span>Sì</span>
                </label>
                <label class="relative flex items-center justify-center w-10 h-8 bg-white border-2 border-<%= @pagina.base_color %>-500 rounded cursor-pointer hover:bg-<%= @pagina.base_color %>-100 has-checked:bg-pink-300">
                  <input type="radio" name="sabrina_intera" class="absolute inset-0 opacity-0 cursor-pointer" data-correct-answer="false">
                  <span>No</span>
                </label>
              </div>
            </div>

            <p class="text-gray-700">
              La frazione <%= render 'shared/frazione', num: 4, den: 4 %> <span class="font-bold">equivale a 1</span> intero.
            </p>
          </div>
        </div>

        <!-- Immagine pizza -->
        <div class="flex justify-center items-start">
          <%= image_tag "nvi4_mat/p063/output-1715932804063_497_193_252_185.png", class: "max-w-full h-auto" %>
        </div>
      </div>
    </div>

    <!-- Sezione 2: Luca mangia 8/4 -->
    <div class="py-4 border-t border-gray-200">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div>
          <p class="text-gray-700 mb-4">
            Luca mangia <%= render 'shared/frazione', num: 8, den: 4 %>.
          </p>

          <p class="font-bold text-gray-700 mb-3">
            <span class="text-<%= @pagina.base_color %>-500">•</span> Rispondi.
          </p>

          <div class="space-y-3">
            <div class="flex items-center gap-2 flex-wrap">
              <span class="text-gray-700">Quante pizze intere mangia Luca?</span>
              <input type="text" data-correct-answer="2" class="w-12 border-b-2 border-dotted border-gray-400 text-center font-bold bg-transparent">
            </div>

            <p class="text-gray-700">
              La frazione <%= render 'shared/frazione', num: 8, den: 4 %> <span class="font-bold">equivale a 2</span> interi.
            </p>
          </div>
        </div>

        <!-- Immagine pizze -->
        <div class="flex justify-center items-start">
          <%= image_tag "nvi4_mat/p063/output-1715932804063_491_393_514_183.png", class: "max-w-full h-auto" %>
        </div>
      </div>
    </div>

    <!-- Sezione 3: Linea dei numeri -->
    <div class="py-4 border-t border-gray-200">
      <p class="font-bold text-gray-700 mb-4">
        <span class="text-<%= @pagina.base_color %>-500">•</span> Sistema sulla linea le frazioni <%= render 'shared/frazione', num: 4, den: 4 %> e <%= render 'shared/frazione', num: 8, den: 4 %>.
      </p>

      <!-- Linea dei numeri 0-2 -->
      <div class="relative w-full max-w-lg h-20 mb-4 mx-auto">
        <div class="absolute top-8 left-4 right-4 h-0.5 bg-gray-400"></div>
        <!-- Marcatori principali -->
        <div class="absolute top-6 left-4 w-0.5 h-4 bg-gray-400"></div>
        <div class="absolute top-6 left-1/2 w-0.5 h-4 bg-gray-400"></div>
        <div class="absolute top-6 right-4 w-0.5 h-4 bg-gray-400"></div>
        <!-- Etichette -->
        <span class="absolute top-0 left-4 transform -translate-x-1/2 text-<%= @pagina.base_color %>-600 font-bold">0</span>
        <span class="absolute top-0 left-1/2 transform -translate-x-1/2 text-<%= @pagina.base_color %>-600 font-bold">1</span>
        <span class="absolute top-0 right-4 transform translate-x-1/2 text-<%= @pagina.base_color %>-600 font-bold">2</span>
        <!-- Input per frazioni -->
        <div class="absolute top-12" style="left: calc(50% - 20px)">
          <%= render 'shared/frazione', num: nil, den: nil, num_answer: "4", den_answer: "4" %>
        </div>
        <div class="absolute top-12" style="right: 0">
          <%= render 'shared/frazione', num: nil, den: nil, num_answer: "8", den_answer: "4" %>
        </div>
      </div>
    </div>

    <!-- Box regola -->
    <div class="p-3 bg-pink-light rounded-2xl">
      <p class="text-gray-700">
        <%= render 'shared/frazione', num: 4, den: 4 %> e <%= render 'shared/frazione', num: 8, den: 4 %> sono <span class="font-bold">frazioni apparenti</span>: il numeratore è <span class="font-bold">uguale</span> o <span class="font-bold">multiplo</span> del denominatore.
      </p>
    </div>

    <!-- ESERCIZI -->
    <div class="p-4 md:p-6 bg-orange-100 rounded-2xl">

      <!-- Esercizio 1 -->
      <div class="p-4 bg-white rounded-2xl -mx-4 md:-mx-6 -mt-4 md:-mt-6 mb-6 border-3 border-blue-500">
        <p class="font-bold text-gray-700 mb-4">
          <%= imparare_tutti_badge(1) %>
          Colora la parte indicata dalla frazione e segna con una X se è una frazione propria <span class="bg-blue-500 text-white px-1 rounded">P</span>, impropria <span class="bg-red-500 text-white px-1 rounded">I</span>, apparente <span class="bg-green-500 text-white px-1 rounded">A</span>. Fai attenzione, per una figura occorrono due risposte.
        </p>

        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
          <!-- Figura 1: 5/8 -->
          <div class="flex flex-col items-center gap-2">
            <div class="w-20 h-16 border-2 border-gray-400 grid grid-cols-4 grid-rows-2">
              <% 8.times do |i| %>
                <div class="border border-gray-300 cursor-pointer hover:bg-cyan-100" data-action="click->fraction-coloring#toggleColor"></div>
              <% end %>
            </div>
            <%= render 'shared/frazione', num: 5, den: 8 %>
            <div class="flex gap-1">
              <label class="relative flex items-center justify-center w-7 h-7 bg-blue-500 text-white rounded cursor-pointer hover:opacity-80 has-checked:ring-2 has-checked:ring-blue-800">
                <input type="checkbox" class="absolute inset-0 opacity-0 cursor-pointer" data-correct-answer="true">
                <span>P</span>
              </label>
              <label class="relative flex items-center justify-center w-7 h-7 bg-red-500 text-white rounded cursor-pointer hover:opacity-80 has-checked:ring-2 has-checked:ring-red-800">
                <input type="checkbox" class="absolute inset-0 opacity-0 cursor-pointer" data-correct-answer="false">
                <span>I</span>
              </label>
              <label class="relative flex items-center justify-center w-7 h-7 bg-green-500 text-white rounded cursor-pointer hover:opacity-80 has-checked:ring-2 has-checked:ring-green-800">
                <input type="checkbox" class="absolute inset-0 opacity-0 cursor-pointer" data-correct-answer="false">
                <span>A</span>
              </label>
            </div>
          </div>

          <!-- Figura 2: 4/4 -->
          <div class="flex flex-col items-center gap-2">
            <div class="w-16 h-16 border-2 border-gray-400 grid grid-cols-2 grid-rows-2">
              <% 4.times do |i| %>
                <div class="border border-gray-300 cursor-pointer hover:bg-cyan-100" data-action="click->fraction-coloring#toggleColor"></div>
              <% end %>
            </div>
            <%= render 'shared/frazione', num: 4, den: 4 %>
            <div class="flex gap-1">
              <label class="relative flex items-center justify-center w-7 h-7 bg-blue-500 text-white rounded cursor-pointer hover:opacity-80 has-checked:ring-2 has-checked:ring-blue-800">
                <input type="checkbox" class="absolute inset-0 opacity-0 cursor-pointer" data-correct-answer="false">
                <span>P</span>
              </label>
              <label class="relative flex items-center justify-center w-7 h-7 bg-red-500 text-white rounded cursor-pointer hover:opacity-80 has-checked:ring-2 has-checked:ring-red-800">
                <input type="checkbox" class="absolute inset-0 opacity-0 cursor-pointer" data-correct-answer="true">
                <span>I</span>
              </label>
              <label class="relative flex items-center justify-center w-7 h-7 bg-green-500 text-white rounded cursor-pointer hover:opacity-80 has-checked:ring-2 has-checked:ring-green-800">
                <input type="checkbox" class="absolute inset-0 opacity-0 cursor-pointer" data-correct-answer="true">
                <span>A</span>
              </label>
            </div>
          </div>

          <!-- Figura 3: 13/8 -->
          <div class="flex flex-col items-center gap-2">
            <div class="w-20 h-16 border-2 border-gray-400 grid grid-cols-4 grid-rows-2">
              <% 8.times do |i| %>
                <div class="border border-gray-300 cursor-pointer hover:bg-cyan-100" data-action="click->fraction-coloring#toggleColor"></div>
              <% end %>
            </div>
            <%= render 'shared/frazione', num: 13, den: 8 %>
            <div class="flex gap-1">
              <label class="relative flex items-center justify-center w-7 h-7 bg-blue-500 text-white rounded cursor-pointer hover:opacity-80 has-checked:ring-2 has-checked:ring-blue-800">
                <input type="checkbox" class="absolute inset-0 opacity-0 cursor-pointer" data-correct-answer="false">
                <span>P</span>
              </label>
              <label class="relative flex items-center justify-center w-7 h-7 bg-red-500 text-white rounded cursor-pointer hover:opacity-80 has-checked:ring-2 has-checked:ring-red-800">
                <input type="checkbox" class="absolute inset-0 opacity-0 cursor-pointer" data-correct-answer="true">
                <span>I</span>
              </label>
              <label class="relative flex items-center justify-center w-7 h-7 bg-green-500 text-white rounded cursor-pointer hover:opacity-80 has-checked:ring-2 has-checked:ring-green-800">
                <input type="checkbox" class="absolute inset-0 opacity-0 cursor-pointer" data-correct-answer="false">
                <span>A</span>
              </label>
            </div>
          </div>

          <!-- Figura 4: 10/5 -->
          <div class="flex flex-col items-center gap-2">
            <div class="w-20 h-8 border-2 border-gray-400 grid grid-cols-5">
              <% 5.times do |i| %>
                <div class="<%= i < 4 ? 'border-r border-gray-400' : '' %> cursor-pointer hover:bg-cyan-100" data-action="click->fraction-coloring#toggleColor"></div>
              <% end %>
            </div>
            <%= render 'shared/frazione', num: 10, den: 5 %>
            <div class="flex gap-1">
              <label class="relative flex items-center justify-center w-7 h-7 bg-blue-500 text-white rounded cursor-pointer hover:opacity-80 has-checked:ring-2 has-checked:ring-blue-800">
                <input type="checkbox" class="absolute inset-0 opacity-0 cursor-pointer" data-correct-answer="false">
                <span>P</span>
              </label>
              <label class="relative flex items-center justify-center w-7 h-7 bg-red-500 text-white rounded cursor-pointer hover:opacity-80 has-checked:ring-2 has-checked:ring-red-800">
                <input type="checkbox" class="absolute inset-0 opacity-0 cursor-pointer" data-correct-answer="true">
                <span>I</span>
              </label>
              <label class="relative flex items-center justify-center w-7 h-7 bg-green-500 text-white rounded cursor-pointer hover:opacity-80 has-checked:ring-2 has-checked:ring-green-800">
                <input type="checkbox" class="absolute inset-0 opacity-0 cursor-pointer" data-correct-answer="true">
                <span>A</span>
              </label>
            </div>
          </div>
        </div>
      </div>

      <!-- Esercizio 2 -->
      <div>
        <p class="font-bold text-gray-700 mb-4">
          <%= numero_esercizio_badge(2) %>
          Circonda in blu le frazioni proprie, in rosso quelle improprie e in verde quelle apparenti. Ci sono frazioni che hai circondato due volte? Perché?
        </p>

        <div class="flex flex-wrap gap-4 justify-center" data-controller="word-highlighter">
          <span data-word-highlighter-target="word" data-action="click->word-highlighter#toggleHighlight" class="cursor-pointer hover:opacity-80 p-2 rounded border border-gray-300">
            <%= render 'shared/frazione', num: 7, den: 7 %>
          </span>
          <span data-word-highlighter-target="word" data-action="click->word-highlighter#toggleHighlight" class="cursor-pointer hover:opacity-80 p-2 rounded border border-gray-300">
            <%= render 'shared/frazione', num: 9, den: 6 %>
          </span>
          <span data-word-highlighter-target="word" data-action="click->word-highlighter#toggleHighlight" class="cursor-pointer hover:opacity-80 p-2 rounded border border-gray-300">
            <%= render 'shared/frazione', num: 4, den: 4 %>
          </span>
          <span data-word-highlighter-target="word" data-action="click->word-highlighter#toggleHighlight" class="cursor-pointer hover:opacity-80 p-2 rounded border border-gray-300">
            <%= render 'shared/frazione', num: 18, den: 11 %>
          </span>
          <span data-word-highlighter-target="word" data-action="click->word-highlighter#toggleHighlight" class="cursor-pointer hover:opacity-80 p-2 rounded border border-gray-300">
            <%= render 'shared/frazione', num: 5, den: 20 %>
          </span>
          <span data-word-highlighter-target="word" data-action="click->word-highlighter#toggleHighlight" class="cursor-pointer hover:opacity-80 p-2 rounded border border-gray-300">
            <%= render 'shared/frazione', num: 15, den: 5 %>
          </span>
          <span data-word-highlighter-target="word" data-action="click->word-highlighter#toggleHighlight" class="cursor-pointer hover:opacity-80 p-2 rounded border border-gray-300">
            <%= render 'shared/frazione', num: 19, den: 25 %>
          </span>
          <span data-word-highlighter-target="word" data-action="click->word-highlighter#toggleHighlight" class="cursor-pointer hover:opacity-80 p-2 rounded border border-gray-300">
            <%= render 'shared/frazione', num: 13, den: 11 %>
          </span>
          <span data-word-highlighter-target="word" data-action="click->word-highlighter#toggleHighlight" class="cursor-pointer hover:opacity-80 p-2 rounded border border-gray-300">
            <%= render 'shared/frazione', num: 21, den: 7 %>
          </span>
          <span data-word-highlighter-target="word" data-action="click->word-highlighter#toggleHighlight" class="cursor-pointer hover:opacity-80 p-2 rounded border border-gray-300">
            <%= render 'shared/frazione', num: 12, den: 5 %>
          </span>
          <span data-word-highlighter-target="word" data-action="click->word-highlighter#toggleHighlight" class="cursor-pointer hover:opacity-80 p-2 rounded border border-gray-300">
            <%= render 'shared/frazione', num: 1, den: 6 %>
          </span>
          <span data-word-highlighter-target="word" data-action="click->word-highlighter#toggleHighlight" class="cursor-pointer hover:opacity-80 p-2 rounded border border-gray-300">
            <%= render 'shared/frazione', num: 8, den: 3 %>
          </span>
        </div>
      </div>
    </div>

    <%= render 'shared/exercise_controls' %>
  </div>
</div>
