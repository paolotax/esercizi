<% content_for :titolo, "#{@pagina.titolo} - #{@pagina.numero}" %>

<div class="max-w-7xl mx-auto p-3 md:p-6 bg-white dark:bg-gray-900 text-black dark:text-white font-mono transition-colors duration-300"
     data-controller="exercise-checker page-viewer text-toggle font-controls"
     data-page-viewer-image-url-value="<%= asset_path('bus3_mat/p159/page.png') %>"
     data-text-toggle-target="content"
     data-font-controls-target="content">

  <!-- Header -->
  <%= render 'shared/page_header', pagina: @pagina %>

  <!-- Esercizio 1 - IMPARARE TUTTI -->
  <div class="mb-12" data-controller="fill-blanks auto-advance">
    <div class="flex items-start gap-3 mb-6">
      <div class="flex items-center">
        <div class="bg-cyan-700 text-white rounded-full w-8 h-8 flex items-center justify-center font-bold flex-shrink-0 z-10 relative">
          1
        </div>
        <span class="bg-yellow-300 text-cyan-700 font-bold pl-5 pr-4 py-1 rounded-r-full -ml-3">IMPARARE TUTTI</span>
      </div>
      <p class="text-gray-700 dark:text-gray-200"><strong>Scrivi al posto giusto queste parole:</strong></p>
    </div>

    <p class="text-center mb-6 text-gray-600 dark:text-gray-400">numeratore • denominatore • linea di frazione</p>

    <div class="flex flex-col md:flex-row items-center justify-center gap-8">
      <!-- Barra frazionata -->
      <div class="flex">
        <div class="w-12 h-8 bg-yellow-300 border border-gray-400 dark:border-gray-500"></div>
        <div class="w-12 h-8 bg-yellow-300 border border-gray-400 dark:border-gray-500"></div>
        <div class="w-12 h-8 bg-white dark:bg-gray-700 border border-gray-400 dark:border-gray-500"></div>
        <div class="w-12 h-8 bg-white dark:bg-gray-700 border border-gray-400 dark:border-gray-500"></div>
        <div class="w-12 h-8 bg-white dark:bg-gray-700 border border-gray-400 dark:border-gray-500"></div>
        <div class="w-12 h-8 bg-white dark:bg-gray-700 border border-gray-400 dark:border-gray-500"></div>
        <div class="w-12 h-8 bg-white dark:bg-gray-700 border border-gray-400 dark:border-gray-500"></div>
      </div>

      <!-- Frazione con etichette -->
      <div class="relative">
        <div class="flex flex-col items-center">
          <div class="flex items-center gap-4">
            <span class="font-bold">2</span>
            <span>→</span>
            <input type="text" data-fill-blanks-target="input" data-correct-answer="numeratore"
                   class="w-32 px-2 py-1 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center bg-white dark:bg-gray-700 dark:text-white">
          </div>
          <div class="flex items-center gap-4 my-1">
            <div class="w-8 h-0.5 bg-black dark:bg-white"></div>
            <span>→</span>
            <input type="text" data-fill-blanks-target="input" data-correct-answer="linea di frazione"
                   class="w-32 px-2 py-1 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center bg-white dark:bg-gray-700 dark:text-white">
          </div>
          <div class="flex items-center gap-4">
            <span class="font-bold">7</span>
            <span>→</span>
            <input type="text" data-fill-blanks-target="input" data-correct-answer="denominatore"
                   class="w-32 px-2 py-1 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center bg-white dark:bg-gray-700 dark:text-white">
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-12">
    <!-- Esercizio 2 -->
    <div data-controller="svg-colorable">
      <div class="flex items-start gap-3 mb-4">
        <div class="bg-red-500 text-white rounded-full w-8 h-8 flex items-center justify-center font-bold flex-shrink-0">
          2
        </div>
        <p class="text-gray-700 dark:text-gray-200">
          <strong>Osserva e colora la figura frazionata correttamente.</strong>
        </p>
      </div>

      <div class="flex flex-wrap gap-4 justify-center">
        <!-- Rettangolo 1 - divisione corretta (2 parti verticali) -->
        <svg viewBox="0 0 100 50" class="w-24 h-12 cursor-pointer">
          <rect x="0" y="0" width="50" height="50" fill="white" stroke="black" stroke-width="2"
                data-svg-colorable-target="cell" data-correct="true"
                data-action="click->svg-colorable#toggleCell"/>
          <rect x="50" y="0" width="50" height="50" fill="white" stroke="black" stroke-width="2"
                data-svg-colorable-target="cell" data-correct="true"
                data-action="click->svg-colorable#toggleCell"/>
        </svg>

        <!-- Rettangolo 2 - divisione sbagliata (parti diseguali) -->
        <svg viewBox="0 0 100 50" class="w-24 h-12 cursor-pointer">
          <rect x="0" y="0" width="30" height="50" fill="white" stroke="black" stroke-width="2"
                data-svg-colorable-target="cell" data-correct="false"
                data-action="click->svg-colorable#toggleCell"/>
          <rect x="30" y="0" width="70" height="50" fill="white" stroke="black" stroke-width="2"
                data-svg-colorable-target="cell" data-correct="false"
                data-action="click->svg-colorable#toggleCell"/>
        </svg>

        <!-- Quadrato - divisione corretta (4 parti) -->
        <svg viewBox="0 0 60 60" class="w-16 h-16 cursor-pointer">
          <rect x="0" y="0" width="30" height="30" fill="white" stroke="black" stroke-width="2"
                data-svg-colorable-target="cell" data-correct="true"
                data-action="click->svg-colorable#toggleCell"/>
          <rect x="30" y="0" width="30" height="30" fill="white" stroke="black" stroke-width="2"
                data-svg-colorable-target="cell" data-correct="true"
                data-action="click->svg-colorable#toggleCell"/>
          <rect x="0" y="30" width="30" height="30" fill="white" stroke="black" stroke-width="2"
                data-svg-colorable-target="cell" data-correct="true"
                data-action="click->svg-colorable#toggleCell"/>
          <rect x="30" y="30" width="30" height="30" fill="white" stroke="black" stroke-width="2"
                data-svg-colorable-target="cell" data-correct="true"
                data-action="click->svg-colorable#toggleCell"/>
        </svg>
      </div>
    </div>

    <!-- Esercizio 3 -->
    <div data-controller="svg-colorable">
      <div class="flex items-start gap-3 mb-4">
        <div class="bg-red-500 text-white rounded-full w-8 h-8 flex items-center justify-center font-bold flex-shrink-0">
          3
        </div>
        <p class="text-gray-700 dark:text-gray-200">
          <strong>Colora come indicato dalle frazioni.</strong>
        </p>
      </div>

      <div class="space-y-4">
        <!-- 1/3 -->
        <div class="flex items-center gap-4">
          <div class="text-center">
            <div class="font-bold">1</div>
            <div class="border-t border-black dark:border-white w-4 mx-auto"></div>
            <div class="font-bold">3</div>
          </div>
          <svg viewBox="0 0 90 30" class="w-24 h-8">
            <rect x="0" y="0" width="30" height="30" fill="white" stroke="black" stroke-width="2"
                  data-svg-colorable-target="cell" data-correct="true"
                  data-action="click->svg-colorable#toggleCell"/>
            <rect x="30" y="0" width="30" height="30" fill="white" stroke="black" stroke-width="2"
                  data-svg-colorable-target="cell" data-correct="false"
                  data-action="click->svg-colorable#toggleCell"/>
            <rect x="60" y="0" width="30" height="30" fill="white" stroke="black" stroke-width="2"
                  data-svg-colorable-target="cell" data-correct="false"
                  data-action="click->svg-colorable#toggleCell"/>
          </svg>
        </div>

        <!-- 1/5 -->
        <div class="flex items-center gap-4">
          <div class="text-center">
            <div class="font-bold">1</div>
            <div class="border-t border-black dark:border-white w-4 mx-auto"></div>
            <div class="font-bold">5</div>
          </div>
          <svg viewBox="0 0 150 30" class="w-40 h-8">
            <rect x="0" y="0" width="30" height="30" fill="white" stroke="black" stroke-width="2"
                  data-svg-colorable-target="cell" data-correct="true"
                  data-action="click->svg-colorable#toggleCell"/>
            <rect x="30" y="0" width="30" height="30" fill="white" stroke="black" stroke-width="2"
                  data-svg-colorable-target="cell" data-correct="false"
                  data-action="click->svg-colorable#toggleCell"/>
            <rect x="60" y="0" width="30" height="30" fill="white" stroke="black" stroke-width="2"
                  data-svg-colorable-target="cell" data-correct="false"
                  data-action="click->svg-colorable#toggleCell"/>
            <rect x="90" y="0" width="30" height="30" fill="white" stroke="black" stroke-width="2"
                  data-svg-colorable-target="cell" data-correct="false"
                  data-action="click->svg-colorable#toggleCell"/>
            <rect x="120" y="0" width="30" height="30" fill="white" stroke="black" stroke-width="2"
                  data-svg-colorable-target="cell" data-correct="false"
                  data-action="click->svg-colorable#toggleCell"/>
          </svg>
        </div>

        <!-- 1/8 -->
        <div class="flex items-center gap-4">
          <div class="text-center">
            <div class="font-bold">1</div>
            <div class="border-t border-black dark:border-white w-4 mx-auto"></div>
            <div class="font-bold">8</div>
          </div>
          <svg viewBox="0 0 240 30" class="w-60 h-8">
            <% 8.times do |i| %>
              <rect x="<%= i * 30 %>" y="0" width="30" height="30" fill="white" stroke="black" stroke-width="2"
                    data-svg-colorable-target="cell" data-correct="<%= i == 0 %>"
                    data-action="click->svg-colorable#toggleCell"/>
            <% end %>
          </svg>
        </div>
      </div>
    </div>
  </div>

  <!-- Esercizio 4 -->
  <div class="mb-12" data-controller="fill-blanks auto-advance">
    <div class="flex items-start gap-3 mb-4">
      <div class="bg-red-500 text-white rounded-full w-8 h-8 flex items-center justify-center font-bold flex-shrink-0">
        4
      </div>
      <p class="text-gray-700 dark:text-gray-200">
        <strong>Completa.</strong>
      </p>
    </div>

    <div class="flex flex-col md:flex-row items-start gap-6">
      <!-- Immagine crostata -->
      <div class="flex-shrink-0">
        <%= image_tag "bus3_mat/p159/output-1743504902159_148_753_163_167.png", alt: "Crostata divisa in 4 parti", class: "w-32 h-32 rounded" %>
      </div>

      <div class="space-y-4">
        <p>
          <span class="text-red-500">•</span> La crostata è stata divisa in
          <input type="text" data-fill-blanks-target="input" data-correct-answer="4"
                 class="w-10 px-1 py-1 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center bg-white dark:bg-gray-700 dark:text-white" inputmode="numeric">
          parti uguali. Ogni parte uguale si chiama unità frazionaria e si indica con la frazione
          <span class="inline-flex flex-col items-center mx-1">
            <span class="font-bold">1</span>
            <span class="border-t border-black dark:border-white w-4"></span>
            <input type="text" data-fill-blanks-target="input" data-correct-answer="4"
                   class="w-8 px-1 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center bg-white dark:bg-gray-700 dark:text-white" inputmode="numeric">
          </span>.
        </p>

        <p>
          <span class="text-red-500">•</span> 2 parti dell'intera crostata sono i
          <span class="inline-flex flex-col items-center mx-1">
            <span class="font-bold">2</span>
            <span class="border-t border-black dark:border-white w-4"></span>
            <input type="text" data-fill-blanks-target="input" data-correct-answer="4"
                   class="w-8 px-1 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center bg-white dark:bg-gray-700 dark:text-white" inputmode="numeric">
          </span>
          dell'intero.
        </p>

        <p>
          <span class="text-red-500">•</span> Indico l'intera crostata con la frazione
          <span class="inline-flex flex-col items-center mx-1">
            <input type="text" data-fill-blanks-target="input" data-correct-answer="4"
                   class="w-8 px-1 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center bg-white dark:bg-gray-700 dark:text-white" inputmode="numeric">
            <span class="border-t border-black dark:border-white w-4"></span>
            <input type="text" data-fill-blanks-target="input" data-correct-answer="4"
                   class="w-8 px-1 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center bg-white dark:bg-gray-700 dark:text-white" inputmode="numeric">
          </span>.
        </p>
      </div>
    </div>
  </div>

  <!-- Esercizio 5 -->
  <div class="mb-12" data-controller="svg-colorable">
    <div class="flex items-start gap-3 mb-4">
      <div class="bg-red-500 text-white rounded-full w-8 h-8 flex items-center justify-center font-bold flex-shrink-0">
        5
      </div>
      <p class="text-gray-700 dark:text-gray-200">
        <strong>Dividi le figure in 2 parti uguali e colorane una, cioè la metà
          <span class="inline-flex flex-col items-center mx-1">
            <span>(</span>
          </span>
          <span class="inline-flex flex-col items-center">
            <span class="font-bold">1</span>
            <span class="border-t border-black dark:border-white w-3"></span>
            <span class="font-bold">2</span>
          </span>
          <span class="inline-flex flex-col items-center mx-1">
            <span>)</span>
          </span>.
        </strong>
      </p>
    </div>

    <div class="flex flex-wrap gap-6 justify-center">
      <!-- Cerchio -->
      <svg viewBox="0 0 80 80" class="w-20 h-20">
        <path d="M40 0 A40 40 0 0 1 40 80 L40 0" fill="white" stroke="black" stroke-width="2"
              data-svg-colorable-target="cell" data-correct="true"
              data-action="click->svg-colorable#toggleCell"/>
        <path d="M40 0 A40 40 0 0 0 40 80 L40 0" fill="white" stroke="black" stroke-width="2"
              data-svg-colorable-target="cell" data-correct="false"
              data-action="click->svg-colorable#toggleCell"/>
      </svg>

      <!-- Cuore -->
      <svg viewBox="0 0 80 80" class="w-20 h-20">
        <path d="M40 75 L40 15 M40 15 C25 0, 0 10, 10 35 L40 75" fill="white" stroke="black" stroke-width="2"
              data-svg-colorable-target="cell" data-correct="true"
              data-action="click->svg-colorable#toggleCell"/>
        <path d="M40 15 C55 0, 80 10, 70 35 L40 75" fill="white" stroke="black" stroke-width="2"
              data-svg-colorable-target="cell" data-correct="false"
              data-action="click->svg-colorable#toggleCell"/>
      </svg>

      <!-- Freccia/Casa -->
      <svg viewBox="0 0 80 80" class="w-20 h-20">
        <polygon points="40,5 75,40 75,75 40,75 40,40" fill="white" stroke="black" stroke-width="2"
              data-svg-colorable-target="cell" data-correct="true"
              data-action="click->svg-colorable#toggleCell"/>
        <polygon points="40,5 5,40 5,75 40,75 40,40" fill="white" stroke="black" stroke-width="2"
              data-svg-colorable-target="cell" data-correct="false"
              data-action="click->svg-colorable#toggleCell"/>
      </svg>

      <!-- Stella -->
      <svg viewBox="0 0 80 80" class="w-20 h-20">
        <polygon points="40,5 47,30 75,30 52,48 60,75 40,58 40,5" fill="white" stroke="black" stroke-width="2"
              data-svg-colorable-target="cell" data-correct="true"
              data-action="click->svg-colorable#toggleCell"/>
        <polygon points="40,5 33,30 5,30 28,48 20,75 40,58 40,5" fill="white" stroke="black" stroke-width="2"
              data-svg-colorable-target="cell" data-correct="false"
              data-action="click->svg-colorable#toggleCell"/>
      </svg>

      <!-- Farfallino -->
      <svg viewBox="0 0 80 80" class="w-20 h-20">
        <polygon points="40,40 10,10 10,70" fill="white" stroke="black" stroke-width="2"
              data-svg-colorable-target="cell" data-correct="true"
              data-action="click->svg-colorable#toggleCell"/>
        <polygon points="40,40 70,10 70,70" fill="white" stroke="black" stroke-width="2"
              data-svg-colorable-target="cell" data-correct="false"
              data-action="click->svg-colorable#toggleCell"/>
      </svg>
    </div>
  </div>

  <!-- Footer con controlli -->
  <%= render 'shared/exercise_controls' %>
</div>
