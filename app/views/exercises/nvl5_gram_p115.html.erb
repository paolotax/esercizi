<div class="max-w-6xl mx-auto bg-white dark:bg-gray-900 text-black dark:text-white p-3 md:p-6 transition-colors duration-300"
     data-controller="exercise-checker text-toggle font-controls"
     data-text-toggle-target="content"
     data-font-controls-target="content">

  <%= render 'shared/page_header', pagina: @pagina %>

  <!-- Box teoria con immagine -->
  <div class="bg-<%= @pagina.base_color %>-50 dark:bg-<%= @pagina.base_color %>-900/30 p-4 md:p-6 pb-8 rounded-lg">
    <div class="flex flex-col md:flex-row gap-6 items-center">
      <div class="flex-1">
        <p class="text-gray-700 dark:text-gray-200 mb-3">
          L'<strong class="underline">apposizione</strong> è un <strong>nome</strong> che accompagna un altro nome per precisarne il significato. Può essere aggiunta sia al soggetto sia a un complemento.
        </p>
        <p class="text-gray-700 dark:text-gray-200">
          → Sul <strong class="underline">monte</strong> Cervino c'è la neve.
        </p>
      </div>
      <div class="w-64 h-48 flex-shrink-0">
        <svg viewBox="0 0 300 200" class="w-full h-full">
          <!-- Cielo -->
          <ellipse cx="150" cy="100" rx="140" ry="90" fill="#5BC0DE" opacity="0.6"/>
          <!-- Montagna -->
          <path d="M 50 150 L 150 50 L 250 150 Z" fill="#E8E8E8"/>
          <path d="M 120 80 L 150 50 L 180 80 Z" fill="white"/>
          <!-- Prato -->
          <ellipse cx="150" cy="175" rx="120" ry="25" fill="#90EE90"/>
          <!-- Alberi -->
          <path d="M 60 140 L 60 160 M 80 140 L 80 160 M 100 140 L 100 160" stroke="#228B22" stroke-width="3"/>
          <circle cx="60" cy="135" r="8" fill="#228B22"/>
          <circle cx="80" cy="135" r="8" fill="#228B22"/>
          <circle cx="100" cy="135" r="8" fill="#228B22"/>
        </svg>
      </div>
    </div>
  </div>

  <!-- Esercizio 1 - IMPARARE TUTTI - Sottolinea le apposizioni -->
  <div class="bg-<%= @pagina.base_color %>-100 dark:bg-<%= @pagina.base_color %>-900/40 p-4 md:p-6 pb-8 rounded-lg" data-controller="word-highlighter" data-word-highlighter-multi-color-value="false">
    <h2 class="font-bold mb-4 flex items-center gap-2">
      <span class="flex-shrink-0 bg-<%= @pagina.base_color %>-500 text-white rounded-full w-8 h-8 md:w-10 md:h-10 inline-flex items-center justify-center">1</span>
      <span class="bg-yellow-400 text-blue-900 px-3 py-1 rounded-lg font-bold">IMPARARE TUTTI</span>
      Sottolinea le <strong class="underline">apposizioni<span class="inline-block w-6 h-6 bg-yellow-300 rounded ml-1 align-middle cursor-pointer transition transform hover:scale-110" data-word-highlighter-target="colorBox" data-color="yellow" data-action="click->word-highlighter#selectColor"></span></strong>.
    </h2>

    <!-- Hidden color selector for monocolor mode -->
    <div class="hidden">
      <div class="w-6 h-6 bg-yellow-300"
           data-word-highlighter-target="colorBox"
           data-color="yellow">
      </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 cursor-pointer">
      <div class="bg-white dark:bg-gray-800 p-4 rounded-lg">
        <span class="text-<%= @pagina.base_color %>-500">•</span>
        Il <span data-word-highlighter-target="word" data-correct="yellow" data-action="click->word-highlighter#toggleHighlight" class="px-1 rounded">dottor</span> Verdi ha visitato mio fratello.
      </div>

      <div class="bg-white dark:bg-gray-800 p-4 rounded-lg">
        <span class="text-<%= @pagina.base_color %>-500">•</span>
        Oggi la <span data-word-highlighter-target="word" data-correct="yellow" data-action="click->word-highlighter#toggleHighlight" class="px-1 rounded">maestra</span> Sara mi ha interrogato.
      </div>

      <div class="bg-white dark:bg-gray-800 p-4 rounded-lg">
        <span class="text-<%= @pagina.base_color %>-500">•</span>
        La pianta di olivo era sacra per la <span data-word-highlighter-target="word" data-correct="yellow" data-action="click->word-highlighter#toggleHighlight" class="px-1 rounded">dea</span> Atena.
      </div>

      <div class="bg-white dark:bg-gray-800 p-4 rounded-lg">
        <span class="text-<%= @pagina.base_color %>-500">•</span>
        <span data-word-highlighter-target="word" data-correct="yellow" data-action="click->word-highlighter#toggleHighlight" class="px-1 rounded">Zia</span> Marika ha quarant'anni.
      </div>

      <div class="bg-white dark:bg-gray-800 p-4 rounded-lg">
        <span class="text-<%= @pagina.base_color %>-500">•</span>
        Mio <span data-word-highlighter-target="word" data-correct="yellow" data-action="click->word-highlighter#toggleHighlight" class="px-1 rounded">cugino</span> Edo lavora in quel negozio.
      </div>

      <div class="bg-white dark:bg-gray-800 p-4 rounded-lg">
        <span class="text-<%= @pagina.base_color %>-500">•</span>
        Il <span data-word-highlighter-target="word" data-correct="yellow" data-action="click->word-highlighter#toggleHighlight" class="px-1 rounded">fiume</span> Senna attraversa la città di Parigi.
      </div>
    </div>
  </div>

  <!-- Esercizio 2 - Arricchisci con apposizioni -->
  <div class="p-4 md:p-6 pb-8" data-controller="fill-blanks">
    <h2 class="font-bold mb-4 flex items-center gap-2">
      <span class="flex-shrink-0 bg-<%= @pagina.base_color %>-500 text-white rounded-full w-8 h-8 md:w-10 md:h-10 inline-flex items-center justify-center">2</span>
      Arricchisci le frasi con un'<strong class="underline">apposizione</strong>. Scegli tra:
    </h2>

    <div class="flex flex-wrap gap-2 mb-6 justify-center">
      <% ["regione", "papà", "signora", "amica", "amico", "professor", "figlio", "cane"].each do |word| %>
        <span class="bg-<%= @pagina.base_color %>-100 dark:bg-<%= @pagina.base_color %>-900/40 px-4 py-2 rounded-lg font-semibold text-<%= @pagina.base_color %>-700 dark:text-<%= @pagina.base_color %>-300">
          <%= word %>
        </span>
      <% end %>
    </div>

    <div class="space-y-4">
      <div class="bg-<%= @pagina.base_color %>-50 dark:bg-<%= @pagina.base_color %>-900/30 p-4 rounded-lg">
        <span class="text-<%= @pagina.base_color %>-500">•</span>
        Martina, l'<input type="text"
               class="w-32 px-3 py-1 border-b-2 border-dotted border-<%= @pagina.base_color %>-500 bg-transparent dark:text-white focus:outline-none text-center"
               data-fill-blanks-target="input"
               data-correct-answer="amica">
        di mia sorella, è una brava calciatrice.
      </div>

      <div class="bg-<%= @pagina.base_color %>-50 dark:bg-<%= @pagina.base_color %>-900/30 p-4 rounded-lg">
        <span class="text-<%= @pagina.base_color %>-500">•</span>
        Ho accarezzato Birillo, il <input type="text"
               class="w-32 px-3 py-1 border-b-2 border-dotted border-<%= @pagina.base_color %>-500 bg-transparent dark:text-white focus:outline-none text-center"
               data-fill-blanks-target="input"
               data-correct-answer="cane">
        del mio <input type="text"
               class="w-32 px-3 py-1 border-b-2 border-dotted border-<%= @pagina.base_color %>-500 bg-transparent dark:text-white focus:outline-none text-center"
               data-fill-blanks-target="input"
               data-correct-answer="amico">
        Lorenzo.
      </div>

      <div class="bg-<%= @pagina.base_color %>-50 dark:bg-<%= @pagina.base_color %>-900/30 p-4 rounded-lg">
        <span class="text-<%= @pagina.base_color %>-500">•</span>
        Il <input type="text"
               class="w-32 px-3 py-1 border-b-2 border-dotted border-<%= @pagina.base_color %>-500 bg-transparent dark:text-white focus:outline-none text-center"
               data-fill-blanks-target="input"
               data-correct-answer="professor">
        Rossi insegna in un liceo della nostra città.
      </div>

      <div class="bg-<%= @pagina.base_color %>-50 dark:bg-<%= @pagina.base_color %>-900/30 p-4 rounded-lg">
        <span class="text-<%= @pagina.base_color %>-500">•</span>
        La <input type="text"
               class="w-32 px-3 py-1 border-b-2 border-dotted border-<%= @pagina.base_color %>-500 bg-transparent dark:text-white focus:outline-none text-center"
               data-fill-blanks-target="input"
               data-correct-answer="regione">
        Sicilia è la più grande d'Italia.
      </div>

      <div class="bg-<%= @pagina.base_color %>-50 dark:bg-<%= @pagina.base_color %>-900/30 p-4 rounded-lg">
        <span class="text-<%= @pagina.base_color %>-500">•</span>
        <input type="text"
               class="w-32 px-3 py-1 border-b-2 border-dotted border-<%= @pagina.base_color %>-500 bg-transparent dark:text-white focus:outline-none text-center"
               data-fill-blanks-target="input"
               data-correct-answer="papà">
        Andrea ha comprato un regalo per Mirko, suo <input type="text"
               class="w-32 px-3 py-1 border-b-2 border-dotted border-<%= @pagina.base_color %>-500 bg-transparent dark:text-white focus:outline-none text-center"
               data-fill-blanks-target="input"
               data-correct-answer="figlio">.
      </div>

      <div class="bg-<%= @pagina.base_color %>-50 dark:bg-<%= @pagina.base_color %>-900/30 p-4 rounded-lg">
        <span class="text-<%= @pagina.base_color %>-500">•</span>
        La nonna e la <input type="text"
               class="w-32 px-3 py-1 border-b-2 border-dotted border-<%= @pagina.base_color %>-500 bg-transparent dark:text-white focus:outline-none text-center"
               data-fill-blanks-target="input"
               data-correct-answer="signora">
        Giovanna sono amiche da molti anni.
      </div>
    </div>
  </div>

  <!-- Esercizio 3 - Sottolinea in viola/arancione -->
  <div class="bg-<%= @pagina.base_color %>-50 dark:bg-<%= @pagina.base_color %>-900/30 p-4 md:p-6 pb-8 rounded-lg" data-controller="word-highlighter" data-word-highlighter-multi-color-value="true">
    <h2 class="font-bold mb-4 flex items-center gap-2">
      <span class="flex-shrink-0 bg-<%= @pagina.base_color %>-500 text-white rounded-full w-8 h-8 md:w-10 md:h-10 inline-flex items-center justify-center">3</span>
      Sottolinea in <span class="text-purple-600 dark:text-purple-400 font-bold">viola<span class="inline-block w-6 h-6 bg-purple-300 rounded ml-1 align-middle cursor-pointer transition transform hover:scale-110" data-word-highlighter-target="colorBox" data-color="purple" data-action="click->word-highlighter#selectColor"></span></span> i nomi che formano il <span class="underline">predicato nominale</span>,
      in <span class="text-orange-600 dark:text-orange-400 font-bold">arancione<span class="inline-block w-6 h-6 bg-orange-300 rounded ml-1 align-middle cursor-pointer transition transform hover:scale-110" data-word-highlighter-target="colorBox" data-color="orange" data-action="click->word-highlighter#selectColor"></span></span> i nomi che sono <strong class="underline">apposizioni</strong> del soggetto o del complemento.
    </h2>

    <div class="bg-blue-50 dark:bg-blue-900/30 rounded-lg p-4 mb-4">
      <p class="text-gray-700 dark:text-gray-200">
        <strong>Fai attenzione</strong> a non confondere l'apposizione con il nome che forma il predicato nominale:
        Maria <span class="text-purple-600 dark:text-purple-400 underline font-semibold">è la mamma</span> di Bea, la mia <span class="text-orange-600 dark:text-orange-400 underline font-semibold">compagna</span>.
      </p>
    </div>

    <div class="space-y-4 cursor-pointer">
      <div class="bg-white dark:bg-gray-800 p-4 rounded-lg">
        <span class="text-<%= @pagina.base_color %>-500">•</span>
        Mia <span data-word-highlighter-target="word" data-correct="orange" data-action="click->word-highlighter#toggleHighlight" class="px-1 rounded">zia</span>
        Francesca vive a Berlino.
      </div>

      <div class="bg-white dark:bg-gray-800 p-4 rounded-lg">
        <span class="text-<%= @pagina.base_color %>-500">•</span>
        Tuo fratello Andrea è un
        <span data-word-highlighter-target="word" data-correct="purple" data-action="click->word-highlighter#toggleHighlight" class="px-1 rounded">cuoco</span>
        sopraffino!
      </div>

      <div class="bg-white dark:bg-gray-800 p-4 rounded-lg">
        <span class="text-<%= @pagina.base_color %>-500">•</span>
        Giuseppe, il
        <span data-word-highlighter-target="word" data-correct="orange" data-action="click->word-highlighter#toggleHighlight" class="px-1 rounded">postino</span>,
        è passato in anticipo.
      </div>

      <div class="bg-white dark:bg-gray-800 p-4 rounded-lg">
        <span class="text-<%= @pagina.base_color %>-500">•</span>
        Oreste, il
        <span data-word-highlighter-target="word" data-correct="orange" data-action="click->word-highlighter#toggleHighlight" class="px-1 rounded">criceto</span>
        della nonna, è un
        <span data-word-highlighter-target="word" data-correct="purple" data-action="click->word-highlighter#toggleHighlight" class="px-1 rounded">animale</span>
        intelligente.
      </div>

      <div class="bg-white dark:bg-gray-800 p-4 rounded-lg">
        <span class="text-<%= @pagina.base_color %>-500">•</span>
        La mia
        <span data-word-highlighter-target="word" data-correct="orange" data-action="click->word-highlighter#toggleHighlight" class="px-1 rounded">amica</span>
        Ludovica è ammalata.
      </div>

      <div class="bg-white dark:bg-gray-800 p-4 rounded-lg">
        <span class="text-<%= @pagina.base_color %>-500">•</span>
        Quel signore,
        <span data-word-highlighter-target="word" data-correct="orange" data-action="click->word-highlighter#toggleHighlight" class="px-1 rounded">direttore</span>
        del museo, è anche
        <span data-word-highlighter-target="word" data-correct="purple" data-action="click->word-highlighter#toggleHighlight" class="px-1 rounded">scrittore</span>.
      </div>
    </div>
  </div>

  <!-- Reference -->
  <div class="text-right text-gray-500 dark:text-gray-400 mb-6">
    Esercizi p. <%= link_to "188", pagina_path("nvl5_gram_p188"), class: "text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200 underline" %>
  </div>

  <%= render 'shared/exercise_controls' %>
</div>
