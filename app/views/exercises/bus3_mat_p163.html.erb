<% content_for :titolo, "#{@pagina.titolo} - #{@pagina.numero}" %>

<div class="max-w-7xl mx-auto p-3 md:p-6 bg-white dark:bg-gray-900 text-black dark:text-white font-mono transition-colors duration-300"
     data-controller="exercise-checker page-viewer text-toggle font-controls"
     data-page-viewer-image-url-value="<%= asset_path('bus3_mat/p163/page.png') %>"
     data-text-toggle-target="content"
     data-font-controls-target="content">

  <!-- Header -->
  <%= render 'shared/page_header', pagina: @pagina %>

  <!-- Esercizio 1 -->
  <div class="mb-12" data-controller="fill-blanks auto-advance svg-colorable">
    <div class="flex items-start gap-3 mb-6">
      <div class="bg-red-500 text-white rounded-full w-8 h-8 flex items-center justify-center font-bold flex-shrink-0">
        1
      </div>
      <p class="text-gray-700 dark:text-gray-200">
        <strong>Colora la centesima parte, poi completa.</strong>
      </p>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
      <!-- Griglia 10x10 per centesimi -->
      <div class="flex justify-center">
        <div class="grid grid-cols-10 gap-0 border border-gray-400">
          <% 100.times do |i| %>
            <div class="w-5 h-5 border border-gray-300 cursor-pointer hover:bg-yellow-200 transition-colors"
                 data-svg-colorable-target="cell" data-cell-id="cent-<%= i %>"></div>
          <% end %>
        </div>
      </div>

      <!-- Completamento -->
      <div class="space-y-4">
        <p class="text-gray-700 dark:text-gray-200">
          • L'intero è stato diviso in
          <input type="text" data-fill-blanks-target="input" data-correct-answer="100"
                 class="w-14 px-1 py-1 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center bg-white dark:bg-gray-700 dark:text-white" inputmode="numeric">
          parti uguali.
        </p>
        <p class="text-gray-700 dark:text-gray-200">
          • Ogni parte è
          <span class="inline-block text-center">
            <span class="border-b-2 border-gray-600 px-1">1</span>
            <span class="block text-center">
              <input type="text" data-fill-blanks-target="input" data-correct-answer="100"
                     class="w-14 px-1 py-1 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center bg-white dark:bg-gray-700 dark:text-white" inputmode="numeric">
            </span>
          </span>
          dell'intero, cioè 0,01.
        </p>
        <p class="text-gray-700 dark:text-gray-200">
          • La parte non colorata corrisponde ai
          <span class="inline-block text-center">
            <input type="text" data-fill-blanks-target="input" data-correct-answer="99"
                   class="w-14 px-1 py-1 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center bg-white dark:bg-gray-700 dark:text-white" inputmode="numeric">
            <span class="block border-t-2 border-gray-600">100</span>
          </span>
          dell'intero, cioè 0,
          <input type="text" data-fill-blanks-target="input" data-correct-answer="99"
                 class="w-14 px-1 py-1 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center bg-white dark:bg-gray-700 dark:text-white" inputmode="numeric">.
        </p>
      </div>
    </div>
  </div>

  <!-- Esercizio 2 -->
  <div class="mb-12" data-controller="fill-blanks auto-advance">
    <div class="flex items-start gap-3 mb-6">
      <div class="bg-red-500 text-white rounded-full w-8 h-8 flex items-center justify-center font-bold flex-shrink-0">
        2
      </div>
      <p class="text-gray-700 dark:text-gray-200">
        <strong>Completa.</strong>
      </p>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
      <!-- Griglia 10x100 per millesimi (rappresentata come griglia più grande) -->
      <div class="flex justify-center">
        <div class="grid grid-cols-50 gap-0 border border-gray-400 overflow-x-auto">
          <% 10.times do |row| %>
            <% 50.times do |col| %>
              <div class="w-2 h-3 border border-gray-200 bg-white"></div>
            <% end %>
          <% end %>
        </div>
      </div>

      <!-- Completamento millesimi -->
      <div class="space-y-4">
        <p class="text-gray-700 dark:text-gray-200">
          • L'intero è stato diviso in 1000 parti uguali.
        </p>
        <p class="text-gray-700 dark:text-gray-200">
          • Ogni parte è
          <span class="inline-block text-center">
            <span class="border-b-2 border-gray-600 px-1">1</span>
            <span class="block text-center">
              <input type="text" data-fill-blanks-target="input" data-correct-answer="1000"
                     class="w-16 px-1 py-1 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center bg-white dark:bg-gray-700 dark:text-white" inputmode="numeric">
            </span>
          </span>
          dell'intero, cioè 0,0
          <input type="text" data-fill-blanks-target="input" data-correct-answer="01"
                 class="w-10 px-1 py-1 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center bg-white dark:bg-gray-700 dark:text-white" inputmode="numeric">.
        </p>
      </div>
    </div>
  </div>

  <!-- Esercizio 3 -->
  <div class="mb-12" data-controller="fill-blanks auto-advance">
    <div class="flex items-start gap-3 mb-6">
      <div class="bg-red-500 text-white rounded-full w-8 h-8 flex items-center justify-center font-bold flex-shrink-0">
        3
      </div>
      <p class="text-gray-700 dark:text-gray-200">
        <strong>Scrivi la frazione rappresentata in colore e il corrispondente numero decimale.</strong>
      </p>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
      <!-- Prima griglia: 25/100 -->
      <div class="space-y-4">
        <div class="flex justify-center">
          <div class="grid grid-cols-10 gap-0 border border-gray-400">
            <% 100.times do |i| %>
              <% if i < 25 %>
                <div class="w-4 h-4 border border-gray-300 bg-yellow-400"></div>
              <% else %>
                <div class="w-4 h-4 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800"></div>
              <% end %>
            <% end %>
          </div>
        </div>
        <div class="flex items-center justify-center gap-3">
          <span class="inline-block text-center">
            <input type="text" data-fill-blanks-target="input" data-correct-answer="25"
                   class="w-12 px-1 py-1 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center bg-white dark:bg-gray-700 dark:text-white" inputmode="numeric">
            <span class="block border-t-2 border-gray-600">
              <input type="text" data-fill-blanks-target="input" data-correct-answer="100"
                     class="w-12 px-1 py-1 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center bg-white dark:bg-gray-700 dark:text-white" inputmode="numeric">
            </span>
          </span>
          <span class="">→</span>
          <span>0,</span>
          <input type="text" data-fill-blanks-target="input" data-correct-answer="25"
                 class="w-12 px-1 py-1 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center bg-white dark:bg-gray-700 dark:text-white" inputmode="numeric">
        </div>
      </div>

      <!-- Seconda griglia: 37/100 -->
      <div class="space-y-4">
        <div class="flex justify-center">
          <div class="grid grid-cols-10 gap-0 border border-gray-400">
            <% 100.times do |i| %>
              <% if i < 37 %>
                <div class="w-4 h-4 border border-gray-300 bg-purple-400"></div>
              <% else %>
                <div class="w-4 h-4 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800"></div>
              <% end %>
            <% end %>
          </div>
        </div>
        <div class="flex items-center justify-center gap-3">
          <span class="inline-block text-center">
            <input type="text" data-fill-blanks-target="input" data-correct-answer="37"
                   class="w-12 px-1 py-1 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center bg-white dark:bg-gray-700 dark:text-white" inputmode="numeric">
            <span class="block border-t-2 border-gray-600">
              <input type="text" data-fill-blanks-target="input" data-correct-answer="100"
                     class="w-12 px-1 py-1 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center bg-white dark:bg-gray-700 dark:text-white" inputmode="numeric">
            </span>
          </span>
          <span class="">→</span>
          <input type="text" data-fill-blanks-target="input" data-correct-answer="0,37"
                 class="w-14 px-1 py-1 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center bg-white dark:bg-gray-700 dark:text-white">
        </div>
      </div>
    </div>
  </div>

  <!-- Esercizio 4 -->
  <div class="mb-12" data-controller="fill-blanks auto-advance">
    <div class="flex items-start gap-3 mb-6">
      <div class="bg-red-500 text-white rounded-full w-8 h-8 flex items-center justify-center font-bold flex-shrink-0">
        4
      </div>
      <p class="text-gray-700 dark:text-gray-200">
        <strong>Scrivi la frazione decimale.</strong>
      </p>
    </div>

    <div class="flex flex-wrap justify-center gap-8">
      <!-- 3/100 = 0,03 -->
      <div class="flex items-center gap-3">
        <span class="inline-block text-center">
          <input type="text" data-fill-blanks-target="input" data-correct-answer="3"
                 class="w-10 px-1 py-1 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center bg-white dark:bg-gray-700 dark:text-white" inputmode="numeric">
          <span class="block border-t-2 border-gray-600">100</span>
        </span>
        <span>= 0,03</span>
      </div>

      <!-- 9/100 = 0,09 -->
      <div class="flex items-center gap-3">
        <span class="inline-block text-center">
          <input type="text" data-fill-blanks-target="input" data-correct-answer="9"
                 class="w-10 px-1 py-1 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center bg-white dark:bg-gray-700 dark:text-white" inputmode="numeric">
          <span class="block border-t-2 border-gray-600">
            <input type="text" data-fill-blanks-target="input" data-correct-answer="100"
                   class="w-12 px-1 py-1 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center bg-white dark:bg-gray-700 dark:text-white" inputmode="numeric">
          </span>
        </span>
        <span>= 0,09</span>
      </div>

      <!-- 2/1000 = 0,002 -->
      <div class="flex items-center gap-3">
        <span class="inline-block text-center">
          <input type="text" data-fill-blanks-target="input" data-correct-answer="2"
                 class="w-10 px-1 py-1 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center bg-white dark:bg-gray-700 dark:text-white" inputmode="numeric">
          <span class="block border-t-2 border-gray-600">
            <input type="text" data-fill-blanks-target="input" data-correct-answer="1000"
                   class="w-14 px-1 py-1 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center bg-white dark:bg-gray-700 dark:text-white" inputmode="numeric">
          </span>
        </span>
        <span>= 0,002</span>
      </div>
    </div>
  </div>

  <!-- Footer con controlli -->
  <%= render 'shared/exercise_controls' %>
</div>
