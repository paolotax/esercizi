<div class="max-w-6xl mx-auto p-3 md:p-8 bg-white" data-controller="exercise-checker">

  <%= render 'shared/page_header', pagina: @pagina %>

  <!-- Info Box -->
  <div class="bg-<%= @pagina.base_color %>-50 p-4 md:p-6 pb-8 rounded-lg">
    <p class="text-base md:text-lg text-gray-700 mb-4">
      <span class="text-<%= @pagina.base_color %>-500">•</span> I <strong>verbi</strong> indicano un'azione, un modo di essere o uno stato del soggetto. Variano in base:
    </p>
    <div class="space-y-2 text-base md:text-lg text-gray-700 ml-6">
      <p><span class="text-blue-500">•</span> al <strong>modo</strong> → i <strong class="text-blue-600">modi finiti</strong> (indicativo, congiuntivo, condizionale, imperativo) esprimono la persona, i <strong class="text-blue-600">modi indefiniti</strong> (infinito, gerundio, participio) non esprimono la persona;</p>
      <p><span class="text-green-500">•</span> al <strong>tempo</strong> → <strong class="text-green-600">semplice</strong> o <strong class="text-green-600">composto</strong>;</p>
      <p><span class="text-red-500">•</span> alla <strong>persona</strong> → <strong class="text-red-600">singolare</strong> o <strong class="text-red-600">plurale</strong>.</p>
    </div>

    <p class="text-base md:text-lg text-gray-700 mt-4 mb-3 font-semibold">
      <span class="text-<%= @pagina.base_color %>-500">•</span> I verbi si classificano in <strong>tre coniugazioni</strong>, in base alla desinenza dell'infinito presente:
    </p>
    <div class="space-y-2 text-base md:text-lg text-gray-700 ml-6">
      <p><span class="text-orange-500">•</span> <strong>1ª coniugazione</strong> → <strong class="text-orange-600">-are</strong> (amare, cantare...)</p>
      <p><span class="text-purple-500">•</span> <strong>2ª coniugazione</strong> → <strong class="text-purple-600">-ere</strong> (credere, perdere...)</p>
      <p><span class="text-pink-500">•</span> <strong>3ª coniugazione</strong> → <strong class="text-pink-600">-ire</strong> (dormire, finire...)</p>
    </div>
  </div>

  <!-- Exercise 1: IMPARARE TUTTI -->
  <div class="bg-white p-4 md:p-6 pb-8" data-controller="fill-blanks">
    <h2 class="text-lg md:text-xl font-bold mb-4 flex items-center gap-2">
      <span class="flex-shrink-0 bg-<%= @pagina.base_color %>-500 text-white rounded-full w-8 h-8 md:w-10 md:h-10 inline-flex items-center justify-center">1</span>
      Per ogni verbo scrivi l'infinito presente e la corrispondente coniugazione, come nell'esempio.
    </h2>

    <div class="space-y-3 text-base md:text-lg">
      <div class="bg-<%= @pagina.base_color %>-50 rounded-lg p-4">
        <p class="text-gray-700"><span class="text-<%= @pagina.base_color %>-500">•</span> rincorreva → <strong class="text-green-700">rincorrere, 2ª coniug.</strong></p>
      </div>

      <% verbs = [
        { verb: "incontrerai", infinitive: "incontrare", coniug: "1ª coniug." },
        { verb: "fosti partito", infinitive: "partire", coniug: "3ª coniug." },
        { verb: "sarebbe cresciuto", infinitive: "crescere", coniug: "2ª coniug." }
      ] %>

      <% verbs.each do |item| %>
        <div class="rounded-lg p-3 flex flex-wrap items-center gap-2">
          <span class="text-<%= @pagina.base_color %>-500">•</span>
          <span class="text-gray-700"><%= item[:verb] %> →</span>
          <input type="text"
                 class="w-32 border-b-2 border-dotted border-<%= @pagina.base_color %>-500 bg-white text-right px-2 focus:outline-none focus:border-<%= @pagina.base_color %>-700"
                 data-fill-blanks-target="input"
                 data-answer="<%= item[:infinitive] %>"
                 data-correct-answer="<%= item[:infinitive] %>">,
          <input type="text"
                 class="w-32 border-b-2 border-dotted border-<%= @pagina.base_color %>-500 bg-white text-right px-2 focus:outline-none focus:border-<%= @pagina.base_color %>-700"
                 data-fill-blanks-target="input"
                 data-answer="<%= item[:coniug] %>"
                 data-correct-answer="<%= item[:coniug] %>">
        </div>
      <% end %>
    </div>
  </div>

  <!-- Exercise 2: Write person -->
  <div class="bg-white p-4 md:p-6 pb-8" data-controller="fill-blanks">
    <h2 class="text-lg md:text-xl font-bold mb-4 flex items-center gap-2">
      <span class="flex-shrink-0 bg-<%= @pagina.base_color %>-500 text-white rounded-full w-8 h-8 md:w-10 md:h-10 inline-flex items-center justify-center">2</span>
      Per ogni verbo scrivi la persona, come nell'esempio.
    </h2>

    <div class="space-y-3 text-base md:text-lg">
      <div class="bg-<%= @pagina.base_color %>-50 rounded-lg p-4">
        <p class="text-gray-700"><span class="text-<%= @pagina.base_color %>-500">•</span> sei andato → <strong class="text-green-700">tu, 2ª pers. sing.</strong></p>
      </div>

      <% persons = [
        { verb: "finì", answer: "egli/ella, 3ª pers. sing." },
        { verb: "guidai", answer: "io, 1ª pers. sing." },
        { verb: "avranno perso", answer: "essi/esse, 3ª pers. plur." },
        { verb: "tornate", answer: "voi, 2ª pers. plur." },
        { verb: "pensavamo", answer: "noi, 1ª pers. plur." }
      ] %>

      <% persons.each do |item| %>
        <div class="rounded-lg p-3 flex flex-wrap items-center gap-2">
          <span class="text-<%= @pagina.base_color %>-500">•</span>
          <span class="text-gray-700"><%= item[:verb] %> →</span>
          <input type="text"
                 class="flex-1 min-w-[200px] border-b-2 border-dotted border-<%= @pagina.base_color %>-500 bg-white text-right px-2 focus:outline-none focus:border-<%= @pagina.base_color %>-700"
                 data-fill-blanks-target="input"
                 data-answer="<%= item[:answer] %>"
                 data-correct-answer="<%= item[:answer] %>">
        </div>
      <% end %>
    </div>
  </div>

  <!-- Exercise 3: Underline and highlight -->
  <div class="bg-white p-4 md:p-6 pb-8" data-controller="word-highlighter" data-word-highlighter-multi-color-value="true">
    <h2 class="text-lg md:text-xl font-bold mb-4 flex items-center gap-2">
      <span class="flex-shrink-0 bg-<%= @pagina.base_color %>-500 text-white rounded-full w-8 h-8 md:w-10 md:h-10 inline-flex items-center justify-center">3</span>
      Sottolinea i modi finiti<span class="inline-block w-5 h-5 bg-yellow-300 rounded ml-1 cursor-pointer" data-word-highlighter-target="colorBox" data-color="yellow" data-action="click->word-highlighter#selectColor"></span> e i modi indefiniti<span class="inline-block w-5 h-5 bg-cyan-300 rounded ml-1 cursor-pointer" data-word-highlighter-target="colorBox" data-color="cyan" data-action="click->word-highlighter#selectColor"></span>.
    </h2>

    <div class="bg-<%= @pagina.base_color %>-50 rounded-lg p-4 cursor-pointer">
      <p class="text-base md:text-lg text-gray-700 leading-relaxed">
        Quella mattina la sveglia non <span class="transition" data-word-highlighter-target="word" data-action="click->word-highlighter#toggleHighlight" data-correct="yellow">suonò</span>. Per arrivare a scuola in orario, Giacomo
        <span class="transition" data-word-highlighter-target="word" data-action="click->word-highlighter#toggleHighlight" data-correct="yellow">aveva</span> solo un quarto d'ora. <span class="transition" data-word-highlighter-target="word" data-action="click->word-highlighter#toggleHighlight" data-correct="cyan">Mangiando</span> qualche
        biscotto, <span class="transition" data-word-highlighter-target="word" data-action="click->word-highlighter#toggleHighlight" data-correct="yellow">cercò</span> di <span class="transition" data-word-highlighter-target="word" data-action="click->word-highlighter#toggleHighlight" data-correct="cyan">ricordare</span> dove
        <span class="transition" data-word-highlighter-target="word" data-action="click->word-highlighter#toggleHighlight" data-correct="yellow">aveva posato</span> il diario con gli appunti per la lezione. Lo
        <span class="transition" data-word-highlighter-target="word" data-action="click->word-highlighter#toggleHighlight" data-correct="yellow">trovò</span>, <span class="transition" data-word-highlighter-target="word" data-action="click->word-highlighter#toggleHighlight" data-correct="yellow">si vestì</span> in fretta e
        <span class="transition" data-word-highlighter-target="word" data-action="click->word-highlighter#toggleHighlight" data-correct="yellow">corse</span> a scuola. <span class="transition" data-word-highlighter-target="word" data-action="click->word-highlighter#toggleHighlight" data-correct="cyan">Sorridente</span>,
        <span class="transition" data-word-highlighter-target="word" data-action="click->word-highlighter#toggleHighlight" data-correct="yellow">entrò</span> in classe e tutti lo <span class="transition" data-word-highlighter-target="word" data-action="click->word-highlighter#toggleHighlight" data-correct="yellow">salutarono</span>:
        "Buongiorno prof!".
      </p>
    </div>
  </div>

  <%= render 'shared/exercise_controls' %>
</div>
