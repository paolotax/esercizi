<div class="max-w-6xl mx-auto p-3 md:p-8 bg-gradient-to-br from-pink-50 via-white to-blue-50 rounded-3xl shadow-xl" data-controller="exercise-checker page-viewer" data-page-viewer-image-url-value="<%= asset_path('nvi5_mat/p007/page.png') %>">
  <!-- Header -->
  <div class="mb-8">
    <div class="flex items-start sm:items-center justify-between gap-4 mb-4">
      <div class="flex flex-col-reverse sm:flex-row items-start sm:items-center gap-2 sm:gap-4">
        <div class="bg-blue-600 text-white text-md sm:text-xl px-2 sm:px-4 py-1.5 sm:py-2 rounded-lg font-bold">
          GEOMETRIA
        </div>
        <h1 class="text-2xl sm:text-3xl font-bold text-blue-600">PER RICOMINCIARE...</h1>
      </div>
      <div class="cursor-pointer hover:bg-pink-700 transition-colors flex-shrink-0 bg-pink-600 text-white rounded-full w-10 h-10 sm:w-12 sm:h-12 flex items-center justify-center font-bold text-lg sm:text-xl"
           data-action="click->page-viewer#openOriginal" title="Clicca per vedere la pagina originale">
        7
      </div>
    </div>
  </div>

  <div class="space-y-6">
    <!-- Box Ricorda -->
    <div class="bg-gradient-to-r from-blue-100 to-blue-50 rounded-2xl border-4 border-blue-300 shadow-2xl p-4 md:p-6">
      <div class="flex items-start gap-3 mb-4">
        <span class="text-3xl font-bold text-pink-600">Ricorda!</span>
      </div>

      <p class="text-lg text-gray-800 mb-6">
        Il <span class="font-bold text-blue-700">poligono</span> è la parte di piano delimitata da una linea spezzata semplice chiusa.
      </p>

      <!-- Diagramma del poligono -->
      <div class="bg-white rounded-xl p-6 mb-6 flex justify-center">
        <svg viewBox="0 0 400 250" class="w-full max-w-md">
          <!-- Poligono -->
          <polygon points="100,50 300,80 320,180 180,220 80,150"
                   fill="#f0f9ff" stroke="#2563eb" stroke-width="3"/>

          <!-- Diagonale -->
          <line x1="100" y1="50" x2="320" y2="180"
                stroke="#e879f9" stroke-width="2" stroke-dasharray="5,5"/>

          <!-- Etichette -->
          <g class="text-sm">
            <!-- Vertice -->
            <circle cx="100" cy="50" r="4" fill="#ef4444"/>
            <text x="100" y="30" text-anchor="middle" fill="#1f2937" class="font-bold">
              <tspan x="100" dy="0">vertice</tspan>
            </text>
            <rect x="60" y="18" width="80" height="20" fill="white" stroke="#ec4899" stroke-width="2" rx="10"/>
            <text x="100" y="32" text-anchor="middle" fill="#1f2937" class="font-bold text-xs">vertice</text>

            <!-- Diagonale -->
            <rect x="140" y="85" width="90" height="20" fill="white" stroke="#ec4899" stroke-width="2" rx="10"/>
            <text x="185" y="99" text-anchor="middle" fill="#1f2937" class="font-bold text-xs">diagonale</text>

            <!-- Superficie -->
            <text x="200" y="130" text-anchor="middle" fill="#2563eb" class="font-bold text-base">superficie</text>

            <!-- Angolo -->
            <path d="M 80,150 L 100,140 L 90,160" fill="none" stroke="#2563eb" stroke-width="2"/>
            <rect x="25" y="155" width="70" height="20" fill="white" stroke="#ec4899" stroke-width="2" rx="10"/>
            <text x="60" y="169" text-anchor="middle" fill="#1f2937" class="font-bold text-xs">angolo</text>

            <!-- Lato -->
            <rect x="320" y="115" width="55" height="20" fill="white" stroke="#ec4899" stroke-width="2" rx="10"/>
            <text x="347" y="129" text-anchor="middle" fill="#1f2937" class="font-bold text-xs">lato</text>
          </g>
        </svg>
      </div>

      <p class="text-lg text-gray-800">
        I <span class="font-bold text-blue-700">poligoni regolari</span> hanno tutti i lati e tutti gli angoli congruenti fra loro.
      </p>
    </div>

    <!-- Esercizio 1: Colora i poligoni -->
    <div class="bg-white rounded-2xl border-4 border-pink-200 shadow-2xl p-4 md:p-6">
      <h3 class="text-lg font-bold text-blue-700 mb-4 flex items-start gap-3">
        <span class="bg-blue-600 text-white rounded-full w-8 h-8 flex items-center justify-center flex-shrink-0">1</span>
        <span>Colora di rosso i poligoni, poi indica il nome di ciascuno. Scrivi nel quadratino la lettera giusta.</span>
      </h3>

      <!-- Legenda nomi -->
      <div class="bg-blue-50 rounded-lg p-4 mb-6">
        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-2 text-sm">
          <div><span class="font-bold text-blue-700">A</span> triangolo isoscele</div>
          <div><span class="font-bold text-blue-700">B</span> rombo</div>
          <div><span class="font-bold text-blue-700">C</span> quadrato</div>
          <div><span class="font-bold text-blue-700">D</span> trapezio rettangolo</div>
          <div><span class="font-bold text-blue-700">E</span> ottagono</div>
          <div><span class="font-bold text-blue-700">F</span> parallelogramma</div>
        </div>
      </div>

      <!-- Griglia figure -->
      <div class="grid grid-cols-2 md:grid-cols-4 gap-6">
        <!-- Rombo (B) -->
        <div class="flex flex-col items-center gap-2">
          <div class="relative">
            <svg viewBox="0 0 120 140" class="w-28 h-32">
              <polygon points="60,20 100,70 60,120 20,70"
                       class="polygon-shape"
                       data-is-polygon="true"
                       data-answer="B"
                       fill="#e0e7ff" stroke="#3b82f6" stroke-width="2"/>
            </svg>
          </div>
          <input type="text"
                 class="w-12 h-12 text-center text-xl font-bold border-2 border-pink-300 rounded focus:border-pink-500 focus:outline-none uppercase"
                 data-correct-answer="B"
                 maxlength="1">
        </div>

        <!-- Parallelogramma/Trapezio (F o D) -->
        <div class="flex flex-col items-center gap-2">
          <div class="relative">
            <svg viewBox="0 0 140 140" class="w-28 h-32">
              <polygon points="30,30 120,30 100,110 50,110"
                       class="polygon-shape"
                       data-is-polygon="true"
                       data-answer="F"
                       fill="#e0e7ff" stroke="#3b82f6" stroke-width="2"/>
            </svg>
          </div>
          <input type="text"
                 class="w-12 h-12 text-center text-xl font-bold border-2 border-pink-300 rounded focus:border-pink-500 focus:outline-none uppercase"
                 data-correct-answer="F"
                 maxlength="1">
        </div>

        <!-- Triangolo con freccia - NON è poligono per la freccia curva -->
        <div class="flex flex-col items-center gap-2">
          <div class="relative">
            <svg viewBox="0 0 140 140" class="w-28 h-32">
              <polygon points="70,20 120,110 20,110"
                       fill="#f3f4f6" stroke="#3b82f6" stroke-width="2"/>
              <!-- Freccia curva interna -->
              <path d="M 50,60 Q 70,80 90,60"
                    fill="none" stroke="#3b82f6" stroke-width="2"/>
              <polygon points="90,60 85,55 95,55" fill="#3b82f6"/>
            </svg>
          </div>
          <input type="text"
                 class="w-12 h-12 text-center text-xl font-bold border-2 border-pink-300 rounded focus:border-pink-500 focus:outline-none uppercase bg-gray-100"
                 data-correct-answer=""
                 maxlength="1"
                 disabled>
        </div>

        <!-- Forma con semicerchio - NON poligono -->
        <div class="flex flex-col items-center gap-2">
          <div class="relative">
            <svg viewBox="0 0 120 140" class="w-28 h-32">
              <path d="M 20,40 L 100,40 L 100,100 Q 60,120 20,100 Z"
                    fill="#f3f4f6" stroke="#3b82f6" stroke-width="2"/>
            </svg>
          </div>
          <input type="text"
                 class="w-12 h-12 text-center text-xl font-bold border-2 border-pink-300 rounded focus:border-pink-500 focus:outline-none uppercase bg-gray-100"
                 data-correct-answer=""
                 maxlength="1"
                 disabled>
        </div>

        <!-- Triangolo isoscele (A) -->
        <div class="flex flex-col items-center gap-2">
          <div class="relative">
            <svg viewBox="0 0 140 140" class="w-28 h-32">
              <polygon points="70,20 130,120 10,120"
                       class="polygon-shape"
                       data-is-polygon="true"
                       data-answer="A"
                       fill="#e0e7ff" stroke="#3b82f6" stroke-width="2"/>
            </svg>
          </div>
          <input type="text"
                 class="w-12 h-12 text-center text-xl font-bold border-2 border-pink-300 rounded focus:border-pink-500 focus:outline-none uppercase"
                 data-correct-answer="A"
                 maxlength="1">
        </div>

        <!-- Ottagono (E) -->
        <div class="flex flex-col items-center gap-2">
          <div class="relative">
            <svg viewBox="0 0 140 140" class="w-28 h-32">
              <polygon points="70,20 100,30 120,60 120,90 100,120 70,130 40,120 20,90 20,60 40,30"
                       class="polygon-shape"
                       data-is-polygon="true"
                       data-answer="E"
                       fill="#e0e7ff" stroke="#3b82f6" stroke-width="2"/>
            </svg>
          </div>
          <input type="text"
                 class="w-12 h-12 text-center text-xl font-bold border-2 border-pink-300 rounded focus:border-pink-500 focus:outline-none uppercase"
                 data-correct-answer="E"
                 maxlength="1">
        </div>

        <!-- Trapezio rettangolo (D) -->
        <div class="flex flex-col items-center gap-2">
          <div class="relative">
            <svg viewBox="0 0 140 140" class="w-28 h-32">
              <polygon points="30,30 110,30 90,110 30,110"
                       class="polygon-shape"
                       data-is-polygon="true"
                       data-answer="D"
                       fill="#e0e7ff" stroke="#3b82f6" stroke-width="2"/>
            </svg>
          </div>
          <input type="text"
                 class="w-12 h-12 text-center text-xl font-bold border-2 border-pink-300 rounded focus:border-pink-500 focus:outline-none uppercase"
                 data-correct-answer="D"
                 maxlength="1">
        </div>

        <!-- Cerchio parziale - NON poligono -->
        <div class="flex flex-col items-center gap-2">
          <div class="relative">
            <svg viewBox="0 0 120 140" class="w-28 h-32">
              <path d="M 20,70 Q 20,20 70,20 L 70,70 Q 70,120 20,120 Z"
                    fill="#f3f4f6" stroke="#3b82f6" stroke-width="2"/>
            </svg>
          </div>
          <input type="text"
                 class="w-12 h-12 text-center text-xl font-bold border-2 border-pink-300 rounded focus:border-pink-500 focus:outline-none uppercase bg-gray-100"
                 data-correct-answer=""
                 maxlength="1"
                 disabled>
        </div>

        <!-- Quadrato (C) -->
        <div class="flex flex-col items-center gap-2">
          <div class="relative">
            <svg viewBox="0 0 120 140" class="w-28 h-32">
              <rect x="30" y="30" width="80" height="80"
                    class="polygon-shape"
                    data-is-polygon="true"
                    data-answer="C"
                    fill="#e0e7ff" stroke="#3b82f6" stroke-width="2"/>
            </svg>
          </div>
          <input type="text"
                 class="w-12 h-12 text-center text-xl font-bold border-2 border-pink-300 rounded focus:border-pink-500 focus:outline-none uppercase"
                 data-correct-answer="C"
                 maxlength="1">
        </div>
      </div>
    </div>

    <!-- Esercizio 2: Poligoni regolari -->
    <div class="bg-white rounded-2xl border-4 border-blue-200 shadow-2xl p-4 md:p-6">
      <h3 class="text-lg font-bold text-pink-700 mb-4 flex items-start gap-3">
        <span class="bg-pink-600 text-white rounded-full w-8 h-8 flex items-center justify-center flex-shrink-0">2</span>
        <span>Quali dei poligoni dell'esercizio precedente sono poligoni regolari? Scrivi le lettere.</span>
      </h3>

      <div class="flex items-center gap-4 bg-pink-50 rounded-lg p-6">
        <div class="flex items-center gap-2">
          <span class="text-lg">...........</span>
          <input type="text"
                 class="w-16 h-12 text-center text-xl font-bold border-2 border-pink-300 rounded focus:border-pink-500 focus:outline-none uppercase"
                 data-correct-answer="C"
                 maxlength="1">
          <span class="text-lg">e</span>
          <input type="text"
                 class="w-16 h-12 text-center text-xl font-bold border-2 border-pink-300 rounded focus:border-pink-500 focus:outline-none uppercase"
                 data-correct-answer="E"
                 maxlength="1">
        </div>
      </div>

      <div class="mt-4 text-sm text-gray-600 bg-blue-50 rounded-lg p-3">
        <span class="font-bold">Suggerimento:</span> I poligoni regolari hanno tutti i lati e tutti gli angoli uguali tra loro.
      </div>
    </div>

    <!-- Esercizio 3: Formule perimetro -->
    <div class="bg-white rounded-2xl border-4 border-pink-200 shadow-2xl p-4 md:p-6">
      <h3 class="text-lg font-bold text-blue-700 mb-6 flex items-start gap-3">
        <span class="bg-blue-600 text-white rounded-full w-8 h-8 flex items-center justify-center flex-shrink-0">3</span>
        <span>Associa a ogni poligono la formula per calcolare il suo perimetro.</span>
      </h3>

      <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
        <!-- Quadrato -->
        <div class="flex flex-col items-center gap-4">
          <svg viewBox="0 0 150 150" class="w-32 h-32">
            <rect x="25" y="25" width="100" height="100"
                  fill="#dbeafe" stroke="#3b82f6" stroke-width="3"/>
            <!-- Etichetta lato -->
            <text x="75" y="15" text-anchor="middle" fill="#1f2937" class="font-bold text-sm">ℓ</text>
          </svg>

          <div class="text-center font-bold text-lg mb-2">Quadrato</div>

          <select class="w-full px-4 py-3 text-center border-2 border-blue-300 rounded-lg focus:border-blue-500 focus:outline-none font-bold text-blue-700"
                  data-correct-answer="P = ℓ × 4">
            <option value="">Scegli la formula...</option>
            <option value="P = ℓ × 4">P = ℓ × 4</option>
            <option value="P = B + b + ℓ₁ + ℓ₂">P = B + b + ℓ₁ + ℓ₂</option>
            <option value="P = ℓ₁ + ℓ₂ + ℓ₃">P = ℓ₁ + ℓ₂ + ℓ₃</option>
          </select>
        </div>

        <!-- Trapezio -->
        <div class="flex flex-col items-center gap-4">
          <svg viewBox="0 0 150 150" class="w-32 h-32">
            <polygon points="50,30 130,30 110,120 30,120"
                     fill="#dbeafe" stroke="#3b82f6" stroke-width="3"/>
            <!-- Etichette -->
            <text x="90" y="25" text-anchor="middle" fill="#1f2937" class="font-bold text-sm">B</text>
            <text x="70" y="135" text-anchor="middle" fill="#1f2937" class="font-bold text-sm">b</text>
            <text x="20" y="80" text-anchor="middle" fill="#1f2937" class="font-bold text-sm">ℓ₁</text>
            <text x="135" y="80" text-anchor="middle" fill="#1f2937" class="font-bold text-sm">ℓ₂</text>
          </svg>

          <div class="text-center font-bold text-lg mb-2">Trapezio</div>

          <select class="w-full px-4 py-3 text-center border-2 border-blue-300 rounded-lg focus:border-blue-500 focus:outline-none font-bold text-blue-700"
                  data-correct-answer="P = B + b + ℓ₁ + ℓ₂">
            <option value="">Scegli la formula...</option>
            <option value="P = ℓ × 4">P = ℓ × 4</option>
            <option value="P = B + b + ℓ₁ + ℓ₂">P = B + b + ℓ₁ + ℓ₂</option>
            <option value="P = ℓ₁ + ℓ₂ + ℓ₃">P = ℓ₁ + ℓ₂ + ℓ₃</option>
          </select>
        </div>

        <!-- Triangolo -->
        <div class="flex flex-col items-center gap-4">
          <svg viewBox="0 0 150 150" class="w-32 h-32">
            <polygon points="75,20 140,120 10,120"
                     fill="#dbeafe" stroke="#3b82f6" stroke-width="3"/>
            <!-- Etichette -->
            <text x="50" y="80" text-anchor="middle" fill="#1f2937" class="font-bold text-sm">ℓ₁</text>
            <text x="110" y="80" text-anchor="middle" fill="#1f2937" class="font-bold text-sm">ℓ₂</text>
            <text x="75" y="135" text-anchor="middle" fill="#1f2937" class="font-bold text-sm">ℓ₃</text>
          </svg>

          <div class="text-center font-bold text-lg mb-2">Triangolo</div>

          <select class="w-full px-4 py-3 text-center border-2 border-blue-300 rounded-lg focus:border-blue-500 focus:outline-none font-bold text-blue-700"
                  data-correct-answer="P = ℓ₁ + ℓ₂ + ℓ₃">
            <option value="">Scegli la formula...</option>
            <option value="P = ℓ × 4">P = ℓ × 4</option>
            <option value="P = B + b + ℓ₁ + ℓ₂">P = B + b + ℓ₁ + ℓ₂</option>
            <option value="P = ℓ₁ + ℓ₂ + ℓ₃">P = ℓ₁ + ℓ₂ + ℓ₃</option>
          </select>
        </div>
      </div>
    </div>

    <!-- Exercise Controls -->
    <%= render 'shared/exercise_controls', color: 'pink', current_page: 'nvi5_mat_p007' %>

  </div>
</div>

<style>
  .polygon-shape {
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .polygon-shape:hover {
    filter: brightness(0.9);
  }

  .polygon-shape.colored {
    fill: #fecaca !important;
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Gestione click sui poligoni per colorarli
    const polygonShapes = document.querySelectorAll('.polygon-shape');

    polygonShapes.forEach(shape => {
      shape.addEventListener('click', function() {
        if (this.dataset.isPolygon === 'true') {
          this.classList.toggle('colored');
        }
      });
    });
  });
</script>
