<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8" data-controller="exercise-checker">

  <!-- Header con badge SINTASSI -->
  <div class="mb-8">
    <div class="flex items-start justify-between">
      <!-- Badge e Titolo -->
      <div class="flex items-start gap-4">
        <!-- Badge SINTASSI con icona lampadina -->
        <div class="bg-yellow-400 text-orange-700 px-6 py-3 rounded-lg font-bold text-lg flex items-center gap-2">
          <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
            <path d="M10 2a6 6 0 00-6 6c0 1.887.875 3.517 2.084 4.485A.5.5 0 016 12.5V14a1 1 0 001 1h6a1 1 0 001-1v-1.5a.5.5 0 01-.084-.015C15.125 11.517 16 9.887 16 8a6 6 0 00-6-6z"/>
          </svg>
          SINTASSI
        </div>
      </div>
      <!-- Numero pagina -->
      <div class="bg-orange-500 text-white rounded-full w-12 h-12 flex items-center justify-center font-bold text-xl">
        112
      </div>
    </div>

    <!-- Titolo principale -->
    <h1 class="text-3xl font-bold text-orange-600 mt-6 text-center">
      Il complemento di mezzo
    </h1>
  </div>

  <!-- Illustrazione in cucina -->
  <div class="mb-8 relative">
    <div class="bg-yellow-100 rounded-xl p-6">
      <%= image_tag "nvl5_gram_p112_01.jpg", class: "w-full rounded-lg", alt: "Cucina con chef" %>

      <!-- Fumetti dei personaggi -->
      <div class="absolute top-4 left-8 bg-white border-2 border-gray-300 rounded-lg p-3 shadow-lg max-w-xs">
        <p class="text-sm">La ricetta dice di montare l'impasto <span class="text-purple-600 font-bold">con la frusta elettrica</span>, ma non l'abbiamo!</p>
      </div>

      <div class="absolute top-4 right-8 bg-white border-2 border-gray-300 rounded-lg p-3 shadow-lg max-w-xs">
        <p class="text-sm">Monteremo l'impasto <span class="text-purple-600 font-bold">con la forza</span> delle nostre braccia!</p>
      </div>
    </div>
  </div>

  <!-- Box teoria -->
  <div class="bg-yellow-50 border-2 border-yellow-300 rounded-lg p-6 mb-8">
    <ul class="space-y-3 text-gray-700">
      <li class="flex">
        <span class="text-gray-500 mr-2">•</span>
        <span>Il <strong class="underline">complemento di mezzo</strong> è un complemento indiretto;</span>
      </li>
      <li class="flex">
        <span class="text-gray-500 mr-2">•</span>
        <span>indica per mezzo di chi o di che cosa viene compiuta l'azione espressa dal predicato;</span>
      </li>
      <li class="flex">
        <span class="text-gray-500 mr-2">•</span>
        <div>
          <span>risponde alle domande: </span>
          <strong class="underline">per mezzo di chi?</strong> /
          <strong class="underline">per mezzo di che cosa?</strong> /
          <strong class="underline">con che cosa?</strong>
          <div class="mt-2">
            → Bisogna montare l'impasto (<em>con che cosa?</em>) <strong class="underline text-purple-600">con la frusta elettrica</strong>.
          </div>
        </div>
      </li>
    </ul>
  </div>

  <!-- Esercizio 1 - IMPARARE TUTTI -->
  <div class="bg-yellow-100 border-2 border-yellow-400 rounded-lg p-6 mb-8">
    <div class="flex items-center gap-3 mb-4">
      <div class="bg-blue-500 text-white rounded-full w-10 h-10 flex items-center justify-center font-bold text-xl">
        1
      </div>
      <div class="bg-blue-500 text-white px-4 py-2 rounded-lg font-bold">
        IMPARARE TUTTI
      </div>
    </div>

    <div class="mb-4">
      <p class="font-bold text-gray-700">
        Dividi la frase in sintagmi e sottolinea il <span class="underline">complemento di mezzo</span>.
      </p>
    </div>

    <div class="space-y-3">
      <% frases_mezzo = [
        { text: "Stendo la pasta con il mattarello.", complement: "con il mattarello" },
        { text: "Verremo al mare da te in treno.", complement: "in treno" },
        { text: "Il pirata trovò il tesoro con la mappa.", complement: "con la mappa" },
        { text: "Apri il cancello con il telecomando.", complement: "con il telecomando" }
      ] %>

      <% frases_mezzo.each do |frase| %>
        <div class="bg-white p-3 rounded-lg">
          <div class="flex items-center gap-2">
            <span class="text-gray-500">•</span>
            <div data-controller="word-highlighter">
              <% words = frase[:text].split(/\s+/) %>
              <% words.each_with_index do |word, i| %>
                <% if frase[:complement].split(/\s+/).include?(word) %>
                  <span class="transition cursor-pointer hover:bg-purple-100 px-1 rounded"
                        data-word-highlighter-target="word"
                        data-correct="true"
                        data-action="click->word-highlighter#toggleHighlight"><%= word %></span>
                <% else %>
                  <%= word %>
                <% end %>
                <%= " " unless i == words.length - 1 %>
              <% end %>
            </div>
          </div>
        </div>
      <% end %>
    </div>
  </div>

  <!-- Esercizio 2 - Sottolinea il sintagma -->
  <div class="bg-white border-2 border-gray-300 rounded-lg p-6 mb-8">
    <div class="flex items-center gap-3 mb-4">
      <div class="bg-orange-500 text-white rounded-full w-10 h-10 flex items-center justify-center font-bold text-xl">
        2
      </div>
    </div>

    <p class="font-bold text-gray-700 mb-4">
      Sottolinea il sintagma che corrisponde a un <span class="underline">complemento di mezzo</span>.
    </p>

    <div class="space-y-3">
      <% [
        { text: "Andrò a Catania", option1: "con Alice", option2: "con l'aereo", correct: 2 },
        { text: "Vi avvertiremo", option1: "con una mail", option2: "in tempo", correct: 1 },
        { text: "Scrivete", option1: "con precisione", option2: "con la biro blu", correct: 2 },
        { text: "Ci muoveremo", option1: "in gruppo", option2: "in bicicletta", correct: 2 }
      ].each_with_index do |item, index| %>
        <div class="bg-gray-50 p-3 rounded-lg">
          <div class="flex items-center gap-2">
            <span class="text-gray-500">•</span>
            <span><%= item[:text] %></span>
            <div class="flex gap-4 ml-2" data-controller="word-highlighter">
              <span class="cursor-pointer px-2 py-1 border-b-2 border-gray-300 hover:bg-blue-100 transition"
                    data-word-highlighter-target="word"
                    data-correct="<%= item[:correct] == 1 ? 'true' : 'false' %>"
                    data-action="click->word-highlighter#toggleHighlight">
                <strong><%= item[:option1] %></strong>
              </span>
              <span>/</span>
              <span class="cursor-pointer px-2 py-1 border-b-2 border-gray-300 hover:bg-blue-100 transition"
                    data-word-highlighter-target="word"
                    data-correct="<%= item[:correct] == 2 ? 'true' : 'false' %>"
                    data-action="click->word-highlighter#toggleHighlight">
                <strong><%= item[:option2] %></strong>
              </span>
            </div>
          </div>
        </div>
      <% end %>
    </div>
  </div>

  <!-- Esercizio 3 - Analisi logica -->
  <div class="bg-white border-2 border-gray-300 rounded-lg p-6 mb-8" data-controller="fill-blanks">
    <div class="flex items-center gap-3 mb-4">
      <div class="bg-orange-500 text-white rounded-full w-10 h-10 flex items-center justify-center font-bold text-xl">
        3
      </div>
    </div>

    <p class="font-bold text-gray-700 mb-4">
      Esegui l'analisi logica della seguente frase. Il soggetto è sottinteso.
    </p>

    <div class="bg-blue-50 border-2 border-blue-200 rounded-lg p-4 mb-4">
      <p class="text-lg font-semibold text-gray-700">
        • Oggi sono andata a casa di Giovanni con il pullman.
      </p>
    </div>

    <div class="space-y-3">
      <% [
        { parte: "Oggi", analisi: "complemento di tempo" },
        { parte: "sono andata", analisi: "predicato verbale" },
        { parte: "a casa", analisi: "complemento di luogo" },
        { parte: "di Giovanni", analisi: "complemento di specificazione" },
        { parte: "con il pullman", analisi: "complemento di mezzo" }
      ].each do |item| %>
        <div class="flex items-center gap-3">
          <span class="font-semibold text-gray-700 w-32"><%= item[:parte] %> =</span>
          <input type="text"
                 class="flex-1 px-3 py-2 border-b-2 border-dotted border-gray-400 focus:border-blue-500 focus:outline-none"
                 data-fill-blanks-target="input"
                 data-correct-answer="<%= item[:analisi] %>">
        </div>
      <% end %>
    </div>
  </div>

  <!-- Riferimento esercizi aggiuntivi -->
  <div class="mt-8 text-center">
    <div class="inline-block bg-orange-100 border-2 border-orange-300 rounded-lg px-6 py-3">
      <p class="font-bold text-orange-700">
        Esercizi pp. 186-187
      </p>
    </div>
  </div>

  <!-- Exercise controls -->
  <%= render 'shared/exercise_controls', color: 'orange' %>
</div>