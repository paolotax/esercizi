<div class="max-w-6xl mx-auto p-3 md:p-8 bg-white" data-controller="exercise-checker">

  <%= render 'shared/page_header', pagina: @pagina %>

  <!-- Illustrazione -->
  <div class="mb-6 relative">
    <div class="bg-<%= @pagina.base_color %>-50 rounded-lg p-4">
      <%= image_tag "nvl5_gram/p112/p112_01.jpg", class: "w-full rounded-lg", alt: "Cucina con chef" %>
    </div>
  </div>

  <!-- Info Box -->
  <div class="bg-<%= @pagina.base_color %>-50 p-4 md:p-6 pb-8 rounded-lg">
    <ul class="space-y-3 text-base md:text-lg text-gray-700">
      <li class="flex items-start gap-2">
        <span class="text-<%= @pagina.base_color %>-500 font-bold">•</span>
        <span>Il <strong>complemento di mezzo</strong> è un complemento indiretto;</span>
      </li>
      <li class="flex items-start gap-2">
        <span class="text-<%= @pagina.base_color %>-500 font-bold">•</span>
        <span>indica per mezzo di chi o di che cosa viene compiuta l'azione espressa dal predicato;</span>
      </li>
      <li class="flex items-start gap-2">
        <span class="text-<%= @pagina.base_color %>-500 font-bold">•</span>
        <div>
          <span>risponde alle domande: <strong>per mezzo di chi?</strong> / <strong>per mezzo di che cosa?</strong> / <strong>con che cosa?</strong></span>
          <div class="mt-2 text-sm italic">
            → Bisogna montare l'impasto (<em>con che cosa?</em>) <strong class="text-purple-600">con la frusta elettrica</strong>.
          </div>
        </div>
      </li>
    </ul>
  </div>

  <!-- Exercise 1: IMPARARE TUTTI -->
  <div class="bg-<%= @pagina.base_color %>-100 p-4 md:p-6 pb-8 rounded-lg">
    <h2 class="text-lg md:text-xl font-bold mb-4 flex items-center gap-2">
      <span class="flex-shrink-0 bg-<%= @pagina.base_color %>-500 text-white rounded-full w-8 h-8 md:w-10 md:h-10 inline-flex items-center justify-center">1</span>
      <span class="bg-yellow-400 text-blue-900 px-3 py-1 rounded-lg font-bold">IMPARARE TUTTI</span>
      Dividi la frase in sintagmi e sottolinea il complemento di mezzo.
    </h2>

    <div class="space-y-3 text-base md:text-lg">
      <% frases_mezzo = [
        { text: "Stendo la pasta con il mattarello.", complement: "con il mattarello" },
        { text: "Verremo al mare da te in treno.", complement: "in treno" },
        { text: "Il pirata trovò il tesoro con la mappa.", complement: "con la mappa" },
        { text: "Apri il cancello con il telecomando.", complement: "con il telecomando" }
      ] %>

      <% frases_mezzo.each do |frase| %>
        <div class="bg-white rounded-lg p-4">
          <div class="flex items-center gap-2">
            <span class="text-<%= @pagina.base_color %>-500">•</span>
            <div data-controller="word-highlighter">
              <% words = frase[:text].split(/\s+/) %>
              <% words.each_with_index do |word, i| %>
                <% if frase[:complement].split(/\s+/).include?(word) %>
                  <span class="transition cursor-pointer hover:bg-purple-100 px-1 rounded"
                        data-word-highlighter-target="word"
                        data-correct="true"
                        data-action="click->word-highlighter#toggleHighlight"><%= word %></span>
                <% else %>
                  <%= word %>
                <% end %>
                <%= " " unless i == words.length - 1 %>
              <% end %>
            </div>
          </div>
        </div>
      <% end %>
    </div>
  </div>

  <!-- Exercise 2 -->
  <div class="bg-white p-4 md:p-6 pb-8">
    <h2 class="text-lg md:text-xl font-bold mb-4 flex items-center gap-2">
      <span class="flex-shrink-0 bg-<%= @pagina.base_color %>-500 text-white rounded-full w-8 h-8 md:w-10 md:h-10 inline-flex items-center justify-center">2</span>
      Sottolinea il sintagma che corrisponde a un complemento di mezzo.
    </h2>

    <div class="space-y-3 text-base md:text-lg">
      <% [
        { text: "Andrò a Catania", option1: "con Alice", option2: "con l'aereo", correct: 2 },
        { text: "Vi avvertiremo", option1: "con una mail", option2: "in tempo", correct: 1 },
        { text: "Scrivete", option1: "con precisione", option2: "con la biro blu", correct: 2 },
        { text: "Ci muoveremo", option1: "in gruppo", option2: "in bicicletta", correct: 2 }
      ].each do |item| %>
        <div class="bg-<%= @pagina.base_color %>-50 rounded-lg p-4">
          <div class="flex items-center gap-2">
            <span class="text-<%= @pagina.base_color %>-500">•</span>
            <span class="text-gray-700"><%= item[:text] %></span>
            <div class="flex gap-4 ml-2" data-controller="word-highlighter">
              <span class="cursor-pointer px-2 py-1 border-b-2 border-gray-300 hover:bg-blue-100 transition"
                    data-word-highlighter-target="word"
                    data-correct="<%= item[:correct] == 1 ? 'true' : 'false' %>"
                    data-action="click->word-highlighter#toggleHighlight">
                <strong><%= item[:option1] %></strong>
              </span>
              <span>/</span>
              <span class="cursor-pointer px-2 py-1 border-b-2 border-gray-300 hover:bg-blue-100 transition"
                    data-word-highlighter-target="word"
                    data-correct="<%= item[:correct] == 2 ? 'true' : 'false' %>"
                    data-action="click->word-highlighter#toggleHighlight">
                <strong><%= item[:option2] %></strong>
              </span>
            </div>
          </div>
        </div>
      <% end %>
    </div>
  </div>

  <!-- Exercise 3 -->
  <div class="bg-white p-4 md:p-6 pb-8" data-controller="fill-blanks">
    <h2 class="text-lg md:text-xl font-bold mb-4 flex items-center gap-2">
      <span class="flex-shrink-0 bg-<%= @pagina.base_color %>-500 text-white rounded-full w-8 h-8 md:w-10 md:h-10 inline-flex items-center justify-center">3</span>
      Esegui l'analisi logica della seguente frase. Il soggetto è sottinteso.
    </h2>

    <div class="bg-<%= @pagina.base_color %>-50 rounded-lg p-4 mb-4">
      <p class="text-base md:text-lg font-semibold text-gray-700">
        <span class="text-<%= @pagina.base_color %>-500">•</span> Oggi sono andata a casa di Giovanni con il pullman.
      </p>
    </div>

    <div class="space-y-3 text-base md:text-lg">
      <% [
        { parte: "Oggi", analisi: "complemento di tempo" },
        { parte: "sono andata", analisi: "predicato verbale" },
        { parte: "a casa", analisi: "complemento di luogo" },
        { parte: "di Giovanni", analisi: "complemento di specificazione" },
        { parte: "con il pullman", analisi: "complemento di mezzo" }
      ].each do |item| %>
        <div class="bg-<%= @pagina.base_color %>-50 rounded-lg p-4">
          <div class="flex flex-wrap items-center gap-2">
            <span class="font-semibold text-gray-700 w-32"><%= item[:parte] %> =</span>
            <input type="text"
                   class="flex-1 border-b-2 border-dotted border-<%= @pagina.base_color %>-500 bg-white px-2 focus:outline-none"
                   data-fill-blanks-target="input"
                   data-correct-answer="<%= item[:analisi] %>">
          </div>
        </div>
      <% end %>
    </div>
  </div>

  <!-- Reference -->
  <div class="text-right text-sm text-gray-500 mb-6">
    Esercizi pp. <%= link_to "186", pagina_path("nvl5_gram_p186"), class: "text-gray-600 hover:text-gray-800 underline" %>, <%= link_to "187", pagina_path("nvl5_gram_p187"), class: "text-gray-600 hover:text-gray-800 underline" %>
  </div>

  <%= render 'shared/exercise_controls' %>

</div>
