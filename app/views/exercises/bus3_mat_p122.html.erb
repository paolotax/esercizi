<% content_for :titolo, "#{@pagina.titolo} - #{@pagina.numero}" %>

<div class="max-w-7xl mx-auto p-3 md:p-6 bg-white dark:bg-gray-900 text-black dark:text-white font-mono transition-colors duration-300"
     data-controller="exercise-checker page-viewer text-toggle font-controls"
     data-page-viewer-image-url-value="<%= asset_path('bus3_mat/p122/page.png') %>"
     data-text-toggle-target="content"
     data-font-controls-target="content">

  <!-- Header -->
  <%= render 'shared/page_header', pagina: @pagina %>

  <!-- Esercizio 1 - Hotspot su immagine -->
  <div class="mb-12" data-controller="fill-blanks auto-advance">
    <div class="flex items-start gap-3 mb-4">
      <div class="bg-red-500 text-white rounded-full w-8 h-8 flex items-center justify-center font-bold flex-shrink-0">
        1
      </div>
      <p class="text-gray-700 dark:text-gray-200">
        <strong>Osserva le caratteristiche di bambine e bambini sulla neve. Come puoi classificarli? Scrivi i nomi al posto giusto nel <span class="text-cyan-600 dark:text-cyan-400 font-bold">diagramma di Eulero-Venn</span>.</strong>
      </p>
    </div>

    <!-- Immagine con hotspot -->
    <div class="relative max-w-3xl mx-auto"
         data-controller="hotspot-editor"
         data-hotspot-editor-target="container">

      <%= image_tag "bus3_mat/p122/p122_01.jpg",
          alt: "Bambini sulla neve e diagramma di Eulero-Venn",
          class: "w-full h-full object-cover select-none pointer-events-none" %>

      <div class="absolute inset-0">
        <% inputs = [
          { label: "Mari", top: "75.1427%", left: "75.8281%", width: "7.66142%", height: "5.16377%", answer: "Mari" },
          { label: "Alex", top: "60.2443%", left: "6.63014%", width: "8.3125%", height: "5.90323%", answer: "Alex" },
          { label: "Fabio", top: "67.2778%", left: "50.1198%", width: "7.27084%", height: "5.16378%", answer: "Fabio" },
          { label: "Lea", top: "67.4542%", left: "72.4687%", width: "7.01043%", height: "5.5335%", answer: "Lea" },
          { label: "Clara", top: "67.4629%", left: "28.9792%", width: "8.57292%", height: "5.71837%", answer: "Clara" },
          { label: "Teo", top: "74.2941%", left: "30.4635%", width: "6.35937%", height: "5.34864%", answer: "Teo" },
          { label: "Asia", top: "74.3027%", left: "51.0364%", width: "6.35938%", height: "4.97891%", answer: "Asia" }
        ] %>

        <% inputs.each do |input| %>
          <div class="absolute"
               style="top: <%= input[:top] %>; left: <%= input[:left] %>; width: <%= input[:width] %>; height: <%= input[:height] %>;"
               data-hotspot-editor-target="hotspot"
               data-auto-advance-target="input"
               data-action="mousedown->hotspot-editor#startDrag">
            <input type="text"
                   data-fill-blanks-target="input"
                   data-correct-answer="<%= input[:answer] %>"
                   class="w-full h-full py-1 bg-white/60 hover:bg-white/80 focus:bg-white border-2 text-black border-transparent hover:border-cyan-500 focus:border-cyan-600 rounded text-center font-bold transition-colors"
                   maxlength="<%= input[:answer].to_s.length + 2 %>"
                   inputmode="text"
                   aria-label="<%= input[:label] %>">
          </div>
        <% end %>
      </div>
    </div>
  </div>

  <!-- Esercizio 2 -->
  <div class="mb-12" data-controller="fill-blanks auto-advance">
    <div class="flex items-center gap-3 mb-4">
      <div class="bg-red-500 text-white rounded-full w-8 h-8 flex items-center justify-center font-bold flex-shrink-0">
        2
      </div>
      <p class="text-gray-700 dark:text-gray-200">
        <strong>Adesso classifica bambine e bambini con il <span class="text-cyan-600 dark:text-cyan-400 font-bold">diagramma di Carroll</span>.</strong>
      </p>
    </div>

    <!-- Tabella di Carroll -->
    <div class="overflow-x-auto">
      <table class="w-full border-separate border-spacing-0 border-2 border-cyan-400 dark:border-cyan-500 rounded-lg overflow-hidden">
        <thead>
          <tr>
            <th class="border border-cyan-400 dark:border-cyan-500 px-4 py-1 font-normal">Bambine/i...</th>
            <th class="border border-cyan-400 dark:border-cyan-500 px-4 py-1 font-normal">con sciarpa</th>
            <th class="border border-cyan-400 dark:border-cyan-500 px-4 py-1 font-normal"><strong>NON</strong> con sciarpa</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="border border-cyan-400 dark:border-cyan-500 px-4 py-1">con cappello</td>
            <td class="border border-cyan-400 dark:border-cyan-500 px-4 py-1 text-center">
              <input type="text" data-fill-blanks-target="input" data-correct-answer="Fabio"
                     class="w-16 px-1 py-0.5 border-b-2 border-dotted border-gray-400 dark:border-gray-500 bg-transparent dark:text-white text-center" >
              ,
              <input type="text" data-fill-blanks-target="input" data-correct-answer="Asia"
                     class="w-16 px-1 py-0.5 border-b-2 border-dotted border-gray-400 dark:border-gray-500 bg-transparent dark:text-white text-center" >
            </td>
            <td class="border border-cyan-400 dark:border-cyan-500 px-4 py-1 text-center">
              <input type="text" data-fill-blanks-target="input" data-correct-answer="Clara"
                     class="w-16 px-1 py-0.5 border-b-2 border-dotted border-gray-400 dark:border-gray-500 bg-transparent dark:text-white text-center" >
              ,
              <input type="text" data-fill-blanks-target="input" data-correct-answer="Teo"
                     class="w-16 px-1 py-0.5 border-b-2 border-dotted border-gray-400 dark:border-gray-500 bg-transparent dark:text-white text-center" >
            </td>
          </tr>
          <tr>
            <td class="border border-cyan-400 dark:border-cyan-500 px-4 py-1"><strong>NON</strong> con cappello</td>
            <td class="border border-cyan-400 dark:border-cyan-500 px-4 py-1 text-center">
              <input type="text" data-fill-blanks-target="input" data-correct-answer="Lea"
                     class="w-16 px-1 py-0.5 border-b-2 border-dotted border-gray-400 dark:border-gray-500 bg-transparent dark:text-white text-center" >
              ,
              <input type="text" data-fill-blanks-target="input" data-correct-answer="Mari"
                     class="w-16 px-1 py-0.5 border-b-2 border-dotted border-gray-400 dark:border-gray-500 bg-transparent dark:text-white text-center" >
            </td>
            <td class="border border-cyan-400 dark:border-cyan-500 px-4 py-1 text-center">
              <input type="text" data-fill-blanks-target="input" data-correct-answer="Alex"
                     class="w-16 px-1 py-0.5 border-b-2 border-dotted border-gray-400 dark:border-gray-500 bg-transparent dark:text-white text-center" >
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Footer con controlli -->
  <%= render 'shared/exercise_controls' %>
</div>
