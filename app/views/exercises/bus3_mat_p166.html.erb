<% content_for :titolo, "#{@pagina.titolo} - #{@pagina.numero}" %>

<div class="max-w-7xl mx-auto p-3 md:p-6 bg-white dark:bg-gray-900 text-black dark:text-white font-mono transition-colors duration-300"
     data-controller="exercise-checker page-viewer text-toggle font-controls"
     data-page-viewer-image-url-value="<%= asset_path('bus3_mat/p166/page.png') %>"
     data-text-toggle-target="content"
     data-font-controls-target="content">

  <!-- Header -->
  <%= render 'shared/page_header', pagina: @pagina %>

  <!-- Box definizione -->
  <div class="bg-white dark:bg-gray-800 border-4 border-cyan-300 dark:border-cyan-500 rounded-lg p-4 mb-8 mx-auto max-w-xl">
    <p class="text-gray-700 dark:text-gray-200">
      L'<span class="text-cyan-600 dark:text-cyan-400 font-bold">area</span> è la <strong>misura della superficie</strong> di un poligono.
    </p>
    <div class="flex items-center gap-4 mt-4">
      <div class="relative">
        <span class="absolute -top-4 -left-1 text-gray-600 dark:text-gray-400 font-bold">D</span>
        <span class="absolute -top-4 right-0 text-gray-600 dark:text-gray-400 font-bold">C</span>
        <span class="absolute -bottom-5 -left-1 text-gray-600 dark:text-gray-400 font-bold">A</span>
        <span class="absolute -bottom-5 right-0 text-gray-600 dark:text-gray-400 font-bold">B</span>
        <div class="grid grid-cols-7 gap-0 border border-cyan-400">
          <% 21.times do %>
            <div class="w-4 h-4 bg-cyan-200 dark:bg-cyan-700 border border-cyan-300 dark:border-cyan-500"></div>
          <% end %>
        </div>
      </div>
      <p class="text-cyan-700 dark:text-cyan-400 font-bold">A = 21 <span class="inline-block w-4 h-4 bg-cyan-400 dark:bg-cyan-600 border border-cyan-500 dark:border-cyan-400 align-middle"></span></p>
    </div>
  </div>

  <!-- Esercizio 1 -->
  <div class="mb-12" data-controller="fill-blanks auto-advance">
    <div class="flex items-start gap-3 mb-6">
      <div class="bg-red-500 text-white rounded-full w-8 h-8 flex items-center justify-center font-bold flex-shrink-0">
        1
      </div>
      <p class="text-gray-700 dark:text-gray-200">
        <strong>Utilizza l'unità di misura indicata e calcola l'area di questi poligoni.</strong><br>
        Poi colora con lo stesso colore i poligoni che hanno la stessa area. Infine rispondi.
      </p>
    </div>

    <!-- Hotspot su immagine -->
    <div class="relative mb-6"
         data-controller="hotspot-editor"
         data-hotspot-editor-target="container">

      <%= image_tag "bus3_mat/p166/p166_02.jpg",
          alt: "Poligoni su griglia per calcolo area",
          class: "w-full h-full rounded-xl object-cover select-none pointer-events-none" %>

      <div class="absolute inset-0">
        <% inputs = [
          { label: "Area 1", top: "26.6019%", left: "9.81523%", width: "3.96864%", height: "5.15305%", answer: "24" },
          { label: "Area 2", top: "26.6019%", left: "40.0705%", width: "4.75252%", height: "5.45915%", answer: "16" },
          { label: "Area 3", top: "10.3268%", left: "74.8309%", width: "4.41657%", height: "5.45916%", answer: "24" },
          { label: "Area 4", top: "38.9859%", left: "30.8001%", width: "4.46925%", height: "5.77834%", answer: "22" },
          { label: "Area 5", top: "54.458%", left: "72.898%", width: "4.24145%", height: "5.62267%", answer: "16" },
          { label: "Area 6", top: "48.419%", left: "86.4761%", width: "5.38041%", height: "5.93401%", answer: "20" },
          { label: "Area 7", top: "80.37%", left: "10.0949%", width: "3.89977%", height: "5.15567%", answer: "24" },
          { label: "Area 8", top: "90.2948%", left: "40.1624%", width: "4.19261%", height: "4.6939%", answer: "20" },
          { label: "Area 9", top: "89.7859%", left: "68.29%", width: "4.08063%", height: "5.45915%", answer: "20" },
          { label: "Area 10", top: "89.6328%", left: "89.0269%", width: "4.52856%", height: "5.76526%", answer: "16" }
        ] %>

        <% inputs.each do |input| %>
          <div class="absolute"
               style="top: <%= input[:top] %>; left: <%= input[:left] %>; width: <%= input[:width] %>; height: <%= input[:height] %>;"
               data-hotspot-editor-target="hotspot"
               data-action="mousedown->hotspot-editor#startDrag">
            <input type="text"
                   data-fill-blanks-target="input"
                   data-auto-advance-target="input"
                   data-correct-answer="<%= input[:answer] %>"
                   class="w-full h-full py-1 bg-white/70 hover:bg-white/90 focus:bg-white border-2 text-black border-transparent hover:border-cyan-500 focus:border-cyan-600 rounded text-center font-bold transition-colors"
                   maxlength="2"
                   inputmode="numeric"
                   aria-label="<%= input[:label] %>">
          </div>
        <% end %>
      </div>
    </div>

    <div class="flex items-center gap-3 flex-wrap">
      <p class="text-gray-700 dark:text-gray-200">• Come si chiamano i poligoni con la stessa area?</p>
      <input type="text" data-fill-blanks-target="input" data-correct-answer="equiestesi"
             class="w-40 px-2 py-1 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center bg-white dark:bg-gray-800 dark:text-white">
    </div>
  </div>

  <!-- Footer con controlli -->
  <%= render 'shared/exercise_controls' %>
</div>
