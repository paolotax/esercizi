<% content_for :titolo, "#{@pagina.titolo} - #{@pagina.numero}" %>

<div class="max-w-7xl mx-auto p-3 md:p-6 bg-white dark:bg-gray-900 text-black dark:text-white transition-colors duration-300 font-mono"
     data-controller="exercise-checker fill-blanks auto-advance page-viewer fraction-grids text-toggle font-controls"
     data-page-viewer-image-url-value="<%= asset_path('bus3_mat/p078/page.png') %>"
     data-text-toggle-target="content"
     data-font-controls-target="content">

  <!-- Header -->
  <%= render 'shared/page_header', pagina: @pagina %>

  <!-- Esercizio 1 - Griglie con unità frazionarie -->
  <div class="p-4 md:p-6 mb-8">
    <div class="flex items-start gap-3 mb-6">
      <div class="bg-red-500 text-white rounded-full w-8 h-8 flex items-center justify-center font-bold flex-shrink-0">
        1
      </div>
      <p class="text-gray-700 dark:text-gray-200">
        <strong>Scrivi il valore in ogni unità frazionaria. Segui l'esempio.</strong>
      </p>
    </div>

    <!-- Griglia 1 - Esempio con 1/7 (7 celle) -->
    <div class="mb-8">
      <div class="flex gap-0 w-[560px] mx-auto mb-2">
        <% 7.times do %>
          <div class="flex-1 h-24 border-2 border-blue-500 dark:border-blue-400 flex flex-col items-center justify-center bg-blue-50 dark:bg-blue-900/30">
            <span class="font-bold text-blue-600 dark:text-blue-400">1</span>
            <div class="w-6 h-0.5 bg-blue-600 dark:bg-blue-400 my-1"></div>
            <span class="font-bold text-blue-600 dark:text-blue-400">7</span>
          </div>
        <% end %>
      </div>
    </div>

    <!-- Griglia 2 - 3 celle vuote (risposta: 1/3) -->
    <div class="mb-8">
      <div class="flex gap-0 w-[560px] mx-auto mb-2">
        <% 3.times do |i| %>
          <div class="flex-1 h-24 border-2 border-blue-500 dark:border-blue-400 flex flex-col items-center justify-center bg-white dark:bg-gray-800">
            <input type="text"
                   class="w-10 h-8 text-center font-bold border-2 border-gray-300 dark:border-gray-500 focus:border-blue-500 focus:outline-none bg-white dark:bg-gray-700 dark:text-white"
                   data-fraction-grids-target="input"
                   data-answer="1"
                   data-correct-answer="1"
                   maxlength="1"
                   placeholder="">
            <div class="w-10 h-1 bg-gray-400 dark:bg-gray-500 my-1"></div>
            <input type="text"
                   class="w-10 h-8 text-center font-bold border-2 border-gray-300 dark:border-gray-500 focus:border-blue-500 focus:outline-none bg-white dark:bg-gray-700 dark:text-white"
                   data-fraction-grids-target="input"
                   data-answer="3"
                   data-correct-answer="3"
                   maxlength="1"
                   placeholder="">
          </div>
        <% end %>
      </div>
    </div>

    <!-- Griglia 3 - 6 celle vuote (risposta: 1/6) -->
    <div class="mb-8">
      <div class="flex gap-0 w-[560px] mx-auto mb-2">
        <% 6.times do |i| %>
          <div class="flex-1 h-24 border-2 border-blue-500 dark:border-blue-400 flex flex-col items-center justify-center bg-white dark:bg-gray-800">
            <input type="text"
                   class="w-10 h-8 text-center font-bold border-2 border-gray-300 dark:border-gray-500 focus:border-blue-500 focus:outline-none bg-white dark:bg-gray-700 dark:text-white"
                   data-fraction-grids-target="input"
                   data-answer="1"
                   data-correct-answer="1"
                   maxlength="1"
                   placeholder="">
            <div class="w-10 h-1 bg-gray-400 dark:bg-gray-500 my-1"></div>
            <input type="text"
                   class="w-10 h-8 text-center font-bold border-2 border-gray-300 dark:border-gray-500 focus:border-blue-500 focus:outline-none bg-white dark:bg-gray-700 dark:text-white"
                   data-fraction-grids-target="input"
                   data-answer="6"
                   data-correct-answer="6"
                   maxlength="1"
                   placeholder="">
          </div>
        <% end %>
      </div>
    </div>

    <!-- Griglia 4 - 9 celle vuote (risposta: 1/9) -->
    <div class="mb-6">
      <div class="flex gap-0 w-[560px] mx-auto mb-2">
        <% 9.times do |i| %>
          <div class="flex-1 h-24 border-2 border-blue-500 dark:border-blue-400 flex flex-col items-center justify-center bg-white dark:bg-gray-800">
            <input type="text"
                   class="w-10 h-8 text-center font-bold border-2 border-gray-300 dark:border-gray-500 focus:border-blue-500 focus:outline-none bg-white dark:bg-gray-700 dark:text-white"
                   data-fraction-grids-target="input"
                   data-answer="1"
                   data-correct-answer="1"
                   maxlength="1"
                   placeholder="">
            <div class="w-10 h-1 bg-gray-400 dark:bg-gray-500 my-1"></div>
            <input type="text"
                   class="w-10 h-8 text-center font-bold border-2 border-gray-300 dark:border-gray-500 focus:border-blue-500 focus:outline-none bg-white dark:bg-gray-700 dark:text-white"
                   data-fraction-grids-target="input"
                   data-answer="9"
                   data-correct-answer="9"
                   maxlength="1"
                   placeholder="">
          </div>
        <% end %>
      </div>
    </div>

    <!-- Pulsante verifica -->
    <div class="text-center mt-6">
      <button data-action="click->fraction-grids#checkExercise1"
              class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-8 rounded-lg shadow-lg transition-colors">
        Verifica Esercizio 1
      </button>
      <div data-fraction-grids-target="feedback1" class="mt-4 font-semibold"></div>
    </div>
  </div>

  <!-- Esercizio 2 - Progressione frazioni -->
  <div class="p-4 md:p-6 mb-8">
    <div class="flex items-start gap-3 mb-6">
      <div class="bg-red-500 text-white rounded-full w-8 h-8 flex items-center justify-center font-bold flex-shrink-0">
        2
      </div>
      <p class="text-gray-700 dark:text-gray-200">
        <strong>Colora e conta sempre un'unità frazionaria in più fino all'intero. Segui l'esempio.</strong>
      </p>
    </div>

    <!-- Sequenza 1: terzi (0, 1/3, 2/3, 3/3) -->
    <div class="mb-12">
      <div class="flex items-center gap-4 justify-center flex-wrap">
        <!-- Griglia 0 -->
        <div class="text-center">
          <div class="flex gap-0 mb-2">
            <% 3.times do %>
              <div class="w-20 h-20 border-2 border-blue-500 dark:border-blue-400 bg-white dark:bg-gray-800"></div>
            <% end %>
          </div>
          <div class="font-bold text-gray-700 dark:text-gray-300">0</div>
        </div>

        <!-- Freccia -->
        <div class="text-4xl text-cyan-400">→</div>

        <!-- Griglia 1/3 -->
        <div class="text-center">
          <div class="flex gap-0 mb-2">
            <div class="w-20 h-20 border-2 border-blue-500 dark:border-blue-400 bg-blue-300 dark:bg-blue-600"
                 data-fraction-grids-target="cell"
                 data-clickable="true"
                 data-action="click->fraction-grids#toggleCell"></div>
            <% 2.times do %>
              <div class="w-20 h-20 border-2 border-blue-500 dark:border-blue-400 bg-white dark:bg-gray-800"
                   data-fraction-grids-target="cell"
                   data-clickable="true"
                   data-action="click->fraction-grids#toggleCell"></div>
            <% end %>
          </div>
          <div class="flex flex-col items-center justify-center">
            <span class="font-bold text-blue-600 dark:text-blue-400">1</span>
            <div class="w-10 h-0.5 bg-blue-600 dark:bg-blue-400 my-1"></div>
            <span class="font-bold text-blue-600 dark:text-blue-400">3</span>
          </div>
        </div>

        <!-- Freccia -->
        <div class="text-4xl text-cyan-400">→</div>

        <!-- Griglia 2/3 -->
        <div class="text-center">
          <div class="flex gap-0 mb-2">
            <% 2.times do %>
              <div class="w-20 h-20 border-2 border-blue-500 dark:border-blue-400 bg-white dark:bg-gray-800"
                   data-fraction-grids-target="cell"
                   data-clickable="true"
                   data-action="click->fraction-grids#toggleCell"></div>
            <% end %>
            <div class="w-20 h-20 border-2 border-blue-500 dark:border-blue-400 bg-white dark:bg-gray-800"
                 data-fraction-grids-target="cell"
                 data-clickable="true"
                 data-action="click->fraction-grids#toggleCell"></div>
          </div>
          <div class="flex flex-col items-center justify-center">
            <input type="text"
                   class="w-12 h-10 text-center font-bold border-2 border-gray-300 dark:border-gray-500 focus:border-blue-500 focus:outline-none bg-white dark:bg-gray-700 dark:text-white"
                   data-fraction-grids-target="input"
                   data-answer="2"
                   data-correct-answer="2"
                   maxlength="1">
            <div class="w-10 h-0.5 bg-gray-600 dark:bg-gray-400 my-1"></div>
            <input type="text"
                   class="w-12 h-10 text-center font-bold border-2 border-gray-300 dark:border-gray-500 focus:border-blue-500 focus:outline-none bg-white dark:bg-gray-700 dark:text-white"
                   data-fraction-grids-target="input"
                   data-answer="3"
                   data-correct-answer="3"
                   maxlength="1">
          </div>
        </div>

        <!-- Freccia -->
        <div class="text-4xl text-cyan-400">→</div>

        <!-- Griglia 3/3 -->
        <div class="text-center">
          <div class="flex gap-0 mb-2">
            <% 3.times do %>
              <div class="w-20 h-20 border-2 border-blue-500 dark:border-blue-400 bg-white dark:bg-gray-800"
                   data-fraction-grids-target="cell"
                   data-clickable="true"
                   data-action="click->fraction-grids#toggleCell"></div>
            <% end %>
          </div>
          <div class="flex flex-col items-center justify-center">
            <input type="text"
                   class="w-12 h-10 text-center font-bold border-2 border-gray-300 dark:border-gray-500 focus:border-blue-500 focus:outline-none bg-white dark:bg-gray-700 dark:text-white"
                   data-fraction-grids-target="input"
                   data-answer="3"
                   data-correct-answer="3"
                   maxlength="1">
            <div class="w-10 h-0.5 bg-gray-600 dark:bg-gray-400 my-1"></div>
            <input type="text"
                   class="w-12 h-10 text-center font-bold border-2 border-gray-300 dark:border-gray-500 focus:border-blue-500 focus:outline-none bg-white dark:bg-gray-700 dark:text-white"
                   data-fraction-grids-target="input"
                   data-answer="3"
                   data-correct-answer="3"
                   maxlength="1">
          </div>
        </div>
      </div>
    </div>

    <!-- Sequenza 2: quarti (0, 1/4, 2/4, 3/4, 4/4) -->
    <div class="mb-6">
      <div class="flex items-center gap-4 justify-center flex-wrap">
        <!-- Griglia 0 -->
        <div class="text-center">
          <div class="flex gap-0 mb-2">
            <% 4.times do %>
              <div class="w-20 h-20 border-2 border-blue-500 dark:border-blue-400 bg-white dark:bg-gray-800"></div>
            <% end %>
          </div>
          <div class="font-bold text-gray-700 dark:text-gray-300">0</div>
        </div>

        <!-- Freccia -->
        <div class="text-4xl text-cyan-400">→</div>

        <!-- Griglia 1/4 -->
        <div class="text-center">
          <div class="flex gap-0 mb-2">
            <div class="w-20 h-20 border-2 border-blue-500 dark:border-blue-400 bg-blue-300 dark:bg-blue-600"
                 data-fraction-grids-target="cell"
                 data-clickable="true"
                 data-action="click->fraction-grids#toggleCell"></div>
            <% 3.times do %>
              <div class="w-20 h-20 border-2 border-blue-500 dark:border-blue-400 bg-white dark:bg-gray-800"
                   data-fraction-grids-target="cell"
                   data-clickable="true"
                   data-action="click->fraction-grids#toggleCell"></div>
            <% end %>
          </div>
          <div class="flex flex-col items-center justify-center">
            <span class="font-bold text-blue-600 dark:text-blue-400">1</span>
            <div class="w-10 h-0.5 bg-blue-600 dark:bg-blue-400 my-1"></div>
            <span class="font-bold text-blue-600 dark:text-blue-400">4</span>
          </div>
        </div>

        <!-- Freccia -->
        <div class="text-4xl text-cyan-400">→</div>

        <!-- Griglia 2/4 -->
        <div class="text-center">
          <div class="flex gap-0 mb-2">
            <% 4.times do %>
              <div class="w-20 h-20 border-2 border-blue-500 dark:border-blue-400 bg-white dark:bg-gray-800"
                   data-fraction-grids-target="cell"
                   data-clickable="true"
                   data-action="click->fraction-grids#toggleCell"></div>
            <% end %>
          </div>
          <div class="flex flex-col items-center justify-center">
            <input type="text"
                   class="w-12 h-10 text-center font-bold border-2 border-gray-300 dark:border-gray-500 focus:border-blue-500 focus:outline-none bg-white dark:bg-gray-700 dark:text-white"
                   data-fraction-grids-target="input"
                   data-answer="2"
                   data-correct-answer="2"
                   maxlength="1">
            <div class="w-10 h-0.5 bg-gray-600 dark:bg-gray-400 my-1"></div>
            <input type="text"
                   class="w-12 h-10 text-center font-bold border-2 border-gray-300 dark:border-gray-500 focus:border-blue-500 focus:outline-none bg-white dark:bg-gray-700 dark:text-white"
                   data-fraction-grids-target="input"
                   data-answer="4"
                   data-correct-answer="4"
                   maxlength="1">
          </div>
        </div>

        <!-- Freccia -->
        <div class="text-4xl text-cyan-400">→</div>

        <!-- Griglia 3/4 -->
        <div class="text-center">
          <div class="flex gap-0 mb-2">
            <% 4.times do %>
              <div class="w-20 h-20 border-2 border-blue-500 dark:border-blue-400 bg-white dark:bg-gray-800"
                   data-fraction-grids-target="cell"
                   data-clickable="true"
                   data-action="click->fraction-grids#toggleCell"></div>
            <% end %>
          </div>
          <div class="flex flex-col items-center justify-center">
            <input type="text"
                   class="w-12 h-10 text-center font-bold border-2 border-gray-300 dark:border-gray-500 focus:border-blue-500 focus:outline-none bg-white dark:bg-gray-700 dark:text-white"
                   data-fraction-grids-target="input"
                   data-answer="3"
                   data-correct-answer="3"
                   maxlength="1">
            <div class="w-10 h-0.5 bg-gray-600 dark:bg-gray-400 my-1"></div>
            <input type="text"
                   class="w-12 h-10 text-center font-bold border-2 border-gray-300 dark:border-gray-500 focus:border-blue-500 focus:outline-none bg-white dark:bg-gray-700 dark:text-white"
                   data-fraction-grids-target="input"
                   data-answer="4"
                   data-correct-answer="4"
                   maxlength="1">
          </div>
        </div>

        <!-- Freccia -->
        <div class="text-4xl text-cyan-400">→</div>

        <!-- Griglia 4/4 -->
        <div class="text-center">
          <div class="flex gap-0 mb-2">
            <% 4.times do %>
              <div class="w-20 h-20 border-2 border-blue-500 dark:border-blue-400 bg-white dark:bg-gray-800"
                   data-fraction-grids-target="cell"
                   data-clickable="true"
                   data-action="click->fraction-grids#toggleCell"></div>
            <% end %>
          </div>
          <div class="flex flex-col items-center justify-center">
            <input type="text"
                   class="w-12 h-10 text-center font-bold border-2 border-gray-300 dark:border-gray-500 focus:border-blue-500 focus:outline-none bg-white dark:bg-gray-700 dark:text-white"
                   data-fraction-grids-target="input"
                   data-answer="4"
                   data-correct-answer="4"
                   maxlength="1">
            <div class="w-10 h-0.5 bg-gray-600 dark:bg-gray-400 my-1"></div>
            <input type="text"
                   class="w-12 h-10 text-center font-bold border-2 border-gray-300 dark:border-gray-500 focus:border-blue-500 focus:outline-none bg-white dark:bg-gray-700 dark:text-white"
                   data-fraction-grids-target="input"
                   data-answer="4"
                   data-correct-answer="4"
                   maxlength="1">
          </div>
        </div>
      </div>
    </div>

    <!-- Pulsante verifica -->
    <div class="text-center mt-6">
      <button data-action="click->fraction-grids#checkExercise2"
              class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-8 rounded-lg shadow-lg transition-colors">
        Verifica Esercizio 2
      </button>
      <div data-fraction-grids-target="feedback2" class="mt-4 font-semibold"></div>
    </div>
  </div>

  <!-- Esercizio 3 - BERE... CON LE FRAZIONI! -->
  <div class="bg-[#C7EAFB] dark:bg-cyan-900/40 p-4 md:p-6 -ml-3 md:-ml-0 -mr-3 md:mr-0 mb-8">
    <div class="flex items-start gap-3 mb-6">
      <div class="bg-red-500 text-white rounded-full w-8 h-8 flex items-center justify-center font-bold flex-shrink-0">
        3
      </div>
      <div class="flex-1">
        <p class="text-gray-700 dark:text-gray-200">
          <strong>Osserva il succo che diminuisce: scrivi la frazione corrispondente al succo rimasto.</strong>
        </p>
      </div>
    </div>

    <!-- Immagine con bicchieri -->
    <div class="mb-6 flex justify-center">
      <div class="dark:bg-white rounded-xl p-1">
        <%= image_tag "bus3_mat_p078_img03.jpg",
            alt: "Bicchieri con succo che diminuisce",
            class: "w-full h-auto max-w-3xl rounded-lg" %>
      </div>
    </div>

    <!-- Input per le frazioni -->
    <div class="grid grid-cols-2 md:grid-cols-4 gap-6 max-w-4xl mx-auto">
      <!-- Bicchiere 1 - pieno (es. 4/4 o 1) -->
      <div class="bg-white dark:bg-gray-800 rounded-lg p-4 shadow-md">
        <p class="text-center text-gray-600 dark:text-gray-400 mb-2">Bicchiere 1</p>
        <div class="flex flex-col items-center justify-center">
          <input type="text"
                 class="w-16 h-12 text-center font-bold border-2 border-gray-300 dark:border-gray-500 rounded focus:border-blue-500 focus:outline-none bg-white dark:bg-gray-700 dark:text-white"
                 data-fraction-grids-target="input"
                 data-answer="4"
                 data-correct-answer="4"
                 maxlength="1"
                 placeholder="">
          <div class="w-12 h-2 bg-gray-600 dark:bg-gray-400 my-1"></div>
          <input type="text"
                 class="w-16 h-12 text-center font-bold border-2 border-gray-300 dark:border-gray-500 rounded focus:border-blue-500 focus:outline-none bg-white dark:bg-gray-700 dark:text-white"
                 data-fraction-grids-target="input"
                 data-answer="4"
                 data-correct-answer="4"
                 maxlength="1"
                 placeholder="">
        </div>
      </div>

      <!-- Bicchiere 2 - 3/4 -->
      <div class="bg-white dark:bg-gray-800 rounded-lg p-4 shadow-md">
        <p class="text-center text-gray-600 dark:text-gray-400 mb-2">Bicchiere 2</p>
        <div class="flex flex-col items-center justify-center">
          <input type="text"
                 class="w-16 h-12 text-center font-bold border-2 border-gray-300 dark:border-gray-500 rounded focus:border-blue-500 focus:outline-none bg-white dark:bg-gray-700 dark:text-white"
                 data-fraction-grids-target="input"
                 data-answer="3"
                 data-correct-answer="3"
                 maxlength="1"
                 placeholder="">
          <div class="w-12 h-2 bg-gray-600 dark:bg-gray-400 my-1"></div>
          <input type="text"
                 class="w-16 h-12 text-center font-bold border-2 border-gray-300 dark:border-gray-500 rounded focus:border-blue-500 focus:outline-none bg-white dark:bg-gray-700 dark:text-white"
                 data-fraction-grids-target="input"
                 data-answer="4"
                 data-correct-answer="4"
                 maxlength="1"
                 placeholder="">
        </div>
      </div>

      <!-- Bicchiere 3 - 2/4 -->
      <div class="bg-white dark:bg-gray-800 rounded-lg p-4 shadow-md">
        <p class="text-center text-gray-600 dark:text-gray-400 mb-2">Bicchiere 3</p>
        <div class="flex flex-col items-center justify-center">
          <input type="text"
                 class="w-16 h-12 text-center font-bold border-2 border-gray-300 dark:border-gray-500 rounded focus:border-blue-500 focus:outline-none bg-white dark:bg-gray-700 dark:text-white"
                 data-fraction-grids-target="input"
                 data-answer="2"
                 data-correct-answer="2"
                 maxlength="1"
                 placeholder="">
          <div class="w-12 h-2 bg-gray-600 dark:bg-gray-400 my-1"></div>
          <input type="text"
                 class="w-16 h-12 text-center font-bold border-2 border-gray-300 dark:border-gray-500 rounded focus:border-blue-500 focus:outline-none bg-white dark:bg-gray-700 dark:text-white"
                 data-fraction-grids-target="input"
                 data-answer="4"
                 data-correct-answer="4"
                 maxlength="1"
                 placeholder="">
        </div>
      </div>

      <!-- Bicchiere 4 - vuoto (0) -->
      <div class="bg-white dark:bg-gray-800 rounded-lg p-4 shadow-md">
        <p class="text-center text-gray-600 dark:text-gray-400 mb-2">Bicchiere 4</p>
        <div class="text-center">
          <span class="text-4xl font-bold text-gray-700 dark:text-gray-300">0</span>
        </div>
      </div>
    </div>

    <!-- Pulsante verifica -->
    <div class="text-center mt-8">
      <button data-action="click->fraction-grids#checkExercise3"
              class="bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-8 rounded-lg shadow-lg transition-colors">
        Verifica Esercizio 3
      </button>
      <div data-fraction-grids-target="feedback3" class="mt-4 font-semibold"></div>
    </div>
  </div>

  <!-- Quaderno link allineato a destra -->
  <div class="p-4 mb-8 text-right">
    <span class="text-gray-600 dark:text-gray-400">Quaderno →</span> <%= link_to "p. 159", pagina_path("bus3_mat_p159"), class: "text-cyan-600 dark:text-cyan-400 font-bold hover:underline" %> - <%= link_to "160", pagina_path("bus3_mat_p160"), class: "text-cyan-600 dark:text-cyan-400 font-bold hover:underline" %>
  </div>

  <!-- Footer con controlli -->
  <%= render 'shared/exercise_controls' %>
</div>
