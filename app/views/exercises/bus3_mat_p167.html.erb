<% content_for :titolo, "#{@pagina.titolo} - #{@pagina.numero}" %>

<div class="max-w-7xl mx-auto p-3 md:p-6 bg-white font-mono"
     data-controller="exercise-checker page-viewer text-toggle font-controls"
     data-page-viewer-image-url-value="<%= asset_path('bus3_mat/p167/page.png') %>"
     data-text-toggle-target="content"
     data-font-controls-target="content">

  <!-- Header -->
  <%= render 'shared/page_header', pagina: @pagina %>

  <!-- Tabella misure di lunghezza -->
  <div class="overflow-x-auto mb-8">
    <table class="w-full border-separate border-spacing-0 border-2 border-cyan-400 rounded-lg overflow-hidden">
      <thead>
        <tr>
          <th colspan="3" class="border border-cyan-400 bg-pink-100 text-pink-500 px-2 py-1">MULTIPLI</th>
          <th class="border border-cyan-400 bg-cyan-200 text-cyan-600 px-2 py-1">UNITÀ FONDAMENTALE</th>
          <th colspan="3" class="border border-cyan-400 bg-green-100 text-green-500 px-2 py-1">SOTTOMULTIPLI</th>
        </tr>
        <tr>
          <th class="border border-cyan-400 px-2 py-1 text-pink-500">CHILOMETRO<br><span class="font-bold">km</span></th>
          <th class="border border-cyan-400 px-2 py-1 text-pink-500">ETTOMETRO<br><span class="font-bold">hm</span></th>
          <th class="border border-cyan-400 px-2 py-1 text-pink-500">DECAMETRO<br><span class="font-bold">dam</span></th>
          <th class="border border-cyan-400 bg-white px-2 py-1 text-cyan-600">METRO<br><span class="font-bold">m</span></th>
          <th class="border border-cyan-400 px-2 py-1 text-green-500">DECIMETRO<br><span class="font-bold">dm</span></th>
          <th class="border border-cyan-400 px-2 py-1 text-green-500">CENTIMETRO<br><span class="font-bold">cm</span></th>
          <th class="border border-cyan-400 px-2 py-1 text-green-500">MILLIMETRO<br><span class="font-bold">mm</span></th>
        </tr>
      </thead>
      <tbody>
        <tr class="text-center">
          <td class="border border-cyan-400 px-2 py-1">1000 m</td>
          <td class="border border-cyan-400 px-2 py-1">100 m</td>
          <td class="border border-cyan-400 px-2 py-1">10 m</td>
          <td class="border border-cyan-400 bg-white px-2 py-1">1 m</td>
          <td class="border border-cyan-400 px-2 py-1">0,1 m</td>
          <td class="border border-cyan-400 px-2 py-1">0,01 m</td>
          <td class="border border-cyan-400 px-2 py-1">0,001 m</td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Esercizio 1 - IMPARARE TUTTI -->
  <div class="mb-12" data-controller="fill-blanks auto-advance">
    <div class="flex items-center gap-2 mb-6">
      <div class="bg-cyan-700 text-white rounded-full w-8 h-8 flex items-center justify-center font-bold flex-shrink-0">1</div>
      <span class="bg-yellow-300 text-cyan-700 font-bold px-2 py-1">IMPARARE TUTTI</span>
      <span class="text-gray-700">Completa le tabelle. Segui l'esempio.</span>
    </div>

    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
      <!-- Tabella 1: mm → cm (: 10) -->
      <div>
        <p class="text-center font-bold mb-2 text-cyan-600">: 10 --></p>
        <table class="w-full border-separate border-spacing-0 border-2 border-cyan-400 rounded-lg overflow-hidden">
          <thead>
            <tr class="font-bold">
              <th class="border border-cyan-400 px-4 py-1 bg-cyan-100 text-gray-800">mm</th>
              <th class="border border-cyan-400 px-4 py-1 bg-cyan-100 text-gray-800">cm</th>
            </tr>
          </thead>
          <tbody>
            <tr class="text-center text-cyan-500">
              <td class="border border-cyan-400 px-4 py-1">200</td>
              <td class="border border-cyan-400 px-4 py-1">20</td>
            </tr>
            <tr class="text-center">
              <td class="border border-cyan-400 px-4 py-1">450</td>
              <td class="border border-cyan-400 px-4 py-1">
                <input type="text" inputmode="numeric" maxlength="2" data-fill-blanks-target="input" data-correct-answer="45"
                       class="w-12 border-b-2 border-dotted border-gray-400 text-center bg-transparent">
              </td>
            </tr>
            <tr class="text-center">
              <td class="border border-cyan-400 px-4 py-1">800</td>
              <td class="border border-cyan-400 px-4 py-1">
                <input type="text" inputmode="numeric" maxlength="2" data-fill-blanks-target="input" data-correct-answer="80"
                       class="w-12 border-b-2 border-dotted border-gray-400 text-center bg-transparent">
              </td>
            </tr>
            <tr class="text-center">
              <td class="border border-cyan-400 px-4 py-1">70</td>
              <td class="border border-cyan-400 px-4 py-1">
                <input type="text" inputmode="numeric" maxlength="2" data-fill-blanks-target="input" data-correct-answer="7"
                       class="w-12 border-b-2 border-dotted border-gray-400 text-center bg-transparent">
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Tabella 2: m → hm (: 100) -->
      <div>
        <p class="text-center font-bold mb-2 text-cyan-600">: 100 --></p>
        <table class="w-full border-separate border-spacing-0 border-2 border-cyan-400 rounded-lg overflow-hidden">
          <thead>
            <tr class="font-bold">
              <th class="border border-cyan-400 px-4 py-1 bg-cyan-100 text-gray-800">m</th>
              <th class="border border-cyan-400 px-4 py-1 bg-cyan-100 text-gray-800">hm</th>
            </tr>
          </thead>
          <tbody>
            <tr class="text-center">
              <td class="border border-cyan-400 px-4 py-1">600</td>
              <td class="border border-cyan-400 px-4 py-1">
                <input type="text" inputmode="numeric" maxlength="2" data-fill-blanks-target="input" data-correct-answer="6"
                       class="w-12 border-b-2 border-dotted border-gray-400 text-center bg-transparent">
              </td>
            </tr>
            <tr class="text-center">
              <td class="border border-cyan-400 px-4 py-1">5400</td>
              <td class="border border-cyan-400 px-4 py-1">
                <input type="text" inputmode="numeric" maxlength="2" data-fill-blanks-target="input" data-correct-answer="54"
                       class="w-12 border-b-2 border-dotted border-gray-400 text-center bg-transparent">
              </td>
            </tr>
            <tr class="text-center">
              <td class="border border-cyan-400 px-4 py-1">900</td>
              <td class="border border-cyan-400 px-4 py-1">
                <input type="text" inputmode="numeric" maxlength="2" data-fill-blanks-target="input" data-correct-answer="9"
                       class="w-12 border-b-2 border-dotted border-gray-400 text-center bg-transparent">
              </td>
            </tr>
            <tr class="text-center">
              <td class="border border-cyan-400 px-4 py-1">1500</td>
              <td class="border border-cyan-400 px-4 py-1">
                <input type="text" inputmode="numeric" maxlength="2" data-fill-blanks-target="input" data-correct-answer="15"
                       class="w-12 border-b-2 border-dotted border-gray-400 text-center bg-transparent">
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Tabella 3: dam → dm (× 100) -->
      <div>
        <p class="text-center font-bold mb-2 text-cyan-600">× 100 --></p>
        <table class="w-full border-separate border-spacing-0 border-2 border-cyan-400 rounded-lg overflow-hidden">
          <thead>
            <tr class="font-bold">
              <th class="border border-cyan-400 px-4 py-1 bg-cyan-100 text-gray-800">dam</th>
              <th class="border border-cyan-400 px-4 py-1 bg-cyan-100 text-gray-800">dm</th>
            </tr>
          </thead>
          <tbody>
            <tr class="text-center">
              <td class="border border-cyan-400 px-4 py-1">2</td>
              <td class="border border-cyan-400 px-4 py-1">
                <input type="text" inputmode="numeric" maxlength="4" data-fill-blanks-target="input" data-correct-answer="200"
                       class="w-14 border-b-2 border-dotted border-gray-400 text-center bg-transparent">
              </td>
            </tr>
            <tr class="text-center">
              <td class="border border-cyan-400 px-4 py-1">65</td>
              <td class="border border-cyan-400 px-4 py-1">
                <input type="text" inputmode="numeric" maxlength="4" data-fill-blanks-target="input" data-correct-answer="6500"
                       class="w-14 border-b-2 border-dotted border-gray-400 text-center bg-transparent">
              </td>
            </tr>
            <tr class="text-center">
              <td class="border border-cyan-400 px-4 py-1">10</td>
              <td class="border border-cyan-400 px-4 py-1">
                <input type="text" inputmode="numeric" maxlength="4" data-fill-blanks-target="input" data-correct-answer="1000"
                       class="w-14 border-b-2 border-dotted border-gray-400 text-center bg-transparent">
              </td>
            </tr>
            <tr class="text-center">
              <td class="border border-cyan-400 px-4 py-1">34</td>
              <td class="border border-cyan-400 px-4 py-1">
                <input type="text" inputmode="numeric" maxlength="4" data-fill-blanks-target="input" data-correct-answer="3400"
                       class="w-14 border-b-2 border-dotted border-gray-400 text-center bg-transparent">
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Tabella 4: m → km (: 1000) -->
      <div>
        <p class="text-center font-bold mb-2 text-cyan-600">: 1000 --></p>
        <table class="w-full border-separate border-spacing-0 border-2 border-cyan-400 rounded-lg overflow-hidden">
          <thead>
            <tr class="font-bold">
              <th class="border border-cyan-400 px-4 py-1 bg-cyan-100 text-gray-800">m</th>
              <th class="border border-cyan-400 px-4 py-1 bg-cyan-100 text-gray-800">km</th>
            </tr>
          </thead>
          <tbody>
            <tr class="text-center">
              <td class="border border-cyan-400 px-4 py-1">4000</td>
              <td class="border border-cyan-400 px-4 py-1">
                <input type="text" inputmode="numeric" maxlength="2" data-fill-blanks-target="input" data-correct-answer="4"
                       class="w-12 border-b-2 border-dotted border-gray-400 text-center bg-transparent">
              </td>
            </tr>
            <tr class="text-center">
              <td class="border border-cyan-400 px-4 py-1">6000</td>
              <td class="border border-cyan-400 px-4 py-1">
                <input type="text" inputmode="numeric" maxlength="2" data-fill-blanks-target="input" data-correct-answer="6"
                       class="w-12 border-b-2 border-dotted border-gray-400 text-center bg-transparent">
              </td>
            </tr>
            <tr class="text-center">
              <td class="border border-cyan-400 px-4 py-1">9000</td>
              <td class="border border-cyan-400 px-4 py-1">
                <input type="text" inputmode="numeric" maxlength="2" data-fill-blanks-target="input" data-correct-answer="9"
                       class="w-12 border-b-2 border-dotted border-gray-400 text-center bg-transparent">
              </td>
            </tr>
            <tr class="text-center">
              <td class="border border-cyan-400 px-4 py-1">1000</td>
              <td class="border border-cyan-400 px-4 py-1">
                <input type="text" inputmode="numeric" maxlength="2" data-fill-blanks-target="input" data-correct-answer="1"
                       class="w-12 border-b-2 border-dotted border-gray-400 text-center bg-transparent">
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Esercizio 2 -->
  <div class="mb-12" data-controller="word-highlighter" data-word-highlighter-multi-color-value="false">
    <div class="flex items-center gap-3 mb-6">
      <div class="bg-red-500 text-white rounded-full w-8 h-8 flex items-center justify-center font-bold flex-shrink-0">2</div>
      <p class="text-gray-700"><strong>Colora l'unità di misura appropriata.</strong></p>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
      <!-- Formica -->
      <div class="text-center">
        <%= image_tag "bus3_mat/p167/output-1743504902167_233_828_98_82.png", alt: "Formica", class: "w-20 h-20 mx-auto mb-4" %>
        <p class="">
          <span data-word-highlighter-target="word" data-correct="" data-action="click->word-highlighter#toggleHighlight" class="cursor-pointer px-1">5 m</span>
          <span class="text-gray-400">•</span>
          <span data-word-highlighter-target="word" data-correct="" data-action="click->word-highlighter#toggleHighlight" class="cursor-pointer px-1">5 dm</span>
          <span class="text-gray-400">•</span>
          <span data-word-highlighter-target="word" data-correct="blue" data-action="click->word-highlighter#toggleHighlight" class="cursor-pointer px-1">5 mm</span>
        </p>
      </div>

      <!-- Bottiglia -->
      <div class="text-center">
        <%= image_tag "bus3_mat/p167/output-1743504902167_529_813_82_108.png", alt: "Bottiglia", class: "w-16 h-24 mx-auto mb-4" %>
        <p class="">
          <span data-word-highlighter-target="word" data-correct="" data-action="click->word-highlighter#toggleHighlight" class="cursor-pointer px-1">20 m</span>
          <span class="text-gray-400">•</span>
          <span data-word-highlighter-target="word" data-correct="" data-action="click->word-highlighter#toggleHighlight" class="cursor-pointer px-1">20 dm</span>
          <span class="text-gray-400">•</span>
          <span data-word-highlighter-target="word" data-correct="blue" data-action="click->word-highlighter#toggleHighlight" class="cursor-pointer px-1">20 cm</span>
        </p>
      </div>

      <!-- Albero -->
      <div class="text-center">
        <%= image_tag "bus3_mat/p167/output-1743504902167_759_789_140_125.png", alt: "Albero", class: "w-28 h-24 mx-auto mb-4" %>
        <p class="">
          <span data-word-highlighter-target="word" data-correct="blue" data-action="click->word-highlighter#toggleHighlight" class="cursor-pointer px-1">4,5 m</span>
          <span class="text-gray-400">•</span>
          <span data-word-highlighter-target="word" data-correct="" data-action="click->word-highlighter#toggleHighlight" class="cursor-pointer px-1">4,5 dm</span>
          <span class="text-gray-400">•</span>
          <span data-word-highlighter-target="word" data-correct="" data-action="click->word-highlighter#toggleHighlight" class="cursor-pointer px-1">4,5 cm</span>
        </p>
      </div>
    </div>
  </div>

  <!-- Esercizi 3 e 4 appaiati -->
  <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-12" data-controller="fill-blanks">
    <!-- Esercizio 3 -->
    <div>
      <div class="flex items-center gap-3 mb-4">
        <div class="bg-red-500 text-white rounded-full w-8 h-8 flex items-center justify-center font-bold flex-shrink-0">3</div>
        <p class="text-gray-700"><strong>Misura con il righello e completa.</strong></p>
      </div>
      <div class="space-y-3 md:ml-11">
        <div class="flex">
          <strong class="text-cyan-600 flex-shrink-0">•</strong>
          <span class="ml-2">Il mio indice è lungo
            <input type="text" inputmode="numeric" data-fill-blanks-target="input" data-correct-answer="6|7|8"
                   class="w-12 border-b-2 border-dotted border-gray-400 text-center bg-transparent"> cm.</span>
        </div>
        <div class="flex">
          <strong class="text-cyan-600 flex-shrink-0">•</strong>
          <span class="ml-2">Il mio banco è largo
            <input type="text" inputmode="numeric" data-fill-blanks-target="input" data-correct-answer="5|6|7"
                   class="w-12 border-b-2 border-dotted border-gray-400 text-center bg-transparent"> dm.</span>
        </div>
        <div class="flex">
          <strong class="text-cyan-600 flex-shrink-0">•</strong>
          <span class="ml-2">Due decimetri sono
            <input type="text" inputmode="numeric" data-fill-blanks-target="input" data-correct-answer="200"
                   class="w-14 border-b-2 border-dotted border-gray-400 text-center bg-transparent"> mm.</span>
        </div>
        <div class="flex">
          <strong class="text-cyan-600 flex-shrink-0">•</strong>
          <span class="ml-2">Tre decimetri sono
            <input type="text" inputmode="numeric" data-fill-blanks-target="input" data-correct-answer="300"
                   class="w-14 border-b-2 border-dotted border-gray-400 text-center bg-transparent"> mm.</span>
        </div>
      </div>
    </div>

    <!-- Esercizio 4 -->
    <div>
      <div class="flex items-center gap-3 mb-4">
        <div class="bg-red-500 text-white rounded-full w-8 h-8 flex items-center justify-center font-bold flex-shrink-0">4</div>
        <p class="text-gray-700"><strong>Esegui le equivalenze.</strong></p>
      </div>
      <div class="space-y-3 md:ml-11">
        <div class="grid grid-cols-2 gap-x-4 gap-y-3">
          <div class="flex"><span class="w-16">2 m</span><span class="px-2">=</span><input type="text" inputmode="numeric" data-fill-blanks-target="input" data-correct-answer="20" class="w-14 border-b-2 border-dotted border-gray-400 text-center bg-transparent"> dm</div>
          <div class="flex"><span class="w-16">50 m</span><span class="px-2">=</span><input type="text" inputmode="numeric" data-fill-blanks-target="input" data-correct-answer="500" class="w-14 border-b-2 border-dotted border-gray-400 text-center bg-transparent"> dm</div>
          <div class="flex"><span class="w-16">8 m</span><span class="px-2">=</span><input type="text" inputmode="numeric" data-fill-blanks-target="input" data-correct-answer="800" class="w-14 border-b-2 border-dotted border-gray-400 text-center bg-transparent"> cm</div>
          <div class="flex"><span class="w-16">600 dm</span><span class="px-2">=</span><input type="text" inputmode="numeric" data-fill-blanks-target="input" data-correct-answer="6" class="w-14 border-b-2 border-dotted border-gray-400 text-center bg-transparent"> dam</div>
          <div class="flex"><span class="w-16">11 dm</span><span class="px-2">=</span><input type="text" inputmode="numeric" data-fill-blanks-target="input" data-correct-answer="110" class="w-14 border-b-2 border-dotted border-gray-400 text-center bg-transparent"> cm</div>
          <div class="flex"><span class="w-16">300 cm</span><span class="px-2">=</span><input type="text" inputmode="numeric" data-fill-blanks-target="input" data-correct-answer="3" class="w-14 border-b-2 border-dotted border-gray-400 text-center bg-transparent"> m</div>
          <div class="flex"><span class="w-16">90 mm</span><span class="px-2">=</span><input type="text" inputmode="numeric" data-fill-blanks-target="input" data-correct-answer="9" class="w-14 border-b-2 border-dotted border-gray-400 text-center bg-transparent"> cm</div>
          <div class="flex"><span class="w-16">18 cm</span><span class="px-2">=</span><input type="text" inputmode="numeric" data-fill-blanks-target="input" data-correct-answer="180" class="w-14 border-b-2 border-dotted border-gray-400 text-center bg-transparent"> mm</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer con controlli -->
  <%= render 'shared/exercise_controls' %>
</div>
