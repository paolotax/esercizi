<% content_for :titolo, "#{@pagina.titolo} - #{@pagina.numero}" %>

<div class="max-w-7xl mx-auto p-3 md:p-6 bg-white dark:bg-gray-900 text-black dark:text-white font-mono transition-colors duration-300"
     data-controller="exercise-checker page-viewer text-toggle font-controls"
     data-page-viewer-image-url-value="<%= asset_path('bus3_mat/p165/page.png') %>"
     data-text-toggle-target="content"
     data-font-controls-target="content">

  <!-- Header -->
  <%= render 'shared/page_header', pagina: @pagina %>

  <!-- Box definizione -->
  <div class="bg-cyan-50 dark:bg-cyan-900/30 border-2 border-cyan-300 dark:border-cyan-600 rounded-lg p-4 mb-8">
    <p class="text-gray-700 dark:text-gray-200">
      Il <span class="text-cyan-600 dark:text-cyan-400 font-bold">perimetro</span> di un poligono è la <strong>misura del suo contorno</strong>.
    </p>
    <div class="flex items-center gap-4 mt-4">
      <svg viewBox="0 0 100 80" class="w-20 h-16">
        <rect x="10" y="10" width="80" height="60" fill="#E0F7FA" stroke="#0097A7" stroke-width="2"/>
        <text x="5" y="8" font-size="8" fill="currentColor">D</text>
        <text x="90" y="8" font-size="8" fill="currentColor">C</text>
        <text x="5" y="78" font-size="8" fill="currentColor">A</text>
        <text x="90" y="78" font-size="8" fill="currentColor">B</text>
      </svg>
      <p class="text-cyan-700 dark:text-cyan-400 font-bold">P = AB + BC + CD + DA = 20 <span  class="">unità</span></p>
    </div>
  </div>

  <!-- Esercizio 1 -->
  <div class="mb-12" data-controller="fill-blanks auto-advance">
    <div class="flex items-start gap-3 mb-6">
      <div class="bg-red-500 text-white rounded-full w-8 h-8 flex items-center justify-center font-bold flex-shrink-0">
        1
      </div>
      <p class="text-gray-700 dark:text-gray-200">
        <strong>Utilizza l'unità di misura indicata e calcola il perimetro di questi poligoni.</strong>
      </p>
    </div>

    <!-- Griglia con 8 poligoni -->
    <div class="bg-gray-100 dark:bg-gray-800 p-4 rounded-lg mb-6">
      <p  class="text-gray-600 dark:text-gray-400 mb-4">Unità di misura: <span class="inline-block w-4 h-4 border border-gray-400 bg-white"></span></p>

      <div class="grid grid-cols-2 md:grid-cols-4 gap-6">
        <!-- Poligono 1: L a rovescio (8 unità) -->
        <div class="flex flex-col items-center gap-2">
          <div class="grid grid-cols-5 gap-0 w-20">
            <div class="col-span-2 row-span-2">
              <div class="grid grid-cols-2 gap-0">
                <div class="w-4 h-4 border border-gray-400 bg-cyan-200"></div>
                <div class="w-4 h-4 border border-gray-400 bg-cyan-200"></div>
                <div class="w-4 h-4 border border-gray-400 bg-cyan-200"></div>
                <div class="w-4 h-4 border border-gray-400 bg-cyan-200"></div>
              </div>
            </div>
          </div>
          <div class="flex items-center gap-1">
            <span class="text-cyan-600 dark:text-cyan-400 font-bold">P =</span>
            <input type="text" data-fill-blanks-target="input" data-correct-answer="8"
                   class="w-12 px-1 py-1 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center bg-white dark:bg-gray-700 dark:text-white" inputmode="numeric">
            <span  class="">u</span>
          </div>
        </div>

        <!-- Poligono 2: Forma a gradini (14 unità) -->
        <div class="flex flex-col items-center gap-2">
          <svg viewBox="0 0 50 40" class="w-16 h-12">
            <path d="M0,40 L0,20 L10,20 L10,10 L20,10 L20,0 L50,0 L50,40 Z"
                  fill="#B2EBF2" stroke="#0097A7" stroke-width="1"/>
          </svg>
          <div class="flex items-center gap-1">
            <span class="text-cyan-600 dark:text-cyan-400 font-bold">P =</span>
            <input type="text" data-fill-blanks-target="input" data-correct-answer="14"
                   class="w-12 px-1 py-1 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center bg-white dark:bg-gray-700 dark:text-white" inputmode="numeric">
            <span  class="">u</span>
          </div>
        </div>

        <!-- Poligono 3: Rettangolo verticale (10 unità) -->
        <div class="flex flex-col items-center gap-2">
          <div class="w-8 h-16 border-2 border-cyan-500 bg-cyan-100"></div>
          <div class="flex items-center gap-1">
            <span class="text-cyan-600 dark:text-cyan-400 font-bold">P =</span>
            <input type="text" data-fill-blanks-target="input" data-correct-answer="10"
                   class="w-12 px-1 py-1 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center bg-white dark:bg-gray-700 dark:text-white" inputmode="numeric">
            <span  class="">u</span>
          </div>
        </div>

        <!-- Poligono 4: Forma a T (16 unità) -->
        <div class="flex flex-col items-center gap-2">
          <svg viewBox="0 0 50 40" class="w-16 h-12">
            <path d="M0,0 L50,0 L50,10 L30,10 L30,40 L20,40 L20,10 L0,10 Z"
                  fill="#B2EBF2" stroke="#0097A7" stroke-width="1"/>
          </svg>
          <div class="flex items-center gap-1">
            <span class="text-cyan-600 dark:text-cyan-400 font-bold">P =</span>
            <input type="text" data-fill-blanks-target="input" data-correct-answer="16"
                   class="w-12 px-1 py-1 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center bg-white dark:bg-gray-700 dark:text-white" inputmode="numeric">
            <span  class="">u</span>
          </div>
        </div>

        <!-- Poligono 5: L (10 unità) -->
        <div class="flex flex-col items-center gap-2">
          <svg viewBox="0 0 40 40" class="w-12 h-12">
            <path d="M0,0 L10,0 L10,30 L40,30 L40,40 L0,40 Z"
                  fill="#B2EBF2" stroke="#0097A7" stroke-width="1"/>
          </svg>
          <div class="flex items-center gap-1">
            <span class="text-cyan-600 dark:text-cyan-400 font-bold">P =</span>
            <input type="text" data-fill-blanks-target="input" data-correct-answer="10"
                   class="w-12 px-1 py-1 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center bg-white dark:bg-gray-700 dark:text-white" inputmode="numeric">
            <span  class="">u</span>
          </div>
        </div>

        <!-- Poligono 6: Forma a gradini inversa (12 unità) -->
        <div class="flex flex-col items-center gap-2">
          <svg viewBox="0 0 40 40" class="w-12 h-12">
            <path d="M0,0 L20,0 L20,20 L40,20 L40,40 L0,40 Z"
                  fill="#B2EBF2" stroke="#0097A7" stroke-width="1"/>
          </svg>
          <div class="flex items-center gap-1">
            <span class="text-cyan-600 dark:text-cyan-400 font-bold">P =</span>
            <input type="text" data-fill-blanks-target="input" data-correct-answer="12"
                   class="w-12 px-1 py-1 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center bg-white dark:bg-gray-700 dark:text-white" inputmode="numeric">
            <span  class="">u</span>
          </div>
        </div>

        <!-- Poligono 7: T rovesciata (14 unità) -->
        <div class="flex flex-col items-center gap-2">
          <svg viewBox="0 0 50 40" class="w-16 h-12">
            <path d="M15,0 L35,0 L35,25 L50,25 L50,40 L0,40 L0,25 L15,25 Z"
                  fill="#B2EBF2" stroke="#0097A7" stroke-width="1"/>
          </svg>
          <div class="flex items-center gap-1">
            <span class="text-cyan-600 dark:text-cyan-400 font-bold">P =</span>
            <input type="text" data-fill-blanks-target="input" data-correct-answer="14"
                   class="w-12 px-1 py-1 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center bg-white dark:bg-gray-700 dark:text-white" inputmode="numeric">
            <span  class="">u</span>
          </div>
        </div>

        <!-- Poligono 8: Croce (20 unità) -->
        <div class="flex flex-col items-center gap-2">
          <svg viewBox="0 0 50 50" class="w-14 h-14">
            <path d="M15,0 L35,0 L35,15 L50,15 L50,35 L35,35 L35,50 L15,50 L15,35 L0,35 L0,15 L15,15 Z"
                  fill="#B2EBF2" stroke="#0097A7" stroke-width="1"/>
          </svg>
          <div class="flex items-center gap-1">
            <span class="text-cyan-600 dark:text-cyan-400 font-bold">P =</span>
            <input type="text" data-fill-blanks-target="input" data-correct-answer="20"
                   class="w-12 px-1 py-1 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center bg-white dark:bg-gray-700 dark:text-white" inputmode="numeric">
            <span  class="">u</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Esercizio 2 -->
  <div class="mb-12" data-controller="fill-blanks auto-advance">
    <div class="flex items-start gap-3 mb-6">
      <div class="bg-red-500 text-white rounded-full w-8 h-8 flex items-center justify-center font-bold flex-shrink-0">
        2
      </div>
      <p class="text-gray-700 dark:text-gray-200">
        <strong>Misura con il righello i lati dei poligoni e calcola il perimetro in cm.</strong>
      </p>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
      <!-- Trapezio ABCD -->
      <div class="space-y-4">
        <div class="flex justify-center">
          <svg viewBox="0 0 160 100" class="w-48 h-28">
            <polygon points="30,80 130,80 100,20 60,20" fill="none" stroke="currentColor" stroke-width="2"/>
            <text x="55" y="15" font-size="10" fill="currentColor">D</text>
            <text x="100" y="15" font-size="10" fill="currentColor">C</text>
            <text x="22" y="90" font-size="10" fill="currentColor">A</text>
            <text x="130" y="90" font-size="10" fill="currentColor">B</text>
          </svg>
        </div>
        <div class="space-y-2">
          <p>P = AB + BC + CD + DA</p>
          <div class="flex items-center gap-1 flex-wrap">
            <span>P =</span>
            <input type="text" data-fill-blanks-target="input" data-correct-answer="5"
                   class="w-10 px-1 py-1 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center bg-white dark:bg-gray-700 dark:text-white" inputmode="numeric">
            <span>+</span>
            <input type="text" data-fill-blanks-target="input" data-correct-answer="3"
                   class="w-10 px-1 py-1 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center bg-white dark:bg-gray-700 dark:text-white" inputmode="numeric">
            <span>+</span>
            <input type="text" data-fill-blanks-target="input" data-correct-answer="2"
                   class="w-10 px-1 py-1 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center bg-white dark:bg-gray-700 dark:text-white" inputmode="numeric">
            <span>+</span>
            <input type="text" data-fill-blanks-target="input" data-correct-answer="3"
                   class="w-10 px-1 py-1 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center bg-white dark:bg-gray-700 dark:text-white" inputmode="numeric">
            <span>=</span>
            <input type="text" data-fill-blanks-target="input" data-correct-answer="13"
                   class="w-12 px-1 py-1 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center bg-white dark:bg-gray-700 dark:text-white" inputmode="numeric">
            <span>cm</span>
          </div>
        </div>
      </div>

      <!-- Rettangolo EFGH -->
      <div class="space-y-4">
        <div class="flex justify-center">
          <svg viewBox="0 0 160 80" class="w-48 h-20">
            <rect x="20" y="10" width="120" height="60" fill="none" stroke="currentColor" stroke-width="2"/>
            <text x="15" y="8" font-size="10" fill="currentColor">H</text>
            <text x="140" y="8" font-size="10" fill="currentColor">G</text>
            <text x="15" y="78" font-size="10" fill="currentColor">E</text>
            <text x="140" y="78" font-size="10" fill="currentColor">F</text>
          </svg>
        </div>
        <div class="space-y-2">
          <p>P = EF + FG + GH + HE</p>
          <div class="flex items-center gap-1 flex-wrap">
            <span>P =</span>
            <input type="text" data-fill-blanks-target="input" data-correct-answer="6"
                   class="w-10 px-1 py-1 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center bg-white dark:bg-gray-700 dark:text-white" inputmode="numeric">
            <span>+</span>
            <input type="text" data-fill-blanks-target="input" data-correct-answer="3"
                   class="w-10 px-1 py-1 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center bg-white dark:bg-gray-700 dark:text-white" inputmode="numeric">
            <span>+</span>
            <input type="text" data-fill-blanks-target="input" data-correct-answer="6"
                   class="w-10 px-1 py-1 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center bg-white dark:bg-gray-700 dark:text-white" inputmode="numeric">
            <span>+</span>
            <input type="text" data-fill-blanks-target="input" data-correct-answer="3"
                   class="w-10 px-1 py-1 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center bg-white dark:bg-gray-700 dark:text-white" inputmode="numeric">
            <span>=</span>
            <input type="text" data-fill-blanks-target="input" data-correct-answer="18"
                   class="w-12 px-1 py-1 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center bg-white dark:bg-gray-700 dark:text-white" inputmode="numeric">
            <span>cm</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer con controlli -->
  <%= render 'shared/exercise_controls' %>
</div>
