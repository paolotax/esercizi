<div class="max-w-6xl mx-auto bg-white p-3 md:p-6"
     data-controller="exercise-checker text-toggle font-controls"
     data-text-toggle-target="content"
     data-font-controls-target="content">

  <%= render 'shared/page_header', pagina: @pagina %>

  <div class="space-y-6">

    <!-- Interactive Image -->
    <div class="relative rounded-2xl overflow-hidden"
         data-controller="hotspot-editor"
         data-hotspot-editor-target="container">

      <%= image_tag "nvi5_mat/p008/p008_01.jpg",
          alt: "Schema delle potenze: 6 alla terza con etichette POTENZE, ESPONENTE, BASE, 6 per 6 per 6, SEI ALLA TERZA, SEI ELEVATO ALLA TERZA",
          class: "w-full h-full object-cover select-none pointer-events-none" %>

      <div class="absolute inset-0">
        <% hotspots = [
          { label: "POTENZE", top: "8.58%", left: "34.51%", width: "28.67%", height: "6.06%" },
          { label: "ESPONENTE", top: "20.92%", left: "47.70%", width: "21.87%", height: "5.83%" },
          { label: "BASE", top: "34.27%", left: "47.25%", width: "13.42%", height: "5.60%" },
          { label: "6 per 6 per 6", top: "71.26%", left: "8.78%", width: "26.77%", height: "12.12%" },
          { label: "SEI ALLA TERZA", top: "69.23%", left: "61.69%", width: "22.65%", height: "6.30%" },
          { label: "SEI ELEVATO ALLA TERZA", top: "80.35%", left: "56.92%", width: "32.25%", height: "5.13%" }
        ] %>

        <% hotspots.each do |hotspot| %>
          <button type="button"
                  class="absolute rounded-xl bg-blue-500/10 hover:bg-blue-500/25 border-2 border-transparent hover:border-blue-500 focus:border-blue-600 focus:outline-none transition cursor-move"
                  style="top: <%= hotspot[:top] %>; left: <%= hotspot[:left] %>; width: <%= hotspot[:width] %>; height: <%= hotspot[:height] %>;"
                  aria-label="Leggi: <%= hotspot[:label] %>"
                  data-controller="image-speech"
                  data-hotspot-editor-target="hotspot"
                  data-image-speech-word-value="<%= hotspot[:label] %>"
                  data-image-speech-lang-value="it-IT"
                  data-action="mousedown->hotspot-editor#startDrag click->image-speech#speak">
            <span class="sr-only"><%= hotspot[:label] %></span>
          </button>
        <% end %>
      </div>
    </div>

    <!-- Esercizio Collega -->
    <div class="p-4 md:p-6">
      <p class="text-gray-700 mb-6">
        <span class="inline-block w-4 h-4 bg-pink-600 rounded-sm mr-2"></span>
        <span class="font-bold">Collega.</span>
      </p>

      <div class="space-y-4" data-controller="flower-matcher">
        <svg class="absolute top-0 left-0 w-full h-full pointer-events-none z-30"
             data-flower-matcher-target="canvas">
        </svg>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <!-- Colonna sinistra -->
          <div class="space-y-3">
            <div class="p-3 bg-custom-blue-light rounded-lg cursor-pointer hover:bg-blue-100 transition"
                 data-action="click->flower-matcher#selectFlower"
                 data-flower-matcher-target="flower"
                 data-flower-id="esponente"
                 data-pair="quante-volte">
              <span class="text-gray-700">L'<span class="font-bold text-custom-sky">ESPONENTE</span> indica</span>
            </div>
            <div class="p-3 bg-custom-blue-light rounded-lg cursor-pointer hover:bg-blue-100 transition"
                 data-action="click->flower-matcher#selectFlower"
                 data-flower-matcher-target="flower"
                 data-flower-id="base"
                 data-pair="numero">
              <span class="text-gray-700">La <span class="font-bold text-custom-sky">BASE</span> indica</span>
            </div>
            <div class="p-3 bg-custom-blue-light rounded-lg cursor-pointer hover:bg-blue-100 transition"
                 data-action="click->flower-matcher#selectFlower"
                 data-flower-matcher-target="flower"
                 data-flower-id="potenza"
                 data-pair="sei-per-sei">
              <span class="text-gray-700">La <span class="font-bold text-custom-sky">POTENZA</span> 6³ significa</span>
            </div>
          </div>

          <!-- Colonna destra -->
          <div class="space-y-3">
            <div class="p-3 bg-pink-50 rounded-lg cursor-pointer hover:bg-pink-100 transition"
                 data-action="click->flower-matcher#selectFlower"
                 data-flower-matcher-target="flower"
                 data-flower-id="quante-volte"
                 data-pair="esponente">
              <span class="text-gray-700">quante volte la base va moltiplicata per se stessa.</span>
            </div>
            <div class="p-3 bg-pink-50 rounded-lg cursor-pointer hover:bg-pink-100 transition"
                 data-action="click->flower-matcher#selectFlower"
                 data-flower-matcher-target="flower"
                 data-flower-id="sei-per-sei"
                 data-pair="potenza">
              <span class="text-gray-700">6 × 6 × 6.</span>
            </div>
            <div class="p-3 bg-pink-50 rounded-lg cursor-pointer hover:bg-pink-100 transition"
                 data-action="click->flower-matcher#selectFlower"
                 data-flower-matcher-target="flower"
                 data-flower-id="numero"
                 data-pair="base">
              <span class="text-gray-700">il numero da moltiplicare.</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Esercizio Scegli -->
    <div class="p-4 md:p-6">
      <p class="text-gray-700 mb-6">
        <span class="inline-block w-4 h-4 bg-pink-600 rounded-sm mr-2"></span>
        <span class="font-bold">Scegli.</span>
      </p>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <!-- La POTENZA 5⁴ si legge -->
        <div class="space-y-3">
          <p class="text-gray-700">La <span class="font-bold text-custom-sky">POTENZA</span> 5⁴ si legge:</p>
          <div class="space-y-2 ml-4">
            <label class="flex items-center gap-3 p-3 rounded-lg cursor-pointer hover:bg-gray-50 transition-colors">
              <input type="radio" name="potenza_5_4" value="quattro alla quinta" class="w-5 h-5 text-pink-600">
              <span class="font-bold text-custom-sky">QUATTRO ALLA QUINTA.</span>
            </label>
            <label class="flex items-center gap-3 p-3 rounded-lg cursor-pointer hover:bg-gray-50 transition-colors">
              <input type="radio" name="potenza_5_4" value="cinque alla quarta" class="w-5 h-5 text-pink-600" data-correct-answer="true">
              <span class="font-bold text-custom-sky">CINQUE ALLA QUARTA.</span>
            </label>
          </div>
        </div>

        <!-- OTTO ELEVATO ALLA SECONDA corrisponde -->
        <div class="space-y-3">
          <p class="text-gray-700"><span class="font-bold text-custom-sky">OTTO ELEVATO ALLA SECONDA</span> corrisponde:</p>
          <div class="space-y-2 ml-4">
            <label class="flex items-center gap-3 p-3 rounded-lg cursor-pointer hover:bg-gray-50 transition-colors">
              <input type="radio" name="otto_seconda" value="8²" class="w-5 h-5 text-pink-600" data-correct-answer="true">
              <span class="text-gray-700">alla <span class="font-bold text-custom-sky">POTENZA</span> 8².</span>
            </label>
            <label class="flex items-center gap-3 p-3 rounded-lg cursor-pointer hover:bg-gray-50 transition-colors">
              <input type="radio" name="otto_seconda" value="28" class="w-5 h-5 text-pink-600">
              <span class="text-gray-700">alla <span class="font-bold text-custom-sky">POTENZA</span> 28.</span>
            </label>
          </div>
        </div>
      </div>
    </div>

    <%= render 'shared/exercise_controls' %>
  </div>
</div>
