<div class="max-w-6xl mx-auto bg-white p-3 md:p-6"
     data-controller="exercise-checker text-toggle font-controls word-highlighter"
     data-text-toggle-target="content"
     data-font-controls-target="content"
     data-word-highlighter-multi-color-value="true">

  <!-- Header -->
  <%= render 'shared/page_header', pagina: @pagina %>

  <div class="space-y-6">
    <!-- Sezione ESERCIZI -->
    <div class="p-4 md:p-6 bg-orange-100 rounded-lg">
      <h2 class="font-bold text-pink-600 mb-6">ESERCIZI</h2>

      <div class="space-y-6">
        <!-- Exercise 1: Cerchia le classi -->
        <div>
          <div class="mb-4">
            <p class="text-gray-700">
              <%= imparare_tutti_badge(1) %>
              In ogni numero cerchia di
              <span class="text-blue-600 font-semibold">blu<span class="inline-block w-4 h-4 bg-blue-300 rounded-full ml-1 align-middle cursor-pointer" data-word-highlighter-target="colorBox" data-color="blue" data-action="click->word-highlighter#selectColor"></span></span>
              la classe delle unità semplici, di
              <span class="text-purple-600 font-semibold">viola<span class="inline-block w-4 h-4 bg-purple-300 rounded-full ml-1 align-middle cursor-pointer" data-word-highlighter-target="colorBox" data-color="purple" data-action="click->word-highlighter#selectColor"></span></span>
              quella delle migliaia, di
              <span class="text-green-600 font-semibold">verde<span class="inline-block w-4 h-4 bg-green-300 rounded-full ml-1 align-middle cursor-pointer" data-word-highlighter-target="colorBox" data-color="green" data-action="click->word-highlighter#selectColor"></span></span>
              quella dei milioni e di
              <span class="text-orange-600 font-semibold">arancione<span class="inline-block w-4 h-4 bg-orange-300 rounded-full ml-1 align-middle cursor-pointer" data-word-highlighter-target="colorBox" data-color="orange" data-action="click->word-highlighter#selectColor"></span></span>
              quella dei miliardi.
            </p>
          </div>
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
            <% [
              { groups: ["30", "215", "987", "006"], colors: ["orange", "green", "purple", "blue"] },
              { groups: ["4", "056", "125", "003"], colors: ["orange", "green", "purple", "blue"] },
              { groups: ["336", "758", "100", "989"], colors: ["orange", "green", "purple", "blue"] },
              { groups: ["2", "559", "205", "879"], colors: ["orange", "green", "purple", "blue"] },
              { groups: ["1", "200", "002", "900"], colors: ["orange", "green", "purple", "blue"] }
            ].each do |item| %>
              <div class="p-4 text-center bg-white rounded-lg">
                <div class="font-mono font-bold text-gray-800">
                  <% item[:groups].each_with_index do |group, i| %>
                    <span class="cursor-pointer hover:underline px-1" data-word-highlighter-target="word" data-correct="<%= item[:colors][i] %>" data-action="click->word-highlighter#toggleHighlight"><%= group %></span><%= " " if i < item[:groups].length - 1 %>
                  <% end %>
                </div>
              </div>
            <% end %>
          </div>
        </div>

        <!-- Exercise 2: Inserisci in tabella -->
        <div>
          <div class="mb-4">
            <p class="font-bold text-gray-700">
              <%= numero_esercizio_badge(2) %>
              Inserisci i numeri in tabella, poi scrivili in cifre. Segui l'esempio.
            </p>
          </div>
          <div>
            <div class="mb-4">
              <p class="text-gray-700 mb-3"><span class="font-bold">Numeri da inserire:</span></p>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                <div class="p-3 bg-white rounded-lg"><code>3 daG 6 uG 9 uM 8 hk 5 dak 1 uk 6 h</code></div>
                <div class="p-3 bg-white rounded-lg"><code>5 uG 9 hM 7 daM 3 dak 1 uk 7 h 4 u</code></div>
                <div class="p-3 bg-white rounded-lg"><code>2 hG 3 daG 6 hM 4 uM 8 hk 9 dak 6 da 5 u</code></div>
                <div class="p-3 bg-white rounded-lg"><code>1 hG 8 daG 4 uG 5 hM 6 daM 9 uM 2 h 4 da 4 u</code></div>
              </div>
            </div>

            <!-- Tabella -->
            <div class="overflow-x-auto">
              <table class="w-full text-center border-collapse">
                <thead>
                  <tr>
                    <th colspan="3" class="bg-orange-400 text-white py-2 border border-orange-300 font-bold">classe dei miliardi (G)</th>
                    <th colspan="3" class="bg-cyan-400 text-white py-2 border border-cyan-300 font-bold">classe dei milioni (M)</th>
                    <th colspan="3" class="bg-pink-400 text-white py-2 border border-pink-300 font-bold">classe delle migliaia (k)</th>
                    <th colspan="3" class="bg-blue-400 text-white py-2 border border-blue-300 font-bold">classe delle unità semplici</th>
                  </tr>
                  <tr>
                    <th class="bg-orange-200 py-2 border">hG</th>
                    <th class="bg-orange-200 py-2 border">daG</th>
                    <th class="bg-orange-200 py-2 border">uG</th>
                    <th class="bg-cyan-200 py-2 border">hM</th>
                    <th class="bg-cyan-200 py-2 border">daM</th>
                    <th class="bg-cyan-200 py-2 border">uM</th>
                    <th class="bg-pink-200 py-2 border">hk</th>
                    <th class="bg-pink-200 py-2 border">dak</th>
                    <th class="bg-pink-200 py-2 border">uk</th>
                    <th class="bg-blue-200 py-2 border">h</th>
                    <th class="bg-blue-200 py-2 border">da</th>
                    <th class="bg-blue-200 py-2 border">u</th>
                  </tr>
                </thead>
                <tbody>
                  <!-- Riga esempio: 36 009 851 600 -->
                  <tr class="bg-gray-50">
                    <td class="py-2 border"></td>
                    <td class="py-2 border font-bold">3</td>
                    <td class="py-2 border font-bold">6</td>
                    <td class="py-2 border font-bold">0</td>
                    <td class="py-2 border font-bold">0</td>
                    <td class="py-2 border font-bold">9</td>
                    <td class="py-2 border font-bold">8</td>
                    <td class="py-2 border font-bold">5</td>
                    <td class="py-2 border font-bold">1</td>
                    <td class="py-2 border font-bold">6</td>
                    <td class="py-2 border font-bold">0</td>
                    <td class="py-2 border font-bold">0</td>
                  </tr>
                  <!-- Riga 1 -->
                  <tr>
                    <% ["", "", "5", "9", "7", "0", "0", "3", "1", "7", "0", "4"].each do |val| %>
                      <td class="py-2 border">
                        <% if val.empty? %>
                        <% else %>
                          <input type="text" data-correct-answer="<%= val %>" class="w-8 text-center border-b-2 border-dotted border-gray-400 bg-transparent font-bold" maxlength="1">
                        <% end %>
                      </td>
                    <% end %>
                  </tr>
                  <!-- Riga 2 -->
                  <tr class="bg-gray-50">
                    <% ["2", "3", "0", "6", "0", "4", "8", "9", "0", "0", "6", "5"].each do |val| %>
                      <td class="py-2 border">
                        <input type="text" data-correct-answer="<%= val %>" class="w-8 text-center border-b-2 border-dotted border-gray-400 bg-transparent font-bold" maxlength="1">
                      </td>
                    <% end %>
                  </tr>
                  <!-- Riga 3 -->
                  <tr>
                    <% ["1", "8", "4", "5", "6", "9", "0", "0", "0", "2", "4", "4"].each do |val| %>
                      <td class="py-2 border">
                        <input type="text" data-correct-answer="<%= val %>" class="w-8 text-center border-b-2 border-dotted border-gray-400 bg-transparent font-bold" maxlength="1">
                      </td>
                    <% end %>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- Exercise 3: Scrivi in lettere -->
        <div>
          <div class="mb-4">
            <p class="font-bold text-gray-700">
              <%= numero_esercizio_badge(3) %>
              Scrivi in lettere sul quaderno i seguenti numeri.
            </p>
          </div>
          <div class="flex flex-wrap gap-4">
            <% ["556 234", "12 354 098", "9 345 236 063", "1 075 355", "120 000 000"].each do |num| %>
              <span class="bg-white px-4 py-2 font-bold text-cyan-500 rounded border-2 border-cyan-300 whitespace-nowrap"><%= num %></span>
            <% end %>
          </div>
        </div>

        <!-- Exercise 4: Somma di valori -->
        <div>
          <div class="mb-4">
            <p class="font-bold text-gray-700">
              <%= numero_esercizio_badge(4) %>
              Scrivi i numeri come somma di valori, somma di addendi e somma di prodotti. Segui l'esempio.
            </p>
          </div>
          <!-- Esempio -->
          <div class="p-4 bg-white rounded-lg mb-4">
            <div class="space-y-1">
              <div class="flex items-start gap-2">
                <span class="font-bold text-cyan-500 whitespace-nowrap">7 135 024</span>
                <span class="text-pink-600">→</span>
                <span class="text-gray-800 font-bold text-cyan-600">7 uM + 1 hk + 3 dak + 5 uk + 2 da + 4 u</span>
              </div>
              <div class="pl-24 text-gray-800 font-bold text-cyan-600"><span class="whitespace-nowrap">7 000 000</span> + <span class="whitespace-nowrap">100 000</span> + <span class="whitespace-nowrap">30 000</span> + <span class="whitespace-nowrap">5 000</span> + 20 + 4</div>
              <div class="pl-24 text-gray-800 font-bold text-cyan-600">7 × <span class="whitespace-nowrap">1 000 000</span> + 1 × <span class="whitespace-nowrap">100 000</span> + 3 × <span class="whitespace-nowrap">10 000</span> + 5 × <span class="whitespace-nowrap">1 000</span> + 2 × 10 + 4 × 1</div>
            </div>
          </div>
          <!-- Numeri da svolgere sul quaderno -->
          <div class="space-y-4">
            <% ["67 083 105", "190 315 070", "23 500 167 000"].each do |num| %>
              <div class="flex items-center gap-3">
                <span class="font-bold text-cyan-500 whitespace-nowrap"><%= num %></span>
                <span class="text-pink-600">→</span>
                <span class="text-gray-400">.................................................................</span>
              </div>
            <% end %>
          </div>
        </div>
      </div>
    </div>

    <%= render 'shared/exercise_controls' %>
  </div>
</div>
