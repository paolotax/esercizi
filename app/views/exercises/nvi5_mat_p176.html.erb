<div class="max-w-6xl mx-auto bg-white p-3 md:p-6"
     data-controller="exercise-checker text-toggle font-controls word-highlighter"
     data-text-toggle-target="content"
     data-font-controls-target="content">

  <%= render 'shared/page_header', pagina: @pagina %>

  <div class="space-y-6">
    <!-- Tabella classi posizionali -->
    <div class="overflow-x-auto">
      <table class="w-full border-collapse border border-cyan-400">
        <thead>
          <tr>
            <th class="p-2 border border-cyan-400 bg-custom-blue-light-light text-gray-800">CLASSE</th>
            <th colspan="3" class="p-2 border border-cyan-400 bg-custom-blue-light-light text-center text-gray-800">MILIARDI</th>
            <th colspan="3" class="p-2 border border-cyan-400 bg-custom-blue-light-light text-center text-gray-800">MILIONI</th>
            <th colspan="3" class="p-2 border border-cyan-400 bg-custom-blue-light-light text-center text-gray-800">MIGLIAIA</th>
            <th colspan="3" class="p-2 border border-cyan-400 bg-custom-blue-light-light text-center text-gray-800">UNITÀ SEMPLICI</th>
          </tr>
          <tr>
            <th class="p-2 border border-cyan-400 bg-custom-blue-light-light text-gray-800">ORDINE</th>
            <th class="p-2 border border-cyan-400 bg-white text-center">h<span class="font-bold text-cyan-600">G</span></th>
            <th class="p-2 border border-cyan-400 bg-white text-center">da<span class="font-bold text-cyan-600">G</span></th>
            <th class="p-2 border border-cyan-400 bg-white text-center">u<span class="font-bold text-cyan-600">G</span></th>
            <th class="p-2 border border-cyan-400 bg-white text-center">h<span class="font-bold text-cyan-600">M</span></th>
            <th class="p-2 border border-cyan-400 bg-white text-center">da<span class="font-bold text-cyan-600">M</span></th>
            <th class="p-2 border border-cyan-400 bg-white text-center">u<span class="font-bold text-cyan-600">M</span></th>
            <th class="p-2 border border-cyan-400 bg-white text-center">h<span class="font-bold text-cyan-600">k</span></th>
            <th class="p-2 border border-cyan-400 bg-white text-center">da<span class="font-bold text-cyan-600">k</span></th>
            <th class="p-2 border border-cyan-400 bg-white text-center">u<span class="font-bold text-cyan-600">k</span></th>
            <th class="p-2 border border-cyan-400 bg-white text-center">h</th>
            <th class="p-2 border border-cyan-400 bg-white text-center">da</th>
            <th class="p-2 border border-cyan-400 bg-white text-center">u</th>
          </tr>
        </thead>
      </table>
    </div>

    <!-- Esercizio 1: IMPARARE TUTTI -->
    <div class="p-4 bg-white rounded-2xl border-3 border-yellow-400">
      <p class="font-bold text-gray-700 mb-4">
        <%= imparare_tutti_badge(1) %>
        Inserisci i numeri in tabella, come nell'esempio. Poi leggi ad alta voce.
      </p>

      <p class="text-gray-700 mb-4">
        <span class="whitespace-nowrap">35 670 004</span>
        <span class="text-cyan-500 mx-1">•</span>
        <span class="whitespace-nowrap">6 002 390 000</span>
        <span class="text-cyan-500 mx-1">•</span>
        <span class="whitespace-nowrap">250 820 070</span>
        <span class="text-cyan-500 mx-1">•</span>
        <span class="whitespace-nowrap">126 004 000 330</span>
      </p>

      <div class="overflow-x-auto">
        <table class="w-full border-collapse border border-cyan-400">
          <thead>
            <tr>
              <th colspan="3" class="p-2 border border-cyan-400 bg-custom-blue-light-light text-center text-gray-800">Classe dei miliardi (<span class="font-bold">G</span>)</th>
              <th colspan="3" class="p-2 border border-cyan-400 bg-custom-blue-light-light text-center text-gray-800">Classe dei milioni (<span class="font-bold">M</span>)</th>
              <th colspan="3" class="p-2 border border-cyan-400 bg-custom-blue-light-light text-center text-gray-800">Classe delle migliaia (<span class="font-bold">k</span>)</th>
              <th colspan="3" class="p-2 border border-cyan-400 bg-custom-blue-light-light text-center text-gray-800">Classe delle unità semplici</th>
            </tr>
            <tr>
              <th class="p-1 border border-cyan-400 bg-custom-blue-light-light text-center text-gray-800">h</th>
              <th class="p-1 border border-cyan-400 bg-custom-blue-light-light text-center text-gray-800">da</th>
              <th class="p-1 border border-cyan-400 bg-custom-blue-light-light text-center text-gray-800">u</th>
              <th class="p-1 border border-cyan-400 bg-custom-blue-light-light text-center text-gray-800">h</th>
              <th class="p-1 border border-cyan-400 bg-custom-blue-light-light text-center text-gray-800">da</th>
              <th class="p-1 border border-cyan-400 bg-custom-blue-light-light text-center text-gray-800">u</th>
              <th class="p-1 border border-cyan-400 bg-custom-blue-light-light text-center text-gray-800">h</th>
              <th class="p-1 border border-cyan-400 bg-custom-blue-light-light text-center text-gray-800">da</th>
              <th class="p-1 border border-cyan-400 bg-custom-blue-light-light text-center text-gray-800">u</th>
              <th class="p-1 border border-cyan-400 bg-custom-blue-light-light text-center text-gray-800">h</th>
              <th class="p-1 border border-cyan-400 bg-custom-blue-light-light text-center text-gray-800">da</th>
              <th class="p-1 border border-cyan-400 bg-custom-blue-light-light text-center text-gray-800">u</th>
            </tr>
          </thead>
          <tbody>
            <!-- Esempio: 35 670 004 -->
            <tr>
              <td class="p-2 border border-cyan-400 text-center bg-white"></td>
              <td class="p-2 border border-cyan-400 text-center bg-white"></td>
              <td class="p-2 border border-cyan-400 text-center bg-white"></td>
              <td class="p-2 border border-cyan-400 text-center bg-white"></td>
              <td class="p-2 border border-cyan-400 text-center bg-white font-bold text-cyan-600">3</td>
              <td class="p-2 border border-cyan-400 text-center bg-white font-bold text-cyan-600">5</td>
              <td class="p-2 border border-cyan-400 text-center bg-white font-bold text-cyan-600">6</td>
              <td class="p-2 border border-cyan-400 text-center bg-white font-bold text-cyan-600">7</td>
              <td class="p-2 border border-cyan-400 text-center bg-white font-bold text-cyan-600">0</td>
              <td class="p-2 border border-cyan-400 text-center bg-white font-bold text-cyan-600">0</td>
              <td class="p-2 border border-cyan-400 text-center bg-white font-bold text-cyan-600">0</td>
              <td class="p-2 border border-cyan-400 text-center bg-white font-bold text-cyan-600">4</td>
            </tr>
            <!-- 6 002 390 000 -->
            <tr>
              <% ["", "", "6", "0", "0", "2", "3", "9", "0", "0", "0", "0"].each do |digit| %>
                <td class="p-2 border border-cyan-400 text-center bg-white">
                  <input type="text" data-correct-answer="<%= digit %>" class="w-6 text-center border-b border-dotted border-gray-400 bg-transparent">
                </td>
              <% end %>
            </tr>
            <!-- 250 820 070 -->
            <tr>
              <% ["", "", "", "2", "5", "0", "8", "2", "0", "0", "7", "0"].each do |digit| %>
                <td class="p-2 border border-cyan-400 text-center bg-white">
                  <input type="text" data-correct-answer="<%= digit %>" class="w-6 text-center border-b border-dotted border-gray-400 bg-transparent">
                </td>
              <% end %>
            </tr>
            <!-- 126 004 000 330 -->
            <tr>
              <% ["1", "2", "6", "0", "0", "4", "0", "0", "0", "3", "3", "0"].each do |digit| %>
                <td class="p-2 border border-cyan-400 text-center bg-white">
                  <input type="text" data-correct-answer="<%= digit %>" class="w-6 text-center border-b border-dotted border-gray-400 bg-transparent">
                </td>
              <% end %>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Esercizio 2 -->
    <div class="mb-6">
      <div class="flex flex-col md:flex-row gap-4">
        <!-- Testo a sinistra -->
        <div class="md:w-1/2">
          <p class="text-gray-700 mb-4">
            <%= numero_esercizio_badge(2) %>
            In ogni numero cerchia di <span class="text-cyan-500 font-bold cursor-pointer" data-word-highlighter-target="color" data-color="cyan">azzurro</span> la classe delle unità semplici, di <span class="text-purple-500 font-bold cursor-pointer" data-word-highlighter-target="color" data-color="purple">viola</span> quella delle migliaia, di <span class="text-green-500 font-bold cursor-pointer" data-word-highlighter-target="color" data-color="green">verde</span> quella dei milioni e di <span class="text-orange-500 font-bold cursor-pointer" data-word-highlighter-target="color" data-color="orange">arancione</span> quella dei miliardi.
          </p>
        </div>
        <!-- Numeri a destra in 2 colonne -->
        <div class="md:w-1/2">
          <div class="grid grid-cols-2 gap-2">
            <% ["20 146 792 088", "731 560 449 102", "4 090 654 912", "13 589 827 710", "385 703 541 008", "100 001 465 927", "652 504 826", "70 136 980 300"].each do |num| %>
              <div class="p-2 bg-white rounded border border-gray-200 text-center font-mono" data-word-highlighter-target="word">
                <%= num %>
              </div>
            <% end %>
          </div>
        </div>
      </div>
    </div>

    <!-- Esercizio 3 -->
    <div class="mb-6">
      <p class="font-bold text-gray-700 mb-4">
        <%= numero_esercizio_badge(3) %>
        Completa per formare un miliardo.
      </p>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <% [
          ["780 000 000", "220 000 000"],
          ["500 000", "999 500 000"],
          ["999 999 999", "1"],
          ["10", "999 999 990"],
          ["100 000", "999 900 000"],
          ["600 000 000", "400 000 000"]
        ].each do |start_num, answer| %>
          <div class="flex items-center gap-2 flex-wrap">
            <span class="whitespace-nowrap"><%= start_num %></span>
            <span>+</span>
            <input type="text" data-correct-answer="<%= answer.gsub(' ', '') %>" class="w-32 border-b-2 border-dotted border-gray-400 text-center font-bold bg-transparent">
            <span>= 1 uG</span>
          </div>
        <% end %>
      </div>
    </div>

    <!-- Esercizio 4 -->
    <div>
      <p class="font-bold text-gray-700 mb-4">
        <%= numero_esercizio_badge(4) %>
        Nei seguenti numeri dividi le cifre che si riferiscono alle classi, poi scrivi il numero in cifre. Segui l'esempio.
      </p>

      <div class="flex flex-col md:flex-row gap-4">
        <!-- Numeri da scrivere a sinistra -->
        <div class="md:w-2/3 space-y-4">
          <!-- Esempio -->
          <div class="flex items-center gap-2 flex-wrap">
            <span class="text-gray-700">ventiseimilioni<span class="font-bold text-cyan-600">|</span>centotremila<span class="font-bold text-cyan-600">|</span>seicentodue</span>
            <span class="text-cyan-500">→</span>
            <span class="font-bold text-cyan-600">26 103 602</span>
          </div>

          <% [
            ["settemiliardiottantamilionitrecentomila", "7 080 300 000"],
            ["seicentotrentamiliardinovecentomilaquaranta", "630 000 900 040"],
            ["cinquecentomilionitrentaseimilacentoventuno", "500 036 121"],
            ["novantamiliarditrecentomilaseicentotré", "90 000 300 603"]
          ].each do |word, answer| %>
            <div class="flex items-center gap-2 flex-wrap">
              <span class="text-gray-700"><%= word %></span>
              <span class="text-cyan-500">→</span>
              <input type="text" data-correct-answer="<%= answer.gsub(' ', '') %>" class="w-40 border-b-2 border-dotted border-gray-400 text-center font-bold bg-transparent">
            </div>
          <% end %>
        </div>

        <!-- Box regola a destra -->
        <div class="md:w-1/3">
          <div class="p-3 bg-white border-3 border-cyan-400">
            <p class="text-gray-600 italic">Per scrivere i numeri grandi suddividi le cifre in gruppi di tre, partendo da destra.</p>
          </div>
        </div>
      </div>
    </div>

    <%= render 'shared/exercise_controls' %>
  </div>
</div>
