<div class="max-w-6xl mx-auto p-3 md:p-8 bg-gradient-to-br from-pink-50 to-red-50 rounded-lg shadow-lg" data-controller="exercise-checker">

  <%= render 'shared/page_header', pagina: @pagina %>

  <!-- Legend -->
  <div class="mb-6 md:mb-8 grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3">
    <% [
      { label: 'SI • SÌ', color: 'bg-orange-200', text: 'text-orange-900' },
      { label: 'TE • TÈ', color: 'bg-blue-200', text: 'text-blue-900' },
      { label: 'NE • NÉ', color: 'bg-purple-200', text: 'text-purple-900' },
      { label: 'DA • DÀ', color: 'bg-green-200', text: 'text-green-900' },
      { label: 'SE • SÉ', color: 'bg-pink-200', text: 'text-pink-900' },
      { label: 'DI • DÌ', color: 'bg-yellow-200', text: 'text-yellow-900' },
      { label: 'CE • C\'È', color: 'bg-cyan-200', text: 'text-cyan-900' },
      { label: 'ME • M\'È', color: 'bg-red-200', text: 'text-red-900' },
      { label: 'VE • V\'È', color: 'bg-emerald-200', text: 'text-emerald-900' },
      { label: 'LI • LÌ', color: 'bg-indigo-200', text: 'text-indigo-900' },
      { label: 'LA • LÀ', color: 'bg-lime-200', text: 'text-lime-900' }
    ].each do |badge| %>
      <div class="flex items-center justify-center font-bold rounded-lg py-2 text-sm md:text-base <%= badge[:color] %> <%= badge[:text] %>">
        <%= badge[:label] %>
      </div>
    <% end %>
  </div>

  <!-- Exercise 3 -->
  <div class="mb-6 md:mb-8 bg-white rounded-lg p-4 md:p-6 shadow-md">
    <h2 class="text-lg md:text-xl font-bold text-pink-600 mb-4">
      <span class="bg-pink-600 text-white rounded-full w-8 h-8 md:w-10 md:h-10 inline-flex items-center justify-center mr-2">3</span>
      Completa ogni frase con i monosillabi adatti.
    </h2>

    <% exercise_3_items = [
      {
        badge: 'SI • SÌ',
        color: 'border-orange-300 bg-orange-50',
        parts: [
          '• Quando Alessio ',
          { answer: 'si' },
          ' è sposato ha detto “',
          { answer: 'sì' },
          '” così forte che tutti sono scoppiati a ridere.'
        ]
      },
      {
        badge: 'TE • TÈ',
        color: 'border-blue-300 bg-blue-50',
        parts: [
          '• C’è ancora del ',
          { answer: 'tè' },
          ': ',
          { answer: 'te' },
          ' ne verso una tazza?'
        ]
      },
      {
        badge: 'NE • NÉ',
        color: 'border-purple-300 bg-purple-50',
        parts: [
          '• Ho mangiato troppo gelato: non me ',
          { answer: 'ne' },
          ' dare più, ',
          { answer: 'né' },
          ' alla frutta ',
          { answer: 'né' },
          ' alla crema.'
        ]
      },
      {
        badge: 'DA • DÀ',
        color: 'border-green-300 bg-green-50',
        parts: [
          '• Chi non ',
          { answer: 'dà' },
          ' nulla agli altri non riceve nulla ',
          { answer: 'da' },
          ' nessuno.'
        ]
      },
      {
        badge: 'SE • SÉ',
        color: 'border-pink-300 bg-pink-50',
        parts: [
          '• Lui parla spesso tra ',
          { answer: 'sé' },
          ' e ',
          { answer: 'sé' },
          ' a bassa voce. ',
          { answer: 'se' },
          ' non lo sai, ti può stupire.'
        ]
      },
      {
        badge: 'DI • DÌ',
        color: 'border-yellow-300 bg-yellow-50',
        parts: [
          '• La parte del giorno in cui c’è la luce si chiama ',
          { answer: 'dì' },
          '. Invece ',
          { answer: 'di' },
          ' notte il cielo è buio.'
        ]
      },
      {
        badge: 'CE • C\'È',
        color: 'border-cyan-300 bg-cyan-50',
        parts: [
          '• Se non ',
          { answer: 'c\'è' },
          ' più nulla da fare, ',
          { answer: 'ce' },
          ' ne andiamo.'
        ]
      },
      {
        badge: 'ME • M\'È',
        color: 'border-red-300 bg-red-50',
        parts: [
          '• ',
          { answer: 'm\'è' },
          ' sembrata strana la tua risposta! Non ti eri mai comportato così con ',
          { answer: 'me' },
          '.'
        ]
      },
      {
        badge: 'VE • V\'È',
        color: 'border-emerald-300 bg-emerald-50',
        parts: [
          '• ',
          { answer: 've' },
          ' l’assicuro: non ',
          { answer: 'v\'è' },
          ' stato nascosto nulla.'
        ]
      },
      {
        badge: 'LI • LÌ',
        color: 'border-indigo-300 bg-indigo-50',
        parts: [
          '• Arrivano i miei amici! ',
          { answer: 'li' },
          ' abbraccerò dopo un anno. Eccoli ',
          { answer: 'lì' },
          '!'
        ]
      },
      {
        badge: 'LA • LÀ',
        color: 'border-lime-300 bg-lime-50',
        parts: [
          '• Maria abita ',
          { answer: 'là' },
          ', in quella casa. Non ',
          { answer: 'la' },
          ' vedo da tanto tempo.'
        ]
      }
    ] %>

    <div class="space-y-4" data-controller="fill-blanks">
      <% exercise_3_items.each do |item| %>
        <div class="rounded-lg border-2 <%= item[:color] %> p-4">
          <div class="inline-block mb-2 px-3 py-1 rounded-full bg-white shadow text-sm font-bold text-pink-600">
            <%= item[:badge] %>
          </div>
          <p class="text-base md:text-lg leading-relaxed flex flex-wrap items-center gap-1">
            <% item[:parts].each do |part| %>
              <% if part.is_a?(Hash) %>
                <input type="text"
                       class="border-b-2 border-pink-500 bg-white w-16 md:w-20 text-center focus:outline-none focus:border-pink-700"
                       data-fill-blanks-target="input"
                       data-answer="<%= part[:answer] %>"
                       data-correct-answer="<%= part[:answer] %>"
                       maxlength="6">
              <% else %>
                <span><%= part %></span>
              <% end %>
            <% end %>
          </p>
        </div>
      <% end %>
    </div>
  </div>

  <!-- Exercise 4 -->
  <div class="mb-6 md:mb-8 bg-white rounded-lg p-4 md:p-6 shadow-md" data-controller="fill-blanks">
    <h2 class="text-lg md:text-xl font-bold text-pink-600 mb-4">
      <span class="bg-pink-600 text-white rounded-full w-8 h-8 md:w-10 md:h-10 inline-flex items-center justify-center mr-2">4</span>
      Metti l’accento dove manca.
    </h2>

    <% exercise_4_sentences = [
      [
        '• Chi fa da ',
        { answer: 'sé' },
        ' fa per tre.'
      ],
      [
        '• Sulle montagne russe si va su e ',
        { answer: 'giù' },
        '.'
      ],
      [
        '• Ho visto che c’erano macchie qui e ',
        { answer: 'là' },
        '.'
      ],
      [
        '• Non voglio ',
        { answer: 'né' },
        ' il cappotto rosso ',
        { answer: 'né' },
        ' quello blu.'
      ],
      [
        '• Chi ',
        { answer: 'è' },
        ' stato? Sei stato tu?'
      ],
      [
        '• Ho preparato il ',
        { answer: 'tè' },
        ' freddo. Ne vuoi?'
      ],
      [
        '• Chi gli ',
        { answer: 'dà' },
        ' retta? ',
        { answer: 'è' },
        ' già da un’ora che parla.'
      ],
      [
        '• Incontro il nostro vicino di casa tutti i ',
        { answer: 'dì' },
        '.'
      ]
    ] %>

    <div class="space-y-3 text-base md:text-lg leading-relaxed">
      <% exercise_4_sentences.each do |sentence| %>
        <div class="p-3 bg-pink-50 rounded-lg flex flex-wrap items-center gap-1">
          <% sentence.each do |part| %>
            <% if part.is_a?(Hash) %>
              <input type="text"
                     class="border-b-2 border-pink-500 bg-white w-16 md:w-20 text-center focus:outline-none focus:border-pink-700"
                     data-fill-blanks-target="input"
                     data-answer="<%= part[:answer] %>"
                     data-correct-answer="<%= part[:answer] %>"
                     maxlength="6">
            <% else %>
              <span><%= part %></span>
            <% end %>
          <% end %>
        </div>
      <% end %>
    </div>
  </div>

  <!-- Exercise Controls -->
  <%= render 'shared/exercise_controls', color: 'pink', current_page: 'nvl5_gram_p015' %>
</div>

