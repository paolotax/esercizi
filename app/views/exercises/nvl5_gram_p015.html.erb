<div class="max-w-6xl mx-auto bg-white dark:bg-gray-900 text-black dark:text-white p-3 md:p-6 transition-colors duration-300"
     data-controller="exercise-checker text-toggle font-controls"
     data-text-toggle-target="content"
     data-font-controls-target="content">

  <%= render 'shared/page_header', pagina: @pagina %>

  <div class="space-y-6">

  <!-- Exercise 3 -->
  <div class="bg-white dark:bg-gray-800 rounded-lg p-4 md:p-6">
    <h2 class="text-lg md:text-xl font-bold text-gray-800 dark:text-gray-200 mb-4">
      <span class="bg-pink-600 text-white rounded-full w-8 h-8 md:w-10 md:h-10 inline-flex items-center justify-center mr-2">3</span>
      Completa ogni frase con i monosillabi adatti.
    </h2>

    <% exercise_3_items = [
      {
        badge: 'SI • SÌ',
        color: 'border-orange-300 bg-orange-50',
        parts: [
          '• Quando Alessio ',
          { answer: 'si' },
          ' è sposato ha detto “',
          { answer: 'sì' },
          '” così forte che tutti sono scoppiati a ridere.'
        ]
      },
      {
        badge: 'TE • TÈ',
        color: 'border-blue-300 bg-blue-50',
        parts: [
          '• C’è ancora del ',
          { answer: 'tè' },
          ': ',
          { answer: 'te' },
          ' ne verso una tazza?'
        ]
      },
      {
        badge: 'NE • NÉ',
        color: 'border-purple-300 bg-purple-50',
        parts: [
          '• Ho mangiato troppo gelato: non me ',
          { answer: 'ne' },
          ' dare più, ',
          { answer: 'né' },
          ' alla frutta ',
          { answer: 'né' },
          ' alla crema.'
        ]
      },
      {
        badge: 'DA • DÀ',
        color: 'border-green-300 bg-green-50',
        parts: [
          '• Chi non ',
          { answer: 'dà' },
          ' nulla agli altri non riceve nulla ',
          { answer: 'da' },
          ' nessuno.'
        ]
      },
      {
        badge: 'SE • SÉ',
        color: 'border-pink-300 bg-pink-50',
        parts: [
          '• Lui parla spesso tra ',
          { answer: 'sé' },
          ' e ',
          { answer: 'sé' },
          ' a bassa voce. ',
          { answer: 'se' },
          ' non lo sai, ti può stupire.'
        ]
      },
      {
        badge: 'DI • DÌ',
        color: 'border-yellow-300 bg-yellow-50',
        parts: [
          '• La parte del giorno in cui c’è la luce si chiama ',
          { answer: 'dì' },
          '. Invece ',
          { answer: 'di' },
          ' notte il cielo è buio.'
        ]
      },
      {
        badge: 'CE • C\'È',
        color: 'border-cyan-300 bg-cyan-50',
        parts: [
          '• Se non ',
          { answer: 'c\'è' },
          ' più nulla da fare, ',
          { answer: 'ce' },
          ' ne andiamo.'
        ]
      },
      {
        badge: 'ME • M\'È',
        color: 'border-red-300 bg-red-50',
        parts: [
          '• ',
          { answer: 'm\'è' },
          ' sembrata strana la tua risposta! Non ti eri mai comportato così con ',
          { answer: 'me' },
          '.'
        ]
      },
      {
        badge: 'VE • V\'È',
        color: 'border-emerald-300 bg-emerald-50',
        parts: [
          '• ',
          { answer: 've' },
          ' l’assicuro: non ',
          { answer: 'v\'è' },
          ' stato nascosto nulla.'
        ]
      },
      {
        badge: 'LI • LÌ',
        color: 'border-indigo-300 bg-indigo-50',
        parts: [
          '• Arrivano i miei amici! ',
          { answer: 'li' },
          ' abbraccerò dopo un anno. Eccoli ',
          { answer: 'lì' },
          '!'
        ]
      },
      {
        badge: 'LA • LÀ',
        color: 'border-lime-300 bg-lime-50',
        parts: [
          '• Maria abita ',
          { answer: 'là' },
          ', in quella casa. Non ',
          { answer: 'la' },
          ' vedo da tanto tempo.'
        ]
      }
    ] %>

    <div class="sm:ml-7 space-y-8 md:space-y-4" data-controller="fill-blanks">
      <% exercise_3_items.each do |item| %>
        <div class="flex flex-col md:flex-row md:items-center gap-3">
          <div class="bg-white dark:bg-gray-700 border-4 <%= case item[:color]
            when 'border-orange-300 bg-orange-50' then 'border-orange-500 dark:border-orange-400'
            when 'border-blue-300 bg-blue-50' then 'border-blue-500 dark:border-blue-400'
            when 'border-purple-300 bg-purple-50' then 'border-purple-500 dark:border-purple-400'
            when 'border-green-300 bg-green-50' then 'border-green-500 dark:border-green-400'
            when 'border-pink-300 bg-pink-50' then 'border-pink-500 dark:border-pink-400'
            when 'border-yellow-300 bg-yellow-50' then 'border-yellow-500 dark:border-yellow-400'
            when 'border-cyan-300 bg-cyan-50' then 'border-cyan-500 dark:border-cyan-400'
            when 'border-red-300 bg-red-50' then 'border-red-500 dark:border-red-400'
            when 'border-emerald-300 bg-emerald-50' then 'border-emerald-500 dark:border-emerald-400'
            when 'border-indigo-300 bg-indigo-50' then 'border-indigo-500 dark:border-indigo-400'
            when 'border-lime-300 bg-lime-50' then 'border-lime-500 dark:border-lime-400'
            end %> text-black dark:text-white px-4 py-2 rounded-lg font-bold flex-shrink-0 w-32 md:w-36 mx-auto md:mx-0 text-center"><%= item[:badge] %></div>
          <div class="flex-1 text-base md:text-lg leading-relaxed pb-4 md:pb-0">
            <span class="text-cyan-700 dark:text-cyan-400 font-bold text-2xl mr-2">•</span>
            <% item[:parts].each do |part| %>
              <% if part.is_a?(Hash) %>
                <input type="text"
                       class="border-b-3 border-pink-500 dark:border-pink-400 bg-transparent dark:text-white w-12 md:w-16 text-center focus:outline-none focus:border-pink-700 inline-block align-baseline"
                       data-fill-blanks-target="input"
                       data-answer="<%= part[:answer] %>"
                       data-correct-answer="<%= part[:answer] %>"
                       maxlength="6">
              <% else %>
                <span class="inline break-words text-gray-800 dark:text-gray-200"><%= part.gsub(/^•\s*/, '') %></span>
              <% end %>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>
  </div>

  <!-- Exercise 4 -->
  <div class="bg-white dark:bg-gray-800 rounded-lg p-4 md:p-6" data-controller="fill-blanks">
    <h2 class="text-lg md:text-xl font-bold text-gray-800 dark:text-gray-200 mb-4">
      <span class="bg-pink-600 text-white rounded-full w-8 h-8 md:w-10 md:h-10 inline-flex items-center justify-center mr-2">4</span>
      Metti l'accento dove manca.
    </h2>

    <% exercise_4_sentences = [
      [
        'Chi fa da ',
        { answer: 'sé' },
        ' fa per tre.'
      ],
      [
        'Sulle montagne russe si va su e ',
        { answer: 'giù' },
        '.'
      ],
      [
        "Ho visto che c'erano macchie qui e ",
        { answer: 'là' },
        '.'
      ],
      [
        'Non voglio ',
        { answer: 'né' },
        ' il cappotto rosso ',
        { answer: 'né' },
        ' quello blu.'
      ],
      [
        'Chi ',
        { answer: 'è' },
        ' stato? Sei stato tu?'
      ],
      [
        'Ho preparato il ',
        { answer: 'tè' },
        ' freddo. Ne vuoi?'
      ],
      [
        'Chi gli ',
        { answer: 'dà' },
        ' retta? ',
        { answer: 'è' },
        ' già da un’ora che parla.'
      ],
      [
        'Incontro il nostro vicino di casa tutti i ',
        { answer: 'dì' },
        '.'
      ]
    ] %>

    <div class="sm:ml-7 space-y-0 text-base md:text-lg leading-relaxed">
      <% exercise_4_sentences.each do |sentence| %>
        <div class="px-3 py-1 rounded-lg flex flex-wrap items-center gap-1">
          <span class="text-cyan-700 dark:text-cyan-400 font-bold text-2xl mr-2">•</span>
          <% sentence.each do |part| %>
            <% if part.is_a?(Hash) %>
              <input type="text"
                     class="border-b-2 border-pink-500 dark:border-pink-400 bg-transparent dark:text-white w-16 md:w-20 text-center focus:outline-none focus:border-pink-700"
                     data-fill-blanks-target="input"
                     data-answer="<%= part[:answer] %>"
                     data-correct-answer="<%= part[:answer] %>"
                     maxlength="6">
            <% else %>
              <span class="text-gray-800 dark:text-gray-200"><%= part %></span>
            <% end %>
          <% end %>
        </div>
      <% end %>
    </div>
  </div>

  <!-- Exercise Controls -->
  <%= render 'shared/exercise_controls' %>
  </div><!-- chiude space-y-6 -->
</div>

