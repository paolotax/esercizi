<div class="max-w-6xl mx-auto bg-white p-3 md:p-6"
     data-controller="exercise-checker text-toggle font-controls"
     data-text-toggle-target="content"
     data-font-controls-target="content">

  <%= render 'shared/page_header', pagina: @pagina %>

  <div class="space-y-6">
    <div class="grid grid-cols-1 md:grid-cols-2 divide-y-2 md:divide-y-0 md:divide-x-2 divide-<%= @pagina.base_color %>-300">
      <!-- Colonna sinistra -->
      <div class="space-y-6">
        <!-- Esercizio 1 -->
        <div class="p-4">
          
          <div class="mb-4">
            <p class="font-bold text-gray-700">
              <%= numero_esercizio_badge(1) %>
              Trova la frazione complementare e completa il calcolo.
            </p>
          </div>

          <div class="space-y-3">
            <div class="flex items-center gap-2 flex-wrap">
              <%= render 'shared/frazione', num: 17, den: 29 %>
              <span class="font-bold">+</span>
              <%= render 'shared/frazione', num: nil, den: 29, num_answer: "12" %>
              <span class="font-bold">=</span>
              <%= render 'shared/frazione', num: nil, den: 29, num_answer: "29" %>
            </div>

            <div class="flex items-center gap-2 flex-wrap">
              <%= render 'shared/frazione', num: 45, den: 75 %>
              <span class="font-bold">+</span>
              <%= render 'shared/frazione', num: nil, den: 75, num_answer: "30" %>
              <span class="font-bold">=</span>
              <%= render 'shared/frazione', num: nil, den: 75, num_answer: "75" %>
            </div>

            <div class="flex items-center gap-2 flex-wrap">
              <%= render 'shared/frazione', num: nil, den: 58, num_answer: "34" %>
              <span class="font-bold">+</span>
              <%= render 'shared/frazione', num: 24, den: 58 %>
              <span class="font-bold">=</span>
              <%= render 'shared/frazione', num: nil, den: 58, num_answer: "58" %>
            </div>

            <div class="flex items-center gap-2 flex-wrap">
              <%= render 'shared/frazione', num: nil, den: 60, num_answer: "22" %>
              <span class="font-bold">+</span>
              <%= render 'shared/frazione', num: 38, den: 60 %>
              <span class="font-bold">=</span>
              <%= render 'shared/frazione', num: nil, den: 60, num_answer: "60" %>
            </div>

            <div class="flex items-center gap-2 flex-wrap">
              <%= render 'shared/frazione', num: nil, den: 100, num_answer: "5" %>
              <span class="font-bold">+</span>
              <%= render 'shared/frazione', num: 95, den: 100 %>
              <span class="font-bold">=</span>
              <%= render 'shared/frazione', num: nil, den: 100, num_answer: "100" %>
            </div>

            <div class="flex items-center gap-2 flex-wrap">
              <%= render 'shared/frazione', num: nil, den: 1000, num_answer: "635" %>
              <span class="font-bold">+</span>
              <%= render 'shared/frazione', num: 365, den: 1000 %>
              <span class="font-bold">=</span>
              <%= render 'shared/frazione', num: nil, den: 1000, num_answer: "1000" %>
            </div>
          </div>
        </div>

        <!-- Esercizio 2 -->
        <div class="p-4">
          
          <div class="mb-4">
            <p class="font-bold text-gray-700">
              <%= numero_esercizio_badge(2) %>
              Per ciascuna di queste frazioni, scrivine due equivalenti.
            </p>
          </div>

          <div class="grid grid-cols-2 gap-3">
            <div class="flex items-center gap-2">
              <%= render 'shared/frazione', num: 3, den: 7 %>
              <span>→</span>
              <%= render 'shared/frazione', num: nil, den: nil, num_answer: "6", den_answer: "14" %>
              <%= render 'shared/frazione', num: nil, den: nil, num_answer: "9", den_answer: "21" %>
            </div>

            <div class="flex items-center gap-2">
              <%= render 'shared/frazione', num: 5, den: 6 %>
              <span>→</span>
              <%= render 'shared/frazione', num: nil, den: nil, num_answer: "10", den_answer: "12" %>
              <%= render 'shared/frazione', num: nil, den: nil, num_answer: "15", den_answer: "18" %>
            </div>

            <div class="flex items-center gap-2">
              <%= render 'shared/frazione', num: 5, den: 21 %>
              <span>→</span>
              <%= render 'shared/frazione', num: nil, den: nil, num_answer: "10", den_answer: "42" %>
              <%= render 'shared/frazione', num: nil, den: nil, num_answer: "15", den_answer: "63" %>
            </div>

            <div class="flex items-center gap-2">
              <%= render 'shared/frazione', num: 4, den: 9 %>
              <span>→</span>
              <%= render 'shared/frazione', num: nil, den: nil, num_answer: "8", den_answer: "18" %>
              <%= render 'shared/frazione', num: nil, den: nil, num_answer: "12", den_answer: "27" %>
            </div>

            <div class="flex items-center gap-2">
              <%= render 'shared/frazione', num: 8, den: 12 %>
              <span>→</span>
              <%= render 'shared/frazione', num: nil, den: nil, num_answer: "16", den_answer: "24" %>
              <%= render 'shared/frazione', num: nil, den: nil, num_answer: "2", den_answer: "3" %>
            </div>

            <div class="flex items-center gap-2">
              <%= render 'shared/frazione', num: 2, den: 10 %>
              <span>→</span>
              <%= render 'shared/frazione', num: nil, den: nil, num_answer: "4", den_answer: "20" %>
              <%= render 'shared/frazione', num: nil, den: nil, num_answer: "1", den_answer: "5" %>
            </div>
          </div>
        </div>

        <!-- Esercizio 3 -->
        <div class="p-4" data-controller="word-highlighter" data-word-highlighter-multi-color-value="true">
          
          <div class="mb-4">
            <p class="font-bold text-gray-700">
              <%= numero_esercizio_badge(3) %>
              Cerchia di
              <span class="text-green-600">verde</span> le frazioni proprie, di
              <span class="text-blue-600">blu</span> le improprie e di
              <span class="text-red-600">rosso</span> le apparenti.
            </p>
          </div>

          <div class="flex flex-wrap gap-3 mb-4">
            <span data-word-highlighter-target="word" data-correct="green"
                  data-action="click->word-highlighter#toggleHighlight"
                  class="border-2 border-gray-300 rounded-lg px-3 py-2 cursor-pointer">
              <%= render 'shared/frazione', num: 12, den: 38 %>
            </span>
            <span data-word-highlighter-target="word" data-correct="red"
                  data-action="click->word-highlighter#toggleHighlight"
                  class="border-2 border-gray-300 rounded-lg px-3 py-2 cursor-pointer">
              <%= render 'shared/frazione', num: 21, den: 7 %>
            </span>
            <span data-word-highlighter-target="word" data-correct="green"
                  data-action="click->word-highlighter#toggleHighlight"
                  class="border-2 border-gray-300 rounded-lg px-3 py-2 cursor-pointer">
              <%= render 'shared/frazione', num: 32, den: 59 %>
            </span>
            <span data-word-highlighter-target="word" data-correct="green"
                  data-action="click->word-highlighter#toggleHighlight"
                  class="border-2 border-gray-300 rounded-lg px-3 py-2 cursor-pointer">
              <%= render 'shared/frazione', num: 25, den: 40 %>
            </span>
            <span data-word-highlighter-target="word" data-correct="blue"
                  data-action="click->word-highlighter#toggleHighlight"
                  class="border-2 border-gray-300 rounded-lg px-3 py-2 cursor-pointer">
              <%= render 'shared/frazione', num: 19, den: 11 %>
            </span>
            <span data-word-highlighter-target="word" data-correct="red"
                  data-action="click->word-highlighter#toggleHighlight"
                  class="border-2 border-gray-300 rounded-lg px-3 py-2 cursor-pointer">
              <%= render 'shared/frazione', num: 48, den: 4 %>
            </span>
            <span data-word-highlighter-target="word" data-correct="red"
                  data-action="click->word-highlighter#toggleHighlight"
                  class="border-2 border-gray-300 rounded-lg px-3 py-2 cursor-pointer">
              <%= render 'shared/frazione', num: 50, den: 5 %>
            </span>
            <span data-word-highlighter-target="word" data-correct="blue"
                  data-action="click->word-highlighter#toggleHighlight"
                  class="border-2 border-gray-300 rounded-lg px-3 py-2 cursor-pointer">
              <%= render 'shared/frazione', num: 13, den: 8 %>
            </span>
            <span data-word-highlighter-target="word" data-correct="red"
                  data-action="click->word-highlighter#toggleHighlight"
                  class="border-2 border-gray-300 rounded-lg px-3 py-2 cursor-pointer">
              <%= render 'shared/frazione', num: 18, den: 3 %>
            </span>
            <span data-word-highlighter-target="word" data-correct="green"
                  data-action="click->word-highlighter#toggleHighlight"
                  class="border-2 border-gray-300 rounded-lg px-3 py-2 cursor-pointer">
              <%= render 'shared/frazione', num: 13, den: 18 %>
            </span>
          </div>

          <p class="text-gray-600 text-sm">Quali di queste frazioni sono sia improprie sia apparenti?</p>
        </div>

        <!-- Esercizio 4 -->
        <div class="p-4">
          <div class="mb-4">
            <p class="font-bold text-gray-700">
              <%= numero_esercizio_badge(4) %>
              Completa con <span class="text-pink-800">&gt;</span>, <span class="text-pink-800">=</span>, <span class="text-pink-800">&lt;</span>.
            </p>
          </div>

          <div class="grid grid-cols-2 gap-3">
            <div class="flex items-center gap-1">
              <%= render 'shared/frazione', num: 8, den: 15 %>
              <input type="text" data-correct-answer="<" class="w-8 px-1 py-1 border-2 border-pink-400 rounded text-center font-bold bg-white">
              <%= render 'shared/frazione', num: 16, den: 15 %>
            </div>

            <div class="flex items-center gap-1">
              <%= render 'shared/frazione', num: 12, den: 17 %>
              <input type="text" data-correct-answer="<" class="w-8 px-1 py-1 border-2 border-pink-400 rounded text-center font-bold bg-white">
              <%= render 'shared/frazione', num: 12, den: 15 %>
            </div>

            <div class="flex items-center gap-1">
              <%= render 'shared/frazione', num: 18, den: 21 %>
              <input type="text" data-correct-answer=">" class="w-8 px-1 py-1 border-2 border-pink-400 rounded text-center font-bold bg-white">
              <%= render 'shared/frazione', num: 18, den: 25 %>
            </div>

            <div class="flex items-center gap-1">
              <%= render 'shared/frazione', num: 7, den: 8 %>
              <input type="text" data-correct-answer=">" class="w-8 px-1 py-1 border-2 border-pink-400 rounded text-center font-bold bg-white">
              <%= render 'shared/frazione', num: 5, den: 9 %>
            </div>

            <div class="flex items-center gap-1">
              <%= render 'shared/frazione', num: 4, den: 8 %>
              <input type="text" data-correct-answer="=" class="w-8 px-1 py-1 border-2 border-pink-400 rounded text-center font-bold bg-white">
              <%= render 'shared/frazione', num: 12, den: 24 %>
            </div>

            <div class="flex items-center gap-1">
              <%= render 'shared/frazione', num: 16, den: 24 %>
              <input type="text" data-correct-answer=">" class="w-8 px-1 py-1 border-2 border-pink-400 rounded text-center font-bold bg-white">
              <%= render 'shared/frazione', num: 3, den: 24 %>
            </div>
          </div>
        </div>
      </div>

      <!-- Colonna destra -->
      <div class="space-y-6">
        <!-- Esercizio 5 -->
        <div class="p-4 relative" data-controller="flower-matcher">
          <div class="mb-4">
            <p class="font-bold text-gray-700">
              <%= numero_esercizio_badge(5) %>
              Collega le coppie di frazioni equivalenti.
            </p>
          </div>

          <!-- SVG Canvas per le linee -->
          <svg class="absolute top-0 left-0 w-full h-full pointer-events-none z-10"
               data-flower-matcher-target="canvas">
          </svg>

          <div class="relative space-y-4">
            <!-- Riga superiore -->
            <div class="grid grid-cols-7 gap-1 text-sm">
              <div class="p-2 bg-blue-50 rounded text-center cursor-pointer hover:bg-blue-100 transition"
                   data-action="click->flower-matcher#selectFlower"
                   data-flower-matcher-target="flower"
                   data-flower-id="top-1"
                   data-pair="a">
                <%= render 'shared/frazione', num: 2, den: 5 %>
              </div>
              <div class="p-2 bg-blue-50 rounded text-center cursor-pointer hover:bg-blue-100 transition"
                   data-action="click->flower-matcher#selectFlower"
                   data-flower-matcher-target="flower"
                   data-flower-id="top-2"
                   data-pair="b">
                <%= render 'shared/frazione', num: 3, den: 7 %>
              </div>
              <div class="p-2 bg-blue-50 rounded text-center cursor-pointer hover:bg-blue-100 transition"
                   data-action="click->flower-matcher#selectFlower"
                   data-flower-matcher-target="flower"
                   data-flower-id="top-3"
                   data-pair="c">
                <%= render 'shared/frazione', num: 8, den: 12 %>
              </div>
              <div class="p-2 bg-blue-50 rounded text-center cursor-pointer hover:bg-blue-100 transition"
                   data-action="click->flower-matcher#selectFlower"
                   data-flower-matcher-target="flower"
                   data-flower-id="top-4"
                   data-pair="d">
                <%= render 'shared/frazione', num: 1, den: 9 %>
              </div>
              <div class="p-2 bg-blue-50 rounded text-center cursor-pointer hover:bg-blue-100 transition"
                   data-action="click->flower-matcher#selectFlower"
                   data-flower-matcher-target="flower"
                   data-flower-id="top-5"
                   data-pair="e">
                <%= render 'shared/frazione', num: 5, den: 8 %>
              </div>
              <div class="p-2 bg-blue-50 rounded text-center cursor-pointer hover:bg-blue-100 transition"
                   data-action="click->flower-matcher#selectFlower"
                   data-flower-matcher-target="flower"
                   data-flower-id="top-6"
                   data-pair="f">
                <%= render 'shared/frazione', num: 30, den: 50 %>
              </div>
              <div class="p-2 bg-blue-50 rounded text-center cursor-pointer hover:bg-blue-100 transition"
                   data-action="click->flower-matcher#selectFlower"
                   data-flower-matcher-target="flower"
                   data-flower-id="top-7"
                   data-pair="g">
                <%= render 'shared/frazione', num: 4, den: 22 %>
              </div>
            </div>

            <!-- Riga inferiore -->
            <div class="grid grid-cols-7 gap-1 text-sm">
              <div class="p-2 bg-green-50 rounded text-center cursor-pointer hover:bg-green-100 transition"
                   data-action="click->flower-matcher#selectFlower"
                   data-flower-matcher-target="flower"
                   data-flower-id="bot-1"
                   data-pair="c">
                <%= render 'shared/frazione', num: 4, den: 6 %>
              </div>
              <div class="p-2 bg-green-50 rounded text-center cursor-pointer hover:bg-green-100 transition"
                   data-action="click->flower-matcher#selectFlower"
                   data-flower-matcher-target="flower"
                   data-flower-id="bot-2"
                   data-pair="e">
                <%= render 'shared/frazione', num: 10, den: 16 %>
              </div>
              <div class="p-2 bg-green-50 rounded text-center cursor-pointer hover:bg-green-100 transition"
                   data-action="click->flower-matcher#selectFlower"
                   data-flower-matcher-target="flower"
                   data-flower-id="bot-3"
                   data-pair="a">
                <%= render 'shared/frazione', num: 4, den: 10 %>
              </div>
              <div class="p-2 bg-green-50 rounded text-center cursor-pointer hover:bg-green-100 transition"
                   data-action="click->flower-matcher#selectFlower"
                   data-flower-matcher-target="flower"
                   data-flower-id="bot-4"
                   data-pair="f">
                <%= render 'shared/frazione', num: 3, den: 5 %>
              </div>
              <div class="p-2 bg-green-50 rounded text-center cursor-pointer hover:bg-green-100 transition"
                   data-action="click->flower-matcher#selectFlower"
                   data-flower-matcher-target="flower"
                   data-flower-id="bot-5"
                   data-pair="b">
                <%= render 'shared/frazione', num: 9, den: 21 %>
              </div>
              <div class="p-2 bg-green-50 rounded text-center cursor-pointer hover:bg-green-100 transition"
                   data-action="click->flower-matcher#selectFlower"
                   data-flower-matcher-target="flower"
                   data-flower-id="bot-6"
                   data-pair="g">
                <%= render 'shared/frazione', num: 2, den: 11 %>
              </div>
              <div class="p-2 bg-green-50 rounded text-center cursor-pointer hover:bg-green-100 transition"
                   data-action="click->flower-matcher#selectFlower"
                   data-flower-matcher-target="flower"
                   data-flower-id="bot-7"
                   data-pair="d">
                <%= render 'shared/frazione', num: 3, den: 27 %>
              </div>
            </div>
          </div>
        </div>

        <!-- Esercizio 6 -->
        <div class="p-4">
          <div class="mb-4">
            <p class="font-bold text-gray-700">
              <%= numero_esercizio_badge(6) %>
              Scrivi le frazioni decimali sotto forma di percentuale.
            </p>
          </div>

          <div class="flex flex-wrap gap-4">
            <div class="flex items-center gap-2">
              <%= render 'shared/frazione', num: 66, den: 100 %>
              <span>=</span>
              <input type="text" data-correct-answer="66" class="w-14 px-2 py-1 border-2 border-pink-400 rounded text-center font-bold bg-white">
              <span>%</span>
            </div>

            <div class="flex items-center gap-2">
              <%= render 'shared/frazione', num: 81, den: 100 %>
              <span>=</span>
              <input type="text" data-correct-answer="81" class="w-14 px-2 py-1 border-2 border-pink-400 rounded text-center font-bold bg-white">
              <span>%</span>
            </div>

            <div class="flex items-center gap-2">
              <%= render 'shared/frazione', num: 15, den: 100 %>
              <span>=</span>
              <input type="text" data-correct-answer="15" class="w-14 px-2 py-1 border-2 border-pink-400 rounded text-center font-bold bg-white">
              <span>%</span>
            </div>
          </div>
        </div>

        <!-- Esercizio 7 -->
        <div class="p-4">
          <div class="mb-4">
            <p class="font-bold text-gray-700">
              <%= numero_esercizio_badge(7) %>
              Scrivi le percentuali sotto forma di frazioni decimali.
            </p>
          </div>

          <div class="flex flex-wrap gap-4">
            <div class="flex items-center gap-2">
              <span>63% =</span>
              <%= render 'shared/frazione', num: nil, den: 100, num_answer: "63" %>
            </div>

            <div class="flex items-center gap-2">
              <span>9% =</span>
              <%= render 'shared/frazione', num: nil, den: 100, num_answer: "9" %>
            </div>

            <div class="flex items-center gap-2">
              <span>38% =</span>
              <%= render 'shared/frazione', num: nil, den: 100, num_answer: "38" %>
            </div>
          </div>
        </div>

        <!-- Esercizio 8 -->
        <div class="p-4">
          <div class="mb-4">
            <p class="font-bold text-gray-700">
              <%= numero_esercizio_badge(8) %>
              Calcola il valore delle percentuali.
            </p>
          </div>

          <div class="space-y-2">
            <div class="flex items-center gap-3">
              <span>15% di 300 →</span>
              <input type="text" data-correct-answer="45" class="w-20 px-2 py-1 border-2 border-pink-400 rounded text-center font-bold bg-white">
            </div>
            <div class="flex items-center gap-3">
              <span>50% di 1200 →</span>
              <input type="text" data-correct-answer="600" class="w-20 px-2 py-1 border-2 border-pink-400 rounded text-center font-bold bg-white">
            </div>
            <div class="flex items-center gap-3">
              <span>30% di 1350 →</span>
              <input type="text" data-correct-answer="405" class="w-20 px-2 py-1 border-2 border-pink-400 rounded text-center font-bold bg-white">
            </div>
            <div class="flex items-center gap-3">
              <span>6% di 3600 →</span>
              <input type="text" data-correct-answer="216" class="w-20 px-2 py-1 border-2 border-pink-400 rounded text-center font-bold bg-white">
            </div>
          </div>
        </div>

        <!-- Esercizio 9 -->
        <div class="p-4">
          <div class="mb-4">
            <p class="font-bold text-gray-700">
              <%= numero_esercizio_badge(9) %>
              Calcola il valore dell'intero.
            </p>
          </div>

          <div class="space-y-2">
            <div class="flex items-center gap-3">
              <span>27 è il 10% di? →</span>
              <input type="text" data-correct-answer="270" class="w-20 px-2 py-1 border-2 border-pink-400 rounded text-center font-bold bg-white">
            </div>
            <div class="flex items-center gap-3">
              <span>45 è il 15% di? →</span>
              <input type="text" data-correct-answer="300" class="w-20 px-2 py-1 border-2 border-pink-400 rounded text-center font-bold bg-white">
            </div>
            <div class="flex items-center gap-3">
              <span>36 è il 12% di? →</span>
              <input type="text" data-correct-answer="300" class="w-20 px-2 py-1 border-2 border-pink-400 rounded text-center font-bold bg-white">
            </div>
            <div class="flex items-center gap-3">
              <span>63 è il 9% di? →</span>
              <input type="text" data-correct-answer="700" class="w-20 px-2 py-1 border-2 border-pink-400 rounded text-center font-bold bg-white">
            </div>
          </div>
        </div>
      </div>
    </div>

    <%= render 'shared/exercise_controls' %>
  </div>
</div>
