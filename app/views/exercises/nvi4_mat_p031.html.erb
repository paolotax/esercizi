<div class="max-w-6xl mx-auto bg-white p-3 md:p-6"
     data-controller="exercise-checker text-toggle font-controls"
     data-text-toggle-target="content"
     data-font-controls-target="content">

  <%= render 'shared/page_header', pagina: @pagina %>

  <div class="space-y-6">

    <!-- Box Teoria -->
    <div class="p-4 md:p-6 bg-white rounded-3xl border-4 border-blue-800 space-y-4">
      <p class="font-bold text-gray-700">
        <span class="text-<%= @pagina.base_color %>-500">•</span> Leggi e osserva.
      </p>

      <!-- IN RIGA -->
      <div>
        <h3 class="font-bold text-<%= @pagina.base_color %>-600 mb-2">IN RIGA</h3>
        <div class="flex flex-wrap items-center gap-4">
          <p class="text-gray-700 flex-1">
            Sottrai le unità alle unità, le decine alle decine, le centinaia alle centinaia...
          </p>
          <%= image_tag "nvi4_mat/p031/p031_01.jpg", alt: "379 - 54 = 325", class: "shrink-0" %>
        </div>
      </div>

      <!-- IN COLONNA -->
      <div>
        <h3 class="font-bold text-<%= @pagina.base_color %>-600 mb-2">IN COLONNA</h3>
        <p class="text-gray-700 mb-3">
          Quando esegui la sottrazione è necessario mettere in colonna rispettando il <span class="font-bold">valore posizionale</span> delle cifre. Poi si calcola a partire dalle unità.<br>
          Quando la cifra del minuendo è minore della cifra corrispondente del sottraendo, si deve fare un <span class="font-bold">cambio</span>.
        </p>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
          <!-- Senza cambio -->
          <div>
            <p class="font-bold text-<%= @pagina.base_color %>-600 mb-2 text-center">Senza cambio</p>
            <%= render 'strumenti/sottrazioni/column_subtraction',
                sottrazione: Sottrazione.new(minuend: 379, subtrahend: 54, show_minuend_subtrahend: true, show_solution: true, show_borrow: false, show_toolbar: false) %>
          </div>

          <!-- Con il cambio -->
          <div>
            <p class="font-bold text-<%= @pagina.base_color %>-600 mb-2 text-center">Con il cambio</p>
            <%= render 'strumenti/sottrazioni/column_subtraction',
                sottrazione: Sottrazione.new(minuend: 532, subtrahend: 175, show_minuend_subtrahend: true, show_solution: true, show_borrow: true, show_toolbar: false) %>
          </div>

          <!-- AllenaMente -->
          <div class="p-3 bg-white rounded-2xl border-3 border-blue-400">
            <p class="font-bold text-gray-800 mb-2">
              <span class="bg-yellow-400 px-2 py-1 rounded">AllenaMente!</span>
            </p>
            <p class="text-gray-700 mb-2">
              Al luna park Giulia, Lin e Sara hanno vinto 9 pupazzetti. Giulia ne ha vinti 2 in meno di Sara e Sara 2 in meno di Lin.<br>
              Quanti pupazzetti ha vinto ciascuna bambina?
            </p>
            <div class="space-y-2">
              <div class="flex items-center gap-2">
                <span class="shrink-0">Lin:</span>
                <input type="text" data-correct-answer="5" class="w-16 border-b-2 border-dotted border-gray-400 text-center font-bold bg-transparent">
                <span class="shrink-0">pupazzetti</span>
              </div>
              <div class="flex items-center gap-2">
                <span class="shrink-0">Sara:</span>
                <input type="text" data-correct-answer="3" class="w-16 border-b-2 border-dotted border-gray-400 text-center font-bold bg-transparent">
                <span class="shrink-0">pupazzetti</span>
              </div>
              <div class="flex items-center gap-2">
                <span class="shrink-0">Giulia:</span>
                <input type="text" data-correct-answer="1" class="w-16 border-b-2 border-dotted border-gray-400 text-center font-bold bg-transparent">
                <span class="shrink-0">pupazzetti</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ESERCIZI -->
    <div class="p-4 md:p-6 bg-orange-100 rounded-2xl">

      <!-- Esercizio 1 - IMPARARE TUTTI -->
      <div class="mb-8">
        <p class="font-bold text-gray-700 mb-4">
          <%= imparare_tutti_badge(1) %>
          Calcola in riga. Fai attenzione agli eventuali cambi.
        </p>

        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
          <div class="flex items-center gap-2">
            <span class="shrink-0">974 − 520 =</span>
            <input type="text" data-correct-answer="454" class="w-20 border-b-2 border-dotted border-gray-400 text-center font-bold bg-transparent">
          </div>
          <div class="flex items-center gap-2">
            <span class="shrink-0">573 − 147 =</span>
            <input type="text" data-correct-answer="426" class="w-20 border-b-2 border-dotted border-gray-400 text-center font-bold bg-transparent">
          </div>
          <div class="flex items-center gap-2">
            <span class="shrink-0 whitespace-nowrap">2 369 − 1 138 =</span>
            <input type="text" data-correct-answer="1231" class="w-20 border-b-2 border-dotted border-gray-400 text-center font-bold bg-transparent">
          </div>
          <div class="flex items-center gap-2">
            <span class="shrink-0 whitespace-nowrap">4 426 − 1 210 =</span>
            <input type="text" data-correct-answer="3216" class="w-20 border-b-2 border-dotted border-gray-400 text-center font-bold bg-transparent">
          </div>
          <div class="flex items-center gap-2">
            <span class="shrink-0">678 − 245 =</span>
            <input type="text" data-correct-answer="433" class="w-20 border-b-2 border-dotted border-gray-400 text-center font-bold bg-transparent">
          </div>
          <div class="flex items-center gap-2">
            <span class="shrink-0">428 − 273 =</span>
            <input type="text" data-correct-answer="155" class="w-20 border-b-2 border-dotted border-gray-400 text-center font-bold bg-transparent">
          </div>
          <div class="flex items-center gap-2">
            <span class="shrink-0 whitespace-nowrap">3 848 − 2 408 =</span>
            <input type="text" data-correct-answer="1440" class="w-20 border-b-2 border-dotted border-gray-400 text-center font-bold bg-transparent">
          </div>
          <div class="flex items-center gap-2">
            <span class="shrink-0 whitespace-nowrap">7 660 − 4 324 =</span>
            <input type="text" data-correct-answer="3336" class="w-20 border-b-2 border-dotted border-gray-400 text-center font-bold bg-transparent">
          </div>
        </div>
      </div>

      <!-- Esercizio 2 -->
      <div class="mb-8">
        <p class="font-bold text-gray-700 mb-4">
          <%= numero_esercizio_badge(2) %>
          Trova la regola e completa le sequenze.
        </p>

        <!-- Sequenza 1: 479, 475, 471, ..., 447 (regola: -4) -->
        <div class="mb-4">
          <div class="flex flex-wrap items-center gap-2">
            <span class="px-3 py-2 border border-gray-300 bg-white font-bold">479</span>
            <span class="text-<%= @pagina.base_color %>-500">→</span>
            <span class="px-3 py-2 border border-gray-300 bg-white font-bold">475</span>
            <span class="text-<%= @pagina.base_color %>-500">→</span>
            <span class="px-3 py-2 border border-gray-300 bg-white font-bold">471</span>
            <span class="text-<%= @pagina.base_color %>-500">→</span>
            <input type="text" data-correct-answer="467" class="w-16 px-2 py-2 border border-gray-300 bg-white text-center font-bold">
            <span class="text-<%= @pagina.base_color %>-500">→</span>
            <input type="text" data-correct-answer="463" class="w-16 px-2 py-2 border border-gray-300 bg-white text-center font-bold">
            <span class="text-<%= @pagina.base_color %>-500">→</span>
            <input type="text" data-correct-answer="459" class="w-16 px-2 py-2 border border-gray-300 bg-white text-center font-bold">
            <span class="text-<%= @pagina.base_color %>-500">→</span>
            <input type="text" data-correct-answer="455" class="w-16 px-2 py-2 border border-gray-300 bg-white text-center font-bold">
            <span class="text-<%= @pagina.base_color %>-500">→</span>
            <input type="text" data-correct-answer="451" class="w-16 px-2 py-2 border border-gray-300 bg-white text-center font-bold">
            <span class="text-<%= @pagina.base_color %>-500">→</span>
            <span class="px-3 py-2 border border-gray-300 bg-white font-bold">447</span>
          </div>
        </div>

        <!-- Sequenza 2: 1851, ..., 1847, 1845, ..., 1835 (regola: -2) -->
        <div>
          <div class="flex flex-wrap items-center gap-2">
            <span class="px-3 py-2 border border-gray-300 bg-white font-bold whitespace-nowrap">1 851</span>
            <span class="text-<%= @pagina.base_color %>-500">→</span>
            <input type="text" data-correct-answer="1849" class="w-16 px-2 py-2 border border-gray-300 bg-white text-center font-bold">
            <span class="text-<%= @pagina.base_color %>-500">→</span>
            <span class="px-3 py-2 border border-gray-300 bg-white font-bold whitespace-nowrap">1 847</span>
            <span class="text-<%= @pagina.base_color %>-500">→</span>
            <span class="px-3 py-2 border border-gray-300 bg-white font-bold whitespace-nowrap">1 845</span>
            <span class="text-<%= @pagina.base_color %>-500">→</span>
            <input type="text" data-correct-answer="1843" class="w-16 px-2 py-2 border border-gray-300 bg-white text-center font-bold">
            <span class="text-<%= @pagina.base_color %>-500">→</span>
            <input type="text" data-correct-answer="1841" class="w-16 px-2 py-2 border border-gray-300 bg-white text-center font-bold">
            <span class="text-<%= @pagina.base_color %>-500">→</span>
            <input type="text" data-correct-answer="1839" class="w-16 px-2 py-2 border border-gray-300 bg-white text-center font-bold">
            <span class="text-<%= @pagina.base_color %>-500">→</span>
            <input type="text" data-correct-answer="1837" class="w-16 px-2 py-2 border border-gray-300 bg-white text-center font-bold">
            <span class="text-<%= @pagina.base_color %>-500">→</span>
            <span class="px-3 py-2 border border-gray-300 bg-white font-bold whitespace-nowrap">1 835</span>
          </div>
        </div>
      </div>

      <!-- Esercizio 3 -->
      <div>
        <p class="font-bold text-gray-700 mb-4">
          <%= numero_esercizio_badge(3) %>
          Calcola in colonna sul quaderno.
        </p>

        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
          <div class="flex items-center gap-2">
            <span class="shrink-0">865 − 651 =</span>
            <input type="text" data-correct-answer="214" class="w-20 border-b-2 border-dotted border-gray-400 text-center font-bold bg-transparent">
          </div>
          <div class="flex items-center gap-2">
            <span class="shrink-0 whitespace-nowrap">2 578 − 368 =</span>
            <input type="text" data-correct-answer="2210" class="w-20 border-b-2 border-dotted border-gray-400 text-center font-bold bg-transparent">
          </div>
          <div class="flex items-center gap-2">
            <span class="shrink-0">940 − 574 =</span>
            <input type="text" data-correct-answer="366" class="w-20 border-b-2 border-dotted border-gray-400 text-center font-bold bg-transparent">
          </div>
          <div class="flex items-center gap-2">
            <span class="shrink-0 whitespace-nowrap">1 358 − 239 =</span>
            <input type="text" data-correct-answer="1119" class="w-20 border-b-2 border-dotted border-gray-400 text-center font-bold bg-transparent">
          </div>
          <div class="flex items-center gap-2">
            <span class="shrink-0 whitespace-nowrap">3 051 − 984 =</span>
            <input type="text" data-correct-answer="2067" class="w-20 border-b-2 border-dotted border-gray-400 text-center font-bold bg-transparent">
          </div>
          <div class="flex items-center gap-2">
            <span class="shrink-0 whitespace-nowrap">2 589 − 904 =</span>
            <input type="text" data-correct-answer="1685" class="w-20 border-b-2 border-dotted border-gray-400 text-center font-bold bg-transparent">
          </div>
          <div class="flex items-center gap-2">
            <span class="shrink-0 whitespace-nowrap">4 072 − 2 364 =</span>
            <input type="text" data-correct-answer="1708" class="w-20 border-b-2 border-dotted border-gray-400 text-center font-bold bg-transparent">
          </div>
          <div class="flex items-center gap-2">
            <span class="shrink-0 whitespace-nowrap">8 310 − 2 555 =</span>
            <input type="text" data-correct-answer="5755" class="w-20 border-b-2 border-dotted border-gray-400 text-center font-bold bg-transparent">
          </div>
          <div class="flex items-center gap-2">
            <span class="shrink-0 whitespace-nowrap">7 309 − 3 898 =</span>
            <input type="text" data-correct-answer="3411" class="w-20 border-b-2 border-dotted border-gray-400 text-center font-bold bg-transparent">
          </div>
          <div class="flex items-center gap-2">
            <span class="shrink-0 whitespace-nowrap">2 740 − 1 909 =</span>
            <input type="text" data-correct-answer="831" class="w-20 border-b-2 border-dotted border-gray-400 text-center font-bold bg-transparent">
          </div>
        </div>
      </div>

    </div>

    <%= render 'shared/quaderno_link', pagine: [182] %>

    <%= render 'shared/exercise_controls' %>
  </div>
</div>
