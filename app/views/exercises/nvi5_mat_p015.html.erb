<div class="max-w-6xl mx-auto bg-white dark:bg-gray-900 text-black dark:text-white p-3 md:p-6 transition-colors duration-300"
     data-controller="exercise-checker text-toggle font-controls"
     data-text-toggle-target="content"
     data-font-controls-target="content">

  <!-- Header -->
  <%= render 'shared/page_header', pagina: @pagina %>

  <div class="space-y-6">
    <!-- Problema iniziale -->
    <div class="p-4 md:p-6 bg-custom-blue-light dark:bg-cyan-900/40 rounded-lg">
      <p class="text-gray-800 dark:text-gray-200 leading-relaxed mb-3">
        Laura e Giulia hanno partecipato a una gara di ginnastica ritmica organizzata a scuola.
        Il voto della gara è stato <span class="font-bold text-custom-sky dark:text-cyan-400">9,28</span> per Laura e <span class="font-bold text-custom-sky dark:text-cyan-400">9,73</span> per Giulia.
      </p>
      <p class="text-gray-800 dark:text-gray-200 leading-relaxed">
        L'insegnante vuole inserire i voti nel registro, ma può inserire solo numeri con una cifra
        decimale, non con due. Quali numeri inserirà l'insegnante?
      </p>
    </div>

    <!-- Spiegazione -->
    <div class="p-4 md:p-6 bg-white dark:bg-gray-800 border-3 border-blue-500 dark:border-blue-400 rounded-3xl">
      <p class="text-gray-800 dark:text-gray-200 mb-4">
        Poiché i voti non possono essere inseriti così come sono, occorre fare delle <span class="font-bold">approssimazioni</span>
        (<span class="font-bold">arrotondamenti</span>), cioè sostituire i numeri esatti con numeri "più semplici", ma il più possibile vicini
        a quelli esatti.
      </p>
      <p class="text-gray-800 dark:text-gray-200 font-semibold mb-3">
        Per approssimare dobbiamo seguire alcune regole.
      </p>

      <div class="space-y-3">
        <!-- Regola 1 -->
        <p class="text-gray-800 dark:text-gray-200">
          <span class="text-blue-600 dark:text-blue-400 font-bold">&#9654;</span> Innanzitutto dobbiamo stabilire <span class="font-bold">il valore al quale vogliamo arrotondare il numero</span>;
          nel nostro caso i decimi.
        </p>

        <!-- Regola 2 con box rosa allineato -->
        <div class="flex flex-col md:flex-row gap-4">
          <div class="flex-1">
            <p class="text-gray-800 dark:text-gray-200 mb-3">
              <span class="text-blue-600 dark:text-blue-400 font-bold">&#9654;</span> Poi dobbiamo osservare la prima cifra che non scriveremo più; nel nostro caso i centesimi:
            </p>

            <div class="ml-6 space-y-3">
              <p class="text-gray-700 dark:text-gray-300">
                – se essa è <span class="font-bold">maggiore di 5</span>, facciamo un <span class="font-bold">arrotondamento per eccesso</span>,
                cioè aumentiamo di 1 l'ultima cifra considerata (nel nostro caso i decimi) e sostituiamo con zero le cifre successive.
              </p>
              <p class="text-gray-700 dark:text-gray-300 italic pl-4">
                Laura ha ottenuto 9,2<span class="font-bold text-custom-sky dark:text-cyan-400">8</span> che arrotondiamo per eccesso a <span class="font-bold">9,3</span>.
              </p>

              <p class="text-gray-700 dark:text-gray-300">
                – se essa è <span class="font-bold">minore di 5</span>, facciamo un <span class="font-bold">arrotondamento per difetto</span>,
                cioè sostituiamo con zero le cifre successive a quella considerata.
              </p>
              <p class="text-gray-700 dark:text-gray-300 italic pl-4">
                Giulia ha ottenuto 9,7<span class="font-bold text-custom-sky dark:text-cyan-400">3</span> che arrotondiamo per difetto a <span class="font-bold">9,7</span>.
              </p>

              <p class="text-gray-700 dark:text-gray-300">
                – se essa è <span class="font-bold">uguale a 5</span>, possiamo arrotondare per eccesso o per difetto.
              </p>
            </div>
          </div>

          <!-- Box nota allineato a destra -->
          <div class="md:w-64 self-end">
            <div class="p-3 bg-pink-100 dark:bg-pink-900/30 rounded-lg">
              <p class="text-gray-700 dark:text-gray-300">
                Quando arrotondiamo <span class="font-bold">per eccesso</span>, il numero approssimato è <span class="font-bold">maggiore</span> del numero esatto; quando arrotondiamo <span class="font-bold">per difetto</span>, il numero approssimato è <span class="font-bold">minore</span> del numero esatto.
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Risposta -->
    <div class="p-4 md:p-6">
      <p class="text-gray-800 dark:text-gray-200">
        Ora puoi rispondere: <span class="bg-custom-blue-light dark:bg-cyan-900/40 px-2 py-1 rounded">L'insegnante inserirà <span class="font-bold">9,7</span> per Giulia e <span class="font-bold">9,3</span> per Laura.</span>
      </p>
    </div>

    <!-- Sezione ESERCIZI -->
    <div class="p-4 md:p-6 bg-orange-100 dark:bg-orange-900/30 rounded-lg">
      <h2 class="font-bold text-pink-600 dark:text-pink-400 mb-6">ESERCIZI</h2>

      <div class="space-y-6">
        <!-- Exercise 1: Arrotonda ai decimi -->
        <div data-controller="word-highlighter" data-word-highlighter-multi-color-value="true">
          <div class="flex items-start gap-3 mb-4">
            <%= numero_esercizio_badge(1) %>
            <p class="font-bold text-gray-700 dark:text-gray-200">
              Arrotonda ai decimi i seguenti numeri. Poi cerchia con il
              <span class="text-red-600 dark:text-red-400">rosso<span class="inline-block w-4 h-4 bg-red-300 dark:bg-red-600 rounded-full ml-1 align-middle cursor-pointer transition transform hover:scale-110" data-word-highlighter-target="colorBox" data-color="red" data-action="click->word-highlighter#selectColor"></span></span>
              quelli che hai arrotondato per eccesso e in
              <span class="text-blue-600 dark:text-blue-400">blu<span class="inline-block w-4 h-4 bg-blue-300 dark:bg-blue-600 rounded-full ml-1 align-middle cursor-pointer transition transform hover:scale-110" data-word-highlighter-target="colorBox" data-color="blue" data-action="click->word-highlighter#selectColor"></span></span>
              quelli che hai arrotondato per difetto.
            </p>
          </div>
          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 ml-11">
            <% [
              { num: "3,14", answer: "3,1", correct: "blue" },
              { num: "18,25", answer: "18,3", correct: "red" },
              { num: "4,44", answer: "4,4", correct: "blue" },
              { num: "12,356", answer: "12,4", correct: "red" },
              { num: "33,235", answer: "33,2", correct: "blue" },
              { num: "6,38", answer: "6,4", correct: "red" }
            ].each do |item| %>
              <div class="flex items-center gap-2">
                <span data-word-highlighter-target="word" data-correct="<%= item[:correct] %>" data-action="click->word-highlighter#toggleHighlight" class="text-gray-700 dark:text-gray-200 cursor-pointer transition px-1"><%= item[:num] %></span>
                <span class="text-pink-600 dark:text-pink-400">→</span>
                <input type="text" data-correct-answer="<%= item[:answer] %>" class="w-16 px-2 py-1 border-b-2 border-dotted border-gray-400 dark:border-gray-500 bg-transparent dark:text-white text-center" placeholder="...">
              </div>
            <% end %>
          </div>
        </div>

        <!-- Exercise 2: Arrotonda all'unità -->
        <div data-controller="word-highlighter" data-word-highlighter-multi-color-value="true">
          <div class="flex items-start gap-3 mb-4">
            <%= numero_esercizio_badge(2) %>
            <p class="font-bold text-gray-700 dark:text-gray-200">
              Arrotonda all'unità i seguenti numeri. Poi cerchia con il
              <span class="text-red-600 dark:text-red-400">rosso<span class="inline-block w-4 h-4 bg-red-300 dark:bg-red-600 rounded-full ml-1 align-middle cursor-pointer transition transform hover:scale-110" data-word-highlighter-target="colorBox" data-color="red" data-action="click->word-highlighter#selectColor"></span></span>
              quelli che hai arrotondato per eccesso e in
              <span class="text-blue-600 dark:text-blue-400">blu<span class="inline-block w-4 h-4 bg-blue-300 dark:bg-blue-600 rounded-full ml-1 align-middle cursor-pointer transition transform hover:scale-110" data-word-highlighter-target="colorBox" data-color="blue" data-action="click->word-highlighter#selectColor"></span></span>
              quelli che hai arrotondato per difetto.
            </p>
          </div>
          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 ml-11">
            <% [
              { num: "14,8", answer: "15", correct: "red" },
              { num: "5,61", answer: "6", correct: "red" },
              { num: "24,18", answer: "24", correct: "blue" },
              { num: "45,23", answer: "45", correct: "blue" },
              { num: "18,234", answer: "18", correct: "blue" },
              { num: "23,843", answer: "24", correct: "red" }
            ].each do |item| %>
              <div class="flex items-center gap-2">
                <span data-word-highlighter-target="word" data-correct="<%= item[:correct] %>" data-action="click->word-highlighter#toggleHighlight" class="text-gray-700 dark:text-gray-200 cursor-pointer transition px-1"><%= item[:num] %></span>
                <span class="text-pink-600 dark:text-pink-400">→</span>
                <input type="text" data-correct-answer="<%= item[:answer] %>" class="w-16 px-2 py-1 border-b-2 border-dotted border-gray-400 dark:border-gray-500 bg-transparent dark:text-white text-center" placeholder="...">
              </div>
            <% end %>
          </div>
        </div>
      </div>
    </div>

    <!-- Exercise Controls -->
    <%= render 'shared/exercise_controls' %>
  </div>
</div>
