<div class="max-w-6xl mx-auto bg-white dark:bg-gray-900 text-black dark:text-white p-3 md:p-6 transition-colors duration-300"
     data-controller="exercise-checker text-toggle font-controls"
     data-text-toggle-target="content"
     data-font-controls-target="content">

  <%= render 'shared/page_header', pagina: @pagina %>

  <!-- Esercizio 1: Trasforma dalla forma attiva alla forma passiva -->
  <div class="mb-6 bg-white dark:bg-gray-800 rounded-2xl border-4 border-yellow-200 dark:border-yellow-700 shadow-2xl p-4 md:p-6" data-controller="fill-blanks">
    <h2 class="font-bold text-gray-700 dark:text-gray-200 mb-4">
      <span class="bg-yellow-600 text-white rounded-full w-8 h-8 md:w-10 md:h-10 inline-flex items-center justify-center mr-2">1</span>
      <span class="bg-yellow-400 dark:bg-yellow-500 text-blue-800 dark:text-blue-900 px-2 py-1 rounded font-bold mr-2">IMPARARE TUTTI</span>
      Trasforma le frasi cambiando il verbo dalla <strong class="underline text-blue-600 dark:text-blue-400">forma attiva</strong> alla <strong class="underline text-red-600 dark:text-red-400">forma passiva</strong>.
    </h2>

    <div class="space-y-4">
      <!-- Esempio completato -->
      <div class="bg-blue-50 dark:bg-blue-900/30 border-2 border-blue-300 dark:border-blue-700 rounded-xl p-4">
        <div class="mb-2">
          <span class="text-gray-700 dark:text-gray-200">• Il muratore → <span class="bg-blue-200 dark:bg-blue-800 px-2 py-1 rounded">ripara</span> → il muro.</span>
        </div>
        <div class="flex items-center gap-2">
          <span class="text-gray-700 dark:text-gray-200">Il muro ← <span class="bg-red-200 dark:bg-red-800 px-2 py-1 rounded font-bold">è riparato</span> ← dal muratore.</span>
        </div>
      </div>

      <!-- Esercizio 1 -->
      <div class="bg-gray-50 dark:bg-gray-800 border-2 border-gray-200 dark:border-gray-700 rounded-xl p-4">
        <div class="mb-2">
          <span class="text-gray-700 dark:text-gray-200">• Mattia beve l'aranciata.</span>
        </div>
        <div class="flex flex-wrap items-center gap-2">
          <span class="text-gray-700 dark:text-gray-200">L'aranciata ←</span>
          <input type="text" class="border-b-2 border-yellow-400 dark:border-yellow-600 bg-transparent dark:text-white px-2 py-1 focus:outline-none focus:border-yellow-600 dark:focus:border-yellow-400 w-40" data-fill-blanks-target="input" data-correct-answer="è bevuta" placeholder="">
          <span class="text-gray-700 dark:text-gray-200">← da Mattia.</span>
        </div>
      </div>

      <!-- Esercizio 2 -->
      <div class="bg-gray-50 dark:bg-gray-800 border-2 border-gray-200 dark:border-gray-700 rounded-xl p-4">
        <div class="mb-2">
          <span class="text-gray-700 dark:text-gray-200">• Gli investigatori hanno scoperto il colpevole.</span>
        </div>
        <div class="flex flex-wrap items-center gap-2">
          <span class="text-gray-700 dark:text-gray-200">Il colpevole ←</span>
          <input type="text" class="border-b-2 border-yellow-400 dark:border-yellow-600 bg-transparent dark:text-white px-2 py-1 focus:outline-none focus:border-yellow-600 dark:focus:border-yellow-400 w-48" data-fill-blanks-target="input" data-correct-answer="è stato scoperto" placeholder="">
          <span class="text-gray-700 dark:text-gray-200">← dagli investigatori.</span>
        </div>
      </div>

      <!-- Esercizio 3 -->
      <div class="bg-gray-50 dark:bg-gray-800 border-2 border-gray-200 dark:border-gray-700 rounded-xl p-4">
        <div class="mb-2">
          <span class="text-gray-700 dark:text-gray-200">• Un architetto ha arredato l'appartamento.</span>
        </div>
        <div class="flex flex-wrap items-center gap-2">
          <span class="text-gray-700 dark:text-gray-200">L'appartamento ←</span>
          <input type="text" class="border-b-2 border-yellow-400 dark:border-yellow-600 bg-transparent dark:text-white px-2 py-1 focus:outline-none focus:border-yellow-600 dark:focus:border-yellow-400 w-48" data-fill-blanks-target="input" data-correct-answer="è stato arredato" placeholder="">
          <span class="text-gray-700 dark:text-gray-200">← da un architetto.</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Esercizio 2: Sottolinea il verbo e indica forma attiva o passiva -->
  <div class="mb-6 bg-white dark:bg-gray-800 rounded-2xl border-4 border-blue-200 dark:border-blue-700 shadow-2xl p-4 md:p-6" data-controller="word-highlighter multiple-choice" data-word-highlighter-multi-color-value="false">
    <h2 class="font-bold text-gray-700 dark:text-gray-200 mb-4">
      <span class="bg-blue-600 text-white rounded-full w-8 h-8 md:w-10 md:h-10 inline-flex items-center justify-center mr-2">2</span>
      In ogni frase sottolinea il <strong class="underline">verbo<span class="inline-block w-6 h-6 bg-blue-300 dark:bg-blue-600 rounded ml-1 align-middle cursor-pointer transition transform hover:scale-110" data-word-highlighter-target="colorBox" data-color="blue" data-action="click->word-highlighter#selectColor"></span></strong>, poi indica con una X se è declinato alla <strong class="underline text-blue-600 dark:text-blue-400">forma attiva</strong> (A) o alla <strong class="underline text-red-600 dark:text-red-400">forma passiva</strong> (P).
    </h2>

    <!-- Hidden color selector for monocolor mode -->
    <div class="hidden">
      <span data-word-highlighter-target="colorBox" data-color="blue"></span>
    </div>

    <div class="space-y-3">
      <div class="bg-gray-50 dark:bg-gray-800 border-2 border-gray-200 dark:border-gray-700 rounded-xl px-4 py-3">
        <div class="flex items-center justify-between cursor-pointer">
          <span class="text-gray-700 dark:text-gray-200 flex-1">• Sara <span data-word-highlighter-target="word" data-correct="blue" data-action="click->word-highlighter#toggleHighlight" class="px-1 rounded">ha vinto</span> una gara di sci.</span>
          <div class="flex items-center gap-4">
            <label class="flex items-center gap-2 cursor-pointer">
              <input type="radio" name="q1" data-multiple-choice-target="answer" data-correct-answer="true" class="w-5 h-5">
              <span class="font-bold">A</span>
            </label>
            <label class="flex items-center gap-2 cursor-pointer">
              <input type="radio" name="q1" data-multiple-choice-target="answer" data-correct-answer="false" class="w-5 h-5">
              <span class="font-bold">P</span>
            </label>
          </div>
        </div>
      </div>

      <div class="bg-gray-50 dark:bg-gray-800 border-2 border-gray-200 dark:border-gray-700 rounded-xl px-4 py-3">
        <div class="flex items-center justify-between cursor-pointer">
          <span class="text-gray-700 dark:text-gray-200 flex-1">• L'incendio <span data-word-highlighter-target="word" data-correct="blue" data-action="click->word-highlighter#toggleHighlight" class="px-1 rounded">brucia</span> il bosco.</span>
          <div class="flex items-center gap-4">
            <label class="flex items-center gap-2 cursor-pointer">
              <input type="radio" name="q2" data-multiple-choice-target="answer" data-correct-answer="true" class="w-5 h-5">
              <span class="font-bold">A</span>
            </label>
            <label class="flex items-center gap-2 cursor-pointer">
              <input type="radio" name="q2" data-multiple-choice-target="answer" data-correct-answer="false" class="w-5 h-5">
              <span class="font-bold">P</span>
            </label>
          </div>
        </div>
      </div>

      <div class="bg-gray-50 dark:bg-gray-800 border-2 border-gray-200 dark:border-gray-700 rounded-xl px-4 py-3">
        <div class="flex items-center justify-between cursor-pointer">
          <span class="text-gray-700 dark:text-gray-200 flex-1">• Chiara <span data-word-highlighter-target="word" data-correct="blue" data-action="click->word-highlighter#toggleHighlight" class="px-1 rounded">beve</span> una cioccolata calda.</span>
          <div class="flex items-center gap-4">
            <label class="flex items-center gap-2 cursor-pointer">
              <input type="radio" name="q3" data-multiple-choice-target="answer" data-correct-answer="true" class="w-5 h-5">
              <span class="font-bold">A</span>
            </label>
            <label class="flex items-center gap-2 cursor-pointer">
              <input type="radio" name="q3" data-multiple-choice-target="answer" data-correct-answer="false" class="w-5 h-5">
              <span class="font-bold">P</span>
            </label>
          </div>
        </div>
      </div>

      <div class="bg-gray-50 dark:bg-gray-800 border-2 border-gray-200 dark:border-gray-700 rounded-xl px-4 py-3">
        <div class="flex items-center justify-between cursor-pointer">
          <span class="text-gray-700 dark:text-gray-200 flex-1">• La siepe <span data-word-highlighter-target="word" data-correct="blue" data-action="click->word-highlighter#toggleHighlight" class="px-1 rounded">è stata potata</span> ieri.</span>
          <div class="flex items-center gap-4">
            <label class="flex items-center gap-2 cursor-pointer">
              <input type="radio" name="q4" data-multiple-choice-target="answer" data-correct-answer="false" class="w-5 h-5">
              <span class="font-bold">A</span>
            </label>
            <label class="flex items-center gap-2 cursor-pointer">
              <input type="radio" name="q4" data-multiple-choice-target="answer" data-correct-answer="true" class="w-5 h-5">
              <span class="font-bold">P</span>
            </label>
          </div>
        </div>
      </div>

      <div class="bg-gray-50 dark:bg-gray-800 border-2 border-gray-200 dark:border-gray-700 rounded-xl px-4 py-3">
        <div class="flex items-center justify-between cursor-pointer">
          <span class="text-gray-700 dark:text-gray-200 flex-1">• Quel dipinto <span data-word-highlighter-target="word" data-correct="blue" data-action="click->word-highlighter#toggleHighlight" class="px-1 rounded">è stato fatto</span> da mio zio.</span>
          <div class="flex items-center gap-4">
            <label class="flex items-center gap-2 cursor-pointer">
              <input type="radio" name="q5" data-multiple-choice-target="answer" data-correct-answer="false" class="w-5 h-5">
              <span class="font-bold">A</span>
            </label>
            <label class="flex items-center gap-2 cursor-pointer">
              <input type="radio" name="q5" data-multiple-choice-target="answer" data-correct-answer="true" class="w-5 h-5">
              <span class="font-bold">P</span>
            </label>
          </div>
        </div>
      </div>

      <div class="bg-gray-50 dark:bg-gray-800 border-2 border-gray-200 dark:border-gray-700 rounded-xl px-4 py-3">
        <div class="flex items-center justify-between cursor-pointer">
          <span class="text-gray-700 dark:text-gray-200 flex-1">• L'albero <span data-word-highlighter-target="word" data-correct="blue" data-action="click->word-highlighter#toggleHighlight" class="px-1 rounded">fu colpito</span> da un fulmine.</span>
          <div class="flex items-center gap-4">
            <label class="flex items-center gap-2 cursor-pointer">
              <input type="radio" name="q6" data-multiple-choice-target="answer" data-correct-answer="false" class="w-5 h-5">
              <span class="font-bold">A</span>
            </label>
            <label class="flex items-center gap-2 cursor-pointer">
              <input type="radio" name="q6" data-multiple-choice-target="answer" data-correct-answer="true" class="w-5 h-5">
              <span class="font-bold">P</span>
            </label>
          </div>
        </div>
      </div>

      <div class="bg-gray-50 dark:bg-gray-800 border-2 border-gray-200 dark:border-gray-700 rounded-xl px-4 py-3">
        <div class="flex items-center justify-between cursor-pointer">
          <span class="text-gray-700 dark:text-gray-200 flex-1">• La maestra <span data-word-highlighter-target="word" data-correct="blue" data-action="click->word-highlighter#toggleHighlight" class="px-1 rounded">ha letto</span> il mio testo.</span>
          <div class="flex items-center gap-4">
            <label class="flex items-center gap-2 cursor-pointer">
              <input type="radio" name="q7" data-multiple-choice-target="answer" data-correct-answer="true" class="w-5 h-5">
              <span class="font-bold">A</span>
            </label>
            <label class="flex items-center gap-2 cursor-pointer">
              <input type="radio" name="q7" data-multiple-choice-target="answer" data-correct-answer="false" class="w-5 h-5">
              <span class="font-bold">P</span>
            </label>
          </div>
        </div>
      </div>

      <div class="bg-gray-50 dark:bg-gray-800 border-2 border-gray-200 dark:border-gray-700 rounded-xl px-4 py-3">
        <div class="flex items-center justify-between cursor-pointer">
          <span class="text-gray-700 dark:text-gray-200 flex-1">• Un cane <span data-word-highlighter-target="word" data-correct="blue" data-action="click->word-highlighter#toggleHighlight" class="px-1 rounded">abbaiava</span> alla luna.</span>
          <div class="flex items-center gap-4">
            <label class="flex items-center gap-2 cursor-pointer">
              <input type="radio" name="q8" data-multiple-choice-target="answer" data-correct-answer="true" class="w-5 h-5">
              <span class="font-bold">A</span>
            </label>
            <label class="flex items-center gap-2 cursor-pointer">
              <input type="radio" name="q8" data-multiple-choice-target="answer" data-correct-answer="false" class="w-5 h-5">
              <span class="font-bold">P</span>
            </label>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Esercizio 3: Scrivi frasi con forma attiva e passiva -->
  <div class="mb-6 bg-white dark:bg-gray-800 rounded-2xl border-4 border-green-200 dark:border-green-700 shadow-2xl p-4 md:p-6" data-controller="fill-blanks">
    <h2 class="font-bold text-gray-700 dark:text-gray-200 mb-4">
      <span class="bg-green-600 text-white rounded-full w-8 h-8 md:w-10 md:h-10 inline-flex items-center justify-center mr-2">3</span>
      Per ciascuna coppia di parole trova un verbo adatto e scrivi una frase con la <strong class="underline text-blue-600 dark:text-blue-400">forma attiva</strong> (A) e una con la <strong class="underline text-red-600 dark:text-red-400">forma passiva</strong> (P).
    </h2>

    <div class="space-y-6">
      <!-- Coppia 1 -->
      <div class="bg-green-50 dark:bg-green-900/30 border-2 border-green-300 dark:border-green-700 rounded-xl p-4">
        <div class="mb-3">
          <span class="bg-green-200 dark:bg-green-800 text-green-800 dark:text-green-200 px-3 py-1 rounded-full font-bold">nonna • ninna nanna</span>
        </div>
        <div class="space-y-2">
          <div class="flex items-center gap-2">
            <span class="font-bold text-blue-600 dark:text-blue-400">A</span>
            <input type="text" class="flex-1 border-b-2 border-green-400 dark:border-green-600 bg-transparent dark:text-white px-2 py-1 focus:outline-none focus:border-green-600 dark:focus:border-green-400" data-fill-blanks-target="input" data-correct-answer="libera" placeholder="">
          </div>
          <div class="flex items-center gap-2">
            <span class="font-bold text-red-600 dark:text-red-400">P</span>
            <input type="text" class="flex-1 border-b-2 border-green-400 dark:border-green-600 bg-transparent dark:text-white px-2 py-1 focus:outline-none focus:border-green-600 dark:focus:border-green-400" data-fill-blanks-target="input" data-correct-answer="libera" placeholder="">
          </div>
        </div>
      </div>

      <!-- Coppia 2 -->
      <div class="bg-green-50 dark:bg-green-900/30 border-2 border-green-300 dark:border-green-700 rounded-xl p-4">
        <div class="mb-3">
          <span class="bg-green-200 dark:bg-green-800 text-green-800 dark:text-green-200 px-3 py-1 rounded-full font-bold">Samuele • panino</span>
        </div>
        <div class="space-y-2">
          <div class="flex items-center gap-2">
            <span class="font-bold text-blue-600 dark:text-blue-400">A</span>
            <input type="text" class="flex-1 border-b-2 border-green-400 dark:border-green-600 bg-transparent dark:text-white px-2 py-1 focus:outline-none focus:border-green-600 dark:focus:border-green-400" data-fill-blanks-target="input" data-correct-answer="libera" placeholder="">
          </div>
          <div class="flex items-center gap-2">
            <span class="font-bold text-red-600 dark:text-red-400">P</span>
            <input type="text" class="flex-1 border-b-2 border-green-400 dark:border-green-600 bg-transparent dark:text-white px-2 py-1 focus:outline-none focus:border-green-600 dark:focus:border-green-400" data-fill-blanks-target="input" data-correct-answer="libera" placeholder="">
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer with reference -->
  <div class="mt-8 text-center">
    <p class="text-red-600 dark:text-red-400 font-bold">Grammatica pp. <%= link_to "80", pagina_path("nvl5_gram_p080"), class: "text-red-600 dark:text-red-400 hover:text-red-800 dark:hover:text-red-300 underline font-bold" %>, <%= link_to "81", pagina_path("nvl5_gram_p081"), class: "text-red-600 dark:text-red-400 hover:text-red-800 dark:hover:text-red-300 underline font-bold" %></p>
  </div>

  <!-- Exercise controls -->
  <%= render 'shared/exercise_controls' %>
</div>
