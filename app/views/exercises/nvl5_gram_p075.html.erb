<div class="max-w-6xl mx-auto p-3 md:p-8 bg-white" data-controller="exercise-checker">

  <%= render 'shared/page_header', pagina: @pagina %>

  <!-- Exercise 1: IMPARARE TUTTI -->
  <div class="bg-white p-4 md:p-6 pb-8" data-controller="word-highlighter" data-word-highlighter-multi-color-value="true">
    <h2 class="text-lg md:text-xl font-bold mb-4 flex items-center gap-2">
      <span class="flex-shrink-0 bg-<%= @pagina.base_color %>-500 text-white rounded-full w-8 h-8 md:w-10 md:h-10 inline-flex items-center justify-center">1</span>
      Sottolinea infinito presente<span class="inline-block w-5 h-5 bg-yellow-300 rounded ml-1 cursor-pointer" data-word-highlighter-target="colorBox" data-color="yellow" data-action="click->word-highlighter#selectColor"></span> e infinito passato<span class="inline-block w-5 h-5 bg-orange-300 rounded ml-1 cursor-pointer" data-word-highlighter-target="colorBox" data-color="orange" data-action="click->word-highlighter#selectColor"></span>.
    </h2>

    <div class="space-y-3 text-base md:text-lg cursor-pointer">
      <div class="bg-<%= @pagina.base_color %>-50 rounded-lg p-4">
        <p class="text-gray-700"><span class="text-<%= @pagina.base_color %>-500">•</span> Mi piace <span class="transition" data-word-highlighter-target="word" data-action="click->word-highlighter#toggleHighlight" data-correct="yellow">leggere</span> il giornale la mattina prima di <span class="transition" data-word-highlighter-target="word" data-action="click->word-highlighter#toggleHighlight" data-correct="yellow">uscire</span> di casa.</p>
      </div>
      <div class="bg-<%= @pagina.base_color %>-50 rounded-lg p-4">
        <p class="text-gray-700"><span class="text-<%= @pagina.base_color %>-500">•</span> Pensavo di <span class="transition" data-word-highlighter-target="word" data-action="click->word-highlighter#toggleHighlight" data-correct="orange">aver fatto</span> già ieri questo compito.</p>
      </div>
      <div class="bg-<%= @pagina.base_color %>-50 rounded-lg p-4">
        <p class="text-gray-700"><span class="text-<%= @pagina.base_color %>-500">•</span> Smettila di <span class="transition" data-word-highlighter-target="word" data-action="click->word-highlighter#toggleHighlight" data-correct="yellow">correre</span> qui e là!</p>
      </div>
      <div class="bg-<%= @pagina.base_color %>-50 rounded-lg p-4">
        <p class="text-gray-700"><span class="text-<%= @pagina.base_color %>-500">•</span> Sono contenta di <span class="transition" data-word-highlighter-target="word" data-action="click->word-highlighter#toggleHighlight" data-correct="orange">essere passata</span> da te prima di <span class="transition" data-word-highlighter-target="word" data-action="click->word-highlighter#toggleHighlight" data-correct="yellow">partire</span>.</p>
      </div>
    </div>
  </div>

  <!-- Exercise 2: Complete table -->
  <div class="bg-white p-4 md:p-6 pb-8" data-controller="fill-blanks">
    <h2 class="text-lg md:text-xl font-bold mb-4 flex items-center gap-2">
      <span class="flex-shrink-0 bg-<%= @pagina.base_color %>-500 text-white rounded-full w-8 h-8 md:w-10 md:h-10 inline-flex items-center justify-center">2</span>
      Completa la tabella come nell'esempio.
    </h2>

    <div class="overflow-x-auto">
      <table class="w-full border-collapse text-sm md:text-base">
        <thead>
          <tr class="bg-<%= @pagina.base_color %>-100">
            <th class="border border-<%= @pagina.base_color %>-300 px-4 py-3 font-bold">Forma verbale</th>
            <th class="border border-<%= @pagina.base_color %>-300 px-4 py-3 font-bold">Coniugazione</th>
            <th class="border border-<%= @pagina.base_color %>-300 px-4 py-3 font-bold">Infinito presente</th>
            <th class="border border-<%= @pagina.base_color %>-300 px-4 py-3 font-bold">Infinito passato</th>
          </tr>
        </thead>
        <tbody>
          <tr class="bg-<%= @pagina.base_color %>-50">
            <td class="border border-<%= @pagina.base_color %>-200 px-4 py-3">laverò</td>
            <td class="border border-<%= @pagina.base_color %>-200 px-4 py-3">1ª</td>
            <td class="border border-<%= @pagina.base_color %>-200 px-4 py-3">lavare</td>
            <td class="border border-<%= @pagina.base_color %>-200 px-4 py-3">avere lavato</td>
          </tr>
          <tr class="bg-white">
            <td class="border border-<%= @pagina.base_color %>-200 px-4 py-3">uscimmo</td>
            <td class="border border-<%= @pagina.base_color %>-200 px-4 py-3">
              <input type="text" class="w-full border-b-2 border-dotted border-<%= @pagina.base_color %>-500 bg-white text-right px-2 focus:outline-none" data-fill-blanks-target="input" data-answer="3ª" data-correct-answer="3ª">
            </td>
            <td class="border border-<%= @pagina.base_color %>-200 px-4 py-3">
              <input type="text" class="w-full border-b-2 border-dotted border-<%= @pagina.base_color %>-500 bg-white text-right px-2 focus:outline-none" data-fill-blanks-target="input" data-answer="uscire" data-correct-answer="uscire">
            </td>
            <td class="border border-<%= @pagina.base_color %>-200 px-4 py-3">
              <input type="text" class="w-full border-b-2 border-dotted border-<%= @pagina.base_color %>-500 bg-white text-right px-2 focus:outline-none" data-fill-blanks-target="input" data-answer="essere usciti" data-correct-answer="essere usciti">
            </td>
          </tr>
          <tr class="bg-<%= @pagina.base_color %>-50">
            <td class="border border-<%= @pagina.base_color %>-200 px-4 py-3">tenevate</td>
            <td class="border border-<%= @pagina.base_color %>-200 px-4 py-3">
              <input type="text" class="w-full border-b-2 border-dotted border-<%= @pagina.base_color %>-500 bg-white text-right px-2 focus:outline-none" data-fill-blanks-target="input" data-answer="2ª" data-correct-answer="2ª">
            </td>
            <td class="border border-<%= @pagina.base_color %>-200 px-4 py-3">
              <input type="text" class="w-full border-b-2 border-dotted border-<%= @pagina.base_color %>-500 bg-white text-right px-2 focus:outline-none" data-fill-blanks-target="input" data-answer="tenere" data-correct-answer="tenere">
            </td>
            <td class="border border-<%= @pagina.base_color %>-200 px-4 py-3">
              <input type="text" class="w-full border-b-2 border-dotted border-<%= @pagina.base_color %>-500 bg-white text-right px-2 focus:outline-none" data-fill-blanks-target="input" data-answer="avere tenuto" data-correct-answer="avere tenuto">
            </td>
          </tr>
          <tr class="bg-white">
            <td class="border border-<%= @pagina.base_color %>-200 px-4 py-3">amaste</td>
            <td class="border border-<%= @pagina.base_color %>-200 px-4 py-3">
              <input type="text" class="w-full border-b-2 border-dotted border-<%= @pagina.base_color %>-500 bg-white text-right px-2 focus:outline-none" data-fill-blanks-target="input" data-answer="1ª" data-correct-answer="1ª">
            </td>
            <td class="border border-<%= @pagina.base_color %>-200 px-4 py-3">
              <input type="text" class="w-full border-b-2 border-dotted border-<%= @pagina.base_color %>-500 bg-white text-right px-2 focus:outline-none" data-fill-blanks-target="input" data-answer="amare" data-correct-answer="amare">
            </td>
            <td class="border border-<%= @pagina.base_color %>-200 px-4 py-3">
              <input type="text" class="w-full border-b-2 border-dotted border-<%= @pagina.base_color %>-500 bg-white text-right px-2 focus:outline-none" data-fill-blanks-target="input" data-answer="avere amato" data-correct-answer="avere amato">
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Exercise 3: Replace with gerundio -->
  <div class="bg-white p-4 md:p-6 pb-8" data-controller="fill-blanks">
    <h2 class="text-lg md:text-xl font-bold mb-4 flex items-center gap-2">
      <span class="flex-shrink-0 bg-<%= @pagina.base_color %>-500 text-white rounded-full w-8 h-8 md:w-10 md:h-10 inline-flex items-center justify-center">3</span>
      Sostituisci l'espressione tra parentesi con un gerundio presente o passato. Osserva l'esempio.
    </h2>

    <div class="space-y-3 text-base md:text-lg">
      <div class="bg-<%= @pagina.base_color %>-50 rounded-lg p-4">
        <p class="text-gray-700"><span class="text-<%= @pagina.base_color %>-500">•</span> (Mentre andavo) <strong class="text-green-700">Andando</strong> a scuola in bicicletta ho forato una ruota.</p>
      </div>

      <div class="bg-<%= @pagina.base_color %>-50 rounded-lg p-4">
        <div class="flex flex-wrap items-center gap-2">
          <span class="text-<%= @pagina.base_color %>-500">•</span>
          <span class="text-gray-700">(Siccome è)</span>
          <input type="text" class="flex-1 min-w-[150px] border-b-2 border-dotted border-<%= @pagina.base_color %>-500 bg-white text-right px-2 focus:outline-none" data-fill-blanks-target="input" data-answer="Essendo" data-correct-answer="Essendo">
          <span class="text-gray-700">troppo piccola, Gaia non può salire sul trenino.</span>
        </div>
      </div>

      <div class="bg-<%= @pagina.base_color %>-50 rounded-lg p-4">
        <div class="flex flex-wrap items-center gap-2">
          <span class="text-<%= @pagina.base_color %>-500">•</span>
          <span class="text-gray-700">(Poiché studiamo)</span>
          <input type="text" class="flex-1 min-w-[150px] border-b-2 border-dotted border-<%= @pagina.base_color %>-500 bg-white text-right px-2 focus:outline-none" data-fill-blanks-target="input" data-answer="Studiando" data-correct-answer="Studiando">
          <span class="text-gray-700">molto, abbiamo ottimi voti.</span>
        </div>
      </div>

      <div class="bg-<%= @pagina.base_color %>-50 rounded-lg p-4">
        <div class="flex flex-wrap items-center gap-2">
          <span class="text-<%= @pagina.base_color %>-500">•</span>
          <span class="text-gray-700">(Dopo che ruppe)</span>
          <input type="text" class="flex-1 min-w-[150px] border-b-2 border-dotted border-<%= @pagina.base_color %>-500 bg-white text-right px-2 focus:outline-none" data-fill-blanks-target="input" data-answer="Avendo rotto" data-correct-answer="Avendo rotto">
          <span class="text-gray-700">gli occhiali, Ryan non poteva leggere.</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Exercise 4: Write mode and tense -->
  <div class="bg-white p-4 md:p-6 pb-8" data-controller="fill-blanks">
    <h2 class="text-lg md:text-xl font-bold mb-4 flex items-center gap-2">
      <span class="flex-shrink-0 bg-<%= @pagina.base_color %>-500 text-white rounded-full w-8 h-8 md:w-10 md:h-10 inline-flex items-center justify-center">4</span>
      Scrivi il modo e il tempo di ciascuna forma verbale.
    </h2>

    <div class="space-y-3 text-base md:text-lg">
      <div class="bg-<%= @pagina.base_color %>-50 rounded-lg p-4">
        <p class="text-gray-700"><span class="text-<%= @pagina.base_color %>-500">•</span> passando → <strong class="text-green-700">m. gerundio, t. presente</strong></p>
      </div>

      <% verb_forms = [
        { verb: "essere partito", answer: "m. infinito, t. passato" },
        { verb: "avendo corso", answer: "m. gerundio, t. passato" },
        { verb: "calante", answer: "m. participio, t. presente" },
        { verb: "sapere", answer: "m. infinito, t. presente" },
        { verb: "nutrendo", answer: "m. gerundio, t. presente" }
      ] %>

      <% verb_forms.each do |item| %>
        <div class="rounded-lg p-3 flex flex-wrap items-center gap-2">
          <span class="text-<%= @pagina.base_color %>-500">•</span>
          <span class="text-gray-700"><%= item[:verb] %> →</span>
          <input type="text"
                 class="flex-1 min-w-[200px] border-b-2 border-dotted border-<%= @pagina.base_color %>-500 bg-white text-right px-2 focus:outline-none"
                 data-fill-blanks-target="input"
                 data-answer="<%= item[:answer] %>"
                 data-correct-answer="<%= item[:answer] %>">
        </div>
      <% end %>
    </div>
  </div>

  <!-- Exercise 5: Participle function -->
  <div class="bg-white p-4 md:p-6 pb-8" data-controller="multiple-choice">
    <h2 class="text-lg md:text-xl font-bold mb-4 flex items-center gap-2">
      <span class="flex-shrink-0 bg-<%= @pagina.base_color %>-500 text-white rounded-full w-8 h-8 md:w-10 md:h-10 inline-flex items-center justify-center">5</span>
      Leggi le frasi e segna con una X la funzione di ogni participio sottolineato: nome (N), aggettivo (A) o tempo composto (TC).
    </h2>

    <div class="overflow-x-auto">
      <table class="w-full border-collapse text-sm md:text-base">
        <thead>
          <tr class="bg-<%= @pagina.base_color %>-100">
            <th class="border border-<%= @pagina.base_color %>-300 px-4 py-3 font-bold text-left">Frase</th>
            <th class="border border-<%= @pagina.base_color %>-300 px-4 py-3 font-bold">N</th>
            <th class="border border-<%= @pagina.base_color %>-300 px-4 py-3 font-bold">A</th>
            <th class="border border-<%= @pagina.base_color %>-300 px-4 py-3 font-bold">TC</th>
          </tr>
        </thead>
        <tbody>
          <tr class="bg-<%= @pagina.base_color %>-50">
            <td class="border border-<%= @pagina.base_color %>-200 px-4 py-3"><span class="text-<%= @pagina.base_color %>-500">•</span> Quel <u>cantante</u> è anche un ballerino.</td>
            <td class="border border-<%= @pagina.base_color %>-200 px-4 py-3 text-center">
              <input type="radio" name="ex5_1" value="N" class="w-4 h-4">
            </td>
            <td class="border border-<%= @pagina.base_color %>-200 px-4 py-3 text-center">
              <input type="radio" name="ex5_1" value="A" class="w-4 h-4">
            </td>
            <td class="border border-<%= @pagina.base_color %>-200 px-4 py-3 text-center">
              <input type="radio" name="ex5_1" value="TC" class="w-4 h-4">
            </td>
          </tr>
          <tr class="bg-white">
            <td class="border border-<%= @pagina.base_color %>-200 px-4 py-3"><span class="text-<%= @pagina.base_color %>-500">•</span> Questo è il biglietto <u>vincente</u>!</td>
            <td class="border border-<%= @pagina.base_color %>-200 px-4 py-3 text-center">
              <input type="radio" name="ex5_2" value="N" class="w-4 h-4">
            </td>
            <td class="border border-<%= @pagina.base_color %>-200 px-4 py-3 text-center">
              <input type="radio" name="ex5_2" value="A" class="w-4 h-4">
            </td>
            <td class="border border-<%= @pagina.base_color %>-200 px-4 py-3 text-center">
              <input type="radio" name="ex5_2" value="TC" class="w-4 h-4">
            </td>
          </tr>
          <tr class="bg-<%= @pagina.base_color %>-50">
            <td class="border border-<%= @pagina.base_color %>-200 px-4 py-3"><span class="text-<%= @pagina.base_color %>-500">•</span> Gli <u>invitati</u> alla festa erano contenti.</td>
            <td class="border border-<%= @pagina.base_color %>-200 px-4 py-3 text-center">
              <input type="radio" name="ex5_3" value="N" class="w-4 h-4">
            </td>
            <td class="border border-<%= @pagina.base_color %>-200 px-4 py-3 text-center">
              <input type="radio" name="ex5_3" value="A" class="w-4 h-4">
            </td>
            <td class="border border-<%= @pagina.base_color %>-200 px-4 py-3 text-center">
              <input type="radio" name="ex5_3" value="TC" class="w-4 h-4">
            </td>
          </tr>
          <tr class="bg-white">
            <td class="border border-<%= @pagina.base_color %>-200 px-4 py-3"><span class="text-<%= @pagina.base_color %>-500">•</span> Ho <u>salutato</u> un vicino di casa.</td>
            <td class="border border-<%= @pagina.base_color %>-200 px-4 py-3 text-center">
              <input type="radio" name="ex5_4" value="N" class="w-4 h-4">
            </td>
            <td class="border border-<%= @pagina.base_color %>-200 px-4 py-3 text-center">
              <input type="radio" name="ex5_4" value="A" class="w-4 h-4">
            </td>
            <td class="border border-<%= @pagina.base_color %>-200 px-4 py-3 text-center">
              <input type="radio" name="ex5_4" value="TC" class="w-4 h-4">
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <div class="text-right text-sm text-gray-500 mb-6">
    Esercizi pp. <%= link_to "168", pagina_path("nvl5_gram_p168"), class: "text-gray-600 hover:text-gray-800 underline" %>, <%= link_to "169", pagina_path("nvl5_gram_p169"), class: "text-gray-600 hover:text-gray-800 underline" %>
  </div>

  <%= render 'shared/exercise_controls' %>
</div>
