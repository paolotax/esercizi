<div class="max-w-6xl mx-auto bg-white dark:bg-gray-900 p-3 md:p-6 transition-colors duration-300"
     data-controller="exercise-checker text-toggle font-controls"
     data-text-toggle-target="content"
     data-font-controls-target="content">

  <%= render 'shared/page_header', pagina: @pagina %>

  <div class="space-y-6">

    <!-- Esercizio 1: IMPARARE TUTTI - Proprietà commutativa -->
    <div class="p-5 bg-white dark:bg-gray-800 rounded-2xl border-3 border-yellow-400 dark:border-yellow-500">
      <p class="font-bold text-gray-700 dark:text-gray-200 mb-4">
        <%= imparare_tutti_badge(1) %>
        Calcola applicando la proprietà commutativa. Segui l'esempio.
      </p>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div class="space-y-3">
          <!-- Esempio -->
          <div class="flex items-center gap-2 flex-wrap">
            <span class="font-bold text-gray-700 dark:text-gray-200">37 + 122</span>
            <span class="text-gray-700 dark:text-gray-200">=</span>
            <span class="font-bold text-cyan-600 dark:text-cyan-400">122 + 37</span>
            <span class="text-gray-700 dark:text-gray-200">=</span>
            <span class="font-bold text-cyan-600 dark:text-cyan-400">159</span>
          </div>

          <%= render 'shared/fill_item', color: "cyan",
              segments: ["53 + 245 =", { answer: "245+53", width: "w-24" }, "=", { answer: "298", width: "w-16" }] %>
          <%= render 'shared/fill_item', color: "cyan",
              segments: ["516 + 73 =", { answer: "73+516", width: "w-24" }, "=", { answer: "589", width: "w-16" }] %>
          <%= render 'shared/fill_item', color: "cyan",
              segments: ["425 + 54 =", { answer: "54+425", width: "w-24" }, "=", { answer: "479", width: "w-16" }] %>
          <%= render 'shared/fill_item', color: "cyan",
              segments: ["73 + 124 =", { answer: "124+73", width: "w-24" }, "=", { answer: "197", width: "w-16" }] %>
          <%= render 'shared/fill_item', color: "cyan",
              segments: ["80 + 410 =", { answer: "410+80", width: "w-24" }, "=", { answer: "490", width: "w-16" }] %>
        </div>

        <!-- Box proprietà commutativa -->
        <div class="flex items-start justify-center">
          <div class="p-4 bg-cyan-50 dark:bg-cyan-900 rounded-lg border-2 border-cyan-400 dark:border-cyan-600">
            <p class="font-bold text-cyan-600 dark:text-cyan-400 mb-2">Proprietà commutativa</p>
            <p class="text-gray-700 dark:text-gray-200"><span class="font-bold">120</span> + 60 = 60 + <span class="font-bold">120</span> = 180</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Esercizio 2: Proprietà associativa -->
    <div>
      <p class="font-bold text-gray-700 dark:text-gray-200 mb-4">
        <%= numero_esercizio_badge(2) %>
        Cerchia gli addendi che ti conviene associare e calcola. Segui l'esempio.
      </p>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div class="space-y-4">
          <!-- Esempio con immagine -->
          <div class="flex items-center gap-2 flex-wrap mb-2">
            <%= image_tag "nvi4_mat/p180/p180_01.jpg", class: "h-8 dark:bg-white dark:rounded dark:p-1", alt: "(700) + (300) + 40" %>
            <span class="text-gray-700 dark:text-gray-200">=</span>
            <span class="font-bold text-cyan-600 dark:text-cyan-400">1 000</span>
            <span class="text-gray-700 dark:text-gray-200">+</span>
            <span class="font-bold text-cyan-600 dark:text-cyan-400">40</span>
            <span class="text-gray-700 dark:text-gray-200">=</span>
            <span class="font-bold text-cyan-600 dark:text-cyan-400">1 040</span>
          </div>

          <%= render 'shared/fill_item', color: "cyan",
              segments: ["15 + 23 + 17 =", { answer: "32", width: "w-16" }, "+", { answer: "23", width: "w-16" }, "=", { answer: "55", width: "w-16" }] %>
          <%= render 'shared/fill_item', color: "cyan",
              segments: ["25 + 35 + 44 =", { answer: "60", width: "w-16" }, "+", { answer: "44", width: "w-16" }, "=", { answer: "104", width: "w-16" }] %>
          <%= render 'shared/fill_item', color: "cyan",
              segments: ["600 + 1 370 + 30 =", { answer: "630", width: "w-16" }, "+", { answer: "1370", width: "w-16" }, "=", { answer: "2000", width: "w-16" }] %>
          <%= render 'shared/fill_item', color: "cyan",
              segments: ["160 + 40 + 220 =", { answer: "200", width: "w-16" }, "+", { answer: "220", width: "w-16" }, "=", { answer: "420", width: "w-16" }] %>
        </div>

        <!-- Box proprietà associativa -->
        <div class="flex items-start justify-center">
          <div class="p-4 bg-cyan-50 dark:bg-cyan-900 rounded-lg border-2 border-cyan-400 dark:border-cyan-600">
            <p class="font-bold text-cyan-600 dark:text-cyan-400 mb-2">Proprietà associativa</p>
            <div class="space-y-1">
              <div class="flex items-center gap-2">
                <span class="text-gray-700 dark:text-gray-200">150</span>
                <span class="text-gray-700 dark:text-gray-200">+</span>
                <span class="text-gray-700 dark:text-gray-200">50</span>
                <span class="text-gray-700 dark:text-gray-200">+</span>
                <span class="text-gray-700 dark:text-gray-200">80</span>
                <span class="text-gray-700 dark:text-gray-200">=</span>
                <span class="text-gray-700 dark:text-gray-200">280</span>
              </div>
              <div class="flex items-center gap-2">
                <span class="text-cyan-500">↓</span>
                <span class="invisible">+</span>
                <span class="text-cyan-500">↓</span>
              </div>
              <div class="flex items-center gap-2">
                <span class="font-bold text-gray-700 dark:text-gray-200">200</span>
                <span class="text-gray-700 dark:text-gray-200">+</span>
                <span class="text-gray-700 dark:text-gray-200">80</span>
                <span class="text-gray-700 dark:text-gray-200">=</span>
                <span class="text-gray-700 dark:text-gray-200">280</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Esercizio 3: Commutativa + Associativa -->
    <div>
      <p class="font-bold text-gray-700 dark:text-gray-200 mb-4">
        <%= numero_esercizio_badge(3) %>
        Applica prima la proprietà commutativa, poi la proprietà associativa e calcola. Segui l'esempio.
      </p>

      <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <!-- Esempio -->
        <div class="space-y-2">
          <p class="font-bold text-gray-700 dark:text-gray-200">46 + 11 + 24 + 29 =</p>
          <p class="text-cyan-600 dark:text-cyan-400 font-bold">70 + 40 = 110</p>
        </div>

        <div class="space-y-2">
          <p class="font-bold text-gray-700 dark:text-gray-200">65 + 43 + 35 + 27 =</p>
          <%= render 'shared/fill_item', color: "cyan",
              segments: [{ answer: "100", width: "w-14" }, "+", { answer: "70", width: "w-14" }, "=", { answer: "170", width: "w-14" }] %>
        </div>

        <div class="space-y-2">
          <p class="font-bold text-gray-700 dark:text-gray-200">32 + 20 + 58 + 50 =</p>
          <%= render 'shared/fill_item', color: "cyan",
              segments: [{ answer: "90", width: "w-14" }, "+", { answer: "70", width: "w-14" }, "=", { answer: "160", width: "w-14" }] %>
        </div>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-4">
        <div class="space-y-2">
          <p class="text-gray-700 dark:text-gray-200">79 + 55 + 21 + 45 =</p>
          <%= render 'shared/fill_item', color: "cyan",
              segments: [{ answer: "100", width: "w-14" }, "+", { answer: "100", width: "w-14" }, "=", { answer: "200", width: "w-14" }] %>
        </div>

        <div class="space-y-2">
          <p class="text-gray-700 dark:text-gray-200">73 + 18 + 53 + 22 =</p>
          <%= render 'shared/fill_item', color: "cyan",
              segments: [{ answer: "126", width: "w-14" }, "+", { answer: "40", width: "w-14" }, "=", { answer: "166", width: "w-14" }] %>
        </div>

        <div class="space-y-2">
          <p class="text-gray-700 dark:text-gray-200">70 + 56 + 30 + 84 =</p>
          <%= render 'shared/fill_item', color: "cyan",
              segments: [{ answer: "100", width: "w-14" }, "+", { answer: "140", width: "w-14" }, "=", { answer: "240", width: "w-14" }] %>
        </div>
      </div>
    </div>

    <!-- Esercizio 4: Scrivi risultato e proprietà -->
    <div>
      <p class="font-bold text-gray-700 dark:text-gray-200 mb-4">
        <%= numero_esercizio_badge(4) %>
        Scrivi il risultato di ogni addizione e quale o quali proprietà sono state applicate.
      </p>

      <div class="space-y-4">
        <!-- Prima operazione -->
        <%= render 'shared/fill_item', color: "cyan", bullet: "•",
            segments: ["85 + 15 + 100 = (85 + 15) + 100 = 100 + 100 =", { answer: "200", width: "w-16" }, "Proprietà", { answer: "associativa", width: "w-48" }] %>

        <!-- Seconda operazione -->
        <%= render 'shared/fill_item', color: "cyan", bullet: "•",
            segments: ["21 + 138 = 138 + 21 =", { answer: "159", width: "w-16" }, "Proprietà", { answer: "commutativa", width: "w-48" }] %>

        <!-- Terza operazione -->
        <%= render 'shared/fill_item', color: "cyan", bullet: "•",
            segments: ["151 + 84 + 116 + 29 = (151 + 29) + (84 + 116) = 180 + 200 =", { answer: "380", width: "w-16" }, "Proprietà", { answer: "commutativa e associativa", width: "w-full" }] %>
      </div>
    </div>

    <%= render 'shared/exercise_controls' %>
  </div>
</div>
