<div class="max-w-7xl mx-auto p-3 md:p-6 bg-white dark:bg-gray-900 text-black dark:text-white transition-colors duration-300"
     data-controller="exercise-checker fill-blanks auto-advance text-toggle font-controls"
     data-text-toggle-target="content"
     data-font-controls-target="content">
  
  <!-- Header -->
  <%= render 'shared/page_header', pagina: @pagina %>

  <!-- Esercizio 1: Osserva e completa le frasi -->
  <div class="bg-[#C7EAFB] dark:bg-cyan-900/40 -ml-3 md:-ml-0 -mr-3 md:mr-0 p-4 md:p-8 mb-8" >
    <div class="flex items-start gap-3 mb-6">
      <div class="bg-red-500 text-white rounded-full w-8 h-8 flex items-center justify-center font-bold flex-shrink-0">
        1
      </div>
      <p class="text-gray-700 dark:text-gray-200">
        <strong>Osserva e completa le frasi.</strong>
      </p>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
      <!-- Propriet√† Commutativa -->
      <div class="border-3 border-cyan-400 dark:border-cyan-500 rounded-lg p-6 bg-white dark:bg-gray-800">
        <div class="mb-4 bg-white rounded-xl p-2">
          <%= image_tag "bus3_mat/p024/p24_1.jpg",
              alt: "Propriet√† commutativa",
              class: "max-w-full w-full" %>
        </div>

        <p class="text-gray-700 dark:text-gray-200 mb-3">
          ‚Ä¢ Nelle due operazioni hai cambiato l'ordine degli addendi. Il risultato √®:
        </p>

        <div class="flex gap-6 mb-4">
          <label class="flex items-center gap-2 cursor-pointer">
            <input type="radio" name="prop_comm" data-correct-answer="true" class="w-5 h-5">
            <span class="dark:text-white">uguale.</span>
          </label>
          <label class="flex items-center gap-2 cursor-pointer">
            <input type="radio" name="prop_comm" data-correct-answer="false" class="w-5 h-5">
            <span class="dark:text-white">diverso.</span>
          </label>
        </div>

        <p class="text-gray-700 dark:text-gray-200">
          Hai applicato la <strong class="text-pink-600 dark:text-pink-400">propriet√† commutativa.</strong>
        </p>
      </div>

      <!-- Propriet√† Associativa -->
      <div class="border-3 border-cyan-400 dark:border-cyan-500 rounded-lg p-6 bg-white dark:bg-gray-800">
        <div class="mb-4 bg-white rounded-xl p-2">
          <%= image_tag "bus3_mat/p024/p24_2.jpg",
              alt: "Propriet√† associativa",
              class: "max-w-full w-full" %>
        </div>

        <p class="text-gray-700 dark:text-gray-200 mb-3">
          ‚Ä¢ A due addendi hai sostituito la loro somma. Il risultato √®:
        </p>

        <div class="flex gap-6 mb-4">
          <label class="flex items-center gap-2 cursor-pointer">
            <input type="radio" name="prop_assoc" data-correct-answer="true" class="w-5 h-5">
            <span class="dark:text-white">uguale.</span>
          </label>
          <label class="flex items-center gap-2 cursor-pointer">
            <input type="radio" name="prop_assoc" data-correct-answer="false" class="w-5 h-5">
            <span class="dark:text-white">diverso.</span>
          </label>
        </div>

        <p class="text-gray-700 dark:text-gray-200">
          Hai applicato la <strong class="text-cyan-700 dark:text-cyan-400">propriet√† associativa.</strong>
        </p>
      </div>
    </div>

    <!-- Box riassuntivo -->
    <div class="bg-pink-50 dark:bg-pink-900/30 border-3 border-pink-400 dark:border-pink-500 rounded-2xl p-6 mx-auto max-w-4xl">
      <div class="flex items-start gap-3">
        <div class="text-4xl">üòä</div>
        <div class="space-y-3">
          <p class="text-gray-700 dark:text-gray-200">
            <strong class="text-pink-600 dark:text-pink-400">‚Ä¢ Propriet√† commutativa:</strong> se cambi l'ordine degli addendi, il risultato non cambia.
          </p>
          <p class="text-gray-700 dark:text-gray-200">
            <strong class="text-cyan-700 dark:text-cyan-400">‚Ä¢ Propriet√† associativa:</strong> se sostituisci a due addendi la loro somma, il risultato non cambia.
          </p>
        </div>
      </div>
    </div>
  </div>

  <!-- Esercizi 2 e 3: Grid responsive -->
  <div class="bg-transparent p-4 md:p-8 mb-8">
    <div class="grid grid-cols-1 md:grid-cols-2 gap-10">

      <!-- Esercizio 2: Applica la propriet√† commutativa -->
      <div>
        <div class="flex items-start gap-3 mb-6">
          <div class="bg-red-500 text-white rounded-full w-8 h-8 flex items-center justify-center font-bold flex-shrink-0">
            2
          </div>
          <p class="text-gray-700 dark:text-gray-200">
            <strong>Applica la propriet√† commutativa e calcola. Segui l'esempio.</strong>
          </p>
        </div>

        <!-- Esempio -->
        <div class="flex items-center gap-3 mb-4 dark:text-white">
          <span class="font-bold">4 + 75</span>
          <span>=</span>
          <span class="font-bold text-cyan-700 dark:text-cyan-400">75 + 4</span>
          <span>=</span>
          <span class="font-bold text-cyan-700 dark:text-cyan-400">79</span>
        </div>

        <%= render 'shared/fill_list',
            color: "cyan",
            container_class: "space-y-3",
            items: [
              { segments: ["16 + 121", "=", { answer: "121 + 16", width: "w-28" }, "=", { answer: "137" }] },
              { segments: ["12 + 87", "=", { answer: "87 + 12", width: "w-28" }, "=", { answer: "99" }] },
              { segments: ["15 + 116", "=", { answer: "116 + 15", width: "w-28" }, "=", { answer: "131" }] }
            ] %>
      </div>

      <!-- Esercizio 3: Applica la propriet√† associativa -->
      <div>
        <div class="flex items-start gap-3 mb-6">
          <div class="bg-red-500 text-white rounded-full w-8 h-8 flex items-center justify-center font-bold flex-shrink-0">
            3
          </div>
          <p class="text-gray-700 dark:text-gray-200">
            <strong>Applica la propriet√† associativa e calcola.</strong>
          </p>
        </div>

        <%= render 'shared/fill_list',
            color: "cyan",
            container_class: "space-y-3",
            items: [
              { segments: ["23 + 5 + 25", "=", { answer: "53" }] },
              { segments: ["23 +", { answer: "30" }, "=", { answer: "53" }] },
              { segments: ["48 + 8 + 13", "=", { answer: "69" }] },
              { segments: [{ answer: "56" }, "+ 13", "=", { answer: "69" }] }
            ] %>
      </div>

    </div>
  </div>

  <!-- Esercizio 4: Leggi e completa. Poi calcola -->
  <div class="bg-transparent p-4 md:p-8 mb-8">
    <div class="flex items-start gap-3 mb-6">
      <div class="bg-red-500 text-white rounded-full w-8 h-8 flex items-center justify-center font-bold flex-shrink-0">
        4
      </div>
      <p class="text-gray-700 dark:text-gray-200">
        <strong>Leggi e completa. Poi calcola.</strong>
      </p>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
      <!-- L'1 nell'addizione -->
      <div class="border-3 border-cyan-400 dark:border-cyan-500 rounded-lg p-6 bg-white dark:bg-gray-800">
        <h3 class="font-bold mb-4 dark:text-white">L'<span class="text-cyan-700 dark:text-cyan-400">1</span> nell'addizione</h3>

        <div class="space-y-3 mb-6">
          <div class="flex items-center gap-3 dark:text-white">
            <span class="font-bold">34 + 1 =</span>
            <span class="font-bold text-cyan-700 dark:text-cyan-400">35</span>
          </div>
          <div class="flex items-center gap-3 dark:text-white">
            <span class="font-bold">1 + 106 =</span>
            <span class="font-bold text-cyan-700 dark:text-cyan-400">107</span>
          </div>
        </div>

        <div class="text-gray-700 dark:text-gray-200 mb-6">
          <%= render 'shared/fill_item', color: "cyan", segments: ["Se aggiungi", { answer: "1" }, "a un numero, trovi il suo successivo."] %>
        </div>
      </div>

      <!-- Lo 0 nell'addizione -->
      <div class="border-3 border-cyan-400 dark:border-cyan-500 rounded-lg p-6 bg-white dark:bg-gray-800">
        <h3 class="font-bold mb-4 dark:text-white">Lo <span class="text-cyan-700 dark:text-cyan-400">0</span> nell'addizione</h3>

        <div class="space-y-3 mb-6">
          <div class="flex items-center gap-3 dark:text-white">
            <span class="font-bold">92 + 0 =</span>
            <span class="font-bold text-cyan-700 dark:text-cyan-400">92</span>
          </div>
          <div class="flex items-center gap-3 dark:text-white">
            <span class="font-bold">0 + 115 =</span>
            <span class="font-bold text-cyan-700 dark:text-cyan-400">115</span>
          </div>
        </div>

        <div class="text-gray-700 dark:text-gray-200 mb-6">
          <%= render 'shared/fill_item', color: "cyan", segments: ["Se uno dei due addendi √®", { answer: "0" }, ", il risultato √® l'altro addendo."] %>
        </div>
      </div>

      <!-- Esercizi finali -->
      <div class="mt-6 dark:text-white">
        <%= render 'shared/fill_list',
            color: "cyan",
            container_class: "grid grid-cols-2 md:grid-cols-1 gap-4",
            items: [
              { segments: ["104 + 1 =", { answer: "105" }] },
              { segments: ["172 +", { answer: "1" }, "= 173"] },
              { segments: ["27 + 0 =", { answer: "27" }] },
              { segments: ["203 +", { answer: "0" }, "= 203"] }
            ] %>
      </div>
    </div>
  </div>

  <!-- Quaderno link allineato a destra -->
  <div class="p-4 mb-8 text-right">
    <span class="text-gray-600 dark:text-gray-400">Quaderno ‚Üí</span> <%= link_to "p. 144", pagina_path("bus3_mat_p144"), class: "text-cyan-600 dark:text-cyan-400 font-bold hover:underline" %>
  </div>

  <!-- Footer con controlli -->
  <%= render 'shared/exercise_controls' %>
</div>