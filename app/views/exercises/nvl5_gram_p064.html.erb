<div class="max-w-6xl mx-auto bg-white dark:bg-gray-900 text-black dark:text-white p-3 md:p-6 transition-colors duration-300"
     data-controller="exercise-checker text-toggle font-controls"
     data-text-toggle-target="content"
     data-font-controls-target="content">

  <%= render 'shared/page_header', pagina: @pagina %>

  <!-- Nota consulta mappe -->
  <div class="bg-<%= @pagina.base_color %>-50 dark:bg-<%= @pagina.base_color %>-900/30 p-4 md:p-6 pb-8 rounded-lg">
    <p class="text-base md:text-lg text-gray-700 dark:text-gray-200 font-semibold">
      <span class="text-<%= @pagina.base_color %>-500">•</span> Consulta le pp. 3-5 del blocco mappe.
    </p>
  </div>

  <!-- Exercise 1 -->
  <div class="p-4 md:p-6 pb-8" data-controller="word-highlighter" data-word-highlighter-multi-color-value="false">
    <h2 class="text-lg md:text-xl font-bold mb-4 flex items-center gap-2">
      <span class="flex-shrink-0 bg-<%= @pagina.base_color %>-500 text-white rounded-full w-8 h-8 md:w-10 md:h-10 inline-flex items-center justify-center">1</span>
      Clicca sugli aggettivi qualificativi<span class="inline-block w-5 h-5 bg-yellow-300 rounded ml-1"></span>
    </h2>

    <!-- Color Selector (hidden for mono-color) -->
    <div class="hidden">
      <div class="w-6 h-6 bg-yellow-300" data-word-highlighter-target="colorBox" data-color="yellow"></div>
    </div>

    <div class="space-y-3 text-base md:text-lg cursor-pointer">
      <div class="bg-<%= @pagina.base_color %>-50 dark:bg-<%= @pagina.base_color %>-900/30 rounded-lg p-4">
        <p class="text-gray-700 dark:text-gray-200"><span class="text-<%= @pagina.base_color %>-500">•</span> Il <span class="transition" data-word-highlighter-target="word" data-action="click->word-highlighter#toggleHighlight" data-correct="yellow">bel</span> vestito è in vetrina.</p>
      </div>
      <div class="bg-<%= @pagina.base_color %>-50 dark:bg-<%= @pagina.base_color %>-900/30 rounded-lg p-4">
        <p class="text-gray-700 dark:text-gray-200"><span class="text-<%= @pagina.base_color %>-500">•</span> La <span class="transition" data-word-highlighter-target="word" data-action="click->word-highlighter#toggleHighlight" data-correct="yellow">nuova</span> insegnante è molto <span class="transition" data-word-highlighter-target="word" data-action="click->word-highlighter#toggleHighlight" data-correct="yellow">simpatica</span>.</p>
      </div>
      <div class="bg-<%= @pagina.base_color %>-50 dark:bg-<%= @pagina.base_color %>-900/30 rounded-lg p-4">
        <p class="text-gray-700 dark:text-gray-200"><span class="text-<%= @pagina.base_color %>-500">•</span> Ho comprato dei <span class="transition" data-word-highlighter-target="word" data-action="click->word-highlighter#toggleHighlight" data-correct="yellow">bellissimi</span> fiori <span class="transition" data-word-highlighter-target="word" data-action="click->word-highlighter#toggleHighlight" data-correct="yellow">profumati</span>.</p>
      </div>
      <div class="bg-<%= @pagina.base_color %>-50 dark:bg-<%= @pagina.base_color %>-900/30 rounded-lg p-4">
        <p class="text-gray-700 dark:text-gray-200"><span class="text-<%= @pagina.base_color %>-500">•</span> La giornata <span class="transition" data-word-highlighter-target="word" data-action="click->word-highlighter#toggleHighlight" data-correct="yellow">piovosa</span> mi rende <span class="transition" data-word-highlighter-target="word" data-action="click->word-highlighter#toggleHighlight" data-correct="yellow">triste</span>.</p>
      </div>
    </div>
  </div>

  <!-- Exercise 2 -->
  <div class="p-4 md:p-6 pb-8" data-controller="word-highlighter" data-word-highlighter-multi-color-value="true">
    <h2 class="text-lg md:text-xl font-bold mb-4 flex items-center gap-2">
      <span class="flex-shrink-0 bg-<%= @pagina.base_color %>-500 text-white rounded-full w-8 h-8 md:w-10 md:h-10 inline-flex items-center justify-center">2</span>
      Clicca sui pronomi soggetto<span class="inline-block w-5 h-5 bg-yellow-300 rounded ml-1 cursor-pointer" data-word-highlighter-target="colorBox" data-color="yellow" data-action="click->word-highlighter#selectColor"></span> e sui pronomi complemento<span class="inline-block w-5 h-5 bg-green-300 rounded ml-1 cursor-pointer" data-word-highlighter-target="colorBox" data-color="green" data-action="click->word-highlighter#selectColor"></span>.
    </h2>

    <div class="space-y-3 text-base md:text-lg cursor-pointer">
      <div class="bg-<%= @pagina.base_color %>-50 dark:bg-<%= @pagina.base_color %>-900/30 rounded-lg p-4">
        <p class="text-gray-700 dark:text-gray-200"><span class="text-<%= @pagina.base_color %>-500">•</span> <span class="transition" data-word-highlighter-target="word" data-action="click->word-highlighter#toggleHighlight" data-correct="yellow">Io</span> <span class="transition" data-word-highlighter-target="word" data-action="click->word-highlighter#toggleHighlight" data-correct="green">ti</span> aspetto domani.</p>
      </div>
      <div class="bg-<%= @pagina.base_color %>-50 dark:bg-<%= @pagina.base_color %>-900/30 rounded-lg p-4">
        <p class="text-gray-700 dark:text-gray-200"><span class="text-<%= @pagina.base_color %>-500">•</span> <span class="transition" data-word-highlighter-target="word" data-action="click->word-highlighter#toggleHighlight" data-correct="yellow">Tu</span> <span class="transition" data-word-highlighter-target="word" data-action="click->word-highlighter#toggleHighlight" data-correct="green">mi</span> hai chiamato ieri sera.</p>
      </div>
      <div class="bg-<%= @pagina.base_color %>-50 dark:bg-<%= @pagina.base_color %>-900/30 rounded-lg p-4">
        <p class="text-gray-700 dark:text-gray-200"><span class="text-<%= @pagina.base_color %>-500">•</span> <span class="transition" data-word-highlighter-target="word" data-action="click->word-highlighter#toggleHighlight" data-correct="yellow">Lei</span> <span class="transition" data-word-highlighter-target="word" data-action="click->word-highlighter#toggleHighlight" data-correct="green">ci</span> ha regalato un libro.</p>
      </div>
      <div class="bg-<%= @pagina.base_color %>-50 dark:bg-<%= @pagina.base_color %>-900/30 rounded-lg p-4">
        <p class="text-gray-700 dark:text-gray-200"><span class="text-<%= @pagina.base_color %>-500">•</span> <span class="transition" data-word-highlighter-target="word" data-action="click->word-highlighter#toggleHighlight" data-correct="yellow">Noi</span> <span class="transition" data-word-highlighter-target="word" data-action="click->word-highlighter#toggleHighlight" data-correct="green">li</span> abbiamo incontrati al parco.</p>
      </div>
    </div>
  </div>

  <!-- Exercise 3 -->
  <div class="p-4 md:p-6 pb-8" data-controller="fill-blanks">
    <h2 class="text-lg md:text-xl font-bold mb-4 flex items-center gap-2">
      <span class="flex-shrink-0 bg-<%= @pagina.base_color %>-500 text-white rounded-full w-8 h-8 md:w-10 md:h-10 inline-flex items-center justify-center">3</span>
      Completa con aggettivi/pronomi possessivi, poi indica A o P.
    </h2>

    <% ap_items = [
      { text: "La", answer: "mia", continuation: "casa è grande.", correct: "A" },
      { text: "Il", answer: "tuo", continuation: "libro è interessante.", correct: "A" },
      { text: "Ho perso la penna, ho bisogno della", answer: "tua", continuation: ".", correct: "P" }
    ] %>

    <div class="space-y-3 text-base md:text-lg">
      <% ap_items.each_with_index do |item, index| %>
        <div class="rounded-lg p-3">
          <div class="flex flex-col md:flex-row md:items-center gap-3">
            <div class="flex-1 flex flex-wrap items-center gap-2">
              <span class="text-<%= @pagina.base_color %>-500">•</span>
              <span class="text-gray-700 dark:text-gray-200"><%= item[:text] %></span>
              <input type="text"
                     class="w-24 border-b-2 border-dotted border-<%= @pagina.base_color %>-500 bg-transparent dark:text-white text-right px-2 focus:outline-none focus:border-<%= @pagina.base_color %>-700"
                     data-fill-blanks-target="input"
                     data-answer="<%= item[:answer] %>"
                     data-correct-answer="<%= item[:answer] %>">
              <span class="text-gray-700 dark:text-gray-200"><%= item[:continuation] %></span>
            </div>
            <div class="flex gap-2">
              <label class="inline-flex items-center gap-1">
                <input type="radio" name="ap_<%= index %>" value="A" class="w-4 h-4">
                <span class="bg-red-200 dark:bg-red-900/50 text-red-700 dark:text-red-300 font-bold px-3 py-1 rounded">A</span>
              </label>
              <label class="inline-flex items-center gap-1">
                <input type="radio" name="ap_<%= index %>" value="P" class="w-4 h-4">
                <span class="bg-blue-200 dark:bg-blue-900/50 text-blue-700 dark:text-blue-300 font-bold px-3 py-1 rounded">P</span>
              </label>
            </div>
          </div>
        </div>
      <% end %>
    </div>
  </div>

  <!-- Exercise 4 -->
  <div class="p-4 md:p-6 pb-8" data-controller="word-highlighter" data-word-highlighter-multi-color-value="true">
    <h2 class="text-lg md:text-xl font-bold mb-4 flex items-center gap-2">
      <span class="flex-shrink-0 bg-<%= @pagina.base_color %>-500 text-white rounded-full w-8 h-8 md:w-10 md:h-10 inline-flex items-center justify-center">4</span>
      Clicca sugli aggettivi dimostrativi<span class="inline-block w-5 h-5 bg-red-300 rounded ml-1 cursor-pointer" data-word-highlighter-target="colorBox" data-color="red" data-action="click->word-highlighter#selectColor"></span> e sui pronomi dimostrativi<span class="inline-block w-5 h-5 bg-blue-300 rounded ml-1 cursor-pointer" data-word-highlighter-target="colorBox" data-color="blue" data-action="click->word-highlighter#selectColor"></span>.
    </h2>

    <div class="space-y-3 text-base md:text-lg cursor-pointer">
      <div class="bg-<%= @pagina.base_color %>-50 dark:bg-<%= @pagina.base_color %>-900/30 rounded-lg p-4">
        <p class="text-gray-700 dark:text-gray-200"><span class="text-<%= @pagina.base_color %>-500">•</span> <span class="transition" data-word-highlighter-target="word" data-action="click->word-highlighter#toggleHighlight" data-correct="red">Questo</span> libro è bello, ma preferisco <span class="transition" data-word-highlighter-target="word" data-action="click->word-highlighter#toggleHighlight" data-correct="blue">quello</span>.</p>
      </div>
      <div class="bg-<%= @pagina.base_color %>-50 dark:bg-<%= @pagina.base_color %>-900/30 rounded-lg p-4">
        <p class="text-gray-700 dark:text-gray-200"><span class="text-<%= @pagina.base_color %>-500">•</span> <span class="transition" data-word-highlighter-target="word" data-action="click->word-highlighter#toggleHighlight" data-correct="red">Questa</span> matita è <span class="transition" data-word-highlighter-target="word" data-action="click->word-highlighter#toggleHighlight" data-correct="red">la stessa</span> di ieri.</p>
      </div>
      <div class="bg-<%= @pagina.base_color %>-50 dark:bg-<%= @pagina.base_color %>-900/30 rounded-lg p-4">
        <p class="text-gray-700 dark:text-gray-200"><span class="text-<%= @pagina.base_color %>-500">•</span> <span class="transition" data-word-highlighter-target="word" data-action="click->word-highlighter#toggleHighlight" data-correct="red">Queste</span> scarpe sono comode, <span class="transition" data-word-highlighter-target="word" data-action="click->word-highlighter#toggleHighlight" data-correct="blue">quelle</span> no.</p>
      </div>
    </div>
  </div>

  <!-- Exercise 5 -->
  <div class="p-4 md:p-6 pb-8" data-controller="word-highlighter" data-word-highlighter-multi-color-value="false">
    <h2 class="text-lg md:text-xl font-bold mb-4 flex items-center gap-2">
      <span class="flex-shrink-0 bg-<%= @pagina.base_color %>-500 text-white rounded-full w-8 h-8 md:w-10 md:h-10 inline-flex items-center justify-center">5</span>
      Clicca su tutti gli indefiniti<span class="inline-block w-5 h-5 bg-yellow-300 rounded ml-1"></span>
    </h2>

    <!-- Color Selector (hidden for mono-color) -->
    <div class="hidden">
      <div class="w-6 h-6 bg-yellow-300" data-word-highlighter-target="colorBox" data-color="yellow"></div>
    </div>

    <div class="bg-<%= @pagina.base_color %>-50 dark:bg-<%= @pagina.base_color %>-900/30 rounded-lg p-4 cursor-pointer">
      <p class="text-base md:text-lg text-gray-700 dark:text-gray-200 leading-relaxed">
        Un giorno, <span class="transition" data-word-highlighter-target="word" data-action="click->word-highlighter#toggleHighlight" data-correct="yellow">alcuni</span> amici decisero di andare alla spiaggia.
        <span class="transition" data-word-highlighter-target="word" data-action="click->word-highlighter#toggleHighlight" data-correct="yellow">Qualcuno</span> aveva sentito parlare di una spiaggia nascosta dove
        <span class="transition" data-word-highlighter-target="word" data-action="click->word-highlighter#toggleHighlight" data-correct="yellow">nessuno</span> andava mai. <span class="transition" data-word-highlighter-target="word" data-action="click->word-highlighter#toggleHighlight" data-correct="yellow">Tutti</span> erano
        entusiasti dell'idea. <span class="transition" data-word-highlighter-target="word" data-action="click->word-highlighter#toggleHighlight" data-correct="yellow">Ciascuno</span> portò <span class="transition" data-word-highlighter-target="word" data-action="click->word-highlighter#toggleHighlight" data-correct="yellow">qualcosa</span>
        da mangiare e <span class="transition" data-word-highlighter-target="word" data-action="click->word-highlighter#toggleHighlight" data-correct="yellow">ognuno</span> si divertì molto. Non c'era
        <span class="transition" data-word-highlighter-target="word" data-action="click->word-highlighter#toggleHighlight" data-correct="yellow">niente</span> di meglio che trascorrere una giornata così bella insieme.
      </p>
    </div>
  </div>

  <!-- Exercise 6 -->
  <div class="p-4 md:p-6 pb-8">
    <h2 class="text-lg md:text-xl font-bold mb-4 flex items-center gap-2">
      <span class="flex-shrink-0 bg-<%= @pagina.base_color %>-500 text-white rounded-full w-8 h-8 md:w-10 md:h-10 inline-flex items-center justify-center">6</span>
      Scrivi due frasi per ciascuno: "che" e "quanto" (prima aggettivo, poi pronome).
    </h2>

    <div class="space-y-4 text-base md:text-lg">
      <% ['"che" - aggettivo', '"che" - pronome', '"quanto" - aggettivo', '"quanto" - pronome'].each do |label| %>
        <div class="rounded-lg p-3">
          <p class="font-semibold text-gray-700 dark:text-gray-200 mb-2"><%= label %>:</p>
          <textarea class="w-full border-2 border-<%= @pagina.base_color %>-200 dark:border-<%= @pagina.base_color %>-700 bg-transparent dark:text-white rounded-lg px-3 py-2 focus:outline-none focus:border-<%= @pagina.base_color %>-500"
                    rows="2" placeholder="Scrivi qui..."></textarea>
        </div>
      <% end %>
    </div>
  </div>

  <!-- Exercise 7 -->
  <div class="p-4 md:p-6 pb-8" data-controller="multiple-choice">
    <h2 class="text-lg md:text-xl font-bold mb-4 flex items-center gap-2">
      <span class="flex-shrink-0 bg-<%= @pagina.base_color %>-500 text-white rounded-full w-8 h-8 md:w-10 md:h-10 inline-flex items-center justify-center">7</span>
      Completa tre frasi scegliendo il pronome relativo corretto tra che/le quali/cui.
    </h2>

    <% relative_sentences = [
      { before: "La ragazza", options: ["che", "cui", "la quale"], correct: "che", after: "hai incontrato è mia sorella." },
      { before: "Il libro di", options: ["che", "cui", "il quale"], correct: "cui", after: "ti ho parlato è interessante." },
      { before: "Le amiche", options: ["che", "cui", "le quali"], correct: "le quali", after: "sono venute alla festa si sono divertite." }
    ] %>

    <div class="space-y-3 text-base md:text-lg">
      <% relative_sentences.each_with_index do |item, index| %>
        <div class="rounded-lg p-3">
          <p class="text-gray-700 dark:text-gray-200 flex flex-wrap items-center gap-2">
            <span class="text-<%= @pagina.base_color %>-500">•</span>
            <span><%= item[:before] %></span>
            <% item[:options].each do |option| %>
              <label class="inline-flex items-center gap-1 cursor-pointer">
                <input type="radio" name="rel_<%= index %>" value="<%= option %>" class="w-4 h-4" data-multiple-choice-target="input" data-answer="<%= item[:correct] %>">
                <span class="font-semibold dark:text-white"><%= option %></span>
              </label>
            <% end %>
            <span><%= item[:after] %></span>
          </p>
        </div>
      <% end %>
    </div>
  </div>

  <%= render 'shared/exercise_controls' %>
</div>
