<div class="max-w-6xl mx-auto p-3 md:p-8 bg-gradient-to-br from-purple-50 via-white to-pink-50 rounded-3xl shadow-xl" data-controller="exercise-checker">

  <%= render 'shared/page_header', pagina: @pagina %>

  <!-- Nota consulta mappe -->
  <div class="mb-6 bg-blue-50 border-3 border-blue-300 rounded-xl p-4">
    <p class="text-base md:text-lg text-gray-700 font-semibold">
      Consulta le pp. 3-5 del blocco mappe.
    </p>
  </div>

  <!-- Exercise 1 -->
  <div class="mb-6 bg-white rounded-2xl border-4 border-blue-200 shadow-2xl p-4 md:p-6" data-controller="word-highlighter" data-word-highlighter-multi-color-value="false">
    <h2 class="text-lg md:text-xl font-bold text-blue-700 mb-4 flex items-center flex-wrap gap-2">
      <span class="bg-blue-600 text-white rounded-full w-8 h-8 md:w-10 md:h-10 inline-flex items-center justify-center">1</span>
      <span>Clicca sugli aggettivi qualificativi <span class="inline-block w-4 h-4 bg-yellow-300 rounded ml-1 align-middle"></span></span>
    </h2>

    <!-- Color Selector (hidden for mono-color) -->
    <div class="hidden">
      <div class="w-6 h-6 bg-yellow-300"
           data-word-highlighter-target="colorBox"
           data-color="yellow">
      </div>
    </div>

    <div class="space-y-3 text-base md:text-lg cursor-pointer">
      <div class="bg-blue-50 border-2 border-blue-200 rounded-xl px-4 py-3">
        <p class="text-gray-700">• Il <span class="transition" data-word-highlighter-target="word" data-action="click->word-highlighter#toggleHighlight" data-correct="yellow">bel</span> vestito è in vetrina.</p>
      </div>
      <div class="bg-blue-50 border-2 border-blue-200 rounded-xl px-4 py-3">
        <p class="text-gray-700">• La <span class="transition" data-word-highlighter-target="word" data-action="click->word-highlighter#toggleHighlight" data-correct="yellow">nuova</span> insegnante è molto <span class="transition" data-word-highlighter-target="word" data-action="click->word-highlighter#toggleHighlight" data-correct="yellow">simpatica</span>.</p>
      </div>
      <div class="bg-blue-50 border-2 border-blue-200 rounded-xl px-4 py-3">
        <p class="text-gray-700">• Ho comprato dei <span class="transition" data-word-highlighter-target="word" data-action="click->word-highlighter#toggleHighlight" data-correct="yellow">bellissimi</span> fiori <span class="transition" data-word-highlighter-target="word" data-action="click->word-highlighter#toggleHighlight" data-correct="yellow">profumati</span>.</p>
      </div>
      <div class="bg-blue-50 border-2 border-blue-200 rounded-xl px-4 py-3">
        <p class="text-gray-700">• La giornata <span class="transition" data-word-highlighter-target="word" data-action="click->word-highlighter#toggleHighlight" data-correct="yellow">piovosa</span> mi rende <span class="transition" data-word-highlighter-target="word" data-action="click->word-highlighter#toggleHighlight" data-correct="yellow">triste</span>.</p>
      </div>
    </div>
  </div>

  <!-- Exercise 2 -->
  <div class="mb-6 bg-white rounded-2xl border-4 border-green-200 shadow-2xl p-4 md:p-6" data-controller="word-highlighter" data-word-highlighter-multi-color-value="true">
    <h2 class="text-lg md:text-xl font-bold text-green-700 mb-4 flex items-center flex-wrap gap-2">
      <span class="bg-green-600 text-white rounded-full w-8 h-8 md:w-10 md:h-10 inline-flex items-center justify-center">2</span>
      <span>Clicca sui <span class="text-yellow-600">pronomi soggetto<span class="inline-block w-6 h-6 bg-yellow-300 rounded ml-1 align-middle cursor-pointer transition transform hover:scale-110" data-word-highlighter-target="colorBox" data-color="yellow" data-action="click->word-highlighter#selectColor"></span></span> e sui <span class="text-green-600">pronomi complemento<span class="inline-block w-6 h-6 bg-green-300 rounded ml-1 align-middle cursor-pointer transition transform hover:scale-110" data-word-highlighter-target="colorBox" data-color="green" data-action="click->word-highlighter#selectColor"></span></span>.</span>
    </h2>

    <div class="space-y-3 text-base md:text-lg cursor-pointer">
      <div class="bg-green-50 border-2 border-green-200 rounded-xl px-4 py-3">
        <p class="text-gray-700">• <span class="transition" data-word-highlighter-target="word" data-action="click->word-highlighter#toggleHighlight" data-correct="yellow">Io</span> <span class="transition" data-word-highlighter-target="word" data-action="click->word-highlighter#toggleHighlight" data-correct="green">ti</span> aspetto domani.</p>
      </div>
      <div class="bg-green-50 border-2 border-green-200 rounded-xl px-4 py-3">
        <p class="text-gray-700">• <span class="transition" data-word-highlighter-target="word" data-action="click->word-highlighter#toggleHighlight" data-correct="yellow">Tu</span> <span class="transition" data-word-highlighter-target="word" data-action="click->word-highlighter#toggleHighlight" data-correct="green">mi</span> hai chiamato ieri sera.</p>
      </div>
      <div class="bg-green-50 border-2 border-green-200 rounded-xl px-4 py-3">
        <p class="text-gray-700">• <span class="transition" data-word-highlighter-target="word" data-action="click->word-highlighter#toggleHighlight" data-correct="yellow">Lei</span> <span class="transition" data-word-highlighter-target="word" data-action="click->word-highlighter#toggleHighlight" data-correct="green">ci</span> ha regalato un libro.</p>
      </div>
      <div class="bg-green-50 border-2 border-green-200 rounded-xl px-4 py-3">
        <p class="text-gray-700">• <span class="transition" data-word-highlighter-target="word" data-action="click->word-highlighter#toggleHighlight" data-correct="yellow">Noi</span> <span class="transition" data-word-highlighter-target="word" data-action="click->word-highlighter#toggleHighlight" data-correct="green">li</span> abbiamo incontrati al parco.</p>
      </div>
    </div>
  </div>

  <!-- Exercise 3 -->
  <div class="mb-6 bg-white rounded-2xl border-4 border-purple-200 shadow-2xl p-4 md:p-6" data-controller="fill-blanks">
    <h2 class="text-lg md:text-xl font-bold text-purple-700 mb-4">
      <span class="bg-purple-600 text-white rounded-full w-8 h-8 md:w-10 md:h-10 inline-flex items-center justify-center mr-2">3</span>
      Completa con aggettivi/pronomi possessivi, poi indica A o P.
    </h2>

    <div class="space-y-3 text-base md:text-lg">
      <% ap_items = [
        { text: "La", answer: "mia", continuation: "casa è grande.", correct: "A" },
        { text: "Il", answer: "tuo", continuation: "libro è interessante.", correct: "A" },
        { text: "Ho perso la penna, ho bisogno della", answer: "tua", continuation: ".", correct: "P" }
      ] %>

      <% ap_items.each_with_index do |item, index| %>
        <div class="bg-purple-50 border-2 border-purple-200 rounded-xl px-4 py-3">
          <div class="flex flex-col md:flex-row md:items-center gap-3">
            <div class="flex-1">
              <p class="text-gray-700">
                • <%= item[:text] %>
                <input type="text"
                       class="border-b-2 border-purple-500 bg-transparent px-2 py-1 w-24 focus:outline-none"
                       data-fill-blanks-target="input"
                       data-answer="<%= item[:answer] %>"
                       data-correct-answer="<%= item[:answer] %>"
                       placeholder=".....">
                <%= item[:continuation] %>
              </p>
            </div>
            <div class="flex gap-2">
              <label class="inline-flex items-center gap-1">
                <input type="radio" name="ap_<%= index %>" value="A" class="w-4 h-4">
                <span class="bg-red-200 text-red-700 font-bold px-3 py-1 rounded">A</span>
              </label>
              <label class="inline-flex items-center gap-1">
                <input type="radio" name="ap_<%= index %>" value="P" class="w-4 h-4">
                <span class="bg-blue-200 text-blue-700 font-bold px-3 py-1 rounded">P</span>
              </label>
            </div>
          </div>
        </div>
      <% end %>
    </div>
  </div>

  <!-- Exercise 4 -->
  <div class="mb-6 bg-white rounded-2xl border-4 border-orange-200 shadow-2xl p-4 md:p-6" data-controller="word-highlighter" data-word-highlighter-multi-color-value="true">
    <h2 class="text-lg md:text-xl font-bold text-orange-700 mb-4 flex items-center flex-wrap gap-2">
      <span class="bg-orange-600 text-white rounded-full w-8 h-8 md:w-10 md:h-10 inline-flex items-center justify-center">4</span>
      <span>Clicca sugli <span class="text-red-600">aggettivi dimostrativi<span class="inline-block w-6 h-6 bg-red-300 rounded ml-1 align-middle cursor-pointer transition transform hover:scale-110" data-word-highlighter-target="colorBox" data-color="red" data-action="click->word-highlighter#selectColor"></span></span> e sui <span class="text-blue-600">pronomi dimostrativi<span class="inline-block w-6 h-6 bg-blue-300 rounded ml-1 align-middle cursor-pointer transition transform hover:scale-110" data-word-highlighter-target="colorBox" data-color="blue" data-action="click->word-highlighter#selectColor"></span></span>.</span>
    </h2>

    <div class="space-y-3 text-base md:text-lg cursor-pointer">
      <div class="bg-orange-50 border-2 border-orange-200 rounded-xl px-4 py-3">
        <p class="text-gray-700">• <span class="transition" data-word-highlighter-target="word" data-action="click->word-highlighter#toggleHighlight" data-correct="red">Questo</span> libro è bello, ma preferisco <span class="transition" data-word-highlighter-target="word" data-action="click->word-highlighter#toggleHighlight" data-correct="blue">quello</span>.</p>
      </div>
      <div class="bg-orange-50 border-2 border-orange-200 rounded-xl px-4 py-3">
        <p class="text-gray-700">• <span class="transition" data-word-highlighter-target="word" data-action="click->word-highlighter#toggleHighlight" data-correct="red">Questa</span> matita è <span class="transition" data-word-highlighter-target="word" data-action="click->word-highlighter#toggleHighlight" data-correct="red">la stessa</span> di ieri.</p>
      </div>
      <div class="bg-orange-50 border-2 border-orange-200 rounded-xl px-4 py-3">
        <p class="text-gray-700">• <span class="transition" data-word-highlighter-target="word" data-action="click->word-highlighter#toggleHighlight" data-correct="red">Queste</span> scarpe sono comode, <span class="transition" data-word-highlighter-target="word" data-action="click->word-highlighter#toggleHighlight" data-correct="blue">quelle</span> no.</p>
      </div>
    </div>
  </div>

  <!-- Exercise 5 -->
  <div class="mb-6 bg-white rounded-2xl border-4 border-pink-200 shadow-2xl p-4 md:p-6" data-controller="word-highlighter" data-word-highlighter-multi-color-value="false">
    <h2 class="text-lg md:text-xl font-bold text-pink-700 mb-4 flex items-center flex-wrap gap-2">
      <span class="bg-pink-600 text-white rounded-full w-8 h-8 md:w-10 md:h-10 inline-flex items-center justify-center">5</span>
      <span>Clicca su tutti gli indefiniti <span class="inline-block w-4 h-4 bg-yellow-300 rounded ml-1 align-middle"></span></span>
    </h2>

    <!-- Color Selector (hidden for mono-color) -->
    <div class="hidden">
      <div class="w-6 h-6 bg-yellow-300"
           data-word-highlighter-target="colorBox"
           data-color="yellow">
      </div>
    </div>

    <div class="bg-pink-50 border-2 border-pink-200 rounded-xl px-4 py-3 cursor-pointer">
      <p class="text-base md:text-lg text-gray-700 leading-relaxed">
        Un giorno, <span class="transition" data-word-highlighter-target="word" data-action="click->word-highlighter#toggleHighlight" data-correct="yellow">alcuni</span> amici decisero di andare alla spiaggia.
        <span class="transition" data-word-highlighter-target="word" data-action="click->word-highlighter#toggleHighlight" data-correct="yellow">Qualcuno</span> aveva sentito parlare di una spiaggia nascosta dove
        <span class="transition" data-word-highlighter-target="word" data-action="click->word-highlighter#toggleHighlight" data-correct="yellow">nessuno</span> andava mai. <span class="transition" data-word-highlighter-target="word" data-action="click->word-highlighter#toggleHighlight" data-correct="yellow">Tutti</span> erano
        entusiasti dell'idea. <span class="transition" data-word-highlighter-target="word" data-action="click->word-highlighter#toggleHighlight" data-correct="yellow">Ciascuno</span> portò <span class="transition" data-word-highlighter-target="word" data-action="click->word-highlighter#toggleHighlight" data-correct="yellow">qualcosa</span>
        da mangiare e <span class="transition" data-word-highlighter-target="word" data-action="click->word-highlighter#toggleHighlight" data-correct="yellow">ognuno</span> si divertì molto. Non c'era
        <span class="transition" data-word-highlighter-target="word" data-action="click->word-highlighter#toggleHighlight" data-correct="yellow">niente</span> di meglio che trascorrere una giornata così bella insieme.
      </p>
    </div>
  </div>

  <!-- Exercise 6 -->
  <div class="mb-6 bg-white rounded-2xl border-4 border-cyan-200 shadow-2xl p-4 md:p-6">
    <h2 class="text-lg md:text-xl font-bold text-cyan-700 mb-4">
      <span class="bg-cyan-600 text-white rounded-full w-8 h-8 md:w-10 md:h-10 inline-flex items-center justify-center mr-2">6</span>
      Scrivi due frasi per ciascuno: "che" e "quanto" (prima aggettivo, poi pronome).
    </h2>

    <div class="space-y-4">
      <div class="bg-cyan-50 border-2 border-cyan-200 rounded-xl px-4 py-3">
        <p class="font-semibold text-gray-700 mb-2">"che" - aggettivo:</p>
        <textarea class="w-full border-2 border-cyan-300 rounded-lg px-3 py-2 focus:outline-none"
                  rows="2" placeholder="Scrivi qui..."></textarea>
      </div>

      <div class="bg-cyan-50 border-2 border-cyan-200 rounded-xl px-4 py-3">
        <p class="font-semibold text-gray-700 mb-2">"che" - pronome:</p>
        <textarea class="w-full border-2 border-cyan-300 rounded-lg px-3 py-2 focus:outline-none"
                  rows="2" placeholder="Scrivi qui..."></textarea>
      </div>

      <div class="bg-cyan-50 border-2 border-cyan-200 rounded-xl px-4 py-3">
        <p class="font-semibold text-gray-700 mb-2">"quanto" - aggettivo:</p>
        <textarea class="w-full border-2 border-cyan-300 rounded-lg px-3 py-2 focus:outline-none"
                  rows="2" placeholder="Scrivi qui..."></textarea>
      </div>

      <div class="bg-cyan-50 border-2 border-cyan-200 rounded-xl px-4 py-3">
        <p class="font-semibold text-gray-700 mb-2">"quanto" - pronome:</p>
        <textarea class="w-full border-2 border-cyan-300 rounded-lg px-3 py-2 focus:outline-none"
                  rows="2" placeholder="Scrivi qui..."></textarea>
      </div>
    </div>
  </div>

  <!-- Exercise 7 -->
  <div class="mb-6 bg-white rounded-2xl border-4 border-indigo-200 shadow-2xl p-4 md:p-6" data-controller="multiple-choice">
    <h2 class="text-lg md:text-xl font-bold text-indigo-700 mb-4">
      <span class="bg-indigo-600 text-white rounded-full w-8 h-8 md:w-10 md:h-10 inline-flex items-center justify-center mr-2">7</span>
      Completa tre frasi scegliendo il pronome relativo corretto tra che/le quali/cui.
    </h2>

    <div class="space-y-3 text-base md:text-lg">
      <% relative_sentences = [
        { before: "La ragazza", options: ["che", "cui", "la quale"], correct: "che", after: "hai incontrato è mia sorella." },
        { before: "Il libro di", options: ["che", "cui", "il quale"], correct: "cui", after: "ti ho parlato è interessante." },
        { before: "Le amiche", options: ["che", "cui", "le quali"], correct: "le quali", after: "sono venute alla festa si sono divertite." }
      ] %>

      <% relative_sentences.each_with_index do |item, index| %>
        <div class="bg-indigo-50 border-2 border-indigo-200 rounded-xl px-4 py-3">
          <p class="text-gray-700 flex flex-wrap items-center gap-2">
            • <%= item[:before] %>
            <% item[:options].each do |option| %>
              <label class="inline-flex items-center gap-1 cursor-pointer">
                <input type="radio"
                       name="rel_<%= index %>"
                       value="<%= option %>"
                       class="w-4 h-4"
                       data-multiple-choice-target="input"
                       data-answer="<%= item[:correct] %>">
                <span class="font-semibold"><%= option %></span>
              </label>
            <% end %>
            <%= item[:after] %>
          </p>
        </div>
      <% end %>
    </div>
  </div>

  <%= render partial: "shared/exercise_controls" %>

</div>
