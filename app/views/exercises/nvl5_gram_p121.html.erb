<div class="max-w-6xl mx-auto bg-white dark:bg-gray-900 text-black dark:text-white p-3 md:p-6 transition-colors duration-300"
     data-controller="exercise-checker text-toggle font-controls"
     data-text-toggle-target="content"
     data-font-controls-target="content">

  <%= render 'shared/page_header', pagina: @pagina %>

  <!-- Esempio iniziale -->
  <div class="bg-<%= @pagina.base_color %>-50 dark:bg-<%= @pagina.base_color %>-900/30 p-4 md:p-6 pb-8 rounded-lg">
    <p class="text-gray-700 dark:text-gray-200 font-semibold mb-4">
      <span class="text-<%= @pagina.base_color %>-500 dark:text-<%= @pagina.base_color %>-400">•</span> <em class="underline">Il vento</em> <span class="underline">ha fatto cadere</span> <em class="underline">le fioriere</em>
      <span class="underline">dalla terrazza</span> <span class="underline">al marciapiede</span>.
    </p>
    <div class="flex items-center justify-center gap-2 mb-4 flex-wrap">
      <div class="border border-red-400 dark:border-red-600 rounded-lg px-3 py-2 bg-red-50 dark:bg-red-900/30">
        <span class="font-bold text-red-700 dark:text-red-400">Il vento</span>
      </div>
      <span class="dark:text-gray-400">—</span>
      <div class="border border-blue-400 dark:border-blue-600 rounded-lg px-3 py-2 bg-blue-50 dark:bg-blue-900/30 whitespace-nowrap">
        <span class="font-bold text-blue-700 dark:text-blue-400">ha fatto cadere</span>
      </div>
      <span class="dark:text-gray-400">—</span>
      <div class="border border-pink-400 dark:border-pink-600 rounded-lg px-3 py-2 bg-pink-50 dark:bg-pink-900/30">
        <span class="font-bold text-pink-700 dark:text-pink-400">le fioriere</span>
      </div>
      <span class="dark:text-gray-400">—</span>
      <div class="border border-green-400 dark:border-green-600 rounded-lg px-3 py-2 bg-green-50 dark:bg-green-900/30 whitespace-nowrap">
        <span class="font-bold text-green-700 dark:text-green-400">dalla terrazza</span>
      </div>
      <span class="dark:text-gray-400">—</span>
      <div class="border border-green-400 dark:border-green-600 rounded-lg px-3 py-2 bg-green-50 dark:bg-green-900/30 whitespace-nowrap">
        <span class="font-bold text-green-700 dark:text-green-400">al marciapiede</span>
      </div>
    </div>
    <p class="text-gray-700 dark:text-gray-200">
      Il nucleo della frase sono il <span class="underline font-bold text-blue-600 dark:text-blue-400">verbo</span>
      + l'<em class="underline font-bold text-red-600 dark:text-red-400">argomento soggetto</em>
      + l'<em class="underline font-bold text-pink-600 dark:text-pink-400">argomento oggetto diretto</em>
      + 2 <span class="underline font-bold text-green-600 dark:text-green-400">argomenti oggetto indiretti</span>
    </p>
  </div>

  <!-- Esercizio 1 - IMPARARE TUTTI -->
  <div class="bg-<%= @pagina.base_color %>-100 dark:bg-<%= @pagina.base_color %>-900/40 p-4 md:p-6 pb-8 rounded-lg" data-controller="word-choice">
    <h2 class="font-bold mb-4 flex items-center gap-2">
      <span class="flex-shrink-0 bg-<%= @pagina.base_color %>-500 text-white rounded-full w-8 h-8 md:w-10 md:h-10 inline-flex items-center justify-center">1</span>
      <span class="bg-yellow-400 dark:bg-yellow-500 text-blue-900 dark:text-blue-950 px-3 py-1 rounded-lg font-bold">IMPARARE TUTTI</span>
      Leggi e colora il cartellino con l'argomento necessario al verbo per completare il significato.
    </h2>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <% [
        { frase: "È", blank: true, opzioni: [{testo: "buio", corretto: true}, {testo: "allora", corretto: false}] },
        { frase: "", blank: true, opzioni: [{testo: "Anna", corretto: true}, {testo: "ora", corretto: false}], dopo: "dorme." },
        { frase: "Il cane insegue", blank: true, opzioni: [{testo: "il gatto", corretto: true}, {testo: "in giardino", corretto: false}] },
        { frase: "Franco pulisce", blank: true, opzioni: [{testo: "i vetri", corretto: true}, {testo: "con cura", corretto: false}], dopo: "della macchina." },
        { frase: "Mark accompagna", blank: true, opzioni: [{testo: "il fratello", corretto: true}, {testo: "da scuola", corretto: false}], dopo: "a casa." },
        { frase: "Leonardo litiga", blank: true, opzioni: [{testo: "con Anna", corretto: true}, {testo: "in cucina", corretto: false}] },
        { frase: "Marin consegna", blank: true, opzioni: [{testo: "le chiavi", corretto: true}, {testo: "tutti i giorni", corretto: false}], dopo: "alla zia." }
      ].each_with_index do |item, idx| %>
        <div class="bg-white dark:bg-gray-800 rounded-lg p-4">
          <p class="text-gray-700 dark:text-gray-200 mb-3">
            <span class="text-<%= @pagina.base_color %>-500 dark:text-<%= @pagina.base_color %>-400">•</span> <%= item[:frase] %>
            <span class="inline-block min-w-[120px] border-b-2 border-dotted border-<%= @pagina.base_color %>-400 dark:border-<%= @pagina.base_color %>-600 mx-2 align-bottom">
              <% item[:opzioni].each do |opt| %>
                <span class="inline-block px-3 py-1 border border-<%= @pagina.base_color %>-400 dark:border-<%= @pagina.base_color %>-600 rounded-lg cursor-pointer hover:bg-<%= @pagina.base_color %>-100 dark:hover:bg-<%= @pagina.base_color %>-900/40 transition mr-2 mb-1"
                      data-word-choice-target="word"
                      data-group="frase_<%= idx %>"
                      data-correct="<%= opt[:corretto] %>"
                      data-action="click->word-choice#selectWord">
                  <%= opt[:testo] %>
                </span>
              <% end %>
            </span>
            <%= item[:dopo] %>
          </p>
        </div>
      <% end %>
    </div>
  </div>

  <!-- Esercizio 2 - Argomenti indispensabili -->
  <div class="bg-<%= @pagina.base_color %>-50 dark:bg-<%= @pagina.base_color %>-900/30 p-4 md:p-6 pb-8 rounded-lg" data-controller="fill-blanks">
    <h2 class="font-bold mb-4 flex items-center gap-2">
      <span class="flex-shrink-0 bg-<%= @pagina.base_color %>-500 text-white rounded-full w-8 h-8 md:w-10 md:h-10 inline-flex items-center justify-center">2</span>
      Osserva gli schemi e scrivi gli argomenti indispensabili per completare il significato dei verbi dati.
    </h2>

    <div class="space-y-4">
      <div class="bg-white dark:bg-gray-800 rounded-lg p-4">
        <p class="text-gray-700 dark:text-gray-200">
          <span class="text-<%= @pagina.base_color %>-500 dark:text-<%= @pagina.base_color %>-400">•</span>
          <input type="text" class="border-b-2 border-dotted border-<%= @pagina.base_color %>-500 dark:border-<%= @pagina.base_color %>-400 px-2 py-1 min-w-[200px] focus:outline-none bg-transparent dark:text-white" data-fill-blanks-target="input" data-correct-answer="libera" placeholder="..."> sbadiglia.
        </p>
        <p class="text-gray-500 dark:text-gray-400 mt-2 italic">Risposta libera - soggetto necessario</p>
      </div>

      <div class="bg-white dark:bg-gray-800 rounded-lg p-4">
        <p class="text-gray-700 dark:text-gray-200">
          <span class="text-<%= @pagina.base_color %>-500 dark:text-<%= @pagina.base_color %>-400">•</span> Lucien
          <input type="text" class="border-b-2 border-dotted border-<%= @pagina.base_color %>-500 dark:border-<%= @pagina.base_color %>-400 px-2 py-1 min-w-[200px] focus:outline-none bg-transparent dark:text-white" data-fill-blanks-target="input" data-correct-answer="libera" placeholder="..."> a pallavolo.
        </p>
        <p class="text-gray-500 dark:text-gray-400 mt-2 italic">Risposta libera - verbo necessario</p>
      </div>

      <div class="bg-white dark:bg-gray-800 rounded-lg p-4">
        <p class="text-gray-700 dark:text-gray-200">
          <span class="text-<%= @pagina.base_color %>-500 dark:text-<%= @pagina.base_color %>-400">•</span> Brando
          <input type="text" class="border-b-2 border-dotted border-<%= @pagina.base_color %>-500 dark:border-<%= @pagina.base_color %>-400 px-2 py-1 min-w-[150px] focus:outline-none bg-transparent dark:text-white" data-fill-blanks-target="input" data-correct-answer="libera" placeholder="..."> un consiglio
          <input type="text" class="border-b-2 border-dotted border-<%= @pagina.base_color %>-500 dark:border-<%= @pagina.base_color %>-400 px-2 py-1 min-w-[150px] focus:outline-none bg-transparent dark:text-white" data-fill-blanks-target="input" data-correct-answer="libera" placeholder="...">.
        </p>
        <p class="text-gray-500 dark:text-gray-400 mt-2 italic">Risposta libera - verbo + argomento indiretto</p>
      </div>

      <div class="bg-white dark:bg-gray-800 rounded-lg p-4">
        <p class="text-gray-700 dark:text-gray-200">
          <span class="text-<%= @pagina.base_color %>-500 dark:text-<%= @pagina.base_color %>-400">•</span>
          <input type="text" class="border-b-2 border-dotted border-<%= @pagina.base_color %>-500 dark:border-<%= @pagina.base_color %>-400 px-2 py-1 min-w-[150px] focus:outline-none bg-transparent dark:text-white" data-fill-blanks-target="input" data-correct-answer="libera" placeholder="..."> mangerà
          <input type="text" class="border-b-2 border-dotted border-<%= @pagina.base_color %>-500 dark:border-<%= @pagina.base_color %>-400 px-2 py-1 min-w-[150px] focus:outline-none bg-transparent dark:text-white" data-fill-blanks-target="input" data-correct-answer="libera" placeholder="...">.
        </p>
        <p class="text-gray-500 dark:text-gray-400 mt-2 italic">Risposta libera - soggetto + oggetto diretto</p>
      </div>

      <div class="bg-white dark:bg-gray-800 rounded-lg p-4">
        <p class="text-gray-700 dark:text-gray-200">
          <span class="text-<%= @pagina.base_color %>-500 dark:text-<%= @pagina.base_color %>-400">•</span> Giorgio e Marco regaleranno
          <input type="text" class="border-b-2 border-dotted border-<%= @pagina.base_color %>-500 dark:border-<%= @pagina.base_color %>-400 px-2 py-1 min-w-[200px] focus:outline-none bg-transparent dark:text-white" data-fill-blanks-target="input" data-correct-answer="libera" placeholder="...">.
        </p>
        <p class="text-gray-500 dark:text-gray-400 mt-2 italic">Risposta libera - argomento necessario</p>
      </div>

      <div class="bg-white dark:bg-gray-800 rounded-lg p-4">
        <p class="text-gray-700 dark:text-gray-200">
          <span class="text-<%= @pagina.base_color %>-500 dark:text-<%= @pagina.base_color %>-400">•</span> Vera offre
          <input type="text" class="border-b-2 border-dotted border-<%= @pagina.base_color %>-500 dark:border-<%= @pagina.base_color %>-400 px-2 py-1 min-w-[200px] focus:outline-none bg-transparent dark:text-white" data-fill-blanks-target="input" data-correct-answer="libera" placeholder="...">.
        </p>
        <p class="text-gray-500 dark:text-gray-400 mt-2 italic">Risposta libera - argomento necessario</p>
      </div>

      <div class="bg-white dark:bg-gray-800 rounded-lg p-4">
        <p class="text-gray-700 dark:text-gray-200">
          <span class="text-<%= @pagina.base_color %>-500 dark:text-<%= @pagina.base_color %>-400">•</span> L'autobus 36 va
          <input type="text" class="border-b-2 border-dotted border-<%= @pagina.base_color %>-500 dark:border-<%= @pagina.base_color %>-400 px-2 py-1 min-w-[200px] focus:outline-none bg-transparent dark:text-white" data-fill-blanks-target="input" data-correct-answer="libera" placeholder="...">.
        </p>
        <p class="text-gray-500 dark:text-gray-400 mt-2 italic">Risposta libera - argomento di luogo necessario</p>
      </div>
    </div>
  </div>

  <!-- Box PER L'INSEGNANTE -->
  <div class="bg-amber-50 dark:bg-amber-900/30 rounded-lg p-4 mb-6">
    <div class="flex items-start gap-4">
      <div class="bg-amber-500 dark:bg-amber-600 text-white px-4 py-2 rounded-lg font-bold">
        PER L'INSEGNANTE
      </div>
      <div class="flex-1">
        <p class="text-gray-700 dark:text-gray-200 mb-2">
          Vuoi saperne di più sulla grammatica valenziale?<br>
          Inquadra il qrcode e scopri i materiali <strong>Giunti Scuola</strong>.
        </p>
      </div>
    </div>
  </div>

  <%= render 'shared/exercise_controls' %>
</div>
