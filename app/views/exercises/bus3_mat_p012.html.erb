<% content_for :titolo, "#{@pagina.titolo} - #{@pagina.numero}" %>

<div class="max-w-7xl mx-auto p-3 md:p-6 bg-white dark:bg-gray-900 text-black dark:text-white transition-colors duration-300"
     data-controller="exercise-checker text-toggle font-controls"
     data-text-toggle-target="content"
     data-font-controls-target="content">
  
  <!-- Header -->
  <%= render 'shared/page_header', pagina: @pagina %>

  <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
    <!-- Colonna sinistra -->
    <div class="space-y-8">
      <!-- Esercizio 1: Scrivi i numeri in lettere -->
      <div class="bg-transparent p-4" data-controller="fill-blanks">
        
        <p class="text-gray-700 dark:text-gray-200 mb-4">
          <%= numero_esercizio_badge(1, colore: 'red-500') %>
          Scrivi i numeri in lettere.
        </p>

        <div class="space-y-3">
          <div class="flex items-center gap-3">
            <span class="font-bold min-w-[60px]">856</span>
            <span class="text-red-600 dark:text-red-400">→</span>
            <input type="text" data-fill-blanks-target="input" data-correct-answer="ottocentocinquantasei"
                   class="w-full px-3 py-2 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold bg-transparent dark:text-white"
                   maxlength="25">
          </div>

          <div class="flex items-center gap-3">
            <span class="font-bold min-w-[60px]">799</span>
            <span class="text-red-600 dark:text-red-400">→</span>
            <input type="text" data-fill-blanks-target="input" data-correct-answer="settecentonovantanove"
                   class="w-full px-3 py-2 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold bg-transparent dark:text-white"
                   maxlength="25">
          </div>

          <div class="flex items-center gap-3">
            <span class="font-bold min-w-[60px]">317</span>
            <span class="text-red-600 dark:text-red-400">→</span>
            <input type="text" data-fill-blanks-target="input" data-correct-answer="trecentodiciassette"
                   class="w-full px-3 py-2 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold bg-transparent dark:text-white"
                   maxlength="25">
          </div>
        </div>
      </div>

      <!-- Esercizio 2: Scrivi i numeri in cifre -->
      <div class="bg-transparent p-4" data-controller="fill-blanks">
        
        <p class="text-gray-700 dark:text-gray-200 mb-4">
          <%= numero_esercizio_badge(2, colore: 'red-500') %>
          Scrivi i numeri in cifre.
        </p>

        <div class="space-y-3">
          <div class="flex items-center justify-between flex-wrap gap-3">
            <span>novecentosettantaquattro</span>
            <span>
              <span class="text-red-600 dark:text-red-400">→</span>
              <input type="text" data-fill-blanks-target="input" data-correct-answer="974"
                    class="w-24 px-3 py-2 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold bg-transparent dark:text-white"
                    maxlength="3" inputmode="numeric">
            </span>
          </div>

          <div class="flex items-center justify-between flex-wrap gap-3">
            <span>duecentodiciannove</span>
            <div>
              <span class="text-red-600 dark:text-red-400">→</span>
              <input type="text" data-fill-blanks-target="input" data-correct-answer="219"
                    class="w-24 px-3 py-2 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold bg-transparent dark:text-white"
                    maxlength="3" inputmode="numeric">
            </div>
          </div>

          <div class="flex items-center justify-between flex-wrap gap-3">
            <span>seicentosessantatré</span>
            <div>
              <span class="text-red-600 dark:text-red-400">→</span>
              <input type="text" data-fill-blanks-target="input" data-correct-answer="663"
                    class="w-24 px-3 py-2 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold bg-transparent dark:text-white"
                    maxlength="3" inputmode="numeric">
            </div>
          </div>
        </div>
      </div>

      <!-- Esercizio 3: Collega ogni numero alla scomposizione giusta -->
      <div class="bg-transparent p-4" data-controller="flower-matcher">
        
        <p class="text-gray-700 dark:text-gray-200 mb-4">
          <%= numero_esercizio_badge(3, colore: 'red-500') %>
          Collega ogni numero alla scomposizione giusta.
        </p>

        <div class="relative">
          <!-- SVG Canvas per disegnare le linee -->
          <svg class="absolute top-0 left-0 w-full h-full pointer-events-none z-30"
               data-flower-matcher-target="canvas">
          </svg>

          <!-- Tronchi superiori -->
          <div class="flex justify-around mb-8 relative z-20">
            <div class="bg-amber-700 text-white rounded-full px-6 py-3 cursor-pointer hover:bg-amber-600 transition border-4 border-amber-900"
                 data-action="click->flower-matcher#selectFlower"
                 data-flower-matcher-target="flower"
                 data-flower-id="top-0"
                 data-pair="pair-593">
              <p class="font-bold text-center whitespace-nowrap">
                9 da, 3 u, 5 h
              </p>
            </div>
            <div class="bg-amber-700 text-white rounded-full px-6 py-3 cursor-pointer hover:bg-amber-600 transition border-4 border-amber-900"
                 data-action="click->flower-matcher#selectFlower"
                 data-flower-matcher-target="flower"
                 data-flower-id="top-1"
                 data-pair="pair-503">
              <p class="font-bold text-center whitespace-nowrap">
                0 da, 3 u, 5 h
              </p>
            </div>
          </div>

          <!-- Numeri centrali -->
          <div class="flex justify-center gap-4 mb-8 relative z-20">
            <%
              numbers_ex3 = [
                { num: 539, pair: "pair-539" },
                { num: 593, pair: "pair-593" },
                { num: 503, pair: "pair-503" },
                { num: 350, pair: "pair-350" }
              ]

              numbers_ex3.each do |item|
            %>
              <div class="bg-white dark:bg-gray-800 border-3 border-amber-600 dark:border-amber-500 rounded-lg px-5 py-3 cursor-pointer hover:bg-amber-50 dark:hover:bg-amber-900/40 transition"
                   data-action="click->flower-matcher#selectFlower"
                   data-flower-matcher-target="flower"
                   data-flower-id="num-<%= item[:num] %>"
                   data-pair="<%= item[:pair] %>">
                <p class="font-bold text-center">
                  <%= item[:num] %>
                </p>
              </div>
            <% end %>
          </div>

          <!-- Tronchi inferiori -->
          <div class="flex justify-around relative z-20">
            <div class="bg-amber-700 text-white rounded-full px-6 py-3 cursor-pointer hover:bg-amber-600 transition border-4 border-amber-900"
                 data-action="click->flower-matcher#selectFlower"
                 data-flower-matcher-target="flower"
                 data-flower-id="bottom-0"
                 data-pair="pair-539">
              <p class="font-bold text-center whitespace-nowrap">
                3 da, 5 h, 9 u
              </p>
            </div>
            <div class="bg-amber-700 text-white rounded-full px-6 py-3 cursor-pointer hover:bg-amber-600 transition border-4 border-amber-900"
                 data-action="click->flower-matcher#selectFlower"
                 data-flower-matcher-target="flower"
                 data-flower-id="bottom-1"
                 data-pair="pair-350">
              <p class="font-bold text-center whitespace-nowrap">
                5 da, 0 u, 3 h
              </p>
            </div>
          </div>
        </div>

        <!-- Pulsanti di controllo -->
        <div class="mt-4 flex gap-3 items-center">
          <button class="bg-amber-500 hover:bg-amber-600 text-white font-bold rounded-full shadow-lg transition transform hover:scale-105 flex items-center justify-center w-12 h-12"
                  data-action="click->flower-matcher#reset"
                  title="Ricomincia collegamenti">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
            </svg>
          </button>
        </div>
      </div>

      <!-- Esercizio 4: Indica il valore della cifra evidenziata -->
      <div class="bg-transparent p-4" data-controller="fill-blanks">
        <%= numero_esercizio_badge(4, colore: 'red-500') %>
        <span class="text-gray-700 dark:text-gray-200">
          Indica il valore della cifra evidenziata.
        </span>

        <div class="flex justify-around items-center flex-wrap gap-3">
          <%
            digit_values = [
              { num: "136", underline: 0, answer: "100" },
              { num: "584", underline: 1, answer: "80" },
              { num: "191", underline: 2, answer: "1" },
              { num: "333", underline: 1, answer: "30" },
              { num: "605", underline: 2, answer: "5" }
            ]

            digit_values.each do |item|
              digits = item[:num].chars
          %>
            <div class="text-center">
              <div class="font-bold mb-2">
                <% digits.each_with_index do |digit, idx| %><% if idx == item[:underline] %><span class="text-blue-600 dark:text-blue-400"><%= digit %></span><% else %><span><%= digit %></span><% end %><% end %>
              </div>
              <input type="text" data-fill-blanks-target="input" data-correct-answer="<%= item[:answer] %>"
                     class="w-20 px-2 py-1 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold bg-transparent dark:text-white"
                     maxlength="3" inputmode="numeric">
            </div>
          <% end %>
        </div>
      </div>
    </div>

    <!-- Colonna destra -->
    <div class="space-y-8">
      <!-- Esercizio 5: Completa con >, < o = -->
      <div class="bg-transparent p-4" data-controller="fill-blanks auto-advance">
        
        <p class="text-gray-700 dark:text-gray-200 mb-4">
          <%= numero_esercizio_badge(5, colore: 'red-500') %>
          Completa con <strong>&gt;</strong>, <strong>&lt;</strong> o <strong>=</strong>.
        </p>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
          <%
            comparisons = [
              { a: 152, b: 528, answer: "<" },
              { a: 861, b: 618, answer: ">" },
              { a: 548, b: 693, answer: "<" },
              { a: 333, b: 259, answer: ">" },
              { a: 669, b: 669, answer: "=" },
              { a: 651, b: 615, answer: ">" },
              { a: 999, b: 899, answer: ">" },
              { a: 295, b: 299, answer: "<" },
              { a: 426, b: 426, answer: "=" }
            ]

            comparisons.each do |comp|
          %>
            <div class="p-3 rounded-lg flex items-center justify-center gap-3">
              <span class="font-bold min-w-[50px] text-center"><%= comp[:a] %></span>
              <input type="text"
                     data-fill-blanks-target="input"
                     data-correct-answer="<%= comp[:answer] %>"
                     class="w-12 px-2 py-1 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold bg-transparent dark:text-white"
                     maxlength="1">
              <span class="font-bold min-w-[50px] text-center"><%= comp[:b] %></span>
            </div>
          <% end %>
        </div>
      </div>

      <!-- Esercizio 6: Completa -->
      <div class="bg-transparent p-4" data-controller="fill-blanks auto-advance">
        
        <p class="text-gray-700 dark:text-gray-200 mb-4">
          <%= numero_esercizio_badge(6, colore: 'red-500') %>
          Completa.
        </p>

        <div class="grid grid-cols-2 gap-3">
          <%
            conversions = [
              { question: "5 h", answer: "50", unit: "da" },
              { question: "600 u", answer: "6", unit: "h" },
              { question: "3 da", answer: "30", unit: "u" },
              { question: "90 da", answer: "900", unit: "u" },
              { question: "500 u", answer: "5", unit: "h" },
              { question: "4 h", answer: "400", unit: "u" },
              { question: "700 u", answer: "70", unit: "da" },
              { question: "60 da", answer: "6", unit: "h" },
              { question: "11 da", answer: "110", unit: "u" },
              { question: "9 h", answer: "90", unit: "da" },
              { question: "870 u", answer: "87", unit: "da" },
              { question: "1 h", answer: "10", unit: "da" }
            ]

            conversions.each do |conv|
          %>
            <div class="p-3 flex items-center justify-center gap-2">
              <span class="font-bold"><%= conv[:question] %></span>
              <span class="font-bold">=</span>
              <input type="text"
                     data-fill-blanks-target="input"
                     data-correct-answer="<%= conv[:answer] %>"
                     class="w-16 px-2 py-1 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold bg-transparent dark:text-white"
                     maxlength="3" inputmode="numeric">
              <span class="font-bold"><%= conv[:unit] %></span>
            </div>
          <% end %>
        </div>
      </div>

      <!-- Esercizio 7: In ogni gruppo colora il numero maggiore -->
      <div class="bg-transparent p-4">
        
        <p class="text-gray-700 dark:text-gray-200 mb-4">
          <%= numero_esercizio_badge(7, colore: 'red-500') %>
          In ogni gruppo colora il <strong class="text-blue-600 dark:text-blue-400">numero maggiore</strong>.
        </p>

        <div class="space-y-6">
          <!-- Gruppo blu -->
          <div data-controller="card-selector">
            <div class="flex gap-2 flex-wrap justify-center">
              <% [673, 189, 394, 700].each do |num| %>
                <div class="border-3 border-blue-500 dark:border-blue-400 bg-white dark:bg-gray-800 rounded-lg px-6 py-3 cursor-pointer hover:bg-blue-50 dark:hover:bg-blue-900/40 transition"
                     data-card-selector-target="card"
                     data-action="click->card-selector#select"
                     data-correct="<%= num == 700 ? 'true' : 'false' %>">
                  <span class="font-bold"><%= num %></span>
                </div>
              <% end %>
            </div>
          </div>

          <!-- Gruppo arancio -->
          <div data-controller="card-selector">
            <div class="flex gap-2 flex-wrap justify-center">
              <% [268, 484, 521, 352].each do |num| %>
                <div class="border-3 border-orange-500 dark:border-orange-400 bg-white dark:bg-gray-800 rounded-lg px-6 py-3 cursor-pointer hover:bg-orange-50 dark:hover:bg-orange-900/40 transition"
                     data-card-selector-target="card"
                     data-action="click->card-selector#select"
                     data-correct="<%= num == 521 ? 'true' : 'false' %>">
                  <span class="font-bold"><%= num %></span>
                </div>
              <% end %>
            </div>
          </div>
        </div>
      </div>

      <!-- Esercizio 8: In ogni gruppo colora il numero minore -->
      <div class="bg-transparent p-4">
        
        <p class="text-gray-700 dark:text-gray-200 mb-4">
          <%= numero_esercizio_badge(8, colore: 'red-500') %>
          In ogni gruppo colora il <strong class="text-blue-600 dark:text-blue-400">numero minore</strong>.
        </p>

        <div class="space-y-6">
          <!-- Gruppo blu -->
          <div data-controller="card-selector">
            <div class="flex gap-2 flex-wrap justify-center">
              <% [802, 355, 26, 412].each do |num| %>
                <div class="border-3 border-blue-500 dark:border-blue-400 bg-white dark:bg-gray-800 rounded-lg px-6 py-3 cursor-pointer hover:bg-blue-50 dark:hover:bg-blue-900/40 transition"
                     data-card-selector-target="card"
                     data-action="click->card-selector#select"
                     data-correct="<%= num == 26 ? 'true' : 'false' %>">
                  <span class="font-bold"><%= num %></span>
                </div>
              <% end %>
            </div>
          </div>

          <!-- Gruppo arancio -->
          <div data-controller="card-selector">
            <div class="flex gap-2 flex-wrap justify-center">
              <% [127, 275, 304, 119].each do |num| %>
                <div class="border-3 border-orange-500 dark:border-orange-400 bg-white dark:bg-gray-800 rounded-lg px-6 py-3 cursor-pointer hover:bg-orange-50 dark:hover:bg-orange-900/40 transition"
                     data-card-selector-target="card"
                     data-action="click->card-selector#select"
                     data-correct="<%= num == 119 ? 'true' : 'false' %>">
                  <span class="font-bold"><%= num %></span>
                </div>
              <% end %>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer con controlli -->
  <%= render 'shared/exercise_controls' %>
</div>
