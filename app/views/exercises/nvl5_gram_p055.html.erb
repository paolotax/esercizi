<div class="max-w-6xl mx-auto p-3 md:p-8 bg-white" data-controller="exercise-checker">

  <%= render 'shared/page_header', pagina: @pagina %>

  <!-- Reminder note -->
  <div class="bg-<%= @pagina.base_color %>-50 p-4 md:p-6 pb-8 rounded-lg">
    <h3 class="text-lg md:text-xl font-bold text-<%= @pagina.base_color %>-700 mb-3">Promemoria:</h3>
    <p class="text-base md:text-lg text-gray-700 mb-2">
      <span class="text-<%= @pagina.base_color %>-500">•</span> Le particelle pronominali <strong>mi, ti, lo, gli, la, le, si, ci, vi, li, le, ne</strong> possono precedere il verbo
      (mi raggiungi) oppure legarsi al verbo (raggiungimi).
    </p>
    <p class="text-base md:text-lg text-gray-700">
      <span class="text-<%= @pagina.base_color %>-500">•</span> Quando due particelle compaiono insieme, <strong>mi/ti/si/ci/vi</strong> diventano <strong>me/te/se/ce/ve</strong>.
    </p>
  </div>

  <!-- Exercise 5: Complete with pronoun particles -->
  <div class="bg-white p-4 md:p-6 pb-8" data-controller="fill-blanks">
    <h2 class="text-lg md:text-xl font-bold mb-4 flex items-center gap-2">
      <span class="flex-shrink-0 bg-<%= @pagina.base_color %>-500 text-white rounded-full w-8 h-8 md:w-10 md:h-10 inline-flex items-center justify-center">5</span>
      Completa con una particella pronominale adatta.
    </h2>

    <% particle_sentences = [
      { text: "Svelti, preparate", answer: "vi", continuation: "e andate alla fermata dell'autobus." },
      { text: "Carlo, puoi dir", answer: "mi", continuation: "dove hai comprato questo formaggio? È buonissimo!" },
      { text: "Stiamo andando a vedere la casa nuova;", answer: "ci", continuation: "accompagni?" },
      { text: "Che buono questo succo d'arancia,", answer: "ne", continuation: "prendo ancora un bicchiere." },
      { text: "Prepara la borsa, papà passa a prender", answer: "ti", continuation: "alle 10." }
    ] %>

    <div class="space-y-3 text-base md:text-lg">
      <% particle_sentences.each do |sentence| %>
        <div class="rounded-lg p-3 flex flex-wrap items-center gap-2">
          <span class="text-<%= @pagina.base_color %>-500">•</span>
          <span class="text-gray-700"><%= sentence[:text] %></span>
          <input type="text"
                 class="w-16 border-b-2 border-dotted border-<%= @pagina.base_color %>-500 bg-white text-right px-2 focus:outline-none focus:border-<%= @pagina.base_color %>-700"
                 data-fill-blanks-target="input"
                 data-answer="<%= sentence[:answer] %>"
                 data-correct-answer="<%= sentence[:answer] %>"
                 maxlength="5">
          <span class="text-gray-700"><%= sentence[:continuation] %></span>
        </div>
      <% end %>
    </div>
  </div>

  <!-- Exercise 6: Complete combinations table -->
  <div class="bg-white p-4 md:p-6 pb-8" data-controller="fill-blanks">
    <h2 class="text-lg md:text-xl font-bold mb-4 flex items-center gap-2">
      <span class="flex-shrink-0 bg-<%= @pagina.base_color %>-500 text-white rounded-full w-8 h-8 md:w-10 md:h-10 inline-flex items-center justify-center">6</span>
      Completa la tabella delle combinazioni.
    </h2>

    <p class="text-base md:text-lg text-gray-700 mb-4">
      <span class="text-<%= @pagina.base_color %>-500">•</span> Quando le particelle pronominali si combinano, formano queste coppie:
    </p>

    <div class="overflow-x-auto">
      <table class="w-full border-collapse text-sm md:text-base">
        <thead>
          <tr class="bg-<%= @pagina.base_color %>-100">
            <th class="border border-<%= @pagina.base_color %>-300 px-3 py-2 text-<%= @pagina.base_color %>-700 font-bold">Pronome + lo</th>
            <th class="border border-<%= @pagina.base_color %>-300 px-3 py-2 text-<%= @pagina.base_color %>-700 font-bold">Pronome + la</th>
            <th class="border border-<%= @pagina.base_color %>-300 px-3 py-2 text-<%= @pagina.base_color %>-700 font-bold">Pronome + li</th>
            <th class="border border-<%= @pagina.base_color %>-300 px-3 py-2 text-<%= @pagina.base_color %>-700 font-bold">Pronome + le</th>
          </tr>
        </thead>
        <tbody>
          <!-- Row 1 -->
          <tr class="bg-<%= @pagina.base_color %>-50">
            <td class="border border-<%= @pagina.base_color %>-200 px-3 py-2 text-center font-semibold">me lo</td>
            <td class="border border-<%= @pagina.base_color %>-200 px-3 py-2 text-center font-semibold">me la</td>
            <td class="border border-<%= @pagina.base_color %>-200 px-3 py-2 text-center font-semibold">me li</td>
            <td class="border border-<%= @pagina.base_color %>-200 px-3 py-2 text-center font-semibold">me le</td>
          </tr>

          <!-- Row 2 -->
          <tr class="bg-white">
            <td class="border border-<%= @pagina.base_color %>-200 px-3 py-2 text-center font-semibold">te lo</td>
            <td class="border border-<%= @pagina.base_color %>-200 px-3 py-2">
              <input type="text" class="w-full border-b border-dotted border-<%= @pagina.base_color %>-500 bg-transparent text-center focus:outline-none" data-fill-blanks-target="input" data-answer="te la" data-correct-answer="te la" maxlength="10">
            </td>
            <td class="border border-<%= @pagina.base_color %>-200 px-3 py-2">
              <input type="text" class="w-full border-b border-dotted border-<%= @pagina.base_color %>-500 bg-transparent text-center focus:outline-none" data-fill-blanks-target="input" data-answer="te li" data-correct-answer="te li" maxlength="10">
            </td>
            <td class="border border-<%= @pagina.base_color %>-200 px-3 py-2">
              <input type="text" class="w-full border-b border-dotted border-<%= @pagina.base_color %>-500 bg-transparent text-center focus:outline-none" data-fill-blanks-target="input" data-answer="te le" data-correct-answer="te le" maxlength="10">
            </td>
          </tr>

          <!-- Row 3 -->
          <tr class="bg-<%= @pagina.base_color %>-50">
            <td class="border border-<%= @pagina.base_color %>-200 px-3 py-2 text-center font-semibold">se lo</td>
            <td class="border border-<%= @pagina.base_color %>-200 px-3 py-2">
              <input type="text" class="w-full border-b border-dotted border-<%= @pagina.base_color %>-500 bg-transparent text-center focus:outline-none" data-fill-blanks-target="input" data-answer="se la" data-correct-answer="se la" maxlength="10">
            </td>
            <td class="border border-<%= @pagina.base_color %>-200 px-3 py-2">
              <input type="text" class="w-full border-b border-dotted border-<%= @pagina.base_color %>-500 bg-transparent text-center focus:outline-none" data-fill-blanks-target="input" data-answer="se li" data-correct-answer="se li" maxlength="10">
            </td>
            <td class="border border-<%= @pagina.base_color %>-200 px-3 py-2">
              <input type="text" class="w-full border-b border-dotted border-<%= @pagina.base_color %>-500 bg-transparent text-center focus:outline-none" data-fill-blanks-target="input" data-answer="se le" data-correct-answer="se le" maxlength="10">
            </td>
          </tr>

          <!-- Row 4 -->
          <tr class="bg-white">
            <td class="border border-<%= @pagina.base_color %>-200 px-3 py-2 text-center font-semibold">ce lo</td>
            <td class="border border-<%= @pagina.base_color %>-200 px-3 py-2">
              <input type="text" class="w-full border-b border-dotted border-<%= @pagina.base_color %>-500 bg-transparent text-center focus:outline-none" data-fill-blanks-target="input" data-answer="ce la" data-correct-answer="ce la" maxlength="10">
            </td>
            <td class="border border-<%= @pagina.base_color %>-200 px-3 py-2">
              <input type="text" class="w-full border-b border-dotted border-<%= @pagina.base_color %>-500 bg-transparent text-center focus:outline-none" data-fill-blanks-target="input" data-answer="ce li" data-correct-answer="ce li" maxlength="10">
            </td>
            <td class="border border-<%= @pagina.base_color %>-200 px-3 py-2">
              <input type="text" class="w-full border-b border-dotted border-<%= @pagina.base_color %>-500 bg-transparent text-center focus:outline-none" data-fill-blanks-target="input" data-answer="ce le" data-correct-answer="ce le" maxlength="10">
            </td>
          </tr>

          <!-- Row 5 -->
          <tr class="bg-<%= @pagina.base_color %>-50">
            <td class="border border-<%= @pagina.base_color %>-200 px-3 py-2 text-center font-semibold">ve lo</td>
            <td class="border border-<%= @pagina.base_color %>-200 px-3 py-2">
              <input type="text" class="w-full border-b border-dotted border-<%= @pagina.base_color %>-500 bg-transparent text-center focus:outline-none" data-fill-blanks-target="input" data-answer="ve la" data-correct-answer="ve la" maxlength="10">
            </td>
            <td class="border border-<%= @pagina.base_color %>-200 px-3 py-2">
              <input type="text" class="w-full border-b border-dotted border-<%= @pagina.base_color %>-500 bg-transparent text-center focus:outline-none" data-fill-blanks-target="input" data-answer="ve li" data-correct-answer="ve li" maxlength="10">
            </td>
            <td class="border border-<%= @pagina.base_color %>-200 px-3 py-2">
              <input type="text" class="w-full border-b border-dotted border-<%= @pagina.base_color %>-500 bg-transparent text-center focus:outline-none" data-fill-blanks-target="input" data-answer="ve le" data-correct-answer="ve le" maxlength="10">
            </td>
          </tr>

          <!-- Row 6 -->
          <tr class="bg-white">
            <td class="border border-<%= @pagina.base_color %>-200 px-3 py-2 text-center font-semibold">glielo</td>
            <td class="border border-<%= @pagina.base_color %>-200 px-3 py-2">
              <input type="text" class="w-full border-b border-dotted border-<%= @pagina.base_color %>-500 bg-transparent text-center focus:outline-none" data-fill-blanks-target="input" data-answer="gliela" data-correct-answer="gliela" maxlength="10">
            </td>
            <td class="border border-<%= @pagina.base_color %>-200 px-3 py-2">
              <input type="text" class="w-full border-b border-dotted border-<%= @pagina.base_color %>-500 bg-transparent text-center focus:outline-none" data-fill-blanks-target="input" data-answer="glieli" data-correct-answer="glieli" maxlength="10">
            </td>
            <td class="border border-<%= @pagina.base_color %>-200 px-3 py-2">
              <input type="text" class="w-full border-b border-dotted border-<%= @pagina.base_color %>-500 bg-transparent text-center focus:outline-none" data-fill-blanks-target="input" data-answer="gliele" data-correct-answer="gliele" maxlength="10">
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="mt-4 bg-<%= @pagina.base_color %>-50 rounded-lg px-4 py-3 text-sm md:text-base text-gray-700">
      <p><strong>Nota:</strong> Le forme con "gli" (glielo, gliela, glieli, gliele) si usano per lui, lei, loro.</p>
    </div>
  </div>

  <div class="text-right text-sm text-gray-500 mb-6">
    Esercizi pp. <%= link_to "156", pagina_path("nvl5_gram_p156"), class: "text-gray-600 hover:text-gray-800 underline" %>, <%= link_to "157", pagina_path("nvl5_gram_p157"), class: "text-gray-600 hover:text-gray-800 underline" %> e <%= link_to "163", pagina_path("nvl5_gram_p163"), class: "text-gray-600 hover:text-gray-800 underline" %>
  </div>

  <%= render 'shared/exercise_controls' %>
</div>
