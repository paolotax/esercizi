<div class="max-w-6xl mx-auto bg-white dark:bg-gray-900 text-black dark:text-white p-3 md:p-6 transition-colors duration-300"
     data-controller="exercise-checker text-toggle font-controls flower-matcher"
     data-text-toggle-target="content"
     data-font-controls-target="content">

  <%= render 'shared/page_header', pagina: @pagina %>

  <div class="space-y-6">
    <!-- Osserva e leggi -->
    <div class="p-4 md:p-6 bg-white dark:bg-gray-800 border-3 border-<%= @pagina.base_color %>-400 dark:border-<%= @pagina.base_color %>-500 rounded-2xl">
      <h2 class="font-bold text-<%= @pagina.base_color %>-600 dark:text-<%= @pagina.base_color %>-400 mb-6">
        <span class="text-pink-600 dark:text-pink-400">•</span> Osserva e leggi come eseguire <span class="underline text-cyan-500 dark:text-cyan-400">2,34 × 15,3</span>.
      </h2>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <!-- Step 1 -->
        <div class="p-4 text-center">
          <%= image_tag "nvi5_mat/p033/p033_01.jpg", alt: "Step 1", class: "mx-auto mb-3 dark:bg-white dark:rounded-lg dark:p-1" %>
          <p class="text-gray-700 dark:text-gray-200 text-sm">
            Moltiplica i fattori senza considerare le virgole.
          </p>
        </div>
        <!-- Step 2 -->
        <div class="p-4 text-center">
          <%= image_tag "nvi5_mat/p033/p033_02.jpg", alt: "Step 2", class: "mx-auto mb-3 dark:bg-white dark:rounded-lg dark:p-1" %>
          <p class="text-gray-700 dark:text-gray-200 text-sm">
            Nel prodotto finale metti la <strong class="text-<%= @pagina.base_color %>-600 dark:text-<%= @pagina.base_color %>-400">virgola</strong>, partendo da destra, dopo tante cifre quante sono in tutto le cifre decimali dei due fattori.
          </p>
        </div>
      </div>
    </div>

    <!-- ESERCIZI -->
    <div class="p-4 md:p-6 bg-orange-100 dark:bg-orange-900/30 rounded-lg">
      <!-- Esercizio 1 -->
      <div class="p-4 mb-6">
        <p class="font-bold text-gray-700 dark:text-gray-200 mb-4">
          <%= numero_esercizio_badge(1) %>
          Calcola in colonna sul quaderno. Calcola senza tenere conto della virgola, ma non dimenticarti di metterla al posto giusto nel prodotto.
        </p>
        <div class="grid grid-cols-2 md:grid-cols-4 gap-2 text-gray-800 dark:text-gray-200">
          <p>27,6 × 18 =</p>
          <p>4,35 × 6,7 =</p>
          <p>4,7 × 2,56 =</p>
          <p>852 × 4,23 =</p>
          <p>75 × 3,5 =</p>
          <p>65,8 × 3,15 =</p>
          <p>316 × 9,2 =</p>
          <p>254 × 3,14 =</p>
        </div>
      </div>

      <!-- Esercizio 2 -->
      <div class="p-4 mb-6">
        <p class="font-bold text-gray-700 dark:text-gray-200 mb-2">
          <%= numero_esercizio_badge(2) %>
          Calcola con la calcolatrice il risultato di <strong>287 × 135 =</strong>
          <input type="text" data-correct-answer="38745" class="w-24 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold bg-transparent dark:text-white">
        </p>
        <p class="text-gray-700 dark:text-gray-200 mb-4">
          <strong>Ora riporta nelle moltiplicazioni qui sotto il risultato ottenuto con la calcolatrice e inserisci la virgola al posto giusto.</strong>
        </p>
        <div class="grid grid-cols-2 md:grid-cols-3 gap-3 text-gray-800 dark:text-gray-200">
          <%= render 'shared/fill_list', container_class: "contents", items: [
            { prefix: "28,7 × 1,35 =", answer: "38,745" },
            { prefix: "0,287 × 1,35 =", answer: "0,38745" },
            { prefix: "2,87 × 13,5 =", answer: "38,745" },
            { prefix: "287 × 13,5 =", answer: "3874,5" },
            { prefix: "28,7 × 13,5 =", answer: "387,45" },
            { prefix: "2,87 × 135 =", answer: "387,45" }
          ] %>
        </div>
      </div>

      <!-- Esercizio 3 -->
      <div class="p-4">
        <p class="font-bold text-gray-700 dark:text-gray-200 mb-2">
          <%= numero_esercizio_badge(3) %>
          Collega, senza fare i calcoli, le seguenti moltiplicazioni ai rispettivi risultati.
        </p>
        <p class="text-gray-700 dark:text-gray-200 mb-4">
          Aiutati confrontando le cifre decimali dei fattori e dei prodotti. Poi verifica eseguendo le moltiplicazioni sul quaderno.
        </p>

        <div class="relative">
          <svg class="absolute top-0 left-0 w-full h-full pointer-events-none z-30" data-flower-matcher-target="canvas"></svg>

          <!-- Moltiplicazioni -->
          <div class="flex flex-wrap justify-around gap-3 mb-8 relative z-20">
            <% [
              { id: "mult-1", pair: "p70", label: "32,54 × 2,18 =" },
              { id: "mult-2", pair: "p14579", label: "287 × 50,8 =" },
              { id: "mult-3", pair: "p314", label: "16,29 × 19,3 =" },
              { id: "mult-4", pair: "p3023", label: "138,7 × 21,8 =" }
            ].each do |item| %>
              <div class="px-3 py-2 bg-custom-blue-light dark:bg-cyan-900/40 rounded-lg text-center font-bold cursor-pointer hover:bg-cyan-200 dark:hover:bg-cyan-800 transition dark:text-gray-200"
                   data-action="click->flower-matcher#selectFlower"
                   data-flower-matcher-target="flower"
                   data-flower-id="<%= item[:id] %>"
                   data-pair="<%= item[:pair] %>"><%= item[:label] %></div>
            <% end %>
          </div>

          <!-- Risultati -->
          <div class="flex flex-wrap justify-around gap-3 relative z-20">
            <% [
              { id: "res-1", pair: "p14579", label: "14 579,6" },
              { id: "res-2", pair: "p3023", label: "3 023,66" },
              { id: "res-3", pair: "p70", label: "70,9372" },
              { id: "res-4", pair: "p314", label: "314,397" }
            ].each do |item| %>
              <div class="px-3 py-2 bg-pink-100 dark:bg-pink-900/40 rounded-lg text-center font-bold cursor-pointer hover:bg-pink-200 dark:hover:bg-pink-800 transition dark:text-gray-200"
                   data-action="click->flower-matcher#selectFlower"
                   data-flower-matcher-target="flower"
                   data-flower-id="<%= item[:id] %>"
                   data-pair="<%= item[:pair] %>"><%= item[:label] %></div>
            <% end %>
          </div>

          <!-- Controlli -->
          <div class="mt-4 flex gap-3 items-center">
            <button class="bg-blue-500 hover:bg-blue-600 text-white font-bold rounded-full w-8 h-8 transition flex items-center justify-center"
                    data-action="click->flower-matcher#reset" title="Ricomincia">
              <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
              </svg>
            </button>
            <button class="bg-green-500 hover:bg-green-600 text-white font-bold rounded-full w-8 h-8 transition flex items-center justify-center"
                    data-action="click->flower-matcher#showSolutions" title="Soluzioni">
              <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
              </svg>
            </button>
          </div>
        </div>
      </div>
    </div>

    <%= render 'shared/quaderno_link', pagine: [189] %>

    <%= render 'shared/exercise_controls' %>
  </div>
</div>
