<div class="max-w-6xl mx-auto bg-white dark:bg-gray-900 text-black dark:text-white p-3 md:p-6 transition-colors duration-300"
     data-controller="exercise-checker text-toggle font-controls"
     data-text-toggle-target="content"
     data-font-controls-target="content">

  <%= render 'shared/page_header', pagina: @pagina %>

  <!-- Explanation Box -->
  <div class="bg-yellow-50 dark:bg-yellow-900/30 border-4 border-yellow-400 dark:border-yellow-600 rounded-lg p-6 mb-8">
    <div class="flex items-start gap-6">
      <div class="text-8xl">ðŸŒ·</div>
      <div class="flex-1">
        <h2 class="font-bold text-pink-600 dark:text-pink-400 mb-4">Gruppo GL</h2>
        <div class="grid md:grid-cols-2 gap-4">
          <div class="border-4 border-red-400 dark:border-red-600 rounded-lg p-4 bg-red-50 dark:bg-red-900/30">
            <h3 class="font-bold text-red-600 dark:text-red-400 mb-2">Suono dolce</h3>
            <p class="dark:text-gray-200">â€¢ davanti a <span class="font-bold">I</span></p>
            <p class="dark:text-gray-200">â†’ <span class="font-bold text-red-600 dark:text-red-400">tovaglia</span></p>
          </div>
          <div class="border-4 border-blue-400 dark:border-blue-600 rounded-lg p-4 bg-blue-50 dark:bg-blue-900/30">
            <h3 class="font-bold text-blue-600 dark:text-blue-400 mb-2">Suono duro</h3>
            <p class="dark:text-gray-200">â€¢ davanti a <span class="font-bold">A, E, O, U</span></p>
            <p class="dark:text-gray-200">â†’ <span class="font-bold text-blue-600 dark:text-blue-400">gladiolo</span></p>
            <p class="dark:text-gray-200">â€¢ a volte anche davanti alla vocale <span class="font-bold">I</span></p>
            <p class="dark:text-gray-200">â†’ <span class="font-bold text-blue-600 dark:text-blue-400">glicine</span></p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Exercise 1: Classify GL words -->
  <div class="mb-12 bg-white dark:bg-gray-800 rounded-lg p-6 shadow-md" data-controller="word-sorter">
    <h2 class="font-bold text-pink-600 dark:text-pink-400 mb-6">
      <span class="bg-pink-600 text-white rounded-full w-10 h-10 inline-flex items-center justify-center mr-2">1</span>
      IMPARARE TUTTI Scrivi le seguenti parole nella scatola giusta.
    </h2>

    <!-- Words to classify -->
    <div class="bg-gray-50 dark:bg-gray-700 border-2 border-gray-300 dark:border-gray-600 rounded-lg p-4 mb-6">
      <div class="flex flex-wrap gap-3 justify-center">
        <% words_list = ['maniglia', 'aglio', 'inglese', 'sogliola', 'coniglio', 'glutine', 'maglione', 'globo', 'ciglio', 'migliaia', 'biglietto', 'glaciale'] %>
        <% words_list.each do |word| %>
          <span class="bg-white dark:bg-gray-700 dark:text-gray-100 border-2 border-pink-300 dark:border-pink-600 px-4 py-2 rounded-lg font-bold select-none transition hover:bg-pink-50 dark:hover:bg-pink-900/30 hover:shadow-md" data-word-sorter-target="word">â€¢ <%= word %></span>
        <% end %>
      </div>
    </div>

    <div class="grid md:grid-cols-2 gap-6">
      <!-- GL - Suono Dolce -->
      <div class="border-4 border-red-400 dark:border-red-600 rounded-lg p-6 bg-yellow-50 dark:bg-yellow-900/30">
        <h3 class="font-bold text-red-600 dark:text-red-400 mb-4 text-center">GL - SUONO DOLCE</h3>
        <div class="space-y-2">
          <% dolce_words = ['maniglia', 'aglio', 'sogliola', 'coniglio', 'maglione', 'ciglio', 'migliaia', 'biglietto'] %>
          <% 8.times do |i| %>
            <input type="text"
                   class="w-full border-b-2 border-gray-400 dark:border-gray-600 bg-transparent dark:text-white font-bold focus:outline-none focus:border-red-500 py-2"
                   data-word-sorter-target="input"
                   data-correct-answer="<%= dolce_words[i] %>">
          <% end %>
        </div>
      </div>

      <!-- GL - Suono Duro -->
      <div class="border-4 border-blue-400 dark:border-blue-600 rounded-lg p-6 bg-purple-50 dark:bg-purple-900/30">
        <h3 class="font-bold text-blue-600 dark:text-blue-400 mb-4 text-center">GL - SUONO DURO</h3>
        <div class="space-y-2">
          <% duro_words = ['inglese', 'glutine', 'globo', 'glaciale'] %>
          <% 8.times do |i| %>
            <input type="text"
                   class="w-full border-b-2 border-gray-400 dark:border-gray-600 bg-transparent dark:text-white font-bold focus:outline-none focus:border-blue-500 py-2"
                   data-word-sorter-target="input"
                   data-correct-answer="<%= duro_words[i] || '' %>">
          <% end %>
        </div>
      </div>
    </div>

    <button class="mt-6 bg-pink-500 hover:bg-pink-600 text-white font-bold py-3 px-6 rounded-full transition"
            data-action="click->word-sorter#checkAnswers">
      Controlla
    </button>
  </div>

  <!-- Exercise 2: GLI o LI? -->
  <div class="mb-12 bg-white dark:bg-gray-800 rounded-lg p-4 md:p-6 shadow-md">
    <div class="flex flex-col md:flex-row md:items-start gap-4 mb-6">
      <div class="flex-1">
        <h2 class="font-bold text-pink-600 dark:text-pink-400 mb-4">
          <span class="bg-pink-600 text-white rounded-full w-8 h-8 md:w-10 md:h-10 inline-flex items-center justify-center mr-2">2</span>
          GLI o LI? Completa.
        </h2>
      </div>
      <div class="bg-yellow-50 dark:bg-yellow-900/30 border-2 border-yellow-400 dark:border-yellow-600 rounded-lg p-3 md:p-4 w-full md:max-w-md">
        <p class="font-bold text-gray-800 dark:text-gray-100 mb-2">Si usa <span class="text-pink-600">LI</span> al posto di <span class="text-pink-600">GLI</span>:</p>
        <ul class="space-y-1">
          <li>â€¢ nella sillaba iniziale di parola â†’ <span class="font-bold">lieve, lieta</span>...</li>
          <li>â€¢ quando la <span class="font-bold">L</span> raddoppia in <span class="font-bold">LL</span> â†’ <span class="font-bold">allieva, cancelliere</span>...</li>
          <li>â€¢ in alcune parole â†’ <span class="font-bold">olio, Italia</span>...</li>
        </ul>
      </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6" data-controller="fill-blanks">
      <% completions = [
        {prefix: 'gioco', suffix: 'ere', answer: 'li'},
        {prefix: 'ci', suffix: 'egia', answer: 'li'},
        {prefix: 'petro', suffix: 'o', answer: 'li'},
        {prefix: 'botti', suffix: 'a', answer: 'gli'},
        {prefix: 'meda', suffix: 'a', answer: 'gli'},
        {prefix: 'sbadi', suffix: 'o', answer: 'gli'},
        {prefix: 'o', suffix: 'era', answer: 'gli'},
        {prefix: 'sol', suffix: 'evo', answer: 'li'},
        {prefix: 'sa', suffix: 'era', answer: 'li'}
      ] %>

      <% completions.each do |item| %>
        <div class="flex flex-wrap items-center gap-1 md:gap-2 font-bold">
          <span class="whitespace-nowrap">â€¢ <%= item[:prefix] %></span>
          <input type="text"
                 class="border-b-4 border-pink-500 bg-transparent dark:text-white w-12 md:w-16 text-center focus:outline-none focus:border-pink-700 flex-shrink-0"
                 data-fill-blanks-target="input"
                 data-answer="<%= item[:answer] %>"
                 data-correct-answer="<%= item[:answer] %>"
                 maxlength="3">
          <span class="whitespace-nowrap"><%= item[:suffix] %></span>
        </div>
      <% end %>
    </div>

    <button class="mt-6 bg-pink-500 hover:bg-pink-600 text-white font-bold py-3 px-6 rounded-full transition"
            data-action="click->fill-blanks#checkAnswers">
      Controlla
    </button>
  </div>

  <!-- GIOCO: Find the error -->
  <div class="mb-12 bg-gradient-to-r from-yellow-100 via-orange-100 to-red-100 dark:from-yellow-900/30 dark:via-orange-900/30 dark:to-red-900/30 rounded-lg p-6 shadow-lg border-4 border-yellow-400 dark:border-yellow-600" data-controller="error-finder">
    <div class="flex items-center gap-3 mb-4">
      <span class="">ðŸŽ®</span>
      <h2 class="font-bold" style="color: #ff6b35;">GIOCO</h2>
    </div>

    <h3 class="font-bold text-gray-800 mb-6">In ogni riquadro c'Ã¨ un errore: lavora con un compagno e una compagna e trovatelo!</h3>

    <div class="grid md:grid-cols-3 gap-4">
      <!-- Box 1 -->
      <div class="bg-cyan-100 dark:bg-cyan-900/30 border-4 border-cyan-300 dark:border-cyan-600 rounded-lg p-6 error-group">
        <div class="space-y-3 text-center">
          <div class="font-bold px-2 py-1 rounded" data-error-finder-target="word" data-error="false" data-action="click->error-finder#selectWord">Australia</div>
          <div class="font-bold px-2 py-1 rounded" data-error-finder-target="word" data-error="false" data-action="click->error-finder#selectWord">Italia</div>
          <div class="font-bold px-2 py-1 rounded" data-error-finder-target="word" data-error="true" data-action="click->error-finder#selectWord">Puglia</div>
          <div class="font-bold px-2 py-1 rounded" data-error-finder-target="word" data-error="false" data-action="click->error-finder#selectWord">Sicilia</div>
        </div>
        <div class="mt-4 text-gray-600 italic hidden" data-error-finder-target="hint">
          (Errore: Puglia non ha GL/LI)
        </div>
      </div>

      <!-- Box 2 -->
      <div class="bg-pink-100 dark:bg-pink-900/30 border-4 border-pink-300 dark:border-pink-600 rounded-lg p-6 error-group">
        <div class="space-y-3 text-center">
          <div class="font-bold px-2 py-1 rounded" data-error-finder-target="word" data-error="false" data-action="click->error-finder#selectWord">coniglio</div>
          <div class="font-bold px-2 py-1 rounded" data-error-finder-target="word" data-error="false" data-action="click->error-finder#selectWord">trifoglio</div>
          <div class="font-bold px-2 py-1 rounded" data-error-finder-target="word" data-error="true" data-action="click->error-finder#selectWord">paglia</div>
          <div class="font-bold px-2 py-1 rounded" data-error-finder-target="word" data-error="false" data-action="click->error-finder#selectWord">cespuglio</div>
        </div>
        <div class="mt-4 text-gray-600 italic hidden" data-error-finder-target="hint">
          (Errore: paglia dovrebbe essere paglio se seguisse il pattern)
        </div>
      </div>

      <!-- Box 3 -->
      <div class="bg-green-100 dark:bg-green-900/30 border-4 border-green-300 dark:border-green-600 rounded-lg p-6 error-group">
        <div class="space-y-3 text-center">
          <div class="font-bold px-2 py-1 rounded" data-error-finder-target="word" data-error="false" data-action="click->error-finder#selectWord">lavastoviglie</div>
          <div class="font-bold px-2 py-1 rounded" data-error-finder-target="word" data-error="false" data-action="click->error-finder#selectWord">bottiglia</div>
          <div class="font-bold px-2 py-1 rounded" data-error-finder-target="word" data-error="true" data-action="click->error-finder#selectWord">tovalia</div>
          <div class="font-bold px-2 py-1 rounded" data-error-finder-target="word" data-error="false" data-action="click->error-finder#selectWord">tovagliolo</div>
        </div>
        <div class="mt-4 text-gray-600 italic hidden" data-error-finder-target="hint">
          (Errore: tovalia dovrebbe essere tovaglia)
        </div>
      </div>
    </div>
  </div>

  <!-- Page reference -->
  <div class="text-center text-gray-500 dark:text-gray-400 mb-6">
    <p class="font-semibold">Esercizi p. 138</p>
  </div>

  <!-- Exercise Controls -->
  <%= render 'shared/exercise_controls', color: 'pink' %>
</div>
