<div class="max-w-6xl mx-auto bg-white dark:bg-gray-900 text-black dark:text-white p-3 md:p-6 transition-colors duration-300"
     data-controller="exercise-checker text-toggle font-controls number-line"
     data-text-toggle-target="content"
     data-font-controls-target="content">

  <%= render 'shared/page_header', pagina: @pagina %>

  <div class="space-y-6">

    <!-- Interactive Image -->
    <div class="relative rounded-2xl overflow-hidden bg-white"
         data-controller="hotspot-editor"
         data-hotspot-editor-target="container">

      <%= image_tag "nvi5_mat/p009/p009_01.jpg",
          alt: "Schema dei numeri relativi: +4 numeri positivi, -4 numeri negativi, come si legge PIU' QUATTRO e MENO QUATTRO",
          class: "w-full h-full object-cover select-none pointer-events-none" %>

      <div class="absolute inset-0">
        <% hotspots = [
          { label: "NUMERI RELATIVI", top: "1.88%", left: "28.49%", width: "42.00%", height: "5.95%" },
          { label: "NUMERI POSITIVI", top: "23.89%", left: "10.79%", width: "25.18%", height: "6.18%" },
          { label: "NUMERI NEGATIVI", top: "24.25%", left: "61.43%", width: "27.64%", height: "6.07%" },
          { label: "PIU' QUATTRO", top: "33.12%", left: "11.41%", width: "24.67%", height: "20.67%" },
          { label: "MENO QUATTRO", top: "33.05%", left: "62.73%", width: "26.41%", height: "21.01%" },
          { label: "PIU' QUATTRO", top: "81.48%", left: "13.24%", width: "19.12%", height: "5.48%" },
          { label: "MENO QUATTRO", top: "81.75%", left: "64.91%", width: "21.59%", height: "4.90%" }
        ] %>

        <% hotspots.each do |hotspot| %>
          <button type="button"
                  class="absolute rounded-xl bg-blue-500/10 hover:bg-blue-500/25 border-2 border-transparent hover:border-blue-500 focus:border-blue-600 focus:outline-none transition cursor-move"
                  style="top: <%= hotspot[:top] %>; left: <%= hotspot[:left] %>; width: <%= hotspot[:width] %>; height: <%= hotspot[:height] %>;"
                  aria-label="Leggi: <%= hotspot[:label] %>"
                  data-controller="image-speech"
                  data-hotspot-editor-target="hotspot"
                  data-image-speech-word-value="<%= hotspot[:label] %>"
                  data-image-speech-lang-value="it-IT"
                  data-action="mousedown->hotspot-editor#startDrag click->image-speech#speak">
            <span class="sr-only"><%= hotspot[:label] %></span>
          </button>
        <% end %>
      </div>
    </div>

    <!-- Esercizio Completa -->
    <div class="p-4 md:p-6">
      <p class="text-gray-700 dark:text-gray-200 mb-6">
        <span class="inline-block w-4 h-4 bg-pink-600 rounded-sm mr-2"></span>
        <span class="font-bold">Completa.</span>
      </p>

      <div class="space-y-4">
        <div class="flex flex-wrap items-center gap-2 text-gray-700 dark:text-gray-200">
          <span>I</span>
          <span class="font-bold text-custom-sky dark:text-cyan-400">NUMERI POSITIVI</span>
          <span>e i</span>
          <input type="text"
                 class="w-40 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold text-custom-sky dark:text-cyan-400 bg-transparent focus:border-pink-500 focus:outline-none"
                 data-correct-answer="NUMERI NEGATIVI"
                 placeholder="...">
          <span>sono</span>
          <span class="font-bold text-custom-sky dark:text-cyan-400">NUMERI RELATIVI</span><span>.</span>
        </div>

        <div class="flex flex-wrap items-center gap-2 text-gray-700 dark:text-gray-200">
          <span>I</span>
          <span class="font-bold text-custom-sky dark:text-cyan-400">NUMERI</span>
          <input type="text"
                 class="w-28 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold text-custom-sky dark:text-cyan-400 bg-transparent focus:border-pink-500 focus:outline-none"
                 data-correct-answer="POSITIVI"
                 placeholder="...">
          <span>sono preceduti dal segno</span>
          <span class="font-bold text-custom-sky dark:text-cyan-400">+</span><span>.</span>
        </div>

        <div class="flex flex-wrap items-center gap-2 text-gray-700 dark:text-gray-200">
          <span>I</span>
          <span class="font-bold text-custom-sky dark:text-cyan-400">NUMERI</span>
          <input type="text"
                 class="w-28 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold text-custom-sky dark:text-cyan-400 bg-transparent focus:border-pink-500 focus:outline-none"
                 data-correct-answer="NEGATIVI"
                 placeholder="...">
          <span>sono preceduti dal segno</span>
          <span class="font-bold text-custom-sky dark:text-cyan-400">−</span><span>.</span>
        </div>
      </div>
    </div>

    <!-- Esercizio Linea dei numeri -->
    <div class="p-4 md:p-6">
      <p class="text-gray-700 dark:text-gray-200 mb-6">
        <span class="inline-block w-4 h-4 bg-pink-600 rounded-sm mr-2"></span>
        <span class="font-bold">Osserva la linea dei numeri e cerchia
          <span class="text-custom-sky dark:text-cyan-400 font-bold">−7</span> e
          <span class="text-custom-sky dark:text-cyan-400 font-bold">+5</span>.
        </span>
      </p>

      <!-- Number Line -->
      <div class="overflow-x-auto pb-4">
        <div class="relative py-8 min-w-max">
          <!-- Line with arrows -->
          <div class="absolute top-[calc(50%-26px)] left-4 right-4 h-1 bg-custom-sky -translate-y-1/2"></div>

          <!-- Left Arrow -->
          <div class="absolute left-0 top-[calc(50%-26px)] -translate-y-1/2">
            <svg class="w-6 h-6 text-custom-sky" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M15 19l-7-7 7-7"/>
            </svg>
          </div>

          <!-- Right Arrow -->
          <div class="absolute right-0 top-[calc(50%-26px)] -translate-y-1/2">
            <svg class="w-6 h-6 text-custom-sky" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M9 5l7 7-7 7"/>
            </svg>
          </div>

          <!-- Numbers -->
          <div class="flex items-center justify-center gap-4 md:gap-6 px-8">
            <% [-9, -8, -7, -6, -5, -4, -3, -2, -1, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9].each do |num| %>
              <div class="flex flex-col items-center">
                <!-- Dot on line -->
                <div class="w-2 h-2 bg-custom-sky rounded-full mb-2"></div>
                <!-- Number button -->
                <button type="button"
                        class="number-circle w-10 h-10 md:w-12 md:h-12 rounded-full border-2 border-custom-sky dark:border-cyan-500 bg-white dark:bg-gray-800 flex items-center justify-center font-bold transition-all duration-300 hover:scale-110 focus:outline-none"
                        data-number="<%= num %>"
                        data-number-line-target="numberButton"
                        data-action="click->number-line#toggleNumber"
                        data-correct="<%= num == -7 || num == 5 %>">
                  <span class="<%= num == 0 ? 'text-gray-700 dark:text-gray-200' : 'text-custom-sky dark:text-cyan-400' %>">
                    <%= num > 0 ? "+#{num}" : num %>
                  </span>
                </button>
              </div>
            <% end %>
          </div>
        </div>
      </div>

      <!-- Feedback message -->
      <div class="mt-4 text-center">
        <div data-number-line-target="feedback" class="hidden font-semibold"></div>
      </div>
    </div>

    <%= render 'shared/exercise_controls' %>
  </div>
</div>

<style>
  .number-circle.selected {
    background-color: #0095DA;
    color: white;
    border-color: #0095DA;
    border-width: 3px;
    transform: scale(1.15);
    box-shadow: 0 4px 12px rgba(0, 149, 218, 0.4);
  }

  .number-circle.selected span {
    color: white !important;
  }

  .number-circle:hover {
    box-shadow: 0 2px 8px rgba(0, 149, 218, 0.3);
  }
</style>
