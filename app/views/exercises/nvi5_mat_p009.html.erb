<div class="max-w-6xl mx-auto p-3 md:p-8 bg-gradient-to-br from-blue-50 via-pink-50 to-blue-50 rounded-3xl shadow-xl relative overflow-hidden" data-controller="exercise-checker page-viewer number-line" data-page-viewer-image-url-value="<%= asset_path('nvi5_mat/p009/page.png') %>">

  <!-- Header -->
  <%= render 'shared/page_header', pagina: @pagina %>

  <div class="space-y-6 relative">
    <!-- Interactive Image -->
    <div class="relative rounded-2xl overflow-hidden border-4 border-blue-200 shadow-2xl"
        data-controller="hotspot-editor"
        data-hotspot-editor-target="container">
      <%= image_tag "nvi5_mat/p009/p009_01.jpg",
          alt: "Supermercato con cartellini: frigorifero, cartello del reparto, lampadario, scaffale, flaconi, espositore, caporeparto, cassa, scatole, cliente, cestino, bilancia, cassetta, borse, banco, carrello e corsia",
          class: "w-full h-full object-cover select-none pointer-events-none" %>

      <div class="absolute inset-0">
        <% hotspots = [
        { label: "NUMERI POSITIVI", top: "23.8885%", left: "10.7944%", width: "25.1811%", height: "6.18091%" },
        { label: "NUMERI RELATIVI", top: "1.87802%", left: "28.488%", width: "41.9988%", height: "5.94781%" },
        { label: "PIU' QUATTRO", top: "81.4812%", left: "13.2428%", width: "19.1154%", height: "5.48101%" },
        { label: "NUMERI NEGATIVI", top: "24.2529%", left: "61.428%", width: "27.6429%", height: "6.0728%" },
        { label: "MENO QUATTRO", top: "33.0537%", left: "62.7341%", width: "26.4061%", height: "21.0052%" },
        { label: "PIU' QUATTRO", top: "33.1239%", left: "11.4131%", width: "24.6704%", height: "20.6697%" },
        { label: "MENO QUATTRO", top: "81.7509%", left: "64.9117%", width: "21.5905%", height: "4.89797%" }        
        ] %>

        <% hotspots.each do |hotspot| %>
          <button type="button"
                  class="absolute rounded-xl bg-blue-500/0 hover:bg-blue-500/25 border-2 border-transparent hover:border-blue-500 focus:border-blue-600 focus:outline-none transition shadow-sm cursor-move"
                  style="top: <%= hotspot[:top] %>; left: <%= hotspot[:left] %>; width: <%= hotspot[:width] %>; height: <%= hotspot[:height] %>;"
                  aria-label="Leggi: <%= hotspot[:label] %>"
                  data-controller="image-speech"
                  data-hotspot-editor-target="hotspot"
                  data-image-speech-word-value="<%= hotspot[:label] %>"
                  data-image-speech-lang-value="it-IT"
                  data-action="mousedown->hotspot-editor#startDrag click->image-speech#speak">
            <span class="sr-only"><%= hotspot[:label] %></span>
          </button>
        <% end %>
      </div>
    </div>

    <!-- Esercizio Completa -->
    <div class="bg-white rounded-2xl border-4 border-pink-300 shadow-2xl p-6 md:p-8">
      <div class="flex items-center gap-3 mb-6">
        <div class="w-8 h-8 bg-pink-500 rounded-full flex items-center justify-center">
          <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
            <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"/>
            <path fill-rule="evenodd" d="M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v11a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3zm-3 4a1 1 0 100 2h.01a1 1 0 100-2H7zm3 0a1 1 0 100 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"/>
          </svg>
        </div>
        <h3 class="text-xl font-bold text-pink-600">Completa.</h3>
      </div>

      <div class="space-y-4 text-lg">
        <div class="flex flex-wrap items-center gap-2">
          <span>I</span>
          <span class="font-bold text-pink-600">NUMERI POSITIVI</span>
          <span>e i</span>
          <input type="text"
                 class="w-48 px-4 py-2 border-b-4 border-pink-300 focus:border-pink-500 focus:outline-none font-bold text-pink-700 bg-pink-50 rounded-lg transition-colors"
                 data-correct-answer="NUMERI NEGATIVI"
                 placeholder="...........................">
          <span>sono</span>
          <span class="font-bold text-pink-600">NUMERI RELATIVI</span><span>.</span>
        </div>

        <div class="flex flex-wrap items-center gap-2">
          <span>I</span>
          <span class="font-bold text-pink-600">NUMERI</span>
          <input type="text"
                 class="w-48 px-4 py-2 border-b-4 border-pink-300 focus:border-pink-500 focus:outline-none font-bold text-pink-700 bg-pink-50 rounded-lg transition-colors"
                 data-correct-answer="POSITIVI"
                 placeholder="...........................">
          <span>sono preceduti dal segno</span>
          <span class="font-bold text-blue-600 text-2xl">+</span><span>.</span>
        </div>

        <div class="flex flex-wrap items-center gap-2">
          <span>I</span>
          <span class="font-bold text-pink-600">NUMERI</span>
          <input type="text"
                 class="w-48 px-4 py-2 border-b-4 border-pink-300 focus:border-pink-500 focus:outline-none font-bold text-pink-700 bg-pink-50 rounded-lg transition-colors"
                 data-correct-answer="NEGATIVI"
                 placeholder="...........................">
          <span>sono preceduti dal segno</span>
          <span class="font-bold text-blue-600 text-2xl">-</span><span>.</span>
        </div>
      </div>
    </div>

    <!-- Esercizio Linea dei numeri -->
    <div class="bg-white rounded-2xl border-4 border-blue-300 shadow-2xl p-6 md:p-8">
      <div class="flex items-center gap-3 mb-6">
        <div class="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center">
          <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
            <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"/>
            <path fill-rule="evenodd" d="M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v11a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3zm-3 4a1 1 0 100 2h.01a1 1 0 100-2H7zm3 0a1 1 0 100 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"/>
          </svg>
        </div>
        <h3 class="text-xl font-bold text-blue-600">
          Osserva la linea dei numeri e cerchia
          <span class="text-blue-700">-7</span> e
          <span class="text-blue-700">+5</span>.
        </h3>
      </div>

      <!-- Number Line -->
      <div class="overflow-x-auto pb-4">
        <div class="min-w-max px-4">
          <!-- Arrow left and line -->
          <div class="flex items-center justify-center mb-4">
            <svg class="w-6 h-6 text-blue-600 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M15 19l-7-7 7-7"/>
            </svg>
            <div class="flex-1 h-1 bg-blue-600 mx-2"></div>
          </div>

          <!-- Numbers -->
          <div class="flex items-center justify-between gap-4 md:gap-6">
            <% [-9, -8, -7, -6, -5, -4, -3, -2, -1, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9].each do |num| %>
              <div class="flex flex-col items-center gap-2">
                <!-- Dot -->
                <div class="w-3 h-3 rounded-full bg-blue-600"></div>

                <!-- Number button -->
                <button type="button"
                        class="number-circle w-12 h-12 md:w-14 md:h-14 rounded-full border-3 flex items-center justify-center font-bold text-base md:text-lg transition-all duration-300 hover:scale-110 focus:outline-none"
                        data-number="<%= num %>"
                        data-number-line-target="numberButton"
                        data-action="click->number-line#toggleNumber"
                        data-correct="<%= num == -7 || num == 5 %>">
                  <% if num >= 0 && num > 0 %>
                    <span class="text-blue-700">+<%= num %></span>
                  <% elsif num == 0 %>
                    <span class="text-gray-700"><%= num %></span>
                  <% else %>
                    <span class="text-blue-700"><%= num %></span>
                  <% end %>
                </button>
              </div>
            <% end %>
          </div>

          <!-- Arrow right -->
          <div class="flex items-center justify-center mt-4">
            <div class="flex-1 h-1 bg-blue-600 mx-2"></div>
            <svg class="w-6 h-6 text-blue-600 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M9 5l7 7-7 7"/>
            </svg>
          </div>
        </div>
      </div>

      <!-- Feedback message -->
      <div class="mt-6 text-center">
        <div data-number-line-target="feedback" class="hidden text-lg font-semibold"></div>
      </div>
    </div>

    <!-- Exercise Controls -->
    <%= render 'shared/exercise_controls', color: 'pink', current_page: 'nvi5_mat_p009' %>

  </div>
</div>

<style>
  .number-circle {
    border-color: #3b82f6;
    background-color: white;
    color: #1e40af;
  }

  .number-circle.selected {
    background-color: #3b82f6;
    color: white;
    border-color: #1e40af;
    border-width: 4px;
    transform: scale(1.15);
    box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
  }

  .number-circle:hover {
    border-color: #2563eb;
    box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);
  }
</style>
