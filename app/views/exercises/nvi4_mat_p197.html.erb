<div class="max-w-6xl mx-auto bg-white dark:bg-gray-900 p-3 md:p-6 transition-colors duration-300"
     data-controller="exercise-checker word-highlighter text-toggle font-controls"
     data-text-toggle-target="content"
     data-font-controls-target="content">

  <%= render 'shared/page_header', pagina: @pagina %>

  <div class="space-y-6">

    <!-- Definizione multipli -->
    <div class="p-3 bg-cyan-50 dark:bg-cyan-900 rounded-lg">
      <p class="text-gray-700 dark:text-gray-200">
        I <span class="font-bold">multipli</span> di un numero sono il prodotto di questo numero per qualsiasi altro numero.
      </p>
    </div>

    <!-- Esercizio 1 IMPARARE TUTTI -->
    <div class="p-5 bg-white dark:bg-gray-800 rounded-2xl border-3 border-yellow-400 dark:border-yellow-500">
      <p class="font-bold text-gray-700 dark:text-gray-200 mb-4">
        <%= imparare_tutti_badge(1) %>
        Completa la tabella con i <span class="bg-cyan-100 dark:bg-cyan-800 px-1 rounded">multipli di 7</span>. Poi rispondi alla domanda.
      </p>

      <div class="overflow-x-auto mb-4">
        <table class="border-collapse">
          <tbody>
            <tr>
              <td rowspan="2" class="p-2 border border-cyan-400 dark:border-cyan-600 bg-cyan-100 dark:bg-cyan-800">
                <%= image_tag "nvi4_mat/p197/p197_01.jpg", class: "w-10 h-auto dark:bg-white dark:rounded dark:p-1", alt: "×7" %>
              </td>
              <% [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 12, 20, 30, 40, 50, 60, 70, 80, 90, 100].each do |n| %>
                <td class="p-2 border border-cyan-400 dark:border-cyan-600 text-center bg-cyan-100 dark:bg-cyan-800 text-gray-700 dark:text-gray-200"><%= n %></td>
              <% end %>
            </tr>
            <tr>
              <td class="p-2 border border-cyan-400 dark:border-cyan-600 text-center font-bold text-cyan-600 dark:text-cyan-400">7</td>
              <td class="p-2 border border-cyan-400 dark:border-cyan-600 text-center font-bold text-cyan-600 dark:text-cyan-400">14</td>
              <td class="p-2 border border-cyan-400 dark:border-cyan-600 text-center">
                <input type="text" data-correct-answer="21" class="w-12 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold bg-transparent dark:text-white">
              </td>
              <td class="p-2 border border-cyan-400 dark:border-cyan-600 text-center">
                <input type="text" data-correct-answer="28" class="w-12 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold bg-transparent dark:text-white">
              </td>
              <td class="p-2 border border-cyan-400 dark:border-cyan-600 text-center">
                <input type="text" data-correct-answer="35" class="w-12 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold bg-transparent dark:text-white">
              </td>
              <td class="p-2 border border-cyan-400 dark:border-cyan-600 text-center">
                <input type="text" data-correct-answer="42" class="w-12 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold bg-transparent dark:text-white">
              </td>
              <td class="p-2 border border-cyan-400 dark:border-cyan-600 text-center">
                <input type="text" data-correct-answer="49" class="w-12 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold bg-transparent dark:text-white">
              </td>
              <td class="p-2 border border-cyan-400 dark:border-cyan-600 text-center">
                <input type="text" data-correct-answer="56" class="w-12 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold bg-transparent dark:text-white">
              </td>
              <td class="p-2 border border-cyan-400 dark:border-cyan-600 text-center">
                <input type="text" data-correct-answer="63" class="w-12 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold bg-transparent dark:text-white">
              </td>
              <td class="p-2 border border-cyan-400 dark:border-cyan-600 text-center">
                <input type="text" data-correct-answer="70" class="w-12 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold bg-transparent dark:text-white">
              </td>
              <td class="p-2 border border-cyan-400 dark:border-cyan-600 text-center font-bold text-cyan-600 dark:text-cyan-400">84</td>
              <td class="p-2 border border-cyan-400 dark:border-cyan-600 text-center">
                <input type="text" data-correct-answer="140" class="w-12 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold bg-transparent dark:text-white">
              </td>
              <td class="p-2 border border-cyan-400 dark:border-cyan-600 text-center">
                <input type="text" data-correct-answer="210" class="w-12 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold bg-transparent dark:text-white">
              </td>
              <td class="p-2 border border-cyan-400 dark:border-cyan-600 text-center">
                <input type="text" data-correct-answer="280" class="w-12 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold bg-transparent dark:text-white">
              </td>
              <td class="p-2 border border-cyan-400 dark:border-cyan-600 text-center">
                <input type="text" data-correct-answer="350" class="w-12 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold bg-transparent dark:text-white">
              </td>
              <td class="p-2 border border-cyan-400 dark:border-cyan-600 text-center">
                <input type="text" data-correct-answer="420" class="w-12 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold bg-transparent dark:text-white">
              </td>
              <td class="p-2 border border-cyan-400 dark:border-cyan-600 text-center">
                <input type="text" data-correct-answer="490" class="w-12 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold bg-transparent dark:text-white">
              </td>
              <td class="p-2 border border-cyan-400 dark:border-cyan-600 text-center font-bold text-cyan-600 dark:text-cyan-400">560</td>
              <td class="p-2 border border-cyan-400 dark:border-cyan-600 text-center">
                <input type="text" data-correct-answer="630" class="w-12 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold bg-transparent dark:text-white">
              </td>
              <td class="p-2 border border-cyan-400 dark:border-cyan-600 text-center">
                <input type="text" data-correct-answer="700" class="w-12 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold bg-transparent dark:text-white">
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="flex items-center gap-2 flex-wrap">
        <span class="text-gray-700 dark:text-gray-200"><span class="text-cyan-500">•</span> Quanti multipli del numero 7 potresti ancora trovare?</span>
        <input type="text" data-correct-answer="infiniti" class="w-32 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold bg-transparent dark:text-white">
      </div>
    </div>

    <!-- Esercizio 2 -->
    <div>
      <p class="font-bold text-gray-700 dark:text-gray-200 mb-4">
        <%= numero_esercizio_badge(2) %>
        Scrivi sul quaderno i multipli indicati.
      </p>

      <ul class="list-disc pl-6 space-y-2 text-gray-700 dark:text-gray-200 marker:text-cyan-500">
        <li>Multipli di 3 da 0 a 12</li>
        <li>Multipli di 5 da 35 a 50</li>
      </ul>
    </div>

    <!-- Esercizio 3 -->
    <div>
      <p class="font-bold text-gray-700 dark:text-gray-200 mb-4">
        <%= numero_esercizio_badge(3) %>
        Cerchia i multipli di 4.
      </p>

      <div class="flex flex-wrap gap-4 items-center">
        <% [
          { n: 17, correct: false },
          { n: 36, correct: true },
          { n: 16, correct: true },
          { n: 21, correct: false },
          { n: 40, correct: true },
          { n: 8, correct: true },
          { n: 15, correct: false }
        ].each do |item| %>
          <span data-word-highlighter-target="word"
                data-correct="<%= item[:correct] %>"
                data-action="click->word-highlighter#toggleHighlight"
                class="px-3 py-2 border-2 border-gray-300 dark:border-gray-600 rounded-full cursor-pointer hover:border-cyan-400 dark:hover:border-cyan-500 text-gray-700 dark:text-gray-200 transition-colors">
            <%= item[:n] %>
          </span>
        <% end %>
      </div>
    </div>

    <!-- Esercizio 4 -->
    <div>
      <p class="font-bold text-gray-700 dark:text-gray-200 mb-4">
        <%= numero_esercizio_badge(4) %>
        Cerchia di rosso i <span class="bg-cyan-100 dark:bg-cyan-800 px-1 rounded">multipli di 3</span> e di blu i <span class="bg-cyan-100 dark:bg-cyan-800 px-1 rounded">multipli di 5</span>. Poi rispondi.
      </p>

      <div class="flex flex-wrap gap-4 items-center mb-4">
        <% [9, 15, 27, 30, 12, 35].each do |n| %>
          <span class="px-3 py-2 border-2 border-gray-300 dark:border-gray-600 rounded-full text-gray-700 dark:text-gray-200">
            <%= n %>
          </span>
        <% end %>
      </div>

      <div class="flex items-center gap-2 flex-wrap">
        <span class="text-gray-700 dark:text-gray-200"><span class="text-cyan-500">•</span> Che cosa noti?</span>
        <input type="text" placeholder="Scrivi la tua osservazione..." class="flex-1 min-w-48 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center bg-transparent dark:text-white">
      </div>
    </div>

    <!-- Definizione divisori -->
    <div class="p-3 bg-cyan-50 dark:bg-cyan-900 rounded-lg">
      <p class="text-gray-700 dark:text-gray-200">
        I <span class="font-bold">divisori</span> di un numero lo dividono esattamente (senza resto).
      </p>
    </div>

    <!-- Esercizio 5 -->
    <div>
      <p class="font-bold text-gray-700 dark:text-gray-200 mb-4">
        <%= numero_esercizio_badge(5) %>
        Scopri se i seguenti numeri hanno come <span class="bg-cyan-100 dark:bg-cyan-800 px-1 rounded">divisore 4</span>. Completa la tabella.
      </p>

      <div class="overflow-x-auto">
        <table class="w-full border-collapse border border-cyan-400 dark:border-cyan-600">
          <thead>
            <tr>
              <th class="p-2 border border-cyan-400 dark:border-cyan-600 bg-cyan-100 dark:bg-cyan-800 text-center text-gray-700 dark:text-gray-200">Numero</th>
              <th class="p-2 border border-cyan-400 dark:border-cyan-600 bg-cyan-100 dark:bg-cyan-800 text-center text-gray-700 dark:text-gray-200">Divido per 4 e verifico se il resto è 0</th>
              <th class="p-2 border border-cyan-400 dark:border-cyan-600 bg-cyan-100 dark:bg-cyan-800 text-center text-gray-700 dark:text-gray-200">4 è un suo divisore?</th>
            </tr>
          </thead>
          <tbody>
            <% [
              { num: 60, result: "15", is_divisor: true },
              { num: 92, result: "23", is_divisor: true },
              { num: 128, result: "32", is_divisor: true },
              { num: 160, result: "40", is_divisor: true },
              { num: 224, result: "56", is_divisor: true },
              { num: 242, result: "60 resto 2", is_divisor: false }
            ].each do |row| %>
              <tr>
                <td class="p-2 border border-cyan-400 dark:border-cyan-600 text-center text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-700"><%= row[:num] %></td>
                <td class="p-2 border border-cyan-400 dark:border-cyan-600 text-center bg-white dark:bg-gray-700">
                  <span class="text-gray-700 dark:text-gray-200"><%= row[:num] %> : 4 = </span>
                  <input type="text" data-correct-answer="<%= row[:result] %>" class="w-24 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold bg-transparent dark:text-white">
                </td>
                <td class="p-2 border border-cyan-400 dark:border-cyan-600 text-center bg-white dark:bg-gray-700">
                  <div class="flex justify-center gap-2">
                    <label class="relative flex items-center justify-center w-10 h-8 bg-white dark:bg-gray-600 border-2 border-cyan-500 dark:border-cyan-600 rounded cursor-pointer hover:bg-cyan-100 dark:hover:bg-cyan-800 has-[:checked]:bg-cyan-300 dark:has-[:checked]:bg-cyan-700">
                      <input type="radio" name="div4_<%= row[:num] %>" value="si" class="absolute inset-0 opacity-0 cursor-pointer" <%= 'data-correct-answer=true' if row[:is_divisor] %>>
                      <span class="text-gray-700 dark:text-gray-200">SÌ</span>
                    </label>
                    <label class="relative flex items-center justify-center w-10 h-8 bg-white dark:bg-gray-600 border-2 border-cyan-500 dark:border-cyan-600 rounded cursor-pointer hover:bg-cyan-100 dark:hover:bg-cyan-800 has-[:checked]:bg-cyan-300 dark:has-[:checked]:bg-cyan-700">
                      <input type="radio" name="div4_<%= row[:num] %>" value="no" class="absolute inset-0 opacity-0 cursor-pointer" <%= 'data-correct-answer=true' unless row[:is_divisor] %>>
                      <span class="text-gray-700 dark:text-gray-200">NO</span>
                    </label>
                  </div>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Esercizio 6 -->
    <div>
      <p class="font-bold text-gray-700 dark:text-gray-200 mb-4">
        <%= numero_esercizio_badge(6) %>
        Scrivi almeno quattro divisori per ciascuno dei seguenti numeri.
      </p>

      <div class="space-y-3">
        <div class="flex items-center gap-2 flex-wrap">
          <span class="text-gray-700 dark:text-gray-200 w-12">20</span>
          <span class="text-cyan-500">→</span>
          <input type="text" placeholder="es: 1, 2, 4, 5, 10, 20" class="flex-1 min-w-48 border-b-2 border-dotted border-gray-400 dark:border-gray-500 bg-transparent dark:text-white">
        </div>
        <div class="flex items-center gap-2 flex-wrap">
          <span class="text-gray-700 dark:text-gray-200 w-12">60</span>
          <span class="text-cyan-500">→</span>
          <input type="text" placeholder="es: 1, 2, 3, 4, 5, 6, 10, 12, 15, 20, 30, 60" class="flex-1 min-w-48 border-b-2 border-dotted border-gray-400 dark:border-gray-500 bg-transparent dark:text-white">
        </div>
        <div class="flex items-center gap-2 flex-wrap">
          <span class="text-gray-700 dark:text-gray-200 w-12">100</span>
          <span class="text-cyan-500">→</span>
          <input type="text" placeholder="es: 1, 2, 4, 5, 10, 20, 25, 50, 100" class="flex-1 min-w-48 border-b-2 border-dotted border-gray-400 dark:border-gray-500 bg-transparent dark:text-white">
        </div>
      </div>
    </div>

    <!-- Esercizio 7 -->
    <div>
      <p class="font-bold text-gray-700 dark:text-gray-200 mb-4">
        <%= numero_esercizio_badge(7) %>
        Collega ogni numero nelle stelline ad almeno un suo divisore.
      </p>

      <div class="flex justify-center">
        <%= image_tag "nvi4_mat/p197/p197_02.jpg", class: "max-w-full h-auto dark:bg-white dark:rounded-lg dark:p-2", alt: "Numeri e divisori" %>
      </div>
    </div>

    <%= render 'shared/exercise_controls' %>
  </div>
</div>
