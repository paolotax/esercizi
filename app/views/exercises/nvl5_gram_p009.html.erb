<div class="max-w-6xl mx-auto bg-white dark:bg-gray-900 text-black dark:text-white p-3 md:p-6 transition-colors duration-300"
     data-controller="exercise-checker text-toggle font-controls"
     data-text-toggle-target="content"
     data-font-controls-target="content">

  <%= render 'shared/page_header', pagina: @pagina %>

  <div class="space-y-6">

  <!-- Info Box -->
  <div class="bg-yellow-100 dark:bg-yellow-900/30 rounded-lg p-4 md:p-6 text-gray-800 dark:text-gray-200">
    <h2 class="mb-1">
      Ricordi il plurale di <span class="text-cyan-700 dark:text-cyan-400 font-bold">-CIA</span> e <span class="text-cyan-700 dark:text-cyan-400 font-bold">-GIA</span>?
    </h2>
    <div class="space-y-1">
      <div class="flex flex-wrap items-center gap-6">
        <span class="whitespace-nowrap">bu<span class="font-bold">c</span><span class="font-bold text-cyan-700 dark:text-cyan-400">cia</span> → bu<span class="font-bold text-cyan-700 dark:text-cyan-400">cce</span></span>
        <span class="whitespace-nowrap">spia<span class="font-bold">g</span><span class="font-bold text-cyan-700 dark:text-cyan-400">gia</span> → spia<span class="font-bold text-cyan-700 dark:text-cyan-400">gge</span></span>
        <span class="whitespace-nowrap">cam<span class="font-bold">i</span><span class="font-bold text-cyan-700 dark:text-cyan-400">cia</span> → cami<span class="font-bold text-cyan-700 dark:text-cyan-400">cie</span></span>
      </div>
      <p class="text-gray-800 dark:text-gray-200 mt-1">La <span class="text-cyan-700 dark:text-cyan-400 font-bold">i</span> rimane al <span class="text-cyan-700 dark:text-cyan-400 font-bold">plurale</span> se prima c'è una <span class="font-bold">vocale</span>!</p>
    </div>
  </div>

  <!-- Exercise 5: Complete tables -->
  <div class="bg-white dark:bg-gray-800 rounded-lg p-4 md:p-6">
    <h2 class="font-bold text-gray-800 dark:text-gray-200 mb-4">
      <span class="bg-pink-600 text-white rounded-full w-8 h-8 md:w-10 md:h-10 inline-flex items-center justify-center mr-2">5</span>
      Ripassa il plurale di <span class="font-bold text-cyan-700 dark:text-cyan-400">-CIA</span> e <span class="font-bold text-cyan-700 dark:text-cyan-400">-GIA</span>. Completa le tabelle.
    </h2>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-6" data-controller="fill-blanks">
      <!-- Singolare to Plurale -->
      <div>
        <div class="overflow-x-auto">
          <table class="w-full border-collapse">
            <thead>
              <tr class="bg-blue-200 dark:bg-blue-900/40">
                <th colspan="2" class="border-2 border-blue-400 dark:border-blue-600 px-4 py-3 font-bold text-center text-cyan-700 dark:text-cyan-400">Dal singolare al plurale</th>
              </tr>
            </thead>
            <tbody>
              <% singolare_plurale = [
                {sing: 'bilancia', plur: 'bilance'},
                {sing: 'traccia', plur: 'tracce'},
                {sing: 'camicia', plur: 'camicie'},
                {sing: 'regia', plur: 'regie'},
                {sing: 'antologia', plur: 'antologie'}
              ] %>

              <% singolare_plurale.each do |item| %>
                <tr class="bg-white dark:bg-gray-700">
                  <td class="border-2 border-blue-300 dark:border-blue-600 px-4 py-3 font-bold"><%= item[:sing] %></td>
                  <td class="border-2 border-blue-300 dark:border-blue-600 px-4 py-3">
                    <input type="text"
                           class="w-full border-b-2 border-dotted border-gray-400 dark:border-gray-500 bg-transparent dark:text-white text-left focus:outline-none"
                           data-fill-blanks-target="input"
                           data-answer="<%= item[:plur] %>"
                           data-correct-answer="<%= item[:plur] %>">
                  </td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>
      </div>

      <!-- Plurale to Singolare -->
      <div>
        <div class="overflow-x-auto">
          <table class="w-full border-collapse">
            <thead>
              <tr class="bg-blue-200 dark:bg-blue-900/40">
                <th colspan="2" class="border-2 border-blue-400 dark:border-blue-600 px-4 py-3 font-bold text-center text-cyan-700 dark:text-cyan-400">Dal plurale al singolare</th>
              </tr>
            </thead>
            <tbody>
              <% plurale_singolare = [
                {plur: 'rocce', sing: 'roccia'},
                {plur: 'frecce', sing: 'freccia'},
                {plur: 'querce', sing: 'quercia'},
                {plur: 'piogge', sing: 'pioggia'},
                {plur: 'bugie', sing: 'bugia'}
              ] %>

              <% plurale_singolare.each do |item| %>
                <tr class="bg-white dark:bg-gray-700">
                  <td class="border-2 border-blue-300 dark:border-blue-600 px-4 py-3 font-bold"><%= item[:plur] %></td>
                  <td class="border-2 border-blue-300 dark:border-blue-600 px-4 py-3">
                    <input type="text"
                           class="w-full border-b-2 border-dotted border-gray-400 dark:border-gray-500 bg-transparent dark:text-white text-left focus:outline-none"
                           data-fill-blanks-target="input"
                           data-answer="<%= item[:sing] %>"
                           data-correct-answer="<%= item[:sing] %>">
                  </td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- Exercise 6: Write sentences -->
  <div class="bg-white dark:bg-gray-800 rounded-lg p-4 md:p-6">
    <h2 class="font-bold text-gray-800 dark:text-gray-200 mb-4">
      <span class="bg-pink-600 text-white rounded-full w-8 h-8 md:w-10 md:h-10 inline-flex items-center justify-center mr-2">6</span>
      Scrivi una frase per ciascuna parola.
    </h2>

    <div class="space-y-4">
      <div class="flex items-start gap-3">
        <div class="bg-white dark:bg-gray-700 border-4 border-green-500 dark:border-green-400 text-black dark:text-white px-4 py-2 rounded-lg font-bold flex-shrink-0 ml-10">CAMICIE</div>
        <textarea class="flex-1 border-2 border-dotted border-gray-400 dark:border-gray-500 bg-transparent dark:text-white rounded-lg p-3 focus:outline-none"
                  rows="2"
                  placeholder="Scrivi una frase con la parola CAMICIE..."></textarea>
      </div>

      <div class="flex items-start gap-3">
        <div class="bg-white dark:bg-gray-700 border-4 border-blue-500 dark:border-blue-400 text-black dark:text-white px-4 py-2 rounded-lg font-bold flex-shrink-0 ml-10">CAMICE</div>
        <textarea class="flex-1 border-2 border-dotted border-gray-400 dark:border-gray-500 bg-transparent dark:text-white rounded-lg p-3 focus:outline-none"
                  rows="2"
                  placeholder="Scrivi una frase con la parola CAMICE..."></textarea>
      </div>
    </div>
  </div>

  <!-- Exercise 7: Z and ZZ -->
  <div class="bg-white dark:bg-gray-800 rounded-lg p-4 md:p-6">
    <h2 class="font-bold text-gray-800 dark:text-gray-200 mb-4">
      <span class="bg-pink-600 text-white rounded-full w-8 h-8 md:w-10 md:h-10 inline-flex items-center justify-center mr-2">7</span>
      Ripassa <span class="font-bold text-cyan-700 dark:text-cyan-400">Z</span> e <span class="font-bold text-cyan-700 dark:text-cyan-400">ZZ</span>. Colora la parola corretta.
    </h2>

    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4">
      <% word_pairs = [
        {words: ['COLAZIONE', 'COLAZZIONE'], correct: 'COLAZIONE', color: 'purple'},
        {words: ['CARROZIERE', 'CARROZZIERE'], correct: 'CARROZZIERE', color: 'orange'},
        {words: ['CARROZA', 'CARROZZA'], correct: 'CARROZZA', color: 'yellow'},
        {words: ['LEZIONE', 'LEZZIONE'], correct: 'LEZIONE', color: 'cyan'},
        {words: ['OPERAZZIONE', 'OPERAZIONE'], correct: 'OPERAZIONE', color: 'orange'},
        {words: ['PULIZIA', 'PULIZZIA'], correct: 'PULIZIA', color: 'cyan'}
      ] %>

      <% word_pairs.each do |pair| %>
        <div class="border-4 rounded-full overflow-hidden flex"
             data-controller="card-selector"
             style="border-color: <%= case pair[:color]
               when 'purple' then '#a855f7'
               when 'orange' then '#f97316'
               when 'yellow' then '#eab308'
               when 'cyan' then '#06b6d4'
               end %>;">
          <% pair[:words].each_with_index do |word, idx| %>
            <div class="flex-1 px-3 py-3 text-center font-bold cursor-pointer transition hover:bg-gray-100 dark:hover:bg-gray-700 <%= 'border-r-2' if idx == 0 %>"
                 style="<%= 'border-color: ' + (case pair[:color]
                   when 'purple' then '#a855f7'
                   when 'orange' then '#f97316'
                   when 'yellow' then '#eab308'
                   when 'cyan' then '#06b6d4'
                   end) if idx == 0 %>;"
                 data-action="click->card-selector#select"
                 data-card-selector-target="card"
                 data-correct="<%= word == pair[:correct] %>">
              <%= word %>
            </div>
          <% end %>
        </div>
      <% end %>
    </div>
  </div>

  <!-- GIOCO: Crossword with DOPPIE -->
  <div class="bg-white dark:bg-gray-800 rounded-lg p-4 md:p-6">
    <div class="flex items-center gap-3 mb-4">
      <span class="bg-gradient-to-r from-red-500 to-orange-500 text-white px-4 py-2 rounded-lg font-bold">GIOCO</span>
      <h2 class="font-bold text-gray-800 dark:text-gray-200">
        Gioca con le <span class="font-bold text-cyan-700 dark:text-cyan-400">DOPPIE</span>. Leggi le definizioni e completa lo schema.
      </h2>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <!-- Definitions -->
      <div class="bg-white dark:bg-gray-700 rounded-lg p-4 space-y-2">
        <p><strong class="text-cyan-700 dark:text-cyan-400">1.</strong> Legumi piccoli, tondi e verdi.</p>
        <p><strong class="text-cyan-700 dark:text-cyan-400">2.</strong> È bianco e si usa per rendere dolce il tè o il caffè.</p>
        <p><strong class="text-cyan-700 dark:text-cyan-400">3.</strong> Il suono del telefono.</p>
        <p><strong class="text-cyan-700 dark:text-cyan-400">4.</strong> Galoppa, trotta e nitrisce.</p>
        <p><strong class="text-cyan-700 dark:text-cyan-400">5.</strong> Lo usi per bere.</p>
      </div>

      <!-- Crossword Grid -->
      <div class="bg-white dark:bg-gray-700 rounded-lg p-4">
        <div class="space-y-[-2px]" data-controller="crossword">
          <% answers = [
            {num: 1, answer: 'PISELLI'},
            {num: 2, answer: 'ZUCCHERO'},
            {num: 3, answer: 'SQUILLO'},
            {num: 4, answer: 'CAVALLO'},
            {num: 5, answer: 'BICCHIERE'}
          ] %>

          <% answers.each_with_index do |item, word_idx| %>
            <div class="flex flex-wrap md:flex-nowrap items-center gap-0">
              <span class="font-bold text-cyan-700 dark:text-cyan-400 w-6 flex-shrink-0"><%= item[:num] %></span>
              <% item[:answer].chars.each_with_index do |char, char_idx| %>
                <%
                  # Pre-compila la S di PISELLI (prima parola, terzo carattere) e la Q di SQUILLO (terza parola, secondo carattere)
                  is_prefilled = (word_idx == 0 && char_idx == 2) || (word_idx == 2 && char_idx == 1)
                %>
                <input type="text"
                       maxlength="1"
                       class="w-8 h-8 md:w-10 md:h-10 border-2 border-green-300 dark:border-green-600 bg-white dark:bg-gray-600 dark:text-white text-center font-bold uppercase focus:border-pink-500 focus:outline-none flex-shrink-0 -ml-[2px] first:ml-0 <%= 'bg-gray-100 dark:bg-gray-500' if is_prefilled %>"
                       data-answer="<%= char %>"
                       data-correct-answer="<%= char %>"
                       <% if is_prefilled %>value="<%= char %>" readonly<% end %>>
              <% end %>
            </div>
          <% end %>
        </div>
      </div>
    </div>
  </div>

  <!-- Exercise Controls -->
  <%= render 'shared/exercise_controls' %>
  </div><!-- chiude space-y-6 -->
</div>
