<div class="max-w-6xl mx-auto bg-white dark:bg-gray-900 p-3 md:p-6 transition-colors duration-300"
     data-controller="exercise-checker text-toggle font-controls"
     data-text-toggle-target="content"
     data-font-controls-target="content">

  <%= render 'shared/page_header', pagina: @pagina %>

  <div class="space-y-6">

    <!-- Box teoria -->
    <div class="p-4 bg-cyan-50 dark:bg-cyan-900 rounded-lg border-2 border-cyan-400 dark:border-cyan-600">
      <p class="text-gray-700 dark:text-gray-200 mb-2">
        Per calcolare la <span class="font-bold text-cyan-600 dark:text-cyan-400">frazione di un numero</span>:
      </p>
      <ul class="list-disc list-inside text-gray-700 dark:text-gray-200 mb-3 space-y-1">
        <li><span class="font-bold text-cyan-600 dark:text-cyan-400">dividi</span> il numero per il denominatore;</li>
        <li><span class="font-bold text-cyan-600 dark:text-cyan-400">moltiplica</span> il risultato per il numeratore.</li>
      </ul>
      <div class="flex items-center gap-2 flex-wrap">
        <%= render 'shared/frazione', num: 3, den: 5 %>
        <span class="text-gray-700 dark:text-gray-200">di 20</span>
        <span class="text-cyan-500">→</span>
        <span class="text-gray-700 dark:text-gray-200">20 : <span class="font-bold">5</span> = 4</span>
        <span class="text-cyan-500">→</span>
        <span class="text-gray-700 dark:text-gray-200">4 × <span class="font-bold">3</span> = <span class="font-bold text-cyan-600 dark:text-cyan-400">12</span></span>
      </div>
    </div>

    <!-- Esercizio 1 IMPARARE TUTTI -->
    <div class="p-5 bg-white dark:bg-gray-800 rounded-2xl border-3 border-yellow-400 dark:border-yellow-500">
      <p class="font-bold text-gray-700 dark:text-gray-200 mb-4">
        <%= imparare_tutti_badge(1) %>
        Trova e colora di rosso i <%= render 'shared/frazione', num: 5, den: 9 %> dei 18 bottoni. Segui l'esempio.
      </p>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <!-- Colonna sinistra: bottoni -->
        <div>
          <!-- 18 bottoni divisi in 9 gruppi da 2 -->
          <div class="flex flex-wrap gap-2 mb-4">
            <% 9.times do |group| %>
              <div class="flex gap-1 p-2 border border-dashed border-cyan-400 dark:border-cyan-600 rounded">
                <% 2.times do %>
                  <div class="w-8 h-8 rounded-full border-2 border-cyan-400 dark:border-cyan-600 <%= group < 5 ? 'bg-red-300 dark:bg-red-600' : 'bg-white dark:bg-gray-700' %> flex items-center justify-center">
                    <div class="w-2 h-2 rounded-full bg-cyan-400 dark:bg-cyan-600"></div>
                  </div>
                <% end %>
              </div>
            <% end %>
          </div>

          <!-- Frazioni sotto i gruppi -->
          <div class="flex flex-wrap gap-2">
            <% 9.times do |i| %>
              <div class="w-12 text-center">
                <%= render 'shared/frazione', num: 1, den: 9 %>
              </div>
            <% end %>
          </div>
          <div class="mt-2 text-center">
            <span class="font-bold text-cyan-600 dark:text-cyan-400"><%= render 'shared/frazione', num: 5, den: 9 %></span>
          </div>
        </div>

        <!-- Colonna destra: spiegazione -->
        <div class="p-4 bg-gray-50 dark:bg-gray-700 rounded-lg space-y-4">
          <div>
            <p class="text-gray-700 dark:text-gray-200 mb-2">
              Dividi il numero dei bottoni in tanti gruppi quanti ne indica il denominatore.
            </p>
            <div class="flex items-center gap-2 flex-wrap">
              <span class="text-gray-700 dark:text-gray-200">18 : 9 =</span>
              <span class="font-bold text-cyan-600 dark:text-cyan-400">2</span>
              <span class="text-gray-700 dark:text-gray-200">cioè</span>
              <%= render 'shared/frazione', num: 1, den: 9 %>
              <span class="text-gray-700 dark:text-gray-200">di 18</span>
            </div>
          </div>

          <div>
            <p class="text-gray-700 dark:text-gray-200 mb-2">
              Poi moltiplica per il numeratore.
            </p>
            <div class="flex items-center gap-2 flex-wrap">
              <input type="text" data-correct-answer="2" class="w-10 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold bg-transparent dark:text-white">
              <span class="text-gray-700 dark:text-gray-200">× 5 =</span>
              <input type="text" data-correct-answer="10" class="w-10 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold bg-transparent dark:text-white">
              <span class="text-gray-700 dark:text-gray-200">cioè</span>
              <%= render 'shared/frazione', num: 5, den: 9 %>
              <span class="text-gray-700 dark:text-gray-200">di 18</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Esercizio 2 -->
    <div>
      <p class="font-bold text-gray-700 dark:text-gray-200 mb-4">
        <%= numero_esercizio_badge(2) %>
        Trova e colora di giallo i <%= render 'shared/frazione', num: 2, den: 5 %> delle 20 caramelle.
      </p>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <!-- Colonna sinistra: caramelle -->
        <div>
          <!-- 20 caramelle divise in 5 gruppi da 4 -->
          <div class="grid grid-cols-5 gap-2">
            <% 20.times do |i| %>
              <div class="w-10 h-6 rounded-full border-2 border-cyan-400 dark:border-cyan-600 bg-white dark:bg-gray-700"></div>
            <% end %>
          </div>
        </div>

        <!-- Colonna destra: spiegazione -->
        <div class="p-4 bg-gray-50 dark:bg-gray-700 rounded-lg space-y-4">
          <div>
            <p class="text-gray-700 dark:text-gray-200 mb-2">
              Dividi il numero delle caramelle in tanti gruppi quanti ne indica il denominatore.
            </p>
            <div class="flex items-center gap-2 flex-wrap">
              <span class="text-gray-700 dark:text-gray-200">20 :</span>
              <input type="text" data-correct-answer="5" class="w-10 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold bg-transparent dark:text-white">
              <span class="text-gray-700 dark:text-gray-200">=</span>
              <input type="text" data-correct-answer="4" class="w-10 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold bg-transparent dark:text-white">
              <span class="text-gray-700 dark:text-gray-200">cioè</span>
              <%= render 'shared/frazione', num: 1, den: 5 %>
              <span class="text-gray-700 dark:text-gray-200">di 20</span>
            </div>
          </div>

          <div>
            <p class="text-gray-700 dark:text-gray-200 mb-2">
              Poi moltiplica per il numeratore.
            </p>
            <div class="flex items-center gap-2 flex-wrap">
              <input type="text" data-correct-answer="4" class="w-10 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold bg-transparent dark:text-white">
              <span class="text-gray-700 dark:text-gray-200">×</span>
              <input type="text" data-correct-answer="2" class="w-10 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold bg-transparent dark:text-white">
              <span class="text-gray-700 dark:text-gray-200">=</span>
              <input type="text" data-correct-answer="8" class="w-10 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold bg-transparent dark:text-white">
              <span class="text-gray-700 dark:text-gray-200">cioè</span>
              <%= render 'shared/frazione', num: 2, den: 5 %>
              <span class="text-gray-700 dark:text-gray-200">di 20</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Esercizio 3 -->
    <div>
      <p class="font-bold text-gray-700 dark:text-gray-200 mb-4">
        <%= numero_esercizio_badge(3) %>
        Calcola come nell'esempio.
      </p>

      <div class="space-y-4">
        <!-- Esempio -->
        <div class="flex items-center gap-2 flex-wrap p-3 bg-cyan-50 dark:bg-cyan-900 rounded-lg">
          <%= render 'shared/frazione', num: 3, den: 14 %>
          <span class="text-gray-700 dark:text-gray-200 font-bold">di 28</span>
          <span class="text-cyan-500">→</span>
          <span class="text-gray-700 dark:text-gray-200">28 : 14 = 2</span>
          <span class="text-cyan-500">→</span>
          <span class="text-gray-700 dark:text-gray-200">2 × 3 = <span class="font-bold text-cyan-600 dark:text-cyan-400">6</span></span>
        </div>

        <!-- Esercizi -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <% [
            { num: 3, den: 7, of: 63, div_result: 9, final: 27 },
            { num: 3, den: 6, of: 54, div_result: 9, final: 27 },
            { num: 6, den: 9, of: 36, div_result: 4, final: 24 },
            { num: 7, den: 8, of: 32, div_result: 4, final: 28 },
            { num: 4, den: 9, of: 72, div_result: 8, final: 32 }
          ].each do |item| %>
            <div class="flex items-center gap-2 flex-wrap p-3 border border-cyan-400 dark:border-cyan-600 rounded-lg">
              <%= render 'shared/frazione', num: item[:num], den: item[:den] %>
              <span class="text-gray-700 dark:text-gray-200">di <%= item[:of] %></span>
              <span class="text-cyan-500">→</span>
              <input type="text" data-correct-answer="<%= item[:of] %>" class="w-10 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold bg-transparent dark:text-white">
              <span class="text-gray-700 dark:text-gray-200">:</span>
              <input type="text" data-correct-answer="<%= item[:den] %>" class="w-10 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold bg-transparent dark:text-white">
              <span class="text-gray-700 dark:text-gray-200">=</span>
              <input type="text" data-correct-answer="<%= item[:div_result] %>" class="w-10 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold bg-transparent dark:text-white">
              <span class="text-cyan-500">→</span>
              <input type="text" data-correct-answer="<%= item[:div_result] %>" class="w-10 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold bg-transparent dark:text-white">
              <span class="text-gray-700 dark:text-gray-200">×</span>
              <input type="text" data-correct-answer="<%= item[:num] %>" class="w-10 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold bg-transparent dark:text-white">
              <span class="text-gray-700 dark:text-gray-200">=</span>
              <input type="text" data-correct-answer="<%= item[:final] %>" class="w-10 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold bg-transparent dark:text-white">
            </div>
          <% end %>
        </div>
      </div>
    </div>

    <%= render 'shared/exercise_controls' %>
  </div>
</div>
