<% content_for :titolo, "#{@pagina.titolo} - #{@pagina.numero}" %>

<div class="max-w-7xl mx-auto p-3 md:p-6 bg-white dark:bg-gray-900 text-black dark:text-white transition-colors duration-300"
     data-controller="exercise-checker page-viewer text-toggle font-controls"
     data-page-viewer-image-url-value="<%= asset_path('bus3_mat/p013/page.png') %>"
     data-text-toggle-target="content"
     data-font-controls-target="content">
  <!-- Header -->
  <%= render 'shared/page_header', pagina: @pagina %>

  <!-- Esercizio 9: Conta le palline e scrivi il numero in lettere -->
  <div class="bg-transparent p-4 md:p-8 mb-8" data-controller="fill-blanks auto-advance">
    
    <p class="text-gray-700 dark:text-gray-200">
      <%= numero_esercizio_badge(9, colore: 'red-500') %>
      Conta le palline e scrivi il numero in cifre e in lettere.
    </p>

    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
      <% [280, 407, 632].each_with_index do |numero, index| %>
        <%
          # Calcola il nome in lettere per ciascun numero
          nomi_lettere = {
            280 => "duecentottanta",
            407 => "quattrocentosette",
            632 => "seicentotrentadue"
          }
        %>
        <div class="flex flex-col items-center">
          <div class="bg-gradient-to-br from-orange-50 to-amber-50 dark:from-orange-900/20 dark:to-amber-900/20 rounded-2xl p-4 mb-4">
            <%= render 'strumenti/abaco/abaco',
                       abaco: Abaco.new(columns: 3, correct_value: numero, mode: :balls, editable: true, show_value: false) %>
          </div>
          <div class="w-full">
            <label class="block text-sm font-bold text-gray-700 dark:text-gray-200 mb-2 text-center">In lettere:</label>
            <input type="text" data-fill-blanks-target="input" data-correct-answer="<%= nomi_lettere[numero] %>"
                   class="w-full px-3 py-2 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold bg-transparent dark:text-white"
                   maxlength="25">
          </div>
        </div>
      <% end %>
    </div>
  </div>

  <!-- Esercizio 10: Indica con una X il numero in cifre -->
  <style>
    .custom-checkbox {
      appearance: none;
      -webkit-appearance: none;
      -moz-appearance: none;
      width: 1.75rem;
      height: 1.75rem;
      border: 2px solid #67e8f9;
      border-radius: 0.25rem;
      position: relative;
      cursor: pointer;
      background-color: white;
    }
    .dark .custom-checkbox {
      background-color: #1f2937;
      border-color: #22d3ee;
    }
    .custom-checkbox:checked {
      background-color: white;
    }
    .dark .custom-checkbox:checked {
      background-color: #1f2937;
    }
    .custom-checkbox:checked::after {
      content: '';
      position: absolute;
      left: 50%;
      top: 50%;
      width: 0.875rem;
      height: 0.125rem;
      background-color: #ef4444;
      transform: translate(-50%, -50%) rotate(45deg);
    }
    .custom-checkbox:checked::before {
      content: '';
      position: absolute;
      left: 50%;
      top: 50%;
      width: 0.875rem;
      height: 0.125rem;
      background-color: #ef4444;
      transform: translate(-50%, -50%) rotate(-45deg);
    }
  </style>

  <div class="bg-transparent p-4 md:p-8 mb-8" data-controller="exercise-checker">
    <p class="text-gray-700 dark:text-gray-200">
      <%= numero_esercizio_badge(10, colore: 'red-500') %>
      Indica con una <strong class="text-red-600 dark:text-red-400">X</strong> il numero in cifre.
    </p>

    <div class="space-y-4">
      <!-- duecentonove -->
      <div class="flex flex-wrap items-center gap-4">
        <span class="font-bold min-w-[180px]">duecentonove:</span>
        <label class="flex items-center gap-3 cursor-pointer">
          <input type="checkbox" data-correct-answer="false" class="custom-checkbox">
          <span class="">290</span>
        </label>
        <label class="flex items-center gap-3 cursor-pointer">
          <input type="checkbox" data-correct-answer="false" class="custom-checkbox">
          <span class="">219</span>
        </label>
        <label class="flex items-center gap-3 cursor-pointer">
          <input type="checkbox" data-correct-answer="true" class="custom-checkbox">
          <span class="">209</span>
        </label>
      </div>

      <!-- settecentouno -->
      <div class="flex flex-wrap items-center gap-4">
        <span class="font-bold min-w-[180px]">settecentouno:</span>
        <label class="flex items-center gap-3 cursor-pointer">
          <input type="checkbox" data-correct-answer="false" class="custom-checkbox">
          <span class="">171</span>
        </label>
        <label class="flex items-center gap-3 cursor-pointer">
          <input type="checkbox" data-correct-answer="true" class="custom-checkbox">
          <span class="">701</span>
        </label>
        <label class="flex items-center gap-3 cursor-pointer">
          <input type="checkbox" data-correct-answer="false" class="custom-checkbox">
          <span class="">710</span>
        </label>
      </div>

      <!-- trecentotrenta -->
      <div class="flex flex-wrap items-center gap-4">
        <span class="font-bold min-w-[180px]">trecentotrenta:</span>
        <label class="flex items-center gap-3 cursor-pointer">
          <input type="checkbox" data-correct-answer="false" class="custom-checkbox">
          <span class="">303</span>
        </label>
        <label class="flex items-center gap-3 cursor-pointer">
          <input type="checkbox" data-correct-answer="true" class="custom-checkbox">
          <span class="">330</span>
        </label>
        <label class="flex items-center gap-3 cursor-pointer">
          <input type="checkbox" data-correct-answer="false" class="custom-checkbox">
          <span class="">230</span>
        </label>
      </div>
    </div>
  </div>

  <!-- Esercizio 11: Completa con il numero adatto -->
  <div class="bg-transparent p-4 md:p-8 mb-8" data-controller="fill-blanks">
    <p class="text-gray-700 dark:text-gray-200">
      <%= numero_esercizio_badge(11, colore: 'red-500') %>
      Completa con il numero adatto.
    </p>

    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mt-4">
      <!-- 342 > ___ (201 corretto, 450 sbagliato) -->
      <div class="flex items-center gap-3">
        <span class="font-bold text-xl">342</span>
        <span class="text-blue-600 dark:text-blue-400 text-xl font-bold">&gt;</span>
        <select data-fill-blanks-target="input" data-correct-answer="201"
                class="px-3 py-1 border-2 border-gray-300 dark:border-gray-600 rounded-lg text-center font-bold text-xl bg-white dark:bg-gray-800 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500">
          <option value="">...</option>
          <option value="450">450</option>
          <option value="201">201</option>
        </select>
      </div>

      <!-- ___ < 842 (549 corretto, 900 sbagliato) -->
      <div class="flex items-center gap-3">
        <select data-fill-blanks-target="input" data-correct-answer="549"
                class="px-3 py-1 border-2 border-gray-300 dark:border-gray-600 rounded-lg text-center font-bold text-xl bg-white dark:bg-gray-800 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500">
          <option value="">...</option>
          <option value="549">549</option>
          <option value="900">900</option>
        </select>
        <span class="text-blue-600 dark:text-blue-400 text-xl font-bold">&lt;</span>
        <span class="font-bold text-xl">842</span>
      </div>

      <!-- 723 > ___ (131 corretto, 800 sbagliato) -->
      <div class="flex items-center gap-3">
        <span class="font-bold text-xl">723</span>
        <span class="text-blue-600 dark:text-blue-400 text-xl font-bold">&gt;</span>
        <select data-fill-blanks-target="input" data-correct-answer="131"
                class="px-3 py-1 border-2 border-gray-300 dark:border-gray-600 rounded-lg text-center font-bold text-xl bg-white dark:bg-gray-800 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500">
          <option value="">...</option>
          <option value="800">800</option>
          <option value="131">131</option>
        </select>
      </div>

      <!-- ___ < 652 (256 corretto, 718 sbagliato) -->
      <div class="flex items-center gap-3">
        <select data-fill-blanks-target="input" data-correct-answer="256"
                class="px-3 py-1 border-2 border-gray-300 dark:border-gray-600 rounded-lg text-center font-bold text-xl bg-white dark:bg-gray-800 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500">
          <option value="">...</option>
          <option value="718">718</option>
          <option value="256">256</option>
        </select>
        <span class="text-blue-600 dark:text-blue-400 text-xl font-bold">&lt;</span>
        <span class="font-bold text-xl">652</span>
      </div>

      <!-- 489 > ___ (398 corretto, 512 sbagliato) -->
      <div class="flex items-center gap-3">
        <span class="font-bold text-xl">489</span>
        <span class="text-blue-600 dark:text-blue-400 text-xl font-bold">&gt;</span>
        <select data-fill-blanks-target="input" data-correct-answer="398"
                class="px-3 py-1 border-2 border-gray-300 dark:border-gray-600 rounded-lg text-center font-bold text-xl bg-white dark:bg-gray-800 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500">
          <option value="">...</option>
          <option value="512">512</option>
          <option value="398">398</option>
        </select>
      </div>

      <!-- ___ < 971 (917 corretto, 985 sbagliato) -->
      <div class="flex items-center gap-3">
        <select data-fill-blanks-target="input" data-correct-answer="917"
                class="px-3 py-1 border-2 border-gray-300 dark:border-gray-600 rounded-lg text-center font-bold text-xl bg-white dark:bg-gray-800 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500">
          <option value="">...</option>
          <option value="985">985</option>
          <option value="917">917</option>
        </select>
        <span class="text-blue-600 dark:text-blue-400 text-xl font-bold">&lt;</span>
        <span class="font-bold text-xl">971</span>
      </div>
    </div>
  </div>

  <!-- Esercizio 12: Scomponi i numeri -->
  <div class="bg-transparent p-4 md:p-8 mb-8" data-controller="fill-blanks auto-advance">
    <div class="flex items-start gap-3 mb-6">
      <div class="bg-red-500 text-white rounded-full w-8 h-8 flex items-center justify-center font-bold flex-shrink-0">
        12
      </div>
      <p class="text-gray-700 dark:text-gray-200">
        Scomponi i numeri. Segui l'esempio.
      </p>
    </div>

    <div class="space-y-6">
      <!-- Esempio: 563 -->
      <div class="flex flex-wrap items-center gap-3">
        <span class="font-bold min-w-[60px]">563</span>
        <span class="text-blue-600 dark:text-blue-400">→</span>
        <span class="font-bold text-cyan-700 dark:text-cyan-400">5 h, 6 da, 3 u</span>
        <span class="text-blue-600 dark:text-blue-400">→</span>
        <span class="font-bold text-cyan-700 dark:text-cyan-400">500 + 60 + 3</span>
      </div>

      <!-- 724 -->
      <div class="flex flex-wrap items-center gap-3">
        <span class="font-bold min-w-[60px]">724</span>
        <span class="text-blue-600 dark:text-blue-400">→</span>
        <div class="flex items-center gap-2">
          <input type="text" data-fill-blanks-target="input" data-correct-answer="7"
                 class="w-12 px-2 py-1 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold bg-transparent dark:text-white"
                 maxlength="1" inputmode="numeric">
          <span class="font-bold">h,</span>
          <input type="text" data-fill-blanks-target="input" data-correct-answer="2"
                 class="w-12 px-2 py-1 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold bg-transparent dark:text-white"
                 maxlength="1" inputmode="numeric">
          <span class="font-bold">da,</span>
          <input type="text" data-fill-blanks-target="input" data-correct-answer="4"
                 class="w-12 px-2 py-1 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold bg-transparent dark:text-white"
                 maxlength="1" inputmode="numeric">
          <span class="font-bold">u</span>
        </div>
        <span class="text-blue-600 dark:text-blue-400">→</span>
        <div class="flex items-center gap-2">
          <input type="text" data-fill-blanks-target="input" data-correct-answer="700"
                 class="w-16 px-2 py-1 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold bg-transparent dark:text-white"
                 maxlength="3" inputmode="numeric">
          <span class="font-bold">+</span>
          <input type="text" data-fill-blanks-target="input" data-correct-answer="20"
                 class="w-16 px-2 py-1 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold bg-transparent dark:text-white"
                 maxlength="2" inputmode="numeric">
          <span class="font-bold">+</span>
          <input type="text" data-fill-blanks-target="input" data-correct-answer="4"
                 class="w-16 px-2 py-1 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold bg-transparent dark:text-white"
                 maxlength="1" inputmode="numeric">
        </div>
      </div>

      <!-- 965 -->
      <div class="flex flex-wrap items-center gap-3">
        <span class="font-bold min-w-[60px]">965</span>
        <span class="text-blue-600 dark:text-blue-400">→</span>
        <div class="flex items-center gap-2">
          <input type="text" data-fill-blanks-target="input" data-correct-answer="9"
                 class="w-12 px-2 py-1 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold bg-transparent dark:text-white"
                 maxlength="1" inputmode="numeric">
          <span class="font-bold">h,</span>
          <input type="text" data-fill-blanks-target="input" data-correct-answer="6"
                 class="w-12 px-2 py-1 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold bg-transparent dark:text-white"
                 maxlength="1" inputmode="numeric">
          <span class="font-bold">da,</span>
          <input type="text" data-fill-blanks-target="input" data-correct-answer="5"
                 class="w-12 px-2 py-1 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold bg-transparent dark:text-white"
                 maxlength="1" inputmode="numeric">
          <span class="font-bold">u</span>
        </div>
        <span class="text-blue-600 dark:text-blue-400">→</span>
        <div class="flex items-center gap-2">
          <input type="text" data-fill-blanks-target="input" data-correct-answer="900"
                 class="w-16 px-2 py-1 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold bg-transparent dark:text-white"
                 maxlength="3" inputmode="numeric">
          <span class="font-bold">+</span>
          <input type="text" data-fill-blanks-target="input" data-correct-answer="60"
                 class="w-16 px-2 py-1 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold bg-transparent dark:text-white"
                 maxlength="2" inputmode="numeric">
          <span class="font-bold">+</span>
          <input type="text" data-fill-blanks-target="input" data-correct-answer="5"
                 class="w-16 px-2 py-1 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold bg-transparent dark:text-white"
                 maxlength="1" inputmode="numeric">
        </div>
      </div>
    </div>
  </div>

  <!-- Esercizio 13 GIOCO: Completa il crucinumero -->
  <div class="bg-transparent p-4 md:p-8 mb-8" data-controller="fill-blanks auto-advance">
    <div class="flex items-start gap-3 mb-6">
      <div class="bg-gradient-to-r from-cyan-400 to-blue-500 text-white rounded-full w-8 h-8 flex items-center justify-center font-bold flex-shrink-0">
        13
      </div>
      <div class="flex items-center gap-2">
        <span class="bg-gradient-to-r from-cyan-400 to-blue-500 text-white px-4 py-1 rounded-full font-bold">GIOCO</span>
        <p class="text-gray-700 dark:text-gray-200 font-bold">
          Completa il crucinumero.
        </p>
      </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
      <!-- Definizioni -->
      <div class="space-y-6">
        <!-- Orizzontali -->
        <div>
          <h3 class="font-bold text-gray-800 dark:text-gray-200 mb-3">→ Orizzontali</h3>
          <div class="space-y-2">
            <div class="flex gap-2">
              <span class="font-bold text-blue-600 dark:text-blue-400 min-w-[20px]">2.</span>
              <p class="text-gray-700 dark:text-gray-200">Il numero di giorni in un anno.</p>
            </div>
            <div class="flex gap-2">
              <span class="font-bold text-blue-600 dark:text-blue-400 min-w-[20px]">3.</span>
              <p class="text-gray-700 dark:text-gray-200">Il successivo di 200.</p>
            </div>
            <div class="flex gap-2">
              <span class="font-bold text-blue-600 dark:text-blue-400 min-w-[20px]">4.</span>
              <p class="text-gray-700 dark:text-gray-200">Il precedente di 820.</p>
            </div>
          </div>
        </div>

        <!-- Verticali -->
        <div>
          <h3 class="font-bold text-gray-800 dark:text-gray-200 mb-3">↓ Verticali</h3>
          <div class="space-y-2">
            <div class="flex gap-2">
              <span class="font-bold text-red-600 dark:text-red-400 min-w-[20px]">1.</span>
              <p class="text-gray-700 dark:text-gray-200">Componi 6 da, 4 h, 1 u.</p>
            </div>
            <div class="flex gap-2">
              <span class="font-bold text-red-600 dark:text-red-400 min-w-[20px]">2.</span>
              <p class="text-gray-700 dark:text-gray-200">Il numero 310 è il suo successivo.</p>
            </div>
            <div class="flex gap-2">
              <span class="font-bold text-red-600 dark:text-red-400 min-w-[20px]">3.</span>
              <p class="text-gray-700 dark:text-gray-200">Componi 7 u, 2 h, 1 da.</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Griglia crucinumero 5x5
           Struttura (4→ inizia in riga 3):
                c0  c1  c2  c3  c4
           r0:  ■   ■   ■   4   ■     1↓=461 inizia
           r1:  ■   ■   3   6   5     2→=365
           r2:  ■   2   0   1   ■     3→=201
           r3:  8   1   9   ■   ■     4→=819 (quarta riga!)
           r4:  ■   7   ■   ■   ■     3↓=217 finisce

           Intersezioni: 1↓(4,6,1) 2↓(3,0,9) 3↓(2,1,7)
      -->
      <div class="flex justify-center items-start">
        <div class="inline-grid grid-cols-5 gap-0 border-4 border-cyan-400 dark:border-cyan-500 rounded-lg overflow-hidden">
          <!-- Riga 0: ■ ■ ■ 1↓ ■ -->
          <div class="w-12 h-12 bg-cyan-200 dark:bg-cyan-900/50 border border-cyan-300 dark:border-cyan-600"></div>
          <div class="w-12 h-12 bg-cyan-200 dark:bg-cyan-900/50 border border-cyan-300 dark:border-cyan-600"></div>
          <div class="w-12 h-12 bg-cyan-200 dark:bg-cyan-900/50 border border-cyan-300 dark:border-cyan-600"></div>
          <div class="w-12 h-12 bg-white dark:bg-gray-800 border border-cyan-300 dark:border-cyan-600 relative">
            <input type="text" data-fill-blanks-target="input" data-correct-answer="4"
                   class="w-full h-full text-center text-xl font-bold border-0 bg-transparent dark:text-white focus:bg-yellow-50 dark:focus:bg-yellow-900/30"
                   maxlength="1" inputmode="numeric">
            <span class="absolute top-0.5 left-1 text-[10px] font-bold text-cyan-600 dark:text-cyan-400">1</span>
          </div>
          <div class="w-12 h-12 bg-cyan-200 dark:bg-cyan-900/50 border border-cyan-300 dark:border-cyan-600"></div>

          <!-- Riga 1: ■ ■ 2→ X X (365) -->
          <div class="w-12 h-12 bg-cyan-200 dark:bg-cyan-900/50 border border-cyan-300 dark:border-cyan-600"></div>
          <div class="w-12 h-12 bg-cyan-200 dark:bg-cyan-900/50 border border-cyan-300 dark:border-cyan-600"></div>
          <div class="w-12 h-12 bg-white dark:bg-gray-800 border border-cyan-300 dark:border-cyan-600 relative">
            <input type="text" data-fill-blanks-target="input" data-correct-answer="3"
                   class="w-full h-full text-center text-xl font-bold border-0 bg-transparent dark:text-white focus:bg-yellow-50 dark:focus:bg-yellow-900/30"
                   maxlength="1" inputmode="numeric">
            <span class="absolute top-0.5 left-1 text-[10px] font-bold text-cyan-600 dark:text-cyan-400">2</span>
          </div>
          <div class="w-12 h-12 bg-white dark:bg-gray-800 border border-cyan-300 dark:border-cyan-600 relative">
            <input type="text" data-fill-blanks-target="input" data-correct-answer="6"
                   class="w-full h-full text-center text-xl font-bold border-0 bg-transparent dark:text-white focus:bg-yellow-50 dark:focus:bg-yellow-900/30"
                   maxlength="1" inputmode="numeric">
          </div>
          <div class="w-12 h-12 bg-white dark:bg-gray-800 border border-cyan-300 dark:border-cyan-600 relative">
            <input type="text" data-fill-blanks-target="input" data-correct-answer="5"
                   class="w-full h-full text-center text-xl font-bold border-0 bg-transparent dark:text-white focus:bg-yellow-50 dark:focus:bg-yellow-900/30"
                   maxlength="1" inputmode="numeric">
          </div>

          <!-- Riga 2: ■ 3→ X X ■ (201) -->
          <div class="w-12 h-12 bg-cyan-200 dark:bg-cyan-900/50 border border-cyan-300 dark:border-cyan-600"></div>
          <div class="w-12 h-12 bg-white dark:bg-gray-800 border border-cyan-300 dark:border-cyan-600 relative">
            <input type="text" data-fill-blanks-target="input" data-correct-answer="2"
                   class="w-full h-full text-center text-xl font-bold border-0 bg-transparent dark:text-white focus:bg-yellow-50 dark:focus:bg-yellow-900/30"
                   maxlength="1" inputmode="numeric">
            <span class="absolute top-0.5 left-1 text-[10px] font-bold text-cyan-600 dark:text-cyan-400">3</span>
          </div>
          <div class="w-12 h-12 bg-white dark:bg-gray-800 border border-cyan-300 dark:border-cyan-600 relative">
            <input type="text" data-fill-blanks-target="input" data-correct-answer="0"
                   class="w-full h-full text-center text-xl font-bold border-0 bg-transparent dark:text-white focus:bg-yellow-50 dark:focus:bg-yellow-900/30"
                   maxlength="1" inputmode="numeric">
          </div>
          <div class="w-12 h-12 bg-white dark:bg-gray-800 border border-cyan-300 dark:border-cyan-600 relative">
            <input type="text" data-fill-blanks-target="input" data-correct-answer="1"
                   class="w-full h-full text-center text-xl font-bold border-0 bg-transparent dark:text-white focus:bg-yellow-50 dark:focus:bg-yellow-900/30"
                   maxlength="1" inputmode="numeric">
          </div>
          <div class="w-12 h-12 bg-cyan-200 dark:bg-cyan-900/50 border border-cyan-300 dark:border-cyan-600"></div>

          <!-- Riga 3: 4→ X X ■ ■ (819) -->
          <div class="w-12 h-12 bg-white dark:bg-gray-800 border border-cyan-300 dark:border-cyan-600 relative">
            <input type="text" data-fill-blanks-target="input" data-correct-answer="8"
                   class="w-full h-full text-center text-xl font-bold border-0 bg-transparent dark:text-white focus:bg-yellow-50 dark:focus:bg-yellow-900/30"
                   maxlength="1" inputmode="numeric">
            <span class="absolute top-0.5 left-1 text-[10px] font-bold text-cyan-600 dark:text-cyan-400">4</span>
          </div>
          <div class="w-12 h-12 bg-white dark:bg-gray-800 border border-cyan-300 dark:border-cyan-600 relative">
            <input type="text" data-fill-blanks-target="input" data-correct-answer="1"
                   class="w-full h-full text-center text-xl font-bold border-0 bg-transparent dark:text-white focus:bg-yellow-50 dark:focus:bg-yellow-900/30"
                   maxlength="1" inputmode="numeric">
          </div>
          <div class="w-12 h-12 bg-white dark:bg-gray-800 border border-cyan-300 dark:border-cyan-600 relative">
            <input type="text" data-fill-blanks-target="input" data-correct-answer="9"
                   class="w-full h-full text-center text-xl font-bold border-0 bg-transparent dark:text-white focus:bg-yellow-50 dark:focus:bg-yellow-900/30"
                   maxlength="1" inputmode="numeric">
          </div>
          <div class="w-12 h-12 bg-cyan-200 dark:bg-cyan-900/50 border border-cyan-300 dark:border-cyan-600"></div>
          <div class="w-12 h-12 bg-cyan-200 dark:bg-cyan-900/50 border border-cyan-300 dark:border-cyan-600"></div>

          <!-- Riga 4: ■ X ■ ■ ■ (3↓ finisce con 7) -->
          <div class="w-12 h-12 bg-cyan-200 dark:bg-cyan-900/50 border border-cyan-300 dark:border-cyan-600"></div>
          <div class="w-12 h-12 bg-white dark:bg-gray-800 border border-cyan-300 dark:border-cyan-600 relative">
            <input type="text" data-fill-blanks-target="input" data-correct-answer="7"
                   class="w-full h-full text-center text-xl font-bold border-0 bg-transparent dark:text-white focus:bg-yellow-50 dark:focus:bg-yellow-900/30"
                   maxlength="1" inputmode="numeric">
          </div>
          <div class="w-12 h-12 bg-cyan-200 dark:bg-cyan-900/50 border border-cyan-300 dark:border-cyan-600"></div>
          <div class="w-12 h-12 bg-cyan-200 dark:bg-cyan-900/50 border border-cyan-300 dark:border-cyan-600"></div>
          <div class="w-12 h-12 bg-cyan-200 dark:bg-cyan-900/50 border border-cyan-300 dark:border-cyan-600"></div>
        </div>
      </div>
    </div>

  </div>

  <!-- Quaderno link allineato a destra -->
  <div class="p-4 mb-8 text-right">
    <span class="text-gray-600 dark:text-gray-400">Quaderno →</span> <%= link_to "p. 140", pagina_path("bus3_mat_p140"), class: "text-cyan-600 dark:text-cyan-400 font-bold hover:underline" %>
  </div>

  <!-- Footer con controlli -->
  <%= render 'shared/exercise_controls', color: 'cyan' %>
</div>
