<div class="max-w-6xl mx-auto bg-white dark:bg-gray-900 p-3 md:p-6 transition-colors duration-300"
     data-controller="exercise-checker text-toggle font-controls"
     data-text-toggle-target="content"
     data-font-controls-target="content">

  <%= render 'shared/page_header', pagina: @pagina %>

  <div class="space-y-6">

    <!-- Esercizio 1: IMPARARE TUTTI - Scomponi minuendo e sottraendo -->
    <div class="p-5 bg-white dark:bg-gray-800 rounded-2xl border-3 border-yellow-400 dark:border-yellow-500">
      <p class="font-bold text-gray-700 dark:text-gray-200 mb-4">
        <%= imparare_tutti_badge(1) %>
        Scomponi minuendo e sottraendo e calcola. Segui l'esempio.
      </p>

      <div class="space-y-6">
        <!-- Esempio con immagine -->
        <div class="flex justify-center">
          <%= image_tag "nvi4_mat/p184/p184_01.jpg", class: "max-w-full h-auto dark:bg-white dark:rounded-lg dark:p-1", alt: "Esempio scomposizione minuendo e sottraendo" %>
        </div>

        <!-- Esercizi -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
          <!-- 78 - 53 -->
          <div class="space-y-2">
            <div class="flex items-center gap-2">
              <span class="font-bold text-gray-700 dark:text-gray-200">78</span>
              <span class="text-gray-700 dark:text-gray-200">–</span>
              <span class="font-bold text-gray-700 dark:text-gray-200">53</span>
              <span class="text-gray-700 dark:text-gray-200">=</span>
            </div>
            <div class="flex items-center gap-1 flex-wrap">
              <span class="text-gray-700 dark:text-gray-200">(</span>
              <input type="text" data-correct-answer="70" class="w-10 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold bg-transparent dark:text-white">
              <span class="text-gray-700 dark:text-gray-200">+</span>
              <input type="text" data-correct-answer="8" class="w-10 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold bg-transparent dark:text-white">
              <span class="text-gray-700 dark:text-gray-200">) – (</span>
              <input type="text" data-correct-answer="50" class="w-10 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold bg-transparent dark:text-white">
              <span class="text-gray-700 dark:text-gray-200">+</span>
              <input type="text" data-correct-answer="3" class="w-10 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold bg-transparent dark:text-white">
              <span class="text-gray-700 dark:text-gray-200">) =</span>
            </div>
            <div class="flex items-center gap-1 flex-wrap">
              <input type="text" data-correct-answer="20" class="w-12 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold bg-transparent dark:text-white">
              <span class="text-gray-700 dark:text-gray-200">+</span>
              <input type="text" data-correct-answer="5" class="w-12 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold bg-transparent dark:text-white">
              <span class="text-gray-700 dark:text-gray-200">=</span>
              <input type="text" data-correct-answer="25" class="w-14 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold bg-transparent dark:text-white">
            </div>
          </div>

          <!-- 95 - 72 -->
          <div class="space-y-2">
            <div class="flex items-center gap-2">
              <span class="font-bold text-gray-700 dark:text-gray-200">95</span>
              <span class="text-gray-700 dark:text-gray-200">–</span>
              <span class="font-bold text-gray-700 dark:text-gray-200">72</span>
              <span class="text-gray-700 dark:text-gray-200">=</span>
            </div>
            <div class="flex items-center gap-1 flex-wrap">
              <span class="text-gray-700 dark:text-gray-200">(</span>
              <input type="text" data-correct-answer="90" class="w-10 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold bg-transparent dark:text-white">
              <span class="text-gray-700 dark:text-gray-200">+</span>
              <input type="text" data-correct-answer="5" class="w-10 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold bg-transparent dark:text-white">
              <span class="text-gray-700 dark:text-gray-200">) – (</span>
              <input type="text" data-correct-answer="70" class="w-10 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold bg-transparent dark:text-white">
              <span class="text-gray-700 dark:text-gray-200">+</span>
              <input type="text" data-correct-answer="2" class="w-10 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold bg-transparent dark:text-white">
              <span class="text-gray-700 dark:text-gray-200">) =</span>
            </div>
            <div class="flex items-center gap-1 flex-wrap">
              <input type="text" data-correct-answer="20" class="w-12 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold bg-transparent dark:text-white">
              <span class="text-gray-700 dark:text-gray-200">+</span>
              <input type="text" data-correct-answer="3" class="w-12 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold bg-transparent dark:text-white">
              <span class="text-gray-700 dark:text-gray-200">=</span>
              <input type="text" data-correct-answer="23" class="w-14 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold bg-transparent dark:text-white">
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Esercizio 2: Segui l'esempio e calcola (-11) -->
    <div>
      <p class="font-bold text-gray-700 dark:text-gray-200 mb-4">
        <%= numero_esercizio_badge(2) %>
        Segui l'esempio e calcola.
      </p>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <!-- Tabella sinistra -->
        <div class="overflow-x-auto">
          <table class="w-full border-collapse border border-cyan-400 dark:border-cyan-600">
            <thead>
              <tr>
                <th class="p-2 border border-cyan-400 dark:border-cyan-600 bg-cyan-100 dark:bg-cyan-900 text-center text-gray-800 dark:text-gray-200">Numero</th>
                <th class="p-2 border border-cyan-400 dark:border-cyan-600 bg-cyan-100 dark:bg-cyan-900 text-center text-gray-800 dark:text-gray-200">– 11<br><span class="font-normal">(– 1 da – 1 u)</span></th>
              </tr>
            </thead>
            <tbody>
              <!-- 723 esempio -->
              <tr>
                <td class="p-2 border border-cyan-400 dark:border-cyan-600 text-center bg-white dark:bg-gray-700 font-bold text-gray-700 dark:text-gray-200">723</td>
                <td class="p-2 border border-cyan-400 dark:border-cyan-600 text-center bg-white dark:bg-gray-700 font-bold text-cyan-600 dark:text-cyan-400">712</td>
              </tr>
              <% [
                { num: "684", result: "673" },
                { num: "537", result: "526" },
                { num: "725", result: "714" },
                { num: "683", result: "672" }
              ].each do |item| %>
                <tr>
                  <td class="p-2 border border-cyan-400 dark:border-cyan-600 text-center bg-white dark:bg-gray-700 font-bold text-gray-700 dark:text-gray-200"><%= item[:num] %></td>
                  <td class="p-2 border border-cyan-400 dark:border-cyan-600 text-center bg-white dark:bg-gray-700">
                    <input type="text" data-correct-answer="<%= item[:result] %>" class="w-16 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold bg-transparent dark:text-white">
                  </td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>

        <!-- Tabella destra -->
        <div class="overflow-x-auto">
          <table class="w-full border-collapse border border-cyan-400 dark:border-cyan-600">
            <thead>
              <tr>
                <th class="p-2 border border-cyan-400 dark:border-cyan-600 bg-cyan-100 dark:bg-cyan-900 text-center text-gray-800 dark:text-gray-200">Numero</th>
                <th class="p-2 border border-cyan-400 dark:border-cyan-600 bg-cyan-100 dark:bg-cyan-900 text-center text-gray-800 dark:text-gray-200">– 11<br><span class="font-normal">(– 1 da – 1 u)</span></th>
              </tr>
            </thead>
            <tbody>
              <% [
                { num: "1 031", result: "1020" },
                { num: "5 725", result: "5714" },
                { num: "6 193", result: "6182" },
                { num: "4 578", result: "4567" },
                { num: "2 724", result: "2713" }
              ].each do |item| %>
                <tr>
                  <td class="p-2 border border-cyan-400 dark:border-cyan-600 text-center bg-white dark:bg-gray-700 font-bold text-gray-700 dark:text-gray-200"><%= item[:num] %></td>
                  <td class="p-2 border border-cyan-400 dark:border-cyan-600 text-center bg-white dark:bg-gray-700">
                    <input type="text" data-correct-answer="<%= item[:result] %>" class="w-16 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold bg-transparent dark:text-white">
                  </td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Esercizio 3: Tabelle -9, -99, -999 -->
    <div>
      <p class="font-bold text-gray-700 dark:text-gray-200 mb-4">
        <%= numero_esercizio_badge(3) %>
        Segui l'esempio e calcola.
      </p>

      <!-- Regola -->
      <div class="p-3 bg-pink-light dark:bg-pink-900/40 rounded-xl mb-4">
        <p class="text-gray-700 dark:text-gray-200">
          <span class="font-bold">Per togliere 9, 99, 999…</span> da un qualsiasi numero togli 10, 100, 1 000… e poi aggiungi 1.
        </p>
        <p class="text-center font-bold text-gray-700 dark:text-gray-200 mt-2">
          24 – 9 = (24 <span class="text-cyan-600 dark:text-cyan-400">– 10</span>) <span class="text-cyan-600 dark:text-cyan-400">+ 1</span> = 15
        </p>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <!-- Tabella -9 -->
        <div class="overflow-x-auto">
          <table class="w-full border-collapse border border-cyan-400 dark:border-cyan-600">
            <thead>
              <tr>
                <th class="p-2 border border-cyan-400 dark:border-cyan-600 bg-cyan-100 dark:bg-cyan-900 text-center text-gray-800 dark:text-gray-200">Numero</th>
                <th class="p-2 border border-cyan-400 dark:border-cyan-600 bg-cyan-100 dark:bg-cyan-900 text-center text-gray-800 dark:text-gray-200">– 9<br><span class="font-normal">(– 1 da + 1 u)</span></th>
              </tr>
            </thead>
            <tbody>
              <!-- 564 esempio -->
              <tr>
                <td class="p-2 border border-cyan-400 dark:border-cyan-600 text-center bg-white dark:bg-gray-700 font-bold text-gray-700 dark:text-gray-200">564</td>
                <td class="p-2 border border-cyan-400 dark:border-cyan-600 text-center bg-white dark:bg-gray-700 font-bold text-cyan-600 dark:text-cyan-400">555</td>
              </tr>
              <% [
                { num: "817", result: "808" },
                { num: "573", result: "564" },
                { num: "721", result: "712" },
                { num: "625", result: "616" },
                { num: "866", result: "857" }
              ].each do |item| %>
                <tr>
                  <td class="p-2 border border-cyan-400 dark:border-cyan-600 text-center bg-white dark:bg-gray-700 font-bold text-gray-700 dark:text-gray-200"><%= item[:num] %></td>
                  <td class="p-2 border border-cyan-400 dark:border-cyan-600 text-center bg-white dark:bg-gray-700">
                    <input type="text" data-correct-answer="<%= item[:result] %>" class="w-16 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold bg-transparent dark:text-white">
                  </td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>

        <!-- Tabella -99 -->
        <div class="overflow-x-auto">
          <table class="w-full border-collapse border border-cyan-400 dark:border-cyan-600">
            <thead>
              <tr>
                <th class="p-2 border border-cyan-400 dark:border-cyan-600 bg-cyan-100 dark:bg-cyan-900 text-center text-gray-800 dark:text-gray-200">Numero</th>
                <th class="p-2 border border-cyan-400 dark:border-cyan-600 bg-cyan-100 dark:bg-cyan-900 text-center text-gray-800 dark:text-gray-200">– 99<br><span class="font-normal">(– 1 h + 1 u)</span></th>
              </tr>
            </thead>
            <tbody>
              <% [
                { num: "6 936", result: "6837" },
                { num: "5 720", result: "5621" },
                { num: "3 682", result: "3583" }
              ].each do |item| %>
                <tr>
                  <td class="p-2 border border-cyan-400 dark:border-cyan-600 text-center bg-white dark:bg-gray-700 font-bold text-gray-700 dark:text-gray-200"><%= item[:num] %></td>
                  <td class="p-2 border border-cyan-400 dark:border-cyan-600 text-center bg-white dark:bg-gray-700">
                    <input type="text" data-correct-answer="<%= item[:result] %>" class="w-16 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold bg-transparent dark:text-white">
                  </td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>

        <!-- Tabella -999 -->
        <div class="overflow-x-auto">
          <table class="w-full border-collapse border border-cyan-400 dark:border-cyan-600">
            <thead>
              <tr>
                <th class="p-2 border border-cyan-400 dark:border-cyan-600 bg-cyan-100 dark:bg-cyan-900 text-center text-gray-800 dark:text-gray-200">Numero</th>
                <th class="p-2 border border-cyan-400 dark:border-cyan-600 bg-cyan-100 dark:bg-cyan-900 text-center text-gray-800 dark:text-gray-200">– 999<br><span class="font-normal">(– 1 uk + 1 u)</span></th>
              </tr>
            </thead>
            <tbody>
              <% [
                { num: "25 703", result: "24704" },
                { num: "56 874", result: "55875" }
              ].each do |item| %>
                <tr>
                  <td class="p-2 border border-cyan-400 dark:border-cyan-600 text-center bg-white dark:bg-gray-700 font-bold text-gray-700 dark:text-gray-200"><%= item[:num] %></td>
                  <td class="p-2 border border-cyan-400 dark:border-cyan-600 text-center bg-white dark:bg-gray-700">
                    <input type="text" data-correct-answer="<%= item[:result] %>" class="w-16 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold bg-transparent dark:text-white">
                  </td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Esercizio 4: Fai tappa alla decina precedente -->
    <div>
      <p class="font-bold text-gray-700 dark:text-gray-200 mb-4">
        <%= numero_esercizio_badge(4) %>
        Fai tappa alla <span class="italic">decina precedente</span>. Segui l'esempio.
      </p>

      <!-- Esempio -->
      <div class="p-3 bg-cyan-50 dark:bg-cyan-900 rounded-lg mb-4">
        <p class="font-bold text-gray-700 dark:text-gray-200">
          97 – 28 = (97 – 7) – 21 = 90 – 21 = <span class="text-cyan-600 dark:text-cyan-400">69</span>
        </p>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <% [
          { op: "66 – 39", result: "27" },
          { op: "43 – 25", result: "18" },
          { op: "75 – 47", result: "28" }
        ].each do |item| %>
          <div class="flex items-center gap-2">
            <span class="text-gray-700 dark:text-gray-200"><%= item[:op] %> =</span>
            <input type="text" data-correct-answer="<%= item[:result] %>" class="min-w-0 flex-1 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold bg-transparent dark:text-white">
          </div>
        <% end %>
        <% [
          { op: "53 – 26", result: "27" },
          { op: "87 – 38", result: "49" }
        ].each do |item| %>
          <div class="flex items-center gap-2">
            <span class="text-gray-700 dark:text-gray-200"><%= item[:op] %> =</span>
            <input type="text" data-correct-answer="<%= item[:result] %>" class="min-w-0 flex-1 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold bg-transparent dark:text-white">
          </div>
        <% end %>
      </div>
    </div>

    <%= render 'shared/exercise_controls' %>
  </div>
</div>
