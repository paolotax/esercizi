<div class="max-w-6xl mx-auto bg-white dark:bg-gray-900 p-3 md:p-6 transition-colors duration-300"
     data-controller="exercise-checker text-toggle font-controls"
     data-text-toggle-target="content"
     data-font-controls-target="content">

  <%= render 'shared/page_header', pagina: @pagina %>

  <div class="space-y-6">

    <!-- Sezione: Frazioni con denominatore uguale -->
    <div class="p-4 md:p-6">
      <h2 class="font-bold italic text-<%= @pagina.base_color %>-600 mb-4">Frazioni con denominatore uguale</h2>

      <div class="p-3 bg-custom-blue-light dark:bg-cyan-900 mb-4">
        <p class="text-gray-700 dark:text-gray-200">
          Lucia e Karima hanno partecipato alla corsa campestre. Lucia si è fermata dopo <%= render 'shared/frazione', num: 3, den: 7 %>
          del percorso, Karima dopo <%= render 'shared/frazione', num: 5, den: 7 %>. Chi delle due amiche ha percorso il tratto più lungo?
        </p>
      </div>

      <p class="text-gray-700 dark:text-gray-200 mb-2">
        Per rispondere rappresentiamo il percorso con un segmento diviso in 7 parti uguali.<br>
        Completa: scrivi i nomi delle due amiche.
      </p>

      <!-- Segmento percorso -->
      <div class="flex flex-col md:flex-row gap-4 mb-6">
        <div class="flex-1">
          <div class="relative pt-4 pb-8">
            <div class="flex items-center">
              <div class="border border-gray-400 dark:border-gray-600 px-2 py-1 bg-white dark:bg-gray-700 dark:text-gray-200 mr-1">Partenza</div>
              <div class="flex-1 h-1 bg-cyan-400 relative">
                <% 8.times do |i| %>
                  <div class="absolute top-1/2 -translate-y-1/2 w-0.5 h-4 bg-cyan-600" style="left: <%= (i * 100.0 / 7).round(2) %>%"></div>
                <% end %>
              </div>
              <div class="border border-gray-400 dark:border-gray-600 px-2 py-1 bg-white dark:bg-gray-700 dark:text-gray-200 ml-1">Arrivo</div>
            </div>
            <!-- Posizioni Lucia e Karima -->
            <div class="relative mt-2 flex">
              <div class="absolute text-center" style="left: <%= (3 * 100.0 / 7).round(2) %>%; transform: translateX(-50%);">
                <input type="text" data-correct-answer="Lucia" class="w-16 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center bg-transparent dark:text-white">
                <div class="mt-1"><%= render 'shared/frazione', num: 3, den: 7 %></div>
              </div>
              <div class="absolute text-center" style="left: <%= (5 * 100.0 / 7).round(2) %>%; transform: translateX(-50%);">
                <input type="text" data-correct-answer="Karima" class="w-16 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center bg-transparent dark:text-white">
                <div class="mt-1"><%= render 'shared/frazione', num: 5, den: 7 %></div>
              </div>
            </div>
          </div>
        </div>
        <%= image_tag "nvi4_mat/p067/p067_01.jpg", class: "w-32 h-auto hidden md:block dark:bg-white dark:rounded-lg dark:p-2" %>
      </div>

      <div class="mb-4">
        <p class="text-gray-700 dark:text-gray-200 mb-2">
          Quale delle due frazioni rappresenta il tratto più lungo?
        </p>
        <div class="flex items-center gap-2">
          <%= render 'shared/frazione', num: nil, den: nil, num_answer: "5", den_answer: "7" %>
        </div>
      </div>

      <div class="mb-6">
        <p class="text-gray-700 dark:text-gray-200 mb-2">
          Scrivi il segno &gt; oppure &lt; fra le due frazioni:
          <span class="inline-flex items-center gap-2">
            <%= render 'shared/frazione', num: 3, den: 7 %>
            <input type="text" data-correct-answer="<" class="w-10 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold bg-transparent dark:text-white">
            <%= render 'shared/frazione', num: 5, den: 7 %>
          </span>
        </p>
      </div>
    </div>

    <!-- Prova tu -->
    <div class="p-4 md:p-6">
      <p class="text-gray-700 dark:text-gray-200 mb-4">
        <span class="text-<%= @pagina.base_color %>-500">•</span>
        <strong>Prova tu.</strong>
      </p>

      <p class="text-gray-700 dark:text-gray-200 mb-2">
        Abbiamo diviso la linea dei numeri da 0 a 1 in 20 parti uguali. Colloca al loro posto le frazioni elencate e poi riscrivile in ordine decrescente: dalla maggiore alla minore.
      </p>

      <!-- Frazioni da ordinare -->
      <div class="flex flex-wrap gap-4 mb-4">
        <% [[2,20], [8,20], [4,20], [9,20], [11,20], [14,20], [10,20], [7,20], [1,20]].each do |num, den| %>
          <%= render 'shared/frazione', num: num, den: den %>
        <% end %>
      </div>

      <!-- Ordine decrescente -->
      <div class="flex flex-wrap items-center gap-1 mb-4">
        <% 9.times do |i| %>
          <%= render 'shared/frazione', num: nil, den: 20, num_answer: [14, 11, 10, 9, 8, 7, 4, 2, 1][i].to_s %>
          <% if i < 8 %>
            <span class="text-gray-600">&gt;</span>
          <% end %>
        <% end %>
      </div>

      <!-- Linea dei numeri divisa in 20 parti -->
      <div class="relative pt-4 pb-12 mb-4">
        <div class="flex items-center">
          <span class="text-cyan-600 font-bold mr-2">0</span>
          <div class="flex-1 h-1 bg-cyan-400 relative">
            <% 21.times do |i| %>
              <div class="absolute top-1/2 -translate-y-1/2 w-0.5 h-3 bg-cyan-600" style="left: <%= (i * 100.0 / 20).round(2) %>%"></div>
            <% end %>
          </div>
          <span class="text-cyan-600 font-bold ml-2">1</span>
        </div>
        <!-- Input per le posizioni -->
        <div class="grid grid-cols-9 gap-1 mt-4">
          <% [1, 2, 4, 7, 8, 9, 10, 11, 14].each do |val| %>
            <div class="flex flex-col items-center">
              <%= render 'shared/frazione', num: nil, den: nil, num_answer: val.to_s, den_answer: "20" %>
            </div>
          <% end %>
        </div>
      </div>

      <!-- Box regola -->
      <div class="p-3 bg-pink-light dark:bg-pink-900/40 rounded-2xl w-fit">
        <p class="text-gray-700 dark:text-gray-200">
          Tra due o più frazioni che hanno lo <strong>stesso denominatore</strong>
          è <strong>maggiore</strong> (&gt;) la frazione che ha il <strong>numeratore maggiore</strong>.
        </p>
      </div>
    </div>

    <!-- ESERCIZI -->
    <div class="p-4 md:p-6 bg-orange-100 dark:bg-orange-900/30 rounded-2xl">
      <p class="font-bold text-gray-700 dark:text-gray-200 mb-4">
        <%= numero_esercizio_badge(1) %>
        Confronta le frazioni e inserisci i segni <strong>&lt;</strong> oppure <strong>&gt;</strong>.
      </p>

      <div class="grid grid-cols-2 md:grid-cols-5 gap-4">
        <% [
          [[1,12], [1,4]],
          [[8,12], [8,16]],
          [[6,13], [6,8]],
          [[1,2], [1,5]],
          [[2,9], [2,7]],
          [[3,32], [3,16]],
          [[4,5], [3,5]],
          [[3,2], [1,2]],
          [[1,12], [4,12]],
          [[12,16], [8,16]],
          [[1,9], [3,9]],
          [[6,15], [9,15]]
        ].each do |pair| %>
          <div class="flex items-center gap-1">
            <%= render 'shared/frazione', num: pair[0][0], den: pair[0][1] %>
            <%
              # Calcola il confronto corretto
              left_val = pair[0][0].to_f / pair[0][1]
              right_val = pair[1][0].to_f / pair[1][1]
              correct = left_val > right_val ? ">" : "<"
            %>
            <input type="text" data-correct-answer="<%= correct %>" class="w-8 border-b-2 border-dotted border-gray-400 dark:border-gray-500 text-center font-bold bg-transparent dark:text-white">
            <%= render 'shared/frazione', num: pair[1][0], den: pair[1][1] %>
          </div>
        <% end %>
      </div>
    </div>

    <%= render 'shared/quaderno_link', pagine: [205] %>

    <%= render 'shared/exercise_controls' %>
  </div>
</div>
