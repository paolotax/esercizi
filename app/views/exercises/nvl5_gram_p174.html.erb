<div class="max-w-6xl mx-auto bg-white dark:bg-gray-900 text-black dark:text-white p-3 md:p-6 transition-colors duration-300"
     data-controller="exercise-checker text-toggle font-controls"
     data-text-toggle-target="content"
     data-font-controls-target="content">

  <%= render 'shared/page_header', pagina: @pagina %>

  <!-- Esercizio 1: Sottolinea i verbi impersonali -->
  <div class="mb-6 bg-white dark:bg-gray-800 rounded-2xl border-4 border-yellow-200 dark:border-yellow-700 shadow-2xl p-4 md:p-6" data-controller="word-highlighter">
    <h2 class="font-bold text-gray-700 dark:text-gray-200 mb-4">
      <span class="bg-yellow-600 text-white rounded-full w-8 h-8 md:w-10 md:h-10 inline-flex items-center justify-center mr-2">1</span>
      <span class="bg-yellow-400 dark:bg-yellow-500 text-blue-800 dark:text-blue-900 px-2 py-1 rounded font-bold mr-2">IMPARARE TUTTI</span>
      Sottolinea i <strong class="underline text-blue-600 dark:text-blue-400">verbi impersonali</strong> e di <strong class="underline text-red-600 dark:text-red-400">forma impersonale</strong>.
    </h2>

    <div class="space-y-3">
      <div class="bg-gray-50 dark:bg-gray-800 border-2 border-gray-200 dark:border-gray-700 rounded-xl p-3">
        <span class="text-gray-700 dark:text-gray-200">• <span data-word-highlighter-target="word" data-correct="yellow" data-action="click->word-highlighter#toggleHighlight" class="px-1 rounded cursor-pointer">Nevica</span> senza sosta da più di un'ora.</span>
      </div>

      <div class="bg-gray-50 dark:bg-gray-800 border-2 border-gray-200 dark:border-gray-700 rounded-xl p-3">
        <span class="text-gray-700 dark:text-gray-200">• <span data-word-highlighter-target="word" data-correct="yellow" data-action="click->word-highlighter#toggleHighlight" class="px-1 rounded cursor-pointer">Tuonò</span> e <span data-word-highlighter-target="word" data-correct="yellow" data-action="click->word-highlighter#toggleHighlight" class="px-1 rounded cursor-pointer">lampeggiò</span> per tutta la notte.</span>
      </div>

      <div class="bg-gray-50 dark:bg-gray-800 border-2 border-gray-200 dark:border-gray-700 rounded-xl p-3">
        <span class="text-gray-700 dark:text-gray-200">• <span data-word-highlighter-target="word" data-correct="yellow" data-action="click->word-highlighter#toggleHighlight" class="px-1 rounded cursor-pointer">Capita</span> spesso che piova.</span>
      </div>

      <div class="bg-gray-50 dark:bg-gray-800 border-2 border-gray-200 dark:border-gray-700 rounded-xl p-3">
        <span class="text-gray-700 dark:text-gray-200">• <span data-word-highlighter-target="word" data-correct="yellow" data-action="click->word-highlighter#toggleHighlight" class="px-1 rounded cursor-pointer">Sembra</span> che tu non voglia capirmi!</span>
      </div>

      <div class="bg-gray-50 dark:bg-gray-800 border-2 border-gray-200 dark:border-gray-700 rounded-xl p-3">
        <span class="text-gray-700 dark:text-gray-200">• <span data-word-highlighter-target="word" data-correct="yellow" data-action="click->word-highlighter#toggleHighlight" class="px-1 rounded cursor-pointer">Occorre</span> avere pazienza.</span>
      </div>

      <div class="bg-gray-50 dark:bg-gray-800 border-2 border-gray-200 dark:border-gray-700 rounded-xl p-3">
        <span class="text-gray-700 dark:text-gray-200">• <span data-word-highlighter-target="word" data-correct="yellow" data-action="click->word-highlighter#toggleHighlight" class="px-1 rounded cursor-pointer">Albeggiava</span> quando mi svegliai.</span>
      </div>

      <div class="bg-gray-50 dark:bg-gray-800 border-2 border-gray-200 dark:border-gray-700 rounded-xl p-3">
        <span class="text-gray-700 dark:text-gray-200">• Il contadino temeva che <span data-word-highlighter-target="word" data-correct="yellow" data-action="click->word-highlighter#toggleHighlight" class="px-1 rounded cursor-pointer">grandinasse</span>.</span>
      </div>

      <div class="bg-gray-50 dark:bg-gray-800 border-2 border-gray-200 dark:border-gray-700 rounded-xl p-3">
        <span class="text-gray-700 dark:text-gray-200">• <span data-word-highlighter-target="word" data-correct="yellow" data-action="click->word-highlighter#toggleHighlight" class="px-1 rounded cursor-pointer">Pare</span> che il colpevole abbia confessato.</span>
      </div>

      <div class="bg-gray-50 dark:bg-gray-800 border-2 border-gray-200 dark:border-gray-700 rounded-xl p-3">
        <span class="text-gray-700 dark:text-gray-200">• È opportuno <span data-word-highlighter-target="word" data-correct="yellow" data-action="click->word-highlighter#toggleHighlight" class="px-1 rounded cursor-pointer">seguire</span> una dieta varia.</span>
      </div>

      <div class="bg-gray-50 dark:bg-gray-800 border-2 border-gray-200 dark:border-gray-700 rounded-xl p-3">
        <span class="text-gray-700 dark:text-gray-200">• <span data-word-highlighter-target="word" data-correct="yellow" data-action="click->word-highlighter#toggleHighlight" class="px-1 rounded cursor-pointer">Basta</span> aggiungere un po' di zucchero.</span>
      </div>

      <div class="bg-gray-50 dark:bg-gray-800 border-2 border-gray-200 dark:border-gray-700 rounded-xl p-3">
        <span class="text-gray-700 dark:text-gray-200">• <span data-word-highlighter-target="word" data-correct="yellow" data-action="click->word-highlighter#toggleHighlight" class="px-1 rounded cursor-pointer">Diluviava</span> e non riuscivo a vedere la strada.</span>
      </div>

      <div class="bg-gray-50 dark:bg-gray-800 border-2 border-gray-200 dark:border-gray-700 rounded-xl p-3">
        <span class="text-gray-700 dark:text-gray-200">• Nello studio <span data-word-highlighter-target="word" data-correct="yellow" data-action="click->word-highlighter#toggleHighlight" class="px-1 rounded cursor-pointer">bisogna</span> impegnarsi.</span>
      </div>
    </div>
  </div>

  <!-- Esercizio 2: Sostituisci con forma impersonale -->
  <div class="mb-6 bg-white dark:bg-gray-800 rounded-2xl border-4 border-blue-200 dark:border-blue-700 shadow-2xl p-4 md:p-6" data-controller="fill-blanks">
    <h2 class="font-bold text-gray-700 dark:text-gray-200 mb-4">
      <span class="bg-blue-600 text-white rounded-full w-8 h-8 md:w-10 md:h-10 inline-flex items-center justify-center mr-2">2</span>
      Sostituisci le espressioni sottolineate con un verbo coniugato alla <strong class="underline text-blue-600 dark:text-blue-400">forma impersonale</strong>, come nell'esempio.
    </h2>

    <div class="mb-4 bg-blue-50 dark:bg-blue-900/30 border-2 border-blue-300 dark:border-blue-700 rounded-xl p-3">
      <p class="text-gray-700 dark:text-gray-200"><span class="font-bold text-blue-700 dark:text-blue-400">Nota:</span> Per utilizzare un verbo nella forma impersonale, si mette davanti alla 3ª persona singolare il pronome <strong>si</strong>: si parlava = tutti parlavano, la gente parlava.</p>
    </div>

    <div class="space-y-3">
      <div class="bg-blue-50 dark:bg-blue-900/30 border-2 border-blue-300 dark:border-blue-700 rounded-xl p-3">
        <span class="text-gray-700 dark:text-gray-200">• <u>Tutti dicono</u> che il prossimo inverno sarà molto freddo. → <span class="font-bold text-blue-600 dark:text-blue-400">Si dice che il prossimo inverno sarà molto freddo.</span></span>
      </div>

      <div class="bg-gray-50 dark:bg-gray-800 border-2 border-gray-200 dark:border-gray-700 rounded-xl p-3">
        <span class="text-gray-700 dark:text-gray-200">• Un tempo <u>le persone camminavano</u> di più a piedi.</span>
        <input type="text" class="border-b-2 border-blue-400 dark:border-blue-600 bg-transparent dark:text-white px-2 py-1 focus:outline-none focus:border-blue-600 dark:focus:border-blue-400 w-64" data-fill-blanks-target="input" data-correct-answer="Si camminava" placeholder="">
      </div>

      <div class="bg-gray-50 dark:bg-gray-800 border-2 border-gray-200 dark:border-gray-700 rounded-xl p-3">
        <span class="text-gray-700 dark:text-gray-200">• <u>La gente non rispetta</u> abbastanza la natura.</span>
        <input type="text" class="border-b-2 border-blue-400 dark:border-blue-600 bg-transparent dark:text-white px-2 py-1 focus:outline-none focus:border-blue-600 dark:focus:border-blue-400 w-64" data-fill-blanks-target="input" data-correct-answer="Non si rispetta" placeholder="">
      </div>

      <div class="bg-gray-50 dark:bg-gray-800 border-2 border-gray-200 dark:border-gray-700 rounded-xl p-3">
        <span class="text-gray-700 dark:text-gray-200">• <u>Se uno vuole può</u> fare molto per aiutare gli altri.</span>
        <input type="text" class="border-b-2 border-blue-400 dark:border-blue-600 bg-transparent dark:text-white px-2 py-1 focus:outline-none focus:border-blue-600 dark:focus:border-blue-400 w-64" data-fill-blanks-target="input" data-correct-answer="Se si vuole si può" placeholder="">
      </div>

      <div class="bg-gray-50 dark:bg-gray-800 border-2 border-gray-200 dark:border-gray-700 rounded-xl p-3">
        <span class="text-gray-700 dark:text-gray-200">• Spesso <u>le persone parlano</u> molto senza ascoltare.</span>
        <input type="text" class="border-b-2 border-blue-400 dark:border-blue-600 bg-transparent dark:text-white px-2 py-1 focus:outline-none focus:border-blue-600 dark:focus:border-blue-400 w-64" data-fill-blanks-target="input" data-correct-answer="Spesso si parla" placeholder="">
      </div>
    </div>
  </div>

  <!-- Esercizio 3: Scrivi due frasi -->
  <div class="mb-6 bg-white dark:bg-gray-800 rounded-2xl border-4 border-green-200 dark:border-green-700 shadow-2xl p-4 md:p-6" data-controller="fill-blanks">
    <h2 class="font-bold text-gray-700 dark:text-gray-200 mb-4">
      <span class="bg-green-600 text-white rounded-full w-8 h-8 md:w-10 md:h-10 inline-flex items-center justify-center mr-2">3</span>
      Per ciascun verbo scrivi due frasi, usandolo prima in <strong class="underline text-blue-600 dark:text-blue-400">forma personale</strong>, poi in <strong class="underline text-red-600 dark:text-red-400">forma impersonale</strong>.
    </h2>

    <div class="mb-4 font-semibold text-gray-700 dark:text-gray-200">
      Verbi: <span class="text-green-600 dark:text-green-400">raccontare</span> • <span class="text-green-600 dark:text-green-400">pensare</span>
    </div>

    <div class="space-y-6">
      <div class="bg-green-50 dark:bg-green-900/30 border-2 border-green-300 dark:border-green-700 rounded-xl p-4">
        <div class="mb-3 font-bold text-green-700 dark:text-green-400">Raccontare:</div>
        <div class="space-y-2">
          <div class="flex items-center gap-2">
            <span class="font-bold text-blue-600 dark:text-blue-400">Personale:</span>
            <input type="text" class="flex-1 border-b-2 border-green-400 dark:border-green-600 bg-transparent dark:text-white px-2 py-1 focus:outline-none focus:border-green-600 dark:focus:border-green-400" data-fill-blanks-target="input" data-correct-answer="libera" placeholder="">
          </div>
          <div class="flex items-center gap-2">
            <span class="font-bold text-red-600 dark:text-red-400">Impersonale:</span>
            <input type="text" class="flex-1 border-b-2 border-green-400 dark:border-green-600 bg-transparent dark:text-white px-2 py-1 focus:outline-none focus:border-green-600 dark:focus:border-green-400" data-fill-blanks-target="input" data-correct-answer="libera" placeholder="">
          </div>
        </div>
      </div>

      <div class="bg-green-50 dark:bg-green-900/30 border-2 border-green-300 dark:border-green-700 rounded-xl p-4">
        <div class="mb-3 font-bold text-green-700 dark:text-green-400">Pensare:</div>
        <div class="space-y-2">
          <div class="flex items-center gap-2">
            <span class="font-bold text-blue-600 dark:text-blue-400">Personale:</span>
            <input type="text" class="flex-1 border-b-2 border-green-400 dark:border-green-600 bg-transparent dark:text-white px-2 py-1 focus:outline-none focus:border-green-600 dark:focus:border-green-400" data-fill-blanks-target="input" data-correct-answer="libera" placeholder="">
          </div>
          <div class="flex items-center gap-2">
            <span class="font-bold text-red-600 dark:text-red-400">Impersonale:</span>
            <input type="text" class="flex-1 border-b-2 border-green-400 dark:border-green-600 bg-transparent dark:text-white px-2 py-1 focus:outline-none focus:border-green-600 dark:focus:border-green-400" data-fill-blanks-target="input" data-correct-answer="libera" placeholder="">
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer with reference -->
  <div class="mt-8 text-center">
    <p class="text-red-600 dark:text-red-400 font-bold">Grammatica p. <%= link_to "83", pagina_path("nvl5_gram_p083"), class: "text-red-600 dark:text-red-400 hover:text-red-800 dark:hover:text-red-300 underline font-bold" %></p>
  </div>

  <!-- Exercise controls -->
  <%= render 'shared/exercise_controls' %>
</div>
