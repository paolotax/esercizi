<div class="max-w-6xl mx-auto p-3 md:p-8 bg-gradient-to-br from-cyan-50 via-white to-blue-50 rounded-3xl shadow-xl" data-controller="exercise-checker">

  <%= render 'shared/page_header', pagina: @pagina %>

  <!-- Esercizio 1: Riscrivi le forme verbali ai tempi del modo indicativo -->
  <div class="mb-6 bg-white rounded-2xl border-4 border-yellow-200 shadow-2xl p-4 md:p-6" data-controller="fill-blanks">
    <h2 class="text-lg md:text-xl font-bold text-yellow-700 mb-3">
      <div class="flex items-center gap-2 flex-wrap">
        <div class="flex items-center gap-2">
          <span class="bg-yellow-600 text-white rounded-full w-8 h-8 md:w-10 md:h-10 inline-flex items-center justify-center flex-shrink-0">1</span>
          <span class="bg-yellow-400 text-blue-800 px-2 py-1 rounded text-sm md:text-base font-bold whitespace-nowrap">IMPARARE TUTTI</span>
        </div>
        <span>Riscrivi le forme verbali ai tempi del <span class="text-blue-600 font-bold underline">modo indicativo</span> indicati tra parentesi. Osserva l'esempio.</span>
      </div>
    </h2>

    <div class="space-y-3 text-base md:text-lg">
      <div class="bg-yellow-50 border-2 border-yellow-200 rounded-xl px-3 py-3">
        <div class="flex flex-wrap items-center gap-2">
          <span class="text-gray-700">• Noi partiamo → (pass. remoto)</span>
          <input type="text" class="border-b-2 border-yellow-500 bg-transparent px-2 py-1 focus:outline-none focus:border-yellow-700 w-32" data-fill-blanks-target="input" data-correct-answer="partimmo" placeholder="">
          <span class="text-gray-700">; (trap. remoto)</span>
          <input type="text" class="border-b-2 border-yellow-500 bg-transparent px-2 py-1 focus:outline-none focus:border-yellow-700 w-32" data-fill-blanks-target="input" data-correct-answer="fummo partiti" placeholder="">
        </div>
      </div>

      <div class="bg-yellow-50 border-2 border-yellow-200 rounded-xl px-3 py-3">
        <div class="flex flex-wrap items-center gap-2">
          <span class="text-gray-700">• Io esco → (fut. semplice)</span>
          <input type="text" class="border-b-2 border-yellow-500 bg-transparent px-2 py-1 focus:outline-none focus:border-yellow-700 w-32" data-fill-blanks-target="input" data-correct-answer="uscirò" placeholder="">
          <span class="text-gray-700">; (fut. anteriore)</span>
          <input type="text" class="border-b-2 border-yellow-500 bg-transparent px-2 py-1 focus:outline-none focus:border-yellow-700 w-32" data-fill-blanks-target="input" data-correct-answer="sarò uscito" placeholder="">
        </div>
      </div>

      <div class="bg-yellow-50 border-2 border-yellow-200 rounded-xl px-3 py-3">
        <div class="flex flex-wrap items-center gap-2">
          <span class="text-gray-700">• Tu fai → (imperfetto)</span>
          <input type="text" class="border-b-2 border-yellow-500 bg-transparent px-2 py-1 focus:outline-none focus:border-yellow-700 w-32" data-fill-blanks-target="input" data-correct-answer="facevi" placeholder="">
          <span class="text-gray-700">; (trap. prossimo)</span>
          <input type="text" class="border-b-2 border-yellow-500 bg-transparent px-2 py-1 focus:outline-none focus:border-yellow-700 w-32" data-fill-blanks-target="input" data-correct-answer="avevi fatto" placeholder="">
        </div>
      </div>

      <div class="bg-yellow-50 border-2 border-yellow-200 rounded-xl px-3 py-3">
        <div class="flex flex-wrap items-center gap-2">
          <span class="text-gray-700">• Loro camminano → (pass. remoto)</span>
          <input type="text" class="border-b-2 border-yellow-500 bg-transparent px-2 py-1 focus:outline-none focus:border-yellow-700 w-32" data-fill-blanks-target="input" data-correct-answer="camminarono" placeholder="">
          <span class="text-gray-700">; (imperfetto)</span>
          <input type="text" class="border-b-2 border-yellow-500 bg-transparent px-2 py-1 focus:outline-none focus:border-yellow-700 w-32" data-fill-blanks-target="input" data-correct-answer="camminavano" placeholder="">
        </div>
      </div>
    </div>
  </div>

  <!-- Esercizio 2: Scrivi i verbi al modo congiuntivo nella tabella -->
  <div class="mb-6 bg-white rounded-2xl border-4 border-blue-200 shadow-2xl p-4 md:p-6" data-controller="fill-blanks">
    <h2 class="text-lg md:text-xl font-bold text-blue-700 mb-3">
      <div class="flex items-center gap-2 flex-wrap">
        <span class="bg-blue-600 text-white rounded-full w-8 h-8 md:w-10 md:h-10 inline-flex items-center justify-center flex-shrink-0">2</span>
        <span>Scrivi i verbi al <span class="text-blue-600 font-bold underline">modo congiuntivo</span> al posto giusto nella tabella.</span>
      </div>
    </h2>

    <div class="bg-blue-50 border-2 border-blue-200 rounded-xl px-4 py-3 mb-4 text-sm md:text-base">
      <p class="text-gray-700">che voi ascoltiate • che voi siate partiti • che essi abbiano visto • che tu credessi • che io rida • che noi volessimo • che io fossi guarito • che egli sappia • che loro abbiano creduto • che essi fossero stati • che tu fossi andato • che voi parlaste</p>
    </div>

    <div class="overflow-x-auto">
      <table class="w-full border-collapse border-2 border-blue-300">
        <thead>
          <tr class="bg-blue-100">
            <th class="border-2 border-blue-300 px-3 py-2 text-center text-blue-700 font-bold" colspan="4">MODO CONGIUNTIVO</th>
          </tr>
          <tr class="bg-blue-50">
            <th class="border-2 border-blue-300 px-3 py-2 text-center text-blue-700 font-bold">Presente</th>
            <th class="border-2 border-blue-300 px-3 py-2 text-center text-blue-700 font-bold">Imperfetto</th>
            <th class="border-2 border-blue-300 px-3 py-2 text-center text-blue-700 font-bold">Passato</th>
            <th class="border-2 border-blue-300 px-3 py-2 text-center text-blue-700 font-bold">Trapassato</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="border-2 border-blue-300 px-3 py-2 align-top">
              <input type="text" class="border-b-2 border-blue-500 bg-transparent px-2 py-1 focus:outline-none focus:border-blue-700 w-full mb-2" data-fill-blanks-target="input" data-correct-answer="che voi ascoltiate" placeholder="">
              <input type="text" class="border-b-2 border-blue-500 bg-transparent px-2 py-1 focus:outline-none focus:border-blue-700 w-full mb-2" data-fill-blanks-target="input" data-correct-answer="che io rida" placeholder="">
              <input type="text" class="border-b-2 border-blue-500 bg-transparent px-2 py-1 focus:outline-none focus:border-blue-700 w-full" data-fill-blanks-target="input" data-correct-answer="che egli sappia" placeholder="">
            </td>
            <td class="border-2 border-blue-300 px-3 py-2 align-top">
              <input type="text" class="border-b-2 border-blue-500 bg-transparent px-2 py-1 focus:outline-none focus:border-blue-700 w-full mb-2" data-fill-blanks-target="input" data-correct-answer="che tu credessi" placeholder="">
              <input type="text" class="border-b-2 border-blue-500 bg-transparent px-2 py-1 focus:outline-none focus:border-blue-700 w-full mb-2" data-fill-blanks-target="input" data-correct-answer="che noi volessimo" placeholder="">
              <input type="text" class="border-b-2 border-blue-500 bg-transparent px-2 py-1 focus:outline-none focus:border-blue-700 w-full" data-fill-blanks-target="input" data-correct-answer="che voi parlaste" placeholder="">
            </td>
            <td class="border-2 border-blue-300 px-3 py-2 align-top">
              <input type="text" class="border-b-2 border-blue-500 bg-transparent px-2 py-1 focus:outline-none focus:border-blue-700 w-full mb-2" data-fill-blanks-target="input" data-correct-answer="che voi siate partiti" placeholder="">
              <input type="text" class="border-b-2 border-blue-500 bg-transparent px-2 py-1 focus:outline-none focus:border-blue-700 w-full mb-2" data-fill-blanks-target="input" data-correct-answer="che essi abbiano visto" placeholder="">
              <input type="text" class="border-b-2 border-blue-500 bg-transparent px-2 py-1 focus:outline-none focus:border-blue-700 w-full" data-fill-blanks-target="input" data-correct-answer="che loro abbiano creduto" placeholder="">
            </td>
            <td class="border-2 border-blue-300 px-3 py-2 align-top">
              <input type="text" class="border-b-2 border-blue-500 bg-transparent px-2 py-1 focus:outline-none focus:border-blue-700 w-full mb-2" data-fill-blanks-target="input" data-correct-answer="che io fossi guarito" placeholder="">
              <input type="text" class="border-b-2 border-blue-500 bg-transparent px-2 py-1 focus:outline-none focus:border-blue-700 w-full mb-2" data-fill-blanks-target="input" data-correct-answer="che essi fossero stati" placeholder="">
              <input type="text" class="border-b-2 border-blue-500 bg-transparent px-2 py-1 focus:outline-none focus:border-blue-700 w-full" data-fill-blanks-target="input" data-correct-answer="che tu fossi andato" placeholder="">
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Esercizio 3: Sottolinea la forma verbale corretta -->
  <div class="mb-6 bg-white rounded-2xl border-4 border-green-200 shadow-2xl p-4 md:p-6" data-controller="word-highlighter" data-word-highlighter-multi-color-value="false">
    <h2 class="text-lg md:text-xl font-bold text-green-700 mb-3">
      <div class="flex items-center gap-2 flex-wrap">
        <span class="bg-green-600 text-white rounded-full w-8 h-8 md:w-10 md:h-10 inline-flex items-center justify-center flex-shrink-0">3</span>
        <span>Sottolinea la <span class="text-green-600 font-bold underline">forma verbale corretta</span>.</span>
      </div>
    </h2>

    <!-- Hidden color selector -->
    <div class="hidden">
      <span data-word-highlighter-target="colorBox" data-color="green"></span>
    </div>

    <div class="space-y-3 text-base md:text-lg cursor-pointer">
      <div class="bg-green-50 border-2 border-green-200 rounded-xl px-3 py-3">
        <span class="text-gray-700">• Sarebbe meglio che noi le <span data-word-highlighter-target="word" data-correct="false" data-action="click->word-highlighter#toggleHighlight" class="rounded">crediamo</span> / <span data-word-highlighter-target="word" data-correct="true" data-action="click->word-highlighter#toggleHighlight" class="rounded">credessimo</span>.</span>
      </div>

      <div class="bg-green-50 border-2 border-green-200 rounded-xl px-3 py-3">
        <span class="text-gray-700">• Chiara vuole che io <span data-word-highlighter-target="word" data-correct="true" data-action="click->word-highlighter#toggleHighlight" class="rounded">vada</span> / <span data-word-highlighter-target="word" data-correct="false" data-action="click->word-highlighter#toggleHighlight" class="rounded">vado</span> da lei.</span>
      </div>

      <div class="bg-green-50 border-2 border-green-200 rounded-xl px-3 py-3">
        <span class="text-gray-700">• Se mi <span data-word-highlighter-target="word" data-correct="true" data-action="click->word-highlighter#toggleHighlight" class="rounded">ascoltassi</span> / <span data-word-highlighter-target="word" data-correct="false" data-action="click->word-highlighter#toggleHighlight" class="rounded">ascoltavi</span> lo capiresti.</span>
      </div>

      <div class="bg-green-50 border-2 border-green-200 rounded-xl px-3 py-3">
        <span class="text-gray-700">• Credo che la mamma <span data-word-highlighter-target="word" data-correct="false" data-action="click->word-highlighter#toggleHighlight" class="rounded">è</span> / <span data-word-highlighter-target="word" data-correct="true" data-action="click->word-highlighter#toggleHighlight" class="rounded">sia</span> uscita.</span>
      </div>
    </div>
  </div>

  <!-- Esercizio 4: Coniuga i verbi al tempo opportuno del modo congiuntivo -->
  <div class="mb-6 bg-white rounded-2xl border-4 border-purple-200 shadow-2xl p-4 md:p-6" data-controller="fill-blanks">
    <h2 class="text-lg md:text-xl font-bold text-purple-700 mb-3">
      <div class="flex items-center gap-2 flex-wrap">
        <span class="bg-purple-600 text-white rounded-full w-8 h-8 md:w-10 md:h-10 inline-flex items-center justify-center flex-shrink-0">4</span>
        <span>Coniuga i verbi al tempo opportuno del <span class="text-purple-600 font-bold underline">modo congiuntivo</span> e indica quale <span class="text-purple-600 font-bold underline">tempo</span> hai usato.</span>
      </div>
    </h2>

    <div class="space-y-3 text-base md:text-lg">
      <div class="bg-purple-50 border-2 border-purple-200 rounded-xl px-3 py-3">
        <div class="flex flex-wrap items-center gap-2 mb-2">
          <span class="text-gray-700">• La mamma voleva che io (uscire)</span>
          <input type="text" class="border-b-2 border-purple-500 bg-transparent px-2 py-1 focus:outline-none focus:border-purple-700 w-32" data-fill-blanks-target="input" data-correct-answer="uscissi" placeholder="">
          <span class="text-gray-700">con lei.</span>
        </div>
        <div class="flex flex-wrap items-center gap-2">
          <span class="text-gray-700 font-bold underline">TEMPO:</span>
          <input type="text" class="border-b-2 border-purple-500 bg-transparent px-2 py-1 focus:outline-none focus:border-purple-700 w-48" data-fill-blanks-target="input" data-correct-answer="imperfetto|congiuntivo imperfetto" placeholder="">
        </div>
      </div>

      <div class="bg-purple-50 border-2 border-purple-200 rounded-xl px-3 py-3">
        <div class="flex flex-wrap items-center gap-2 mb-2">
          <span class="text-gray-700">• Spero che tu (essere)</span>
          <input type="text" class="border-b-2 border-purple-500 bg-transparent px-2 py-1 focus:outline-none focus:border-purple-700 w-32" data-fill-blanks-target="input" data-correct-answer="sia" placeholder="">
          <span class="text-gray-700">guarito.</span>
        </div>
        <div class="flex flex-wrap items-center gap-2">
          <span class="text-gray-700 font-bold underline">TEMPO:</span>
          <input type="text" class="border-b-2 border-purple-500 bg-transparent px-2 py-1 focus:outline-none focus:border-purple-700 w-48" data-fill-blanks-target="input" data-correct-answer="passato|congiuntivo passato" placeholder="">
        </div>
      </div>

      <div class="bg-purple-50 border-2 border-purple-200 rounded-xl px-3 py-3">
        <div class="flex flex-wrap items-center gap-2 mb-2">
          <span class="text-gray-700">• Laura pensava che ci (essere)</span>
          <input type="text" class="border-b-2 border-purple-500 bg-transparent px-2 py-1 focus:outline-none focus:border-purple-700 w-32" data-fill-blanks-target="input" data-correct-answer="fosse" placeholder="">
          <span class="text-gray-700">poco vento per far volare l'aquilone.</span>
        </div>
        <div class="flex flex-wrap items-center gap-2">
          <span class="text-gray-700 font-bold underline">TEMPO:</span>
          <input type="text" class="border-b-2 border-purple-500 bg-transparent px-2 py-1 focus:outline-none focus:border-purple-700 w-48" data-fill-blanks-target="input" data-correct-answer="imperfetto|congiuntivo imperfetto" placeholder="">
        </div>
      </div>
    </div>
  </div>

  <div class="text-right text-sm text-gray-500 mb-6">
    Grammatica pp. <%= link_to "68", pagina_path("nvl5_gram_p068"), class: "text-red-600 hover:text-red-800 underline font-bold" %>, <%= link_to "69", pagina_path("nvl5_gram_p069"), class: "text-red-600 hover:text-red-800 underline font-bold" %>, <%= link_to "70", pagina_path("nvl5_gram_p070"), class: "text-red-600 hover:text-red-800 underline font-bold" %>
  </div>

  <!-- Exercise Controls -->
  <div class="mt-6">
    <%= render 'shared/exercise_controls', color: 'cyan', current_page: 'nvl5_gram_p165' %>
  </div>
</div>
