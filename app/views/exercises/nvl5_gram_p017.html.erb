<div class="max-w-6xl mx-auto p-3 md:p-8 bg-white rounded-lg shadow-lg" data-controller="exercise-checker">

  <%= render 'shared/page_header', pagina: @pagina %>

  <!-- Info Box -->
  <div class="mb-3 md:mb-4 bg-yellow-100 rounded-lg p-4 md:p-6 text-base md:text-lg leading-relaxed">
    <p class="text-gray-800 mb-0">
      Il <strong class="text-red-600">troncamento</strong> è la caduta della vocale o della sillaba finale di una parola davanti a un'altra che inizia per vocale.
      In caso di troncamento <strong class="text-red-600">non</strong> si mette l'apostrofo.
    </p>
  </div>

  <!-- Lista esempi -->
  <div class="mb-6 md:mb-8 bg-white rounded-lg p-4 md:p-6 text-base md:text-lg leading-relaxed">
    <p class="text-gray-800 mb-2">Si usa il troncamento:</p>
    <ul class="space-y-1">
      <li class="flex items-start">
        <span class="text-red-600 font-bold text-2xl mr-2">•</span>
        <span class="text-gray-800">con l'articolo <strong class="text-red-600">uno</strong> <span class="text-red-600">→</span> <strong class="text-red-600">un</strong> albero;</span>
      </li>
      <li class="flex items-start">
        <span class="text-red-600 font-bold text-2xl mr-2">•</span>
        <span class="text-gray-800">con <strong class="text-red-600">quale</strong> <span class="text-red-600">→</span> <strong class="text-red-600">qual</strong> è.</span>
      </li>
    </ul>
    <p class="text-gray-800 mb-2 mt-3">Il troncamento può avvenire anche davanti a parole che iniziano per consonante:</p>
    <ul class="space-y-1">
      <li class="flex items-start">
        <span class="text-red-600 font-bold text-2xl mr-2">•</span>
        <span class="text-gray-800">con <strong class="text-red-600">nessuno</strong>, <strong class="text-red-600">alcuno</strong>, <strong class="text-red-600">ciascuno</strong> <span class="text-red-600">→</span> <strong class="text-red-600">nessun</strong> dubbio, <strong class="text-red-600">alcun</strong> problema;</span>
      </li>
      <li class="flex items-start">
        <span class="text-red-600 font-bold text-2xl mr-2">•</span>
        <span class="text-gray-800">con <strong class="text-red-600">quello</strong>, <strong class="text-red-600">bello</strong>, <strong class="text-red-600">buono</strong> <span class="text-red-600">→</span> <strong class="text-red-600">quel</strong> foglio, <strong class="text-red-600">bel</strong> pensiero, <strong class="text-red-600">buon</strong> Capodanno;</span>
      </li>
      <li class="flex items-start">
        <span class="text-red-600 font-bold text-2xl mr-2">•</span>
        <span class="text-gray-800">con <strong class="text-red-600">signore</strong>, <strong class="text-red-600">professore</strong>, <strong class="text-red-600">dottore</strong>, <strong class="text-red-600">santo</strong> <span class="text-red-600">→</span> <strong class="text-red-600">signor</strong> Morelli, <strong class="text-red-600">professor</strong> Longhi, <strong class="text-red-600">san</strong> Francesco.</span>
      </li>
    </ul>
  </div>

  <!-- Exercise 1 -->
  <div class="mb-6 md:mb-8 bg-white rounded-lg p-4 md:p-6 border-4 border-yellow-400" data-controller="word-highlighter" data-word-highlighter-multi-color-value="false">
    <h2 class="text-lg md:text-xl font-bold text-gray-800 mb-4">
      <span class="bg-blue-800 text-white rounded-full w-8 h-8 md:w-10 md:h-10 inline-flex items-center justify-center mr-2">1</span>
      <span class="bg-yellow-400 text-blue-800 px-2 py-1 rounded text-sm md:text-base font-bold">IMPARARE TUTTI</span>
      Cerchia le <strong class="text-red-600">parole troncate</strong>, come nell'esempio.
    </h2>

    <!-- Hidden color selector for monocolor mode -->
    <div class="hidden">
      <span data-word-highlighter-target="colorBox" data-color="red"></span>
    </div>

    <div class="space-y-1 cursor-pointer sm:ml-7">
      <% exercise_1_items = [
        {
          words: [
            { text: "Tommy", correct: false },
            { text: " ", correct: false },
            { text: "soggiornerà", correct: false },
            { text: " ", correct: false },
            { text: "in", correct: false },
            { text: " ", correct: false },
            { text: "un", correct: true },
            { text: " ", correct: false },
            { text: "albergo", correct: false },
            { text: ".", correct: false }
          ]
        },
        {
          words: [
            { text: "La", correct: false },
            { text: " ", correct: false },
            { text: "porta", correct: false },
            { text: " ", correct: false },
            { text: "non", correct: false },
            { text: " ", correct: false },
            { text: "s'apre", correct: false },
            { text: ",", correct: false },
            { text: " ", correct: false },
            { text: "in", correct: false },
            { text: " ", correct: false },
            { text: "nessun", correct: true },
            { text: " ", correct: false },
            { text: "modo", correct: false },
            { text: ".", correct: false }
          ]
        },
        {
          words: [
            { text: "Tanti", correct: false },
            { text: " ", correct: false },
            { text: "auguri", correct: false },
            { text: " ", correct: false },
            { text: "di", correct: false },
            { text: " ", correct: false },
            { text: "buon", correct: true },
            { text: " ", correct: false },
            { text: "compleanno", correct: false },
            { text: "!", correct: false }
          ]
        },
        {
          words: [
            { text: "Qual", correct: true },
            { text: " ", correct: false },
            { text: "è", correct: false },
            { text: " ", correct: false },
            { text: "il", correct: false },
            { text: " ", correct: false },
            { text: "tuo", correct: false },
            { text: " ", correct: false },
            { text: "gioco", correct: false },
            { text: " ", correct: false },
            { text: "di", correct: false },
            { text: " ", correct: false },
            { text: "squadra", correct: false },
            { text: " ", correct: false },
            { text: "preferito", correct: false },
            { text: "?", correct: false }
          ]
        }
      ] %>

      <% exercise_1_items.each do |item| %>
        <div class="rounded-lg px-4 py-2 bg-gray-50">
          <p class="text-base md:text-lg text-gray-800">
            <span class="text-cyan-700 font-bold text-2xl mr-2">•</span>
            <% item[:words].each do |word| %>
              <% if word[:text].strip.empty? || word[:text] == " " %>
                <%= word[:text] %>
              <% else %>
                <span data-word-highlighter-target="word"
                      data-correct="<%= word[:correct] %>"
                      data-action="click->word-highlighter#toggleHighlight"
                      class="px-1 rounded"><%= word[:text] %></span>
              <% end %>
            <% end %>
          </p>
        </div>
      <% end %>
    </div>
  </div>

  <!-- Exercise 2 -->
  <div class="mb-6 md:mb-8 grid grid-cols-1 md:grid-cols-3 gap-4">
    <div class="md:col-span-2 bg-white rounded-lg p-4 md:p-6" data-controller="fill-blanks">
      <h2 class="text-lg md:text-xl font-bold text-gray-800 mb-4">
        <span class="bg-pink-600 text-white rounded-full w-8 h-8 md:w-10 md:h-10 inline-flex items-center justify-center mr-2">2</span>
        Scrivi inserendo l'<strong class="text-cyan-700">elisione</strong> o il <strong class="text-red-600">troncamento</strong>.
      </h2>

      <div class="space-y-4 text-base md:text-lg sm:ml-7">
      <% exercise_2_pairs = [
        { prompt: "buono amico", answer: "buon amico" },
        { prompt: "buona amica", answer: "buon'amica" },
        { prompt: "nessuna atleta", answer: "nessun'atleta" },
        { prompt: "nessuno atleta", answer: "nessun atleta" }
      ] %>

      <% exercise_2_pairs.each do |item| %>
        <div class="px-3 py-1 rounded-lg flex flex-wrap items-center gap-2">
          <span class="text-gray-700"><span class="text-cyan-700 font-bold text-2xl mr-2">•</span> <%= item[:prompt] %> <span class="text-cyan-700">→</span></span>
          <input type="text"
                 class="border-b-2 border-pink-500 bg-white w-48 md:w-64 text-center focus:outline-none focus:border-pink-700"
                 data-fill-blanks-target="input"
                 data-answer="<%= item[:answer] %>"
                 data-correct-answer="<%= item[:answer] %>"
                 maxlength="20">
        </div>
      <% end %>
      </div>
    </div>
    <div class="bg-blue-200 rounded-lg p-4 md:p-6 text-base md:text-lg">
      <p class="text-blue-800">
        Gli aggettivi <strong class="text-red-600">buono</strong> / <strong class="text-red-600">buona</strong> e <strong class="text-red-600">nessuno</strong> / <strong class="text-red-600">nessuna</strong> si comportano come <strong class="text-red-600">un</strong> (maschile) e <strong class="text-red-600">un'</strong> (femminile).
      </p>
    </div>
  </div>

  <!-- Exercise 3 -->
  <div class="mb-6 md:mb-8 grid grid-cols-1 md:grid-cols-3 gap-4">
    <div class="md:col-span-2 bg-white rounded-lg p-4 md:p-6" data-controller="fill-blanks">
      <h2 class="text-lg md:text-xl font-bold text-gray-800 mb-4">
        <span class="bg-pink-600 text-white rounded-full w-8 h-8 md:w-10 md:h-10 inline-flex items-center justify-center mr-2">3</span>
        Tronca le parole tra parentesi, come nell'esempio.
      </h2>

      <div class="space-y-4 text-base md:text-lg leading-relaxed sm:ml-7">
      <p><span class="text-cyan-700 font-bold text-2xl mr-2">•</span> (Vai) <span class="font-bold text-red-600">Va'</span> dove ti porta il cuore, ma (fai)
        <input type="text"
               class="border-b-2 border-pink-500 bg-white w-16 md:w-20 text-center focus:outline-none focus:border-pink-700"
               data-fill-blanks-target="input"
               data-answer="fa'"
               data-correct-answer="fa'"
               maxlength="3">
        attenzione a tutto.
      </p>

      <p><span class="text-cyan-700 font-bold text-2xl mr-2">•</span> (Dai)
        <input type="text"
               class="border-b-2 border-pink-500 bg-white w-16 md:w-20 text-center focus:outline-none focus:border-pink-700"
               data-fill-blanks-target="input"
               data-answer="da'"
               data-correct-answer="da'"
               maxlength="3">
        ciò che hai con generosità, ma tieni per te un (poco)
        <input type="text"
               class="border-b-2 border-pink-500 bg-white w-16 md:w-20 text-center focus:outline-none focus:border-pink-700"
               data-fill-blanks-target="input"
               data-answer="po'"
               data-correct-answer="po'"
               maxlength="3">
        di denaro.
      </p>
      </div>
    </div>
    <div class="bg-blue-200 rounded-lg p-4 md:p-6 text-base md:text-lg">
      <p class="text-blue-800 mb-3">Il troncamento richiede l'<strong class="text-red-600">apostrofo</strong>:</p>
      <ul class="space-y-1">
        <li class="flex items-start">
          <span class="text-red-600 font-bold text-2xl mr-2">•</span>
          <span class="text-blue-800">nei verbi all'imperativo: dai <span class="text-red-600">→</span> <strong class="text-red-600">da'</strong>, dici <span class="text-red-600">→</span> <strong class="text-red-600">di'</strong>; vai <span class="text-red-600">→</span> <strong class="text-red-600">va'</strong>, fai <span class="text-red-600">→</span> <strong class="text-red-600">fa'</strong>;</span>
        </li>
        <li class="flex items-start">
          <span class="text-red-600 font-bold text-2xl mr-2">•</span>
          <span class="text-blue-800">nell'avverbio poco: un poco <span class="text-red-600">→</span> un <strong class="text-red-600">po'</strong>.</span>
        </li>
      </ul>
    </div>
  </div>

  <!-- Exercise Controls -->
  <%= render 'shared/exercise_controls', color: 'pink', current_page: 'nvl5_gram_p017' %>
</div>

