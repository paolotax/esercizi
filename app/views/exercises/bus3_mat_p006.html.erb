<% content_for :titolo, "#{@pagina.titolo} - #{@pagina.numero}" %>

<div class="max-w-7xl mx-auto p-3 md:p-6 bg-gradient-to-b from-cyan-50 to-white" data-controller="exercise-checker page-viewer" data-page-viewer-image-url-value="<%= asset_path('bus3_mat/p006/page.png') %>">
  <!-- Header -->
  <%= render 'shared/page_header', pagina: @pagina %>

  <!-- Teoria -->
  <div class="bg-blue-100 p-4 md:p-6 mb-8 border-l-4 border-blue-500">
    <p class="text-base md:text-lg text-gray-700 mb-3">
      Il nostro sistema di numerazione è decimale perché per contare formiamo gruppi di 10 elementi, cioè contiamo in <strong class="underline">base 10</strong>.
    </p>
    <p class="text-base md:text-lg text-gray-700">
      Un gruppo di <strong class="underline">10 elementi</strong> forma <strong class="underline">1 decina</strong>.
    </p>
  </div>

  <!-- Esercizio 1: Raggruppa in base 10 queste biglie -->
  <div class="bg-transparent p-4 md:p-8 mb-8" data-controller="fill-blanks auto-advance">
    <div class="flex items-start gap-3 mb-6">
      <div class="bg-red-500 text-white rounded-full w-8 h-8 flex items-center justify-center font-bold flex-shrink-0">
        1
      </div>
      <p class="text-base md:text-lg text-gray-700">
        Raggruppa in base 10 queste biglie.
      </p>
    </div>

    <!-- Immagine biglie -->
    <div class="mb-6 flex justify-center">
      <%= image_tag "bus3_mat/p006/output-1743504902006_670_342_312_183.png",
          alt: "Biglie da raggruppare",
          class: "max-w-md" %>
    </div>

    <div class="space-y-4">
      <div class="flex items-center gap-3">
        <span class="text-lg font-bold">• Quante decine hai formato?</span>
        <input type="text" data-fill-blanks-target="input" data-correct-answer="1"
               class="w-16 px-3 py-2 border-2 border-blue-400 rounded text-center font-bold text-lg"
               maxlength="1" inputmode="numeric">
      </div>

      <div class="flex items-center gap-3">
        <span class="text-lg font-bold">• Quante sono le unità, cioè le biglie non raggruppate?</span>
        <input type="text" data-fill-blanks-target="input" data-correct-answer="2"
               class="w-16 px-3 py-2 border-2 border-blue-400 rounded text-center font-bold text-lg"
               maxlength="1" inputmode="numeric">
      </div>
    </div>

    <!-- Spiegazione visiva -->
    <div class="mt-8 bg-white p-6 rounded-lg border-2 border-blue-300">
      <p class="text-gray-700 mb-4">Puoi rappresentare le biglie anche così:</p>

      <div class="flex items-center justify-center gap-4 flex-wrap">
        <div class="text-center">
          <%= image_tag "bus3_mat/p006/output-1743504902006_136_556_215_48.png", class: "mb-2" %>
          <p class="font-bold">1 <span class="underline">decina</span> → 1 <span class="underline">da</span></p>
        </div>

        <span class="text-2xl font-bold">+</span>

        <div class="text-center">
          <%= image_tag "bus3_mat/p006/output-1743504902006_446_555_86_45.png", class: "mb-2" %>
          <p class="font-bold">2 <span class="underline">unità</span> → 2 <span class="underline">u</span></p>
        </div>

        <span class="text-2xl font-bold">=</span>
        <span class="text-3xl font-bold text-blue-600">12</span>
      </div>
    </div>
  </div>

  <!-- Esercizi 2 e 3 in 2 colonne -->
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">

    <!-- Esercizio 2: Scrivi il numero (griglie) -->
    <div class="bg-transparent p-4 md:p-8" data-controller="fill-blanks auto-advance">
      <div class="flex items-start gap-3 mb-6">
        <div class="bg-red-500 text-white rounded-full w-8 h-8 flex items-center justify-center font-bold flex-shrink-0">
          2
        </div>
        <p class="text-base md:text-lg text-gray-700">
          Scrivi il numero.
        </p>
      </div>

      <div class="space-y-6">
        <!-- Prima griglia -->
        <div class="flex items-center gap-4">
          <%= image_tag "bus3_mat/p006/output-1743504902006_99_877_180_137.png", class: "w-32" %>
          <span class="text-2xl font-bold">→</span>
          <div class="flex gap-2">
            <div class="text-center">
              <p class="font-bold mb-2">da</p>
              <input type="text" data-fill-blanks-target="input" data-correct-answer="7"
                     class="w-16 px-2 py-2 border-2 border-red-400 rounded text-center font-bold text-lg"
                     maxlength="1" inputmode="numeric">
            </div>
            <div class="text-center">
              <p class="font-bold mb-2">u</p>
              <input type="text" data-fill-blanks-target="input" data-correct-answer="7"
                     class="w-16 px-2 py-2 border-2 border-blue-400 rounded text-center font-bold text-lg"
                     maxlength="1" inputmode="numeric">
            </div>
          </div>
        </div>

        <!-- Seconda griglia -->
        <div class="flex items-center gap-4">
          <%= image_tag "bus3_mat/p006/output-1743504902006_97_1025_225_138.png", class: "w-32" %>
          <span class="text-2xl font-bold">→</span>
          <div class="flex gap-2">
            <div class="text-center">
              <p class="font-bold mb-2">da</p>
              <input type="text" data-fill-blanks-target="input" data-correct-answer="9"
                     class="w-16 px-2 py-2 border-2 border-red-400 rounded text-center font-bold text-lg"
                     maxlength="1" inputmode="numeric">
            </div>
            <div class="text-center">
              <p class="font-bold mb-2">u</p>
              <input type="text" data-fill-blanks-target="input" data-correct-answer="9"
                     class="w-16 px-2 py-2 border-2 border-blue-400 rounded text-center font-bold text-lg"
                     maxlength="1" inputmode="numeric">
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Esercizio 3: Scrivi il numero (abachi) -->
    <div class="bg-transparent p-4 md:p-8" data-controller="fill-blanks auto-advance">
      <div class="flex items-start gap-3 mb-6">
        <div class="bg-red-500 text-white rounded-full w-8 h-8 flex items-center justify-center font-bold flex-shrink-0">
          3
        </div>
        <p class="text-base md:text-lg text-gray-700">
          Scrivi il numero.
        </p>
      </div>

      <!-- Immagine abachi -->
      <div class="mb-4">
        <%= image_tag "bus3_mat/p006/p06_2.jpg",
            alt: "Abachi con numeri",
            class: "w-full max-w-lg mx-auto" %>
      </div>

      <!-- Grid input per i 6 abachi -->
      <div class="grid grid-cols-2 sm:grid-cols-3 gap-4">
        <%
          # Numeri corrispondenti agli abachi nell'immagine (da verificare)
          abaci_numbers = [
            [1, 1], # 11
            [3, 4], # 34
            [3, 0], # 30
            [0, 4], # 04
            [5, 0], # 50
            [0, 0]  # 00
          ]

          abaci_numbers.each do |da, u|
        %>
          <div class="flex gap-2 justify-center">
            <div class="text-center">
              <p class="font-bold mb-2 text-sm">da</p>
              <input type="text" data-fill-blanks-target="input" data-correct-answer="<%= da %>"
                     class="w-12 px-2 py-2 border-2 border-red-400 rounded text-center font-bold"
                     maxlength="1" inputmode="numeric">
            </div>
            <div class="text-center">
              <p class="font-bold mb-2 text-sm">u</p>
              <input type="text" data-fill-blanks-target="input" data-correct-answer="<%= u %>"
                     class="w-12 px-2 py-2 border-2 border-blue-400 rounded text-center font-bold"
                     maxlength="1" inputmode="numeric">
            </div>
          </div>
        <% end %>
      </div>
    </div>

  </div>

  <!-- Footer con controlli -->
  <%= render 'shared/exercise_controls', color: 'cyan' %>
</div>
