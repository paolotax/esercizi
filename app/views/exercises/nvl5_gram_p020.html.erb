<div class="max-w-7xl mx-auto p-3 md:p-8 bg-white rounded-lg shadow-lg" data-controller="exercise-checker">

  <%= render 'shared/page_header', pagina: @pagina %>

  <!-- Exercise 1 -->
  <div class="bg-prasparent p-4 md:p-6 mb-6 md:mb-8 ">
    <h2 class="text-lg md:text-xl font-bold mb-4 flex items-center gap-2">
      <span class="bg-<%= @pagina.base_color %>-500 text-white rounded-full w-8 h-8 md:w-10 md:h-10 inline-flex items-center justify-center">1</span>
      Sottolinea le parole scritte correttamente, poi correggi quelle sbagliate.
    </h2>

    <div class="grid grid-cols-1 md:grid-cols-4 xl:grid-cols-4 gap-4 mb-6">
      
      <% correct_words = %w[culla cinque liquefare acquaragia acquedotto soqquadro cura quadretto cospicuo inquinato quaranta] %>
      <% all_words = [
        "risquotere", "acquaragia", "tacquino", "acquedotto",
        "culla", "cinque", "liquefare", "quoco",
        "aqquolina", "soqquadro", "cura", "quadretto",
        "aqquario", "cospicuo", "inquinato", "quaranta"
      ] %>

      <% all_words.each do |word| %>
        <div>
          <label class="flex items-center gap-3 bg-white border-2 border-transparent rounded-lg px-3 py-2 hover:border-purple-400 transition"
                  data-controller="exercise-group"
                  data-exercise-group-target="option"
                  data-correct="<%= correct_words.include?(word) %>">
            <input type="checkbox"
                    class="w-5 h-5 text-purple-600 focus:ring-purple-500"
                    data-correct-answer="<%= correct_words.include?(word) %>">
            <span class="text-gray-800 font-medium"><%= word %></span>
            <span class="hidden" data-exercise-group-target="checkmark">✅</span>
          </label>
        </div>
      <% end %>

    </div>



    <div class="p-4">
      <p class="text-base md:text-lg text-gray-600 mb-3">Scrivi correttamente le parole sbagliate.</p>
      <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-3" data-controller="fill-blanks">
        <% corrections = {
          "risquotere" => "riscuotere",
          "tacquino" => "taccuino",
          "quoco" => "cuoco",
          "aqquolina" => "acquolina",
          "aqquario" => "acquario"
        } %>
        <% corrections.each do |wrong, right| %>
          <label class="flex flex-col px-3 py-2">
            
            <input type="text"
                   class="border-b-2 border-dotted border-<%= @pagina.base_color %>-500 bg-white text-center focus:outline-none focus:border-<%= @pagina.base_color %>-700 text-base md:text-lg"
                   data-fill-blanks-target="input"
                   data-answer="<%= right %>"
                   data-correct-answer="<%= right %>"
                   maxlength="15">
          </label>
        <% end %>
      </div>
    </div>
  </div>

  <!-- Exercise 2 -->
  <div class="bg-trasparent p-4 md:p-6 mb-6 md:mb-8 ">
    <h2 class="text-lg md:text-xl font-bold mb-4 flex items-center gap-2">
      <span class="bg-<%= @pagina.base_color %>-500 text-white rounded-full w-8 h-8 md:w-10 md:h-10 inline-flex items-center justify-center">2</span>
      Cerchia la forma corretta.
    </h2>
    
    <div class="space-y-4 text-base md:text-lg" data-controller="word-choice">
      <% sentences = [
        { parts: ["Il papà di Livio è ", ["usciere", "uscere"], " in un grande albergo."], correct: ["uscere"] },
        { parts: ["Preferisco i libri di ", ["fantascienza", "fantascenza"], " alle biografie."], correct: ["fantascienza"] },
        { parts: ["Attraversa sulle ", ["striscie", "strisce"], " pedonali."], correct: ["strisce"] },
        { parts: ["La mamma di Rosy è laureata in ", ["ingenieria", "ingegneria"], "."], correct: ["ingegneria"] },
        { parts: ["Malala è un vero ", ["genio", "gegno"], " dell’informatica."], correct: ["genio"] },
        { parts: ["Ho macchiato la ", ["tovalia", "tovaglia"], " con l’", ["olio", "oglio"], "."], correct: ["tovaglia", "olio"] },
        { parts: ["Sono caduto e mi sono slogato la ", ["cavilia", "caviglia"], "."], correct: ["caviglia"] },
        { parts: ["La ", ["ciera", "cera"], " si scioglie piano piano."], correct: ["cera"] },
        { parts: ["Anna è partita per una ", ["crociera", "crocera"], " e ha portato il suo ", ["caniolino", "cagnolino"], "."], correct: ["crociera", "cagnolino"] },
        { parts: ["La ", ["legna", "lenia"], " non è ", ["sufficiente", "sufficente"], " per tutto l’inverno."], correct: ["legna", "sufficiente"] }
      ] %>

      <% sentences.each_with_index do |sentence, index| %>
        <div class="p-3">
          <p class="leading-relaxed">
            <% group_counter = 0 %>
            <% sentence[:parts].each do |part| %>
              <% if part.is_a?(Array) %>
                <% group_id = "s#{index}_g#{group_counter}" %>
                <% correct = sentence[:correct][group_counter] %>
                <% part.each_with_index do |option, option_idx| %>
                  <span class="px-1 py-0.5 rounded cursor-pointer hover:bg-purple-100 transition"
                        data-word-choice-target="word"
                        data-group="<%= group_id %>"
                        data-correct="<%= option == correct %>"
                        data-action="click->word-choice#select"><%= option %></span><% if option_idx < part.length - 1 %><span class="text-purple-400"> / </span><% end %>
                <% end %>
                <% group_counter += 1 %>
              <% else %>
                <%= part %>
              <% end %>
            <% end %>
          </p>
        </div>
      <% end %>
    </div>
  </div>

  <!-- Exercise 3 -->
  <div class="bg-trasparent p-4 md:p-6 mb-6 md:mb-8 " data-controller="fill-blanks">
    <h2 class="text-lg md:text-xl font-bold mb-4 flex items-center gap-2">
      <span class="bg-<%= @pagina.base_color %>-500 text-white rounded-full w-8 h-8 md:w-10 md:h-10 inline-flex items-center justify-center">3</span>
      Completa coniugando i verbi tra parentesi.
    </h2>

    <div class="space-y-4 text-base md:text-lg">
      <% verbs = [
        { text: ["Noi (bagnare) ", { answer: "bagniamo" }, " i fiori, voi occupatevi delle piante." ] },
        { text: ["Voglio che (spegnere) ", { answer: "spegniate" }, " voi le candeline sulla torta." ] },
        { text: ["La nonna mi (insegnare) ", { answer: "insegna" }, " a fare il pane." ] },
        { text: ["Voi portate i regali e noi li (consegnare) ", { answer: "consegniamo" }, " ai bambini." ] },
        { text: ["Maurizia (disegnare) ", { answer: "disegna" }, " molto bene gli animali." ] },
        { text: ["Roberta ricorda sempre ciò che (sognare) ", { answer: "sogna" }, "." ] }
      ] %>

      <% verbs.each do |item| %>
        <p class="blex flex-wrap items-center gap-1 leading-relaxed">
          <% item[:text].each do |piece| %>
            <% if piece.is_a?(Hash) %>
              <input type="text"
                     class="border-b-2 border-purple-500 bg-white w-24 md:w-28 text-center focus:outline-none focus:border-purple-700"
                     data-fill-blanks-target="input"
                     data-answer="<%= piece[:answer] %>"
                     data-correct-answer="<%= piece[:answer] %>"
                     maxlength="12">
            <% else %>
              <span><%= piece %></span>
            <% end %>
          <% end %>
        </p>
      <% end %>
    </div>
  </div>

  <!-- Exercise 4 -->
  <div class="bg-trasparent p-4 md:p-6 mb-6 md:mb-8 ">
    <h2 class="text-lg md:text-xl font-bold mb-4 flex items-center gap-2">
      <span class="bg-<%= @pagina.base_color %>-500 text-white rounded-full w-8 h-8 md:w-10 md:h-10 inline-flex items-center justify-center">4</span>
      Indica con una <span class="text-red-500">X</span> la forma corretta.
    </h2>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-base md:text-lg">
      <% options_groups = [
        { title: "Parole con C/G", choices: [
          { text: "Le rocce liscie", correct: false },
          { text: "Le rocce lisce", correct: true },
          { text: "Le roccie liscie", correct: false }
        ]},
        { title: "Plurale di camicia", choices: [
          { text: "Le camice fradice", correct: false },
          { text: "Le camicie fradice", correct: true },
          { text: "Le camice fradicie", correct: false }
        ]},
        { title: "Colore degli strumenti", choices: [
          { text: "Le bilance grige", correct: false },
          { text: "Le bilancie grigie", correct: false },
          { text: "Le bilance grigie", correct: true }
        ]},
        { title: "Plurale di arancia", choices: [
          { text: "Le arance marce", correct: true },
          { text: "Le arancie marce", correct: false },
          { text: "Le arancie marcie", correct: false }
        ]}
      ] %>

      <% options_groups.each_with_index do |group, idx| %>
        <div class="p-4 space-y-3" data-controller="exercise-group">
          <% group[:choices].each_with_index do |choice, choice_idx| %>
            <label class="flex items-center gap-3 bg-<%= @pagina.base_color %>-50 border-2 border-<%= @pagina.base_color %>-200 rounded-lg px-3 py-2 hover:border-<%= @pagina.base_color %>-400 transition"
                   data-exercise-group-target="option"
                   data-correct="<%= choice[:correct] %>">
              <input type="checkbox"
                     class="w-5 h-5 text-<%= @pagina.base_color %>-600 focus:ring-<%= @pagina.base_color %>-500"
                     data-correct-answer="<%= choice[:correct] %>">
              <span class="text-gray-800"><%= choice[:text] %></span>
              <span class="hidden" data-exercise-group-target="checkmark">✅</span>
            </label>
          <% end %>
        </div>
      <% end %>
    </div>
  </div>

  <!-- Exercise Controls -->
  <%= render 'shared/exercise_controls' %>
</div>

