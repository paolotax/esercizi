<%= turbo_frame_tag "operation_properties" do %>
  <div class="space-y-6">
    <!-- Titolo operazione -->
    <div class="bg-red-50 p-4 rounded-lg">
      <h4 class="text-lg font-semibold text-red-900 mb-2">
        <svg class="w-5 h-5 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12H4"></path>
        </svg>
        Sottrazione
      </h4>
      <p class="text-sm text-red-700">Configura le proprietà della sottrazione</p>
    </div>

    <%= form_with url: update_operation_dashboard_esercizio_path(@esercizio, operation_id: operation['id']),
                  method: :patch,
                  local: false,
                  data: { turbo_frame: "_top" },
                  class: "space-y-4" do |form| %>

      <!-- Campo titolo -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">
          Titolo/Descrizione (opzionale)
        </label>
        <input type="text"
               name="config[title]"
               value="<%= operation['config']['title'] || "" %>"
               placeholder="Es: Sottrazione con prestito, Differenza tra numeri..."
               class="w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:border-red-500 focus:outline-none">
        <p class="mt-1 text-xs text-gray-500">
          Questo titolo verrà visualizzato sopra l'operazione
        </p>
      </div>

      <!-- Textarea per i valori -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">
          Inserisci le sottrazioni
        </label>
        <textarea name="config[operation_text]"
                  rows="4"
                  placeholder="Esempi:&#10;500 - 123&#10;1000 - 456&#10;250 - 75&#10;&#10;Separa più operazioni con invio o virgola"
                  class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-red-500 focus:outline-none font-mono text-sm"><%= operation['config']['operation_text'] || "" %></textarea>
        <p class="mt-1 text-xs text-gray-500">
          <strong>Suggerimento:</strong> Puoi inserire più operazioni separate da:
          <br>• A capo (invio)
          <br>• Virgola (,)
          <br>• Punto e virgola (;)
        </p>
      </div>

      <!-- Opzioni di visualizzazione -->
      <div class="p-4 bg-gray-50 rounded-lg">
        <p class="text-sm font-semibold text-gray-700 mb-3">Opzioni:</p>
        <div class="grid grid-cols-1 gap-3">

          <label class="flex items-center gap-2 cursor-pointer">
            <input type="checkbox"
                   name="config[show_toolbar]"
                   value="true"
                   <%= 'checked' if operation['config']['show_toolbar'] != false %>
                   class="w-4 h-4 text-red-600 rounded focus:ring-red-500">
            <span class="text-sm text-gray-700">Mostra barra strumenti</span>
          </label>

          <label class="flex items-center gap-2 cursor-pointer">
            <input type="checkbox"
                   name="config[show_borrow]"
                   value="true"
                   <%= 'checked' if operation['config']['show_borrow'] != false %>
                   class="w-4 h-4 text-red-600 rounded focus:ring-red-500">
            <span class="text-sm text-gray-700">Mostra celle per i prestiti</span>
          </label>

          <label class="flex items-center gap-2 cursor-pointer">
            <input type="checkbox"
                   name="config[show_addends]"
                   value="true"
                   <%= 'checked' if operation['config']['show_addends'] == true %>
                   class="w-4 h-4 text-red-600 rounded focus:ring-red-500">
            <span class="text-sm text-gray-700">Mostra minuendo e sottraendo</span>
          </label>

          <label class="flex items-center gap-2 cursor-pointer">
            <input type="checkbox"
                   name="config[show_solution]"
                   value="true"
                   <%= 'checked' if operation['config']['show_solution'] == true %>
                   class="w-4 h-4 text-red-600 rounded focus:ring-red-500">
            <span class="text-sm text-gray-700">Mostra risultato</span>
          </label>
        </div>
      </div>

      <!-- Pulsanti azione -->
      <div class="flex gap-3 pt-4">
        <button type="submit"
                class="flex-1 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition">
          Salva Modifiche
        </button>
        <button type="button"
                data-action="click->properties-panel#close"
                class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition">
          Annulla
        </button>
      </div>
    <% end %>

    <!-- Elimina operazione -->
    <div class="pt-4 border-t">
      <%= button_to "Elimina Operazione",
                    remove_operation_dashboard_esercizio_path(@esercizio),
                    method: :delete,
                    params: { operation_id: operation['id'] },
                    data: {
                      turbo_frame: "_top",
                      turbo_confirm: "Sei sicuro di voler eliminare questa operazione?"
                    },
                    class: "w-full px-4 py-2 bg-red-50 text-red-600 rounded-lg hover:bg-red-100 transition" %>
    </div>
  </div>
<% end %>