<%= turbo_frame_tag "operation_properties" do %>
  <div class="space-y-6">
    <!-- Titolo operazione -->
    <div class="bg-purple-50 p-4 rounded-lg">
      <h4 class="text-lg font-semibold text-purple-900 mb-2">
        <svg class="w-5 h-5 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"></path>
        </svg>
        Configurazione Abaco
      </h4>
      <p class="text-sm text-purple-700">Inserisci i valori per l'abaco</p>
    </div>

    <%= form_with url: update_operation_dashboard_esercizio_path(@esercizio, operation_id: operation['id']),
                  method: :patch,
                  local: false,
                  data: { turbo_frame: "_top" },
                  class: "space-y-4" do |form| %>

      <!-- Campo titolo -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">
          Titolo/Descrizione (opzionale)
        </label>
        <input type="text"
               name="config[title]"
               value="<%= operation['config']['title'] || "" %>"
               placeholder="Es: Rappresenta sull'abaco, Componi il numero..."
               class="w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:border-purple-500 focus:outline-none">
        <p class="mt-1 text-xs text-gray-500">
          Questo titolo verrà visualizzato sopra l'abaco
        </p>
      </div>

      <!-- Textarea per i valori -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">
          Inserisci i numeri per l'abaco
        </label>
        <textarea name="config[operation_text]"
                  rows="4"
                  placeholder="Esempi:&#10;123&#10;456&#10;789&#10;1234&#10;&#10;Separa più numeri con invio o virgola"
                  class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-purple-500 focus:outline-none font-mono text-sm"><%= operation['config']['operation_text'] || "" %></textarea>
        <p class="mt-1 text-xs text-gray-500">
          <strong>Suggerimento:</strong> Puoi inserire più numeri separati da:
          <br>• A capo (invio)
          <br>• Virgola (,)
          <br>• Punto e virgola (;)
        </p>
      </div>

      <!-- Palline per colonna -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">
          Palline per Colonna
        </label>
        <input type="number"
               name="config[max_per_column]"
               value="<%= operation['config']['max_per_column'] || 9 %>"
               min="5"
               max="10"
               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500">
        <p class="mt-1 text-xs text-gray-500">Numero massimo di palline per ogni colonna (standard: 9)</p>
      </div>

      <!-- Opzioni di visualizzazione -->
      <div class="p-4 bg-gray-50 rounded-lg">
        <p class="text-sm font-semibold text-gray-700 mb-3">Opzioni:</p>
        <div class="grid grid-cols-1 gap-3">
          <label class="flex items-center gap-2 cursor-pointer">
            <input type="checkbox"
                   name="config[show_thousands]"
                   value="true"
                   <%= 'checked' if operation['config']['show_thousands'] == true %>
                   class="w-4 h-4 text-purple-600 rounded focus:ring-purple-500">
            <span class="text-sm text-gray-700">Mostra migliaia</span>
          </label>

          <label class="flex items-center gap-2 cursor-pointer">
            <input type="checkbox"
                   name="config[show_hundreds]"
                   value="true"
                   <%= 'checked' if operation['config']['show_hundreds'] != false %>
                   class="w-4 h-4 text-purple-600 rounded focus:ring-purple-500">
            <span class="text-sm text-gray-700">Mostra centinaia</span>
          </label>

          <label class="flex items-center gap-2 cursor-pointer">
            <input type="checkbox"
                   name="config[show_value]"
                   value="true"
                   <%= 'checked' if operation['config']['show_value'] == true %>
                   class="w-4 h-4 text-purple-600 rounded focus:ring-purple-500">
            <span class="text-sm text-gray-700">Mostra valore numerico</span>
          </label>

          <label class="flex items-center gap-2 cursor-pointer">
            <input type="checkbox"
                   name="config[editable]"
                   value="true"
                   <%= 'checked' if operation['config']['editable'] != false %>
                   class="w-4 h-4 text-purple-600 rounded focus:ring-purple-500">
            <span class="text-sm text-gray-700">Permetti modifica interattiva</span>
          </label>

          <label class="flex items-center gap-2 cursor-pointer">
            <input type="checkbox"
                   name="config[disable_auto_zeros]"
                   value="true"
                   <%= 'checked' if operation['config']['disable_auto_zeros'] == true %>
                   class="w-4 h-4 text-purple-600 rounded focus:ring-purple-500">
            <span class="text-sm text-gray-700">Disabilita zeri automatici</span>
          </label>
        </div>
      </div>

      <!-- Pulsanti azione -->
      <div class="flex gap-3 pt-4">
        <button type="submit"
                class="flex-1 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition">
          Salva Modifiche
        </button>
        <button type="button"
                data-action="click->properties-panel#close"
                class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition">
          Annulla
        </button>
      </div>
    <% end %>

    <!-- Elimina operazione -->
    <div class="pt-4 border-t">
      <%= button_to "Elimina Operazione",
                    remove_operation_dashboard_esercizio_path(@esercizio),
                    method: :delete,
                    params: { operation_id: operation['id'] },
                    data: {
                      turbo_frame: "_top",
                      turbo_confirm: "Sei sicuro di voler eliminare questa operazione?"
                    },
                    class: "w-full px-4 py-2 bg-red-50 text-red-600 rounded-lg hover:bg-red-100 transition" %>
    </div>
  </div>
<% end %>